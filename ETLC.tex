% Comandi d'intestazione, formato pagina, lingua
\documentclass[12pt,a4paper]{book}
\usepackage[latin1]{inputenc}
\usepackage[italian]{babel}
% Formato pagina "truccato"
\usepackage[left=2cm,right=2cm,top=2.5cm,bottom=2.5cm]{geometry}
% Colonne
\usepackage{multicol}
% Numerelli nel tondino (Wingdings®-style)
\usepackage{pifont}

\usepackage{comment}

% Personalizzazioni dei parametri LaTeX (formato titoli...). Sono spostati più in su rispetto allo standard, lo preferisco così
\usepackage[font={small,it}]{caption}
%~ Titoli dei capitoli più in sù
\makeatletter
% "\@makechapterhead" applies to ordinary or numbered chapters
\patchcmd{\@makechapterhead}{\vspace*{50\p@}}{}{}{}
\patchcmd{\@makechapterhead}{\vskip 40\p@}{\vskip 20\p@}{}{}
% "\@makeschapterhead" applies to "starred" or un-numbered chapters
\patchcmd{\@makeschapterhead}{\vspace*{50\p@}}{}{}{}
\patchcmd{\@makeschapterhead}{\vskip 40\p@}{\vskip 20\p@}{}{}
\makeatother

%Non porre le immagini sotto le note a piè di pagina
\usepackage[bottom]{footmisc}

%%% Pacchetti per l'ambiente matematico:
% pacchetto standard, fonts extra, simboli extra
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
% Frazioni inline in stile ¼
\usepackage{nicefrac}
% Formule sbarrate (semplificazioni)
\usepackage[makeroom]{cancel}
% corsivo (es. L di trasformata di Laplace, l di lunghezza)
\usepackage{mathrsfs}
% Roba bellina tipo il dcases
\usepackage{mathtools}
%% Un po' di comandi truccati per far prima a scrivere
% Parte reale
\renewcommand{\Re}[1]{\operatorname{\mathfrak{Re}} \left\lbrace #1 \right\rbrace}
\newcommand{\Real}{\operatorname{\mathfrak{Re}}}
% Parte immaginaria
\renewcommand{\Im}{\operatorname{\mathfrak{Im}}}
% Parallelo fra resistenze
\renewcommand{\parallel}{\mathbin{/\mkern-5mu/}}
% Modulo di un complesso
\newcommand{\Mod}[1]{\left|#1\right|}
\newcommand{\n}{\nonumber\\}
\newcommand{\inline}[1]{$\displaystyle #1$}

%%% Pacchetti di grafica
\usepackage{graphicx}
\usepackage{wrapfig}
\usepackage{floatflt}
\usepackage[american]{circuitikz}

% Watermark (rimovibile dopo la bozza)
%\usepackage{draftwatermark}
%\SetWatermarkText{\textbf{BOZZA}}
%\SetWatermarkScale{6}
%\SetWatermarkColor[gray]{.9}

% Link dall'indice (e agli url)
\usepackage[hidelinks]{hyperref}

% Burocrazie per il PDF e la copertina
\title{Appunti di Elettronica per le Telecomunicazioni}
\author{
	Giulio Fieramosca\\Jacopo Belli}

\begin{document}
% Interlinee personalizzate
\setlength{\parindent}{0cm}
\setlength{\parskip}{0.5em}

\frontmatter

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
%                        PAGINA FRONTALE                        %
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %

\begin{titlepage}
	\begingroup % Create the command for including the title page in the document
	\newlength{\drop} % Command for generating a specific amount of whitespace
	\drop=0.05\textheight % Define the command as 10% of the total text height
	
	\rule{\textwidth}{1pt}\par % Thick horizontal line
	\vspace{2pt}\vspace{-\baselineskip} % Whitespace between lines
	\rule{\textwidth}{0.4pt}\par % Thin horizontal line
	
	\vspace{\drop} % Whitespace between the top lines and title
	\centering % Center all text
	{\Huge\makeatletter\@title\makeatother}\\[0.5\baselineskip] % Title line 1
	{\Large A.A. 2016/2017}% Title line 2
	%~ {\Huge \LaTeX ~Templates}} % Title line 3
	
	\vspace{\drop} % Whitespace between the title and short horizontal line
	\rule{0.3\textwidth}{0.4pt}\par % Short horizontal line under the title
	\vspace{\drop} % Whitespace between the thin horizontal line and the author name
	
	{\Large \makeatletter\@author\makeatother} % Author name
	
	\vfill % Whitespace between the author name and publisher text
	
	%\centering{\includegraphics[width=\textwidth]{}}
	
	\vfill
	
	\rule{\textwidth}{0.4pt}\par % Thin horizontal line
	\vspace{2pt}\vspace{-\baselineskip} % Whitespace between lines
	\rule{\textwidth}{1pt}\par % Thick horizontal line
	
	\endgroup
	\clearpage
\end{titlepage}

% Seconda di copertina

\textbf{Dispensa redatta (testo ed alcune immagini) a partire da:}
\begin{itemize}
\item appunti delle lezioni del prof. Bruno Neri;
\item dispensa ``Appunti dalle lezioni di
Elettronica per le Radiofrequenze", a cura di Ing. M. Mincica e Ing. A. Fonte;
\item slides del corso di ``Elettronica delle Telecomunicazioni" del prof. F. Pieri;
\item slides dell'Università del Kansas (\url{http://www.ittc.ku.edu/~jstiles/723/handouts/Wilkinson%20Divider%20Even%20and%20Odd%20Mode%20Analysis.pdf})
\item ``Microwave Engineering" - D. Pozar
\end{itemize}

\textbf{Immagini} realizzate con Digikey\textsuperscript{\textregistered{}} Scheme-It\textsuperscript{\textregistered{}} ed Inkscape

\textbf{Impaginazione} in \LaTeX

\textbf{Achtung!} Questa roba è in fase di revisione. \textbf{Non} la dispensa ufficiale del corso, \textbf{non} è documento rilasciato dal professore, \textbf{non} è un libro.
\\
Usa a tuo rischio e pericolo.

Se tu volessi contribuire al miglioramento di queste dispense, trovi i sorgenti qui:\\
\url{https://github.com/giuliof/Dispense-ETLC}\\
\url{https://box.glgprograms.it/UNIPI-Elet/ELE-TLC/}.

\textbf{Ultima revisione} \today.

% Indice (generato automaticamente)
%\setcounter{tocdepth}{5}
\tableofcontents

% prefazione, introduzione

\chapter{Introduzione}
L'obiettivo del Corso di Elettronica per le Telecomunicazioni è l'analisi e la sintesi del cosiddetto \textit{front-end radio}, ossia tutta la parte di un sistema di radiocomunicazione che opera in ``alta frequenza''.
\\
I sistemi radio operano in un intervallo di frequenze molto esteso, che può andare dalle decine di kHz (per la comunicazione radiotelevisiva) fino ai GHz (per le comunicazioni WiFi) ed oltre. Tradizionalmente ognuna di queste decadi ha un proprio nome, riportato in figura \ref{fig:lunghezzedonda}.

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.7\linewidth]{img/raster/lunghezzedonda}
	\caption{}
	\label{fig:lunghezzedonda}
\end{figure}


Come è noto la frequenza $f$ e la lunghezza d'onda $\lambda$ sono legate dalla relazione $f=\frac{c}{\lambda}$, dove c è la velocità della luce nel mezzo di propagazione del fenomeno. Con il termine \textit{microonde} si va ad identificare quella gamma di frequenze la cui lunghezza d'onda diventa comparabile con quella dei componenti in uso.
Considerando onde che viaggiano nel vuoto ($v = 3\cdot10^8~ \nicefrac{m}{s}$), otteniamo che a 300 MHz corrispondono onde con $\lambda = 1m$. Siccome fino agli anni 60 le dimensioni tipiche dei circuiti e dei componenti elettronici erano di qualche centimetro, si parlava di microonde già per frequenze superiori a 500MHz. Al giorno d'oggi le dimensioni dei dispositivi si sono molto ridotte, fino all'ordine del $\mu m$ per dispositivi integrati, e si comincia a parlare di microonde con frequenze superiori ad alcuni GHz.

L'applicazione dei sistemi di radiocomunicazione è il trasferimento di un'informazione a distanza senza fili. L'informazione, nella sua accezione più generale, è rappresentata da una grandezza fisica $s(t)$ che varia in funzione del tempo. Tale grandezza, prima di essere trasmessa a distanza mediante le onde elettromagnetiche, deve subire una serie di elaborazioni che la rendono idonea alla trasmissione. Innanzi tutto è necessario trasformare la grandezza fisica in un segnale elettrico, funzione assolta dal blocco denominato trasduttore.

Tipicamente il segnale elettrico $e(t)$ in banda base è contenuto in un range frequenziale che va da da qualche Hz a qualche MHz. Un segnale a queste frequenze non è adatto ad essere trasmesso a distanza in quanto sarebbero necessarie antenne di dimensioni paragonabili o maggiori alla lunghezza d'onda e quindi di diverse decine di metri. Il segnale elettrico deve essere dunque traslato a frequenze maggiori attraverso una combinazione con un segnale a radiofrequenza, operazione effettuata da un sottosistema denominato modulatore. Prima di arrivare all'antenna che trasmetterà il segnale modulato è necessario amplificarlo adeguatamente. A seconda delle applicazioni il segnale trasmesso avrà una potenza che potrà variare da poche decine di milliWatt fino a diverse centinaia di kiloWatt ed oltre. 

\begin{figure}[hb]
	\centering
	\includegraphics[width=0.7\linewidth]{img/schema-tlc-tx}
	\caption{}
	\label{fig:schema-tlc-tx}
\end{figure}

Il segnale trasmesso raggiunge il ricevitore con una potenza molto inferiore a quella di trasmissione a causa dell'attenuazione geometrica e delle perdite nel mezzo di trasmissione. In alcuni casi il segnale ricevuto avrà una potenza di poche decine di femtoWatt: tanto basta ad ottenere una ricezione intelligibile, ovvero ad essere in grado di ricostruire l'informazione trasmessa con una probabilità di errore accettabile.

L'antenna si presenta come un generatore di segnale con una impedenza interna, che va a pilotare uno stadio di amplificazione.
Il primo blocco attivo in ricezione è perciò un amplificatore a radiofrequenza a basso rumore.
Il segnale amplificato, che è ancora un segnale \textit{in alta frequenza}, è adesso sufficientemente robusto da essere elaborato dal blocco successivo che ha la funzione di riportarlo in banda-base (eventualmente dopo una o più traslazioni in basso in frequenza). Questa operazione avviene
all'interno del demodulatore.

Dopo un'elaborazione in banda-base il segnale può esser eventualmente riportato nella forma della
grandezza di origine.

\begin{figure}[hb]
	\centering
	\includegraphics[width=0.7\linewidth]{img/schema-tlc-rx}
	\caption{}
	\label{fig:schema-tlc-rx}
\end{figure}

\mainmatter

	\chapter{LNA a parametri Y}
	
	\begin{multicols}{3}
		\includegraphics[width=\linewidth]{img/quadripolo}
		Quadripolo: generico sistema a quattro terminali;
		\columnbreak
		
		\includegraphics[width=\linewidth]{img/2porte}
		Circuito 2-porte: quadripolo per cui sussistono le relazioni $I_1 = -I_4$ e $I_2 = -I_3$. Di solito una coppia di terminali sono l'ingresso e l'altra l'uscita;
		\columnbreak
		
		\includegraphics[width=0.9\linewidth]{img/LNA-tripolo}
		Tripolo: caso particolare di 2-porte dove ingresso e uscita hanno un terminale a comune.
	\end{multicols}
	
	Si può dimostrare che un circuito 2 porte è caratterizzabile e schematizzabile tramite 4 parametri. Note le caratteristiche secondo un set di parametri è (quasi) sempre possibile passare ad un altro.
	
	\begin{multicols}{2}
		$$\begin{cases}
		V_1 = Z_I I_1 + Z_R I_2\\
		V_2 = Z_F I_1 + Z_O I_2\\		
		\end{cases}
		~~ \mbox{Parametri Z}$$
		
		$$\begin{cases}
		I_1 = Y_I V_1 + Y_R V_2\\
		I_2 = Y_F V_1 + Y_O V_2\\		
		\end{cases}
		~~ \mbox{Parametri Y}$$
		
		$$\begin{cases}
		V_1 = h_I I_1 + h_R V_2\\
		I_2 = h_F I_1 + h_O V_2\\		
		\end{cases}
		~~ \mbox{Parametri h}$$
		
		$$\begin{cases}
		b_1 = s_{11} a_1 + s_{12} a_2\\
		b_2 = s_{21} a_1 + s_{22} a_2\\		
		\end{cases}
		~~ \mbox{Parametri S}$$
	\end{multicols}
	
	La scelta dei parametri da usare si fa sia in base alle modalità
	operative di misura, che possono risultare più o meno \textit{comode} a seconda della frequenza di lavoro, sia in base alle potenzialità messe a disposizione del progettista da ciascun set di parametri.
	
	Ad esempio, i parametri Z sono misurati lasciando i terminali aperti, mentre i parametri Y chiudendoli in corto circuito.\\
	Un circuito aperto in bassa frequenza è facilmente ottenibile tagliando un filo di connessione o una pista, ma i due monconi a distanza limitata tra loro rappresentano una capacità, ovvero una reattanza, che ad alte frequenze fa si che i due fili non possono più essere considerati un circuito aperto:
	$$ 1pF ~ @ ~ 1GHz \mbox{ costituisce una reattanza pari a }
	\frac{1}{2 \pi \cdot 1pF \cdot 1Ghz} \simeq 160 \Omega
	$$
	Lo stesso vale per un circuito chiuso: una pista o un tratto di filo possono introdurre un'induttanza di pochi nanoHenry:
	$$ 1nH ~ @ ~ 1GHz \mbox{ costituisce una reattanza pari a }
	2 \pi \cdot 1nH \cdot 1Ghz \simeq 6.28 \Omega
	$$
	
	I parametri usuali dell'elettronica di base introducono in alta frequenza errori di misura non trascurabili, difatti negli ultimi anni si è preferito il set di parametri S, utilizzati estensivamente nel campo delle microonde.
	Poiché sono di uso non immediato, si preferirà utilizzare inizialmente il set di parametri Y che presenta maggiore somiglianza con i set di parametri utilizzati in corsi precedenti (come i parametri h e Z).
	
	\paragraph{Relazione tra ammettenza e impedenza}
	Non è superfluo ricordare che l'ammettenza $Z$ è un numero complesso formato da una parte reale, la resistenza $R$, e una immaginaria, la reattenza $X$. Risulta:
	\[Z = R + jX\]
    Il reciproco dell'impedenza è detto ammettenza. La componente G è la conduttanza mentre B è la suscettanza:
	
	\[Y = \frac{1}{Z} = \frac{1}{R+jX} = \frac{R-jX}{R^2+X^2} = \frac{R}{R^2 + X^2} -j \frac{X}{R^2 + X^2} = G - jB\]
	
	\section{Circuito equivalente a parametri Y}
	
	\begin{figure}[h!]
		\centering
		\includegraphics[width=0.5\linewidth]{img/parametriY}
		\caption{}
	\end{figure}

	\begin{multicols}{2}
		$$
		Y_I = \left. \frac{I_1}{V_1} \right|_{V_2=0}
		~~~
		\mbox{Ammettenza di ingresso}
		$$
		
		$$
		Y_O = \left. \frac{I_2}{V_2} \right|_{V_1=0}
		~~~
		\mbox{Ammettenza di uscita}
		$$
		
		$$
		Y_F = \left. \frac{I_2}{V_1} \right|_{V_2=0}
		~~~
		\mbox{Transconduttanza forward}
		$$
		
		$$
		Y_R = \left. \frac{I_1}{V_2} \right|_{V_1=0}
		~~~
		\mbox{Transconduttanza reverse}
		$$
	\end{multicols}


	\subsubsection*{\textit{esempio} attenuatore}

	\begin{multicols}{2}
		\includegraphics[width=\linewidth]{img/attenuatore}
		
		Nota: la rete è simmetrica
		
		$$Y_I = \nicefrac{1}{Z_I} =
		\frac{1}{R_S + \frac{R_S R_P}{R_S+R_P}} = Y_O$$
		
		$$Y_F = -
		\frac{R_P}{R_S^2 + 2 R_S R_P} = Y_R$$
	\end{multicols}

	\subsubsection*{\textit{esempio} circuito equivalente del FET}
	\begin{minipage}{0.5\linewidth}
		\includegraphics[width=0.9\linewidth]{img/circuitoFET}
	\end{minipage}
	\begin{minipage}{0.5\linewidth}
$$
Y_I = 0
$$
$$
Y_F = g_m
$$
$$
Y_R = 0
$$
$$
Y_O = \nicefrac{1}{Z_0}
$$
	\end{minipage}
	
	\subsection{Proprietà di quadripoli a parametri Y}\label{sec:quadripoli-parallelo}
	Due quadripoli collegati in parallelo e caratterizzati dalle proprie matrici di parametri Y, hanno una	matrice Y complessiva data dalla somma delle due singole.
	
	\begin{minipage}{.5\linewidth}
		\centering
		\includegraphics[width=0.8\linewidth]{img/quadripolo-parallelo}
	\end{minipage}
	\begin{minipage}{.5\linewidth}
	\begin{align*}
	\begin{cases}
	I_{1_A} = Y_{I_A} V_{1_A}+ Y_{R_A}V_{2_A}\\
	I_{2_A} = Y_{F_A} V_{1_A}+ Y_{O_A}V_{2_A}
	\end{cases}\\\\
	\begin{cases}
	I_{1_B} = Y_{I_B} V_{1_B}+ Y_{R_B}V_{2_B}\\
	I_{2_B} = Y_{F_B} V_{1_B}+ Y_{O_B}V_{2_B}
	\end{cases}\\
	\end{align*}
	\end{minipage}
	
	Poiché sono in parallelo, $V_{1_A} = V_{1_B} = V_1$ e analogamente per $V_2$. Applicando la legge dei nodi al quadripolo complessivo si ha $I_1 = I_{1_A}+I_{1_B}$ e $I_2 = I_{2_A}+I_{2_B}$.
	\[
	\begin{cases}
	I_1 = (Y_{I_A} + Y_{I_B}) V_1 + (Y_{R_A}+Y_{R_B})V_2\\
	I_2 = (Y_{F_A} + Y_{F_B}) V_1 + (Y_{O_A}+Y_{O_B})V_2\\
	\end{cases}
	\]
	
	Come esempio di applicazione di quanto appena visto, poniamo il quadripolo B come una impedenza in reazione. Questo quadripolo è caratterizzato dalla seguente matrice Y.
	
	\begin{minipage}{.5\linewidth}
		\centering
		\includegraphics[width=0.4\linewidth]{img/quadripolo-parallelo-impedenza-1}
	\end{minipage}
	\begin{minipage}{.5\linewidth}
		\[
		\left(
		\begin{array}{cc}
		Y_X & -Y_X\\
		-Y_X& Y_X
		\end{array}
		\right)
		\]
	\end{minipage}
	
	\vspace{1em} %aggiustamento estetico fatto abbrutto
	
	\begin{minipage}{.5\linewidth}
		\centering
		\includegraphics[width=0.6\linewidth]{img/quadripolo-parallelo-impedenza-2}
	\end{minipage}
	\begin{minipage}{.5\linewidth}
		Dunque i parametri Y del quadripolo complessivo saranno:
		\[
		\left(
		\begin{array}{cc}
		Y_I +Y_X & Y_R -Y_X\\
		Y_F -Y_X & Y_O +Y_X
		\end{array}
		\right)
		\]
	\end{minipage}
	
	
	\section{Guadagni e definizioni}
	
	\paragraph{Rete reciproca:} una rete due porte è reciproca quando, posto un generatore di tensione sulla porta 1 e misurata la corrente sulla porta 2, questa risulta pari alla corrente misurata scambiando le porte. Di conseguenza le matrici Z ed Y sono simmetriche (i termini incrociati coincidono). Le reti con soli componenti passivi sono usualmente reciproche.
	\paragraph{Rete simmetrica:} un due porte è simmetrico quando l'impedenza d'ingresso è uguale a quella di uscita; in altri termini, lo stesso generatore di prova posto sulla porta 1 o sulla porta 2 è attraversato da pari corrente. Di conseguenza nelle matrici Z o Y i termini 11 sono uguali ai 22.
	
	\begin{figure}[hb]
		\centering
		\includegraphics[width=0.7\linewidth]{img/2porte-analisi}
		\caption{mettere correnti}
		\label{fig:2porte-analisi}
	\end{figure}
	
	
	\paragraph{Guadagno di tensione} $A_V = \frac{V_2}{V_1}$
	
	$$V_2 = -\frac{Y_F}{Y_O + Y_L} V_1
	~~ \Rightarrow ~~
	A_V = -\frac{Y_F}{Y_O + Y_L}$$
	
	\paragraph{Ammettenza di ingresso} $Y_{IN} = \frac{I_1}{V_1}$
	
	$$I_1 = Y_I V_1 + Y_R V_2=
	Y_I V_1 - \frac{Y_F Y_R}{Y_O + Y_L} V_1
	~~ \Rightarrow ~~
	Y_{IN} = Y_I - \frac{Y_F Y_R}{Y_O + Y_L}$$
	
	Se il due porte è unilaterale ($Y_R = 0$) $Y_{IN}$ coincide con $Y_I$ (l'ammettenza di ingresso non dipende dal carico).
	
    \paragraph{Ammettenza di uscita} $Y_{OUT} = \frac{I_2}{V_2}$
        
    Si ripetono analoghi calcoli alla porta di uscita:
	\[Y_{OUT} = Y_O - \frac{Y_F Y_R}{Y_I + Y_S}\]
	
	Si noti che sia $Y_{OUT}$ che $Y_{IN}$ dipendono rispettivamente da $Y_S$ e $Y_L$. Ne consegue che, a una variazione dell'ammettenza di carico (o di sorgente), si ha una variazione anche nell'ammettenza di ingresso (o uscita).
        
	\paragraph{Guadagno operativo di potenza} $G_P = \frac{P_{L}}{P_{IN}}$
	
	Dove $P_L = \frac{V_{2_m}^2}{2}g_L$ e $P_{IN} = \frac{V_{1_m}^2}{2} g_{IN}$ sono rispettivamente la potenza dissipata sul carico e la potenza erogata dal generatore in ingresso\footnote{Questo perché, schematizzando l'uscita del quadripolo con l'equivalente Norton, la tensione $V_2$ è applicata ai capi di $Y_L$. In caso di carico puramente resistivo è chiaro che $g_L = \nicefrac{1}{R_L}$}.
	
	
	
	\paragraph{Guadagno di potenza disponibile} $G_A = \frac{P_{A_{OUT}}}{P_{A_{IN}}}$
	
	$P_{A_{OUT}}$ e $P_{A_{IN}}$ sono, rispettivamente, le potenze disponibili in uscita e in ingresso.
	Si definisce potenza disponibile $P_A$ la massima potenza che un generatore può erogare su un carico opportunamente scelto.
	
	Ipotizzando di avere un generatore con impedenza interna $Z_S = R_S + jX_S$ che pilota un carico $Z_L = R_L + jX_L$ si può dimostrare che, se $R_S > 0$\footnote{Se invece si ha $R_S < 0$, scegliendo un carico $Z_L = - Z_S$ si realizzerebbe una maglia a impedenza nulla, dunque si avrebbe potenza erogata dal generatore $\rightarrow \infty$.}, la condizione di massimo trasferimento di potenza si ha con adattamento complesso coniugato ($Z_L = Z^*_S$).\\
	
	Applicando quanto detto al quadripolo, schematizzato con circuito equivalente di Thevenin, possiamo calcolarne la potenza disponibile in ingresso\footnote{Questa volta, avendo schematizzato l'ingresso con equivalente Thevenin, è più comodo lavorare con la corrente che scorre nella serie $Z_S$ e $Z_{IN}$.}:
	
	$$\begin{aligned}
	&I_{S_m} = \frac{V_{S_m}}{|Z_{IN} + Z_S|} \overset{Z_{IN} = Z_{S}^*}{=} \frac{V_{S_m}}{|R_{IN} + jX_{IN} + R_{IN} - jX_{IN}|} = \frac{V_{S_m}}{2R_{IN}}\\
	&P_{A_{IN}} = \frac{1}{2} \Re{Z_{IN}} I_{S_m}^2 =
	\frac{1}{2} R_{S} \frac{V_{S_m}^2}{4R_{S}^2} =
	\frac{V_{S_m}^2}{8 R_S}
	\end{aligned}$$
	
	Si procede analogamente per la potenza disponibile in uscita. Ricapitolando:
	$$\mbox{Potenza disponibile di sorgente: }
	P_{A_{IN}} = \frac{V_{S_m}^2}{8 R_S}$$
	$$\mbox{Potenza disponibile di uscita: }
	P_{A_{OUT}} = \frac{V_{OUT_m}^2}{8 R_L}$$
    Realizzare l'adattamento complesso coniugato in ingresso e uscita non è, in genere, un'operazione banale. Immaginiamo di adattare un quadripolo partendo dalla resistenza di sorgente. Si adatta la $Y_S$ facendo vedere alla porta di ingresso $Y_S'=Y_{IN}^*$. Si passa poi ad adattare la $Y_L$, inserendo sul carico una resistenza $Y_L' = Y_{OUT}^*$. Quest'ultima operazione, come visto nel calcolo di $Y_{IN}$ e $Y_{OUT}$, altera l'ammettenza di ingresso, quindi non c'è più adattamento sulla porta 1. Si redige nuovamente l'adattamento con $Y_S''=Y_{IN}^*$, ma questo altera $Y_{OUT}$ e così via. Vedremo in seguito che queste iterazioni avranno una convergenza solo in determinati casi. In generale, quindi, il $G_A$ è un guadagno virtuale, in certi casi impossibile da raggiungere.
        
	\paragraph{Guadagno di trasduttore} $G_T = \frac{P_{L}}{P_{A_{IN}}}$
	
	Questo tipo di guadagno è molto usato per la progettazione in radiofrequenza, dove sono note la potenza disponibile del \textit{sensore} (che solitamente è l'antenna) con cui si interfaccia l'amplificatore, e quanta potenza effettiva deve essere erogata al carico (che potrebbero essere gli altoparlanti).
	
	\subparagraph{Espressioni dei guadagni}
	A partire dal guadagno di tensione e dalla definizione di guadagno operativo di potenza, è facile ricavare l'espressione di quest'ultimo:
	$$G_P = \frac{V_{2_m}^2}{2} g_L \cdot \frac{2}{V_{1_m}^2 g_{IN}} = \frac{|Y_F|^2}{|Y_L + Y_O|^2} ~ \frac{g_L}{g_{IN}}$$
	
	Si noti che $G_P$ è funzione della sola impedenza di carico.
	
	Discutiamo il segno di $G_P$:
	\begin{itemize}
		\item $P_L$ solitamente è positivo perché si fa riferimento a carichi passivi (quindi $g_L > 0$);
		\item $P_{IN}$ può anche essere negativo (flusso di potenza uscente) se $g_{IN}<0$;
		\item [$\Rightarrow$] $G_P$ ha lo stesso segno di $g_{IN}$
	\end{itemize}

	Con opportune elaborazioni, a partire dalle definizioni possiamo calcolare anche il guadagno di potenza disponibile e quello di trasduttore. Si ottiene:
        \[G_A = \frac{|Y_F|^2 ~ g_S}{\Re{ (Y_O Y_S + Y_O Y_I - Y_R Y_F)(Y_I + Y_S)^*}}\]
        Si noti che $G_A$ è funzione solo dell'impedenza di sorgente.
        
	\begin{equation}
	G_T = \frac{4 g_S g_L |Y_F|^2}{|(Y_S + Y_I) (Y_O + Y_L) - Y_R Y_F)|^2}
	\label{eq:gt-yparam}
	\end{equation}
    Questo guadagno è funzione sia dell'impedenza di sorgente che di carico: dei tre è senza dubbio il guadagno più significativo per lo studio degli LNA.
    \\Data l'espressione del guadagno di trasduttore si può ricavare il \textbf{guadagno di potenza unilateralizzato}, un parametro di bontà dell'amplificatore ottenuto rendendo unilaterale la rete ($Y_R = 0$) e massimizzando il $G_T$. Dalla precedente equazione \ref{eq:gt-yparam} si ha
	\[G_{T_{UI}} = \frac{4 g_S g_L |Y_F|^2}{|(Y_S + Y_I) (Y_O + Y_L)|^2}\]
	
	Essendo unilaterale, vale
	$\begin{cases} Y_{IN} = Y_I \\
	Y_{OUT} = Y_O \end{cases}$	ed il massimo trasferimento di potenza si ha per
	$\begin{cases}
	Y_S = Y_I^* &
	\rightarrow
	Y_S + Y_I = g_S - jb_I + g_I + jb_I = 2g_I
	\\
	Y_L = Y_O^* &
	\rightarrow
	Y_O + Y_L = g_O + jb_O + g_L - jb_L = 2g_O\end{cases}$.
	Sostituendo, si ottiene:
	
	$$G_{T_{UI ~ max}} = \frac{4 g_I g_O |Y_F|^2}{|4 g_I g_O|^2}$$
	
	
	\subparagraph{Osservazione 1:} Se $g_O < 0$ allora $G_{T_{UI ~ max}} \rightarrow \infty$
	\\
	Poniamo $Y_S \rightarrow \infty$ (cortocircuito). $Y_{OUT} = Y_O - \cancel{ \frac{Y_R Y_F}{Y_I + Y_S} } = - |g_O| + jb_O$. Per massimizzare $G_T$ si può variare l'impedenza di carico $Y_L$. Ponendo $Y_L = -Y_O = |g_O| - jb_O$ si ha però una maglia di uscita a impedenza nulla: la corrente che vi scorre è infinita, $P_{OUT} \rightarrow \infty$, dunque $G_T \rightarrow \infty$
	
	\subparagraph{Osservazione 2:} Se l'ingresso è adattato $G_T = G_P$. Se l'uscita è adattata $G_T = G_A$.\\
	Supponendo che tutte le potenze siano positive, valgono le relazioni $G_T \leqslant G_A$ e $G_T \leqslant G_P$
	
	\section{Rete di polarizzazione RF}
	\begin{minipage}{.5\linewidth}
	La rete di polarizzazione è perfettamente analoga a quella utilizzata nell'elettronica a basse frequenze, con una eccezione: per evitare inutile dissipazione di potenza non si usa una resistenza di collettore, che è sostituita da una induttanza (RFC - Radio Frequency Choke) oppure da un circuito risonante parallelo con pulsazione di risonanza $\omega_0$ in modo che:
	\begin{itemize}
		\item a riposo scorra la corrente di polarizzazione;
		\item alla frequenza d'uso $\omega_0$ appaia come un circuito aperto così da trasferire interamente il segnale al carico.
	\end{itemize}
	\end{minipage}
\begin{minipage}{.5\linewidth}
	\null \vfill
	\includegraphics[width=\linewidth]{img/RetePolarizzazioneRF}
	\null \vfill
	
\end{minipage}

	Più recentemente si preferisce l'uso di configurazioni differenti che riescano a funzionare a tensioni notevolmente ridotte, dell'ordine degli $1 \div 2.5 V$.
	
	Il transistor utilizzato nel corso è il 2N4957, le cui caratteristiche forniscono parametri relativi ad un punto di riposo con $V_{CE} = -10V$ e $I_C = -2mA$.
	
	\begin{minipage}{0.7\linewidth}
	\paragraph{Dimensionamento di $R_1$ ed $R_2$}
	Ipotesi di partitore pesante. Ricorrendo all'equivalente Thevenin sulla base:
	\begin{align*}
	&V_{BB} = V_{CC} \frac{R_2}{R_1 + R_2} \gg R_B |I_B| = \frac{R_1 R_2}{R_1 + R_2} |I_B|\\
	&V_{CC} \gg R_1 |I_{B_{max}}| = R_1 \frac{|I_C|}{h_{FE_{min}}}
	\end{align*}
	\end{minipage}
	\begin{minipage}{0.28\linewidth}
	\includegraphics[width=0.6\linewidth]{img/LNA-partitore-pesante}
	\end{minipage}
	\paragraph{Dimensionamento dei $C_A$}
	I condensatori $C_A$ devono risultare chiusi alla frequenza di lavoro, dunque devono avere reattanza trascurabile rispetto ad almeno una delle resistenze che hanno in serie.
	
	\begin{multicols}{2}
		\begin{center}
			\includegraphics{img/dimensionamento-CA}
		\end{center}
                \columnbreak
		In ingresso... Solitamente, sia la resistenza vista dalla base che le resistenze di polarizzazione sono molto maggiori di $R_S$, quindi basta verificare che $\frac{1}{\omega_0 C_A} \ll R_S$
        \end{multicols}	
	\begin{multicols}{2}
	\begin{center}
		\includegraphics[width=0.55\linewidth]{img/dimensionamento-CA-out}
	\end{center}
        \columnbreak
			In uscita... È sufficiente che $C_A$ sia trascurabile rispetto al carico, dunque $\frac{1}{\omega_0 C_A} \ll R_L$
	\end{multicols}
	
	\paragraph{Dimensionamento di $C_E$}
	Allo stesso modo il condensatore $C_E$ deve risultare chiuso alla frequenza di lavoro. Si usa una regola operativa visto il valore ridotto delle resistenze in gioco:
	\[\frac{1}{\omega_0 C_E} = 0.1 \Omega\]
	
	
	\begin{multicols}{2}
		\paragraph{Dimensionamento di RFC}
		Alla frequenza di lavoro l'induttanza RFC deve risultare un circuito aperto nei confronti del carico:
		$$\omega_0 L \gg R_L$$
		\vfill\null
		\columnbreak
		\paragraph{Dimensionamento del parallelo LC}
		La squadra LC deve risuonare alla frequenza di lavoro, così da assumere impedenza teoricamente infinita:
		
		$$\omega_0 = \sqrt{\frac{1}{LC}}$$
		
		Ovviamente la presenza di $R_L$ e delle componenti parassite nell'induttanza e nel condensatore non daranno mai una impedenza infinita.
		
	\end{multicols}
	
	\section{Rumore negli amplificatori}
	\subsection{Cifra di rumore}
	Un amplificatore, a causa delle sorgenti di rumore presenti al suo interno, presenterà, tipicamente,
	un rapporto segnale rumore in uscita minore di quello in ingresso. Nel migliore dei casi il rapporto segnale rumore rimarrà invariato. L'effetto di degrado di tale rapporto introdotto dall'amplificatore si misura mediante un parametro denominato ``Cifra di Rumore" indicato, in
	genere, con la sigla $NF$ (Noise Figure) ed espresso in $dB$:
	
	\[NF = \frac{\mbox{Potenza di rumore totale in uscita}}{\mbox{Potenza di rumore in  uscita dovuta alla sorgente}} = \frac{N_{U_{TOT}}}{N_{U_{IN}}}\]
	
	\begin{figure}[tbh]
		\centering
		\includegraphics[width=0.5\linewidth]{img/quadripolo-sorgenti-rumore}
		\caption{}
		\label{fig:cifrarumore-1}
	\end{figure}
	
	Il rumore in uscita dovuto a $Z_S$ corrisponde al rumore che si avrebbe in uscita se il quadripolo fosse noiseless,	ovvero se agisse solo la sorgente di rumore termico di $Z_S$. In tal caso la cifra di rumore sarebbe	unitaria. In generale $NF \ge 1$.\\
	Il rumore totale in uscita si ottiene integrando la DSP di rumore in uscita su tutta la banda di
	interesse. Se la banda di interesse è ridotta o si vuole definire una cifra di rumore puntuale ad una
	certa frequenza (o spot), NF è un rapporto di DSP.
	Si può dimostrare che un quadripolo rumoroso è equivalente, ai fini di una determinata uscita, ad
	una rete priva di rumore con una coppia opportuna di generatori, di tensione e di corrente, in ingresso.
	
	\begin{minipage}{0.7\linewidth}
	\paragraph{Potenza disponibile di rumore} Data una sorgente di rumore di tensione $e_t$ con impedenza serie $Z_S$, se chiudiamo il circuito in serie ad un'impedenza $Z_S^*$, si vuole ricavare la potenza dissipata su $Z_S^*$:
        \[I_t = \frac{e_t}{|Z_S + Z_S^*|} = \frac{e_t}{|R_{S} + jX_{S} + R_{S} - jX_{S}|} = \frac{e_t}{2R_{S}}\]\\
	\[V_d = I_t R_S = e_t \frac{R_S}{R_S + R_S} = \frac{e_t}{2}\]
	\[S_{V_d} = \frac{S_{e_t}}{4}~~\left[\frac{V^2}{Hz}\right]\]
	\end{minipage}
	\begin{minipage}{0.3\linewidth}
		\centering
		\includegraphics[width=\linewidth]{img/quadripolo-potenza-disponibile-rumore}
	\end{minipage}
	
	Poiché questa scelta è quella che realizza l'adattamento complesso coniugato, essa è anche quella
	che permette di trasferire sul carico la massima potenza disponibile. La densità spettrale di potenza disponibile sarà:
	\[S_{A_n} = \frac{S_{V_d}}{R_S} = \frac{S_{e_t}}{4R_S} = \frac{4KTR_S}{4R_S} = KT~~\left[\frac{W}{Hz}\right]\]
	Più in generale, dato un generatore di rumore di tensione in serie a un'impedenza si definisce la sua
	densità spettrale di potenza disponibile come segue:
	\[S_{A_X} = \frac{S_X}{4R_S}\]
	La potenza disponibile $P_A$ nell'intervallo di frequenza $f_1-f_2$ è data da:
	\[P_A = \int_{f_1}^{f_2} S_{A_X} df \]
	Essa rappresenta la massima potenza che il generatore di rumore può cedere a un carico nell'intervallo frequenziale $f_1-f_2$. Tale risultato si consegue in condizioni di adattamento complesso coniugato.
	
	Tornando all'analisi del quadripolo, il rumore totale in uscita è dovuto sia ai generatori interni (sorgenti $e_n$ e $i_n$), sia all'impedenza del generatore di segnale che è affetta da rumore termico $e_t$.
%	, mentre il rumore in uscita dovuto a $Z_S$ dipende solo da $e_t$.
	Sotto certe condizioni, dette ``di indipendenza" tra i diversi processi aleatori, lo spettro del processo risultante si ottiene semplicemente sommando i singoli spettri. Lo stesso vale, quindi, per le 	potenze di rumore.
	\begin{align*}
	&NF = \frac{N_{U_{e_t}} + N_{U_{e_n, i_n}}}{N_{U_{e_t}}} = 1+ \frac{N_{U_Q}}{N_{U_{e_t}}}
	\\
	&N_{U_{e_t}} = S_{A_{e_t}} \Delta f G_T = KT \Delta f G_T\\
	&N_{U_Q} = S_{A_Q} \Delta f G_T =\frac{S_{e_n} + S_{i_n}|Z_S|^2}{4R_S} \Delta f G_T
	\end{align*}
	
	Si ricava infine:
	\[NF = 1 + \frac{S_{e_n} + S_{i_n}|Z_S|^2}{4KTR_S}\]
	
	\subsection{Progetto di amplificatori a basso rumore}
	Vogliamo progettare un amplificatore a basso rumore (LNA, Low Noise Amplifier). La cifra di rumore dipende dal quadripolo, attraverso i generatori equivalenti di rumore $S_{e_n}$ e $S_{i_n}$ e dal generatore di segnale, attraverso $Z_S$. Progettare a basso rumore, una volta scelto il dispositivo attivo, equivale a individuare la terminazione ottima per quando riguarda il rumore, ovvero, quella che minimizza NF. Procediamo,
	quindi, alla ricerca del minimo di NF al variare di $Z_S$, osservando che, certamente, NF sarà minimo per
	$X_S$=0.
	 
	\[NF = 1 + \frac{S_{e_n} + S_{i_n}(R_S^2 + X_S^2)}{4KTR_S}\]
	
	Si pone $X_S =  0$ e poi si cerca il massimo osservando dove si annulla la derivata:
	\[\frac{dNF}{dR_S} = \frac{2R_S S{i_n} 4KTR_S - \left(S_{e_n} + R_S^2 S_{i_n}\right)4KT}{(4KTR_S)^2} = 0\]
	\[Z_{ON} = R_{ON}= \sqrt{\frac{S_{e_n}}{S_{i_n}}}\]
	
	Poiché $Z_S$ è, di norma, fissata dalle specifiche di progetto, bisognerà introdurre delle reti di 	trasformazione di impedenza tra la sorgente e l'ingresso dell'amplificatore per far sì che esso veda	l'impedenza ottima dal punto di vista del rumore.
	Per valutare l'effetto di tali reti su NF utilizziamo una formula dovuta a Friis che permette di calcolare la cifra di rumore globale di una rete costituita dalla cascata di due o più quadripoli.
	Con ovvio simbolismo si ottiene per la cifra di rumore totale $NF_{TOT}$:
	\[NF_{TOT} = NF_1 + \frac{NF_2 - 1}{G_{A_1}} + \frac{NF_3 - 1}{G_{A_2}} + ...\]
	
	\begin{figure}[h]
		\centering
		\includegraphics[width=0.8\linewidth]{img/quadripolo-NF-friis}
		\caption{}
		\label{fig:cifrarumore-3}
	\end{figure}
	
	La formula di Friis mostra in termini analitici una considerazione ovvia: per minimizzare la cifra di
	rumore totale di un sistema, bisogna usare come primo stadio quello a cifra di rumore più bassa ed
	assicurarsi che introduca un guadagno quanto maggiore possibile.
	Nel caso in cui $Q_1$ sia una rete di adattamento (passiva, reciproca e non dissipativa) la sua cifra di
	rumore $NF_1$ sarà unitaria (non contiene generatori interni di rumore) come anche il suo guadagno di
	potenza disponibile $G_{A1}$. Pertanto $NF_{TOT} = NF_2$, ovvero la cifra di rumore totale coincide con quella del quadripolo attivo.
	
	Si può facilmente dimostrare, infine, che la cifra di rumore così come è stata definita, coincide col
	rapporto tra il rapporto segnale rumore in ingresso e quello in uscita:
	\[NF = \frac{SNR_I}{SNR_U} = \frac{\frac{S_I}{N_I}}{\frac{S_U}{N_U}}\]
	
	Infine, per calcolare la potenza di rumore o l'SNR in uscita su una certa banda $\Delta f$ ricordiamo che:

	\begin{align*}
	&NF = \frac{N_{U_{TOT}}}{N_{U_{IN}}} = \frac{N_{U_{TOT}}}{KT G_T \Delta f}\\
	&N_{U_{TOT}} = KT \Delta f \cdot G_T \cdot NF\\
	&S_{U} = P_{A_{IN}} G_T = \frac{V_{S_M}^2}{8R_S} G_T
	\end{align*}
	
	\section{Criterio di Barkhausen e stabilità}
	
	Supponendo di saper variare a piacimento  le impedenze di ingresso e uscita di un sistema 2 porte, se ne vuole valutare la stabilità.
	
	\paragraph{Criterio di Barkhausen:} se esiste una coppia di impedenze d'ingresso e uscita $Y_S$ e $Y_L$ tali che $\begin{cases}
	| \beta A (Y_S,Y_L) | = 1\\
	\angle \beta A (Y_S,Y_L)  = 0
	\end{cases}$ allora la rete sostiene autonomamente l'oscillazione alla frequenza $f_0$.
	
	\paragraph{Criterio di Barkhausen all'innesco:} se esiste una coppia di impedenze d'ingresso e uscita $Y_S$ e $Y_L$ tali che $\begin{cases}
	| \beta A (Y_S,Y_L) | > 1\\
	\angle \beta A (Y_S,Y_L)  = 0
	\end{cases}$ allora la rete innesca un'oscillazione che si autoesalta.
	
	\paragraph{Stabilità incondizionata:} il circuito due porte è incondizionatamente stabile $\Leftrightarrow$ non esiste una coppia $Y_S, Y_L$ (con $\Re{Y_S}>0$ e $\Re{Y_L}>0$) che soddisfi i criteri di Barkhausen alla frequenza $f_0$. Una definizione equivalente di Stabilità Incondizionata è:
	\[
	\begin{cases}
	\forall ~ Y_S : \Re{Y_S} \ge 0 & \Rightarrow ~ Y_{OUT} : \Re{Y_{OUT}}>0\\
	\forall ~ Y_L : \Re{Y_L} \ge 0 & \Rightarrow ~ Y_{IN} : \Re{Y_{IN}}>0\\
	\end{cases}
	\]
	
	Dimostriamo quest'ultima relazione in un senso, ovvero che il verificarsi delle condizioni suddette è necessario alla stabilità incondizionata.
%	Dunque si dimostra che se una di queste due condizioni non si verifica il	quadripolo è potenzialmente instabile e può essere utilizzato per realizzare un oscillatore.
	
	Se esiste una $\overline{Y}_S$ tale che la parte reale di $Y_{OUT}$ è negativa (così come la $\Re{Z_{OUT}}$) allora è possibile realizzare una maglia di uscita ad impedenza nulla, utilizzando come $Z_L$ un'impedenza pari a $-Z_{OUT}$. Pertanto $I_{OUT}\rightarrow \infty$ e siamo in condizioni di instabilità.
	
	\begin{figure}[tbh]
		\centering
		\hspace{\fill}
		\includegraphics[height=5em]{img/quadripolo-impedenza-nulla-1}
		\hspace{\fill}
		\includegraphics[height=5em]{img/quadripolo-impedenza-nulla-2}
		\hspace{\fill}
		\caption{Maglia ad impedenza nulla sull'uscita}
		\label{fig:instabilita}
	\end{figure}
	
	Consideriamo adesso un quadripolo caratterizzato a parametri Y, di cui se ne vuol calcolare il $\beta A$ tramite teorema di scomposizione.
	
\begin{figure}[h!]
	\centering
	\includegraphics[width=\linewidth]{img/scomposizione}
	\caption{}
	\label{fig:stabilita-quadripolo-taglio1}
\end{figure}
	
	Per prima cosa dobbiamo individuare un taglio e, quindi, un anello di reazione. Il quadripolo è
	intrinsecamente reazionato tramite la $Y_R$ la quale riporta in ingresso l'effetto dell'uscita.
	Con il taglio effettuato individuiamo la reazione:
	
	$$\beta A = \left. \frac{V_R}{V_P} \right|_{V_S=0}  ~~~
	A = \left. \frac{V_U}{V_P} \right|_{V_S=0}~~
	\beta = \left. \frac{V_R}{V_U} \right|_{V_S=0}$$
	
	Il taglio è tale per cui $\rho = 0 ~ \rightarrow ~ Z_P = Z_I = \frac{V_P}{I_P}$.
	
	\begin{align}
	Y_P &= Y_O + Y_L
	\n
	V_R &= -\frac{Y_F V_1}{Y_O + Y_L} = -\frac{Y_F}{Y_O + Y_L} \left( - \frac{Y_R V_2}{Y_S+Y_I} \right) \qquad \mbox{nota: } V_2 = V_P
	\n
	\beta A &= \frac{Y_F Y_R}{(Y_I + Y_S)(Y_O+Y_L)}
	\end{align}
	
	Verifiche:\\
	Se il quadripolo è unilaterale ($Y_R = 0$): $\beta A = 0$ perché non c'è reazione;\\
	cortocircuitando l'uscita ($Y_L \rightarrow \infty$): $\beta A = 0$;\\
	cortocircuitando l'ingresso ($Y_S \rightarrow \infty$): $\beta A = 0$;
	
	
	Il $\beta A$ ci permette di analizzare in termini analitici le condizioni di Barkhausen
	$$\begin{cases}
	| \beta A (Y_S,Y_L) | > 1\\
	\angle \beta A (Y_S,Y_L)  = 0
	\end{cases}$$
	Dal sistema, mediante elaborazioni di una certa complessità che in questa sede non vengono
	riportate, si ricava un criterio basato sul cosiddetto \textbf{Fattore di Stern K}:
	
	Fissati $g_S$ e $g_L$, se
	$\displaystyle K = \frac{2(g_I+g_S)(g_O + g_L)}{\Re{Y_R Y_F}	+  |Y_R Y_F|} > 1$ allora il sistema non ha soluzione, $\forall$ coppia $(b_S,~b_L)$
	
	\subparagraph{Osservazione:} si esclude il caso $g_I<0$ e $g_O<0$ perché si ha un due porte sicuramente non stabile:
	supponiamo $g_I < 0$ e uscita chiusa in corto circuito: $Y_{IN} = Y_I - \frac{Y_R Y_F}{Y_O + Y_L} \overset{\mathrm{Y_L \rightarrow \infty}}{=} Y_I
	= g_I + jb_I$
	\\
	Provando ad adattare l'ingresso si è obbligati a porre $Y_S = -Y_{IN}$: si genera dunque una maglia a impedenza nulla, quindi qualunque sia la sollecitazione del generatore di ingresso la risposta tende a divergere ($I \rightarrow \infty$).
	
	La condizione sul fattore di Stern è molto utile alle radiofrequenze, poiché gli accoppiamenti capacitivi e induttivi spuri possono far variare le parti reattive delle impedenze di sorgente e di carico e generare oscillazioni, tranne se $K>1$.\\
	Attenzione: $K>1$ non equivale a dire che il quadripolo è incondizionatamente stabile, perché si riferisce ad una particolare coppia ($g_S$ ,$g_L$).
	
	Si vede che K è una funzione crescente di $g_S$ e $g_L$. Il denominatore è la somma di una parte reale e del modulo
	dello stesso vettore che è maggiore sia della parte reale che di quella immaginaria. Perciò il
	denominatore è sicuramente positivo.\\
	Se calcoliamo K nella situazione peggiore ($g_S =0$ e $g_L =0$) e verifichiamo che esso risulta positivo, sicuramente continuerà ad esserlo per ogni coppia $g_S >0$, $g_L > 0$	ovvero il quadripolo risulterà incondizionatamente stabile.
		
	In altri termini, i quadripoli che verificano la condizione:
	\begin{align*}
	&
	\frac{2 g_I g_O}{\Re{Y_R Y_F} + |Y_R Y_F|} > 1
	~~~
	\mbox{sono certamente Incondizionatamente Stabili}\\
	&
	2 g_I g_O > \Re{Y_R Y_F} + |Y_R Y_F|
	\\
	&
	|Y_R Y_F| < 2 g_I g_O - \Re{Y_R Y_F}
	\end{align*}
	\begin{align}
	C = \frac{|Y_R Y_F|}{2 g_I g_O - \Re{Y_R Y_F}} < 1
	\end{align}
	
	C prende il nome di  \textbf{fattore di Linvill}, ed è compreso fra 0 ed 1 se e solo se il quadripolo è incondizionatamente stabile.
	
	\paragraph{Caso particolare:} $Y_R =0 \rightarrow C=0$, quadripolo unilaterale,	situazione di marginale stabilità, va trattata separatamente.
	$$
	\mbox{Se }
	\begin{cases}
	g_I > 0 \\
	g_O > 0
	\end{cases}
	~~
	\Rightarrow
	~
	\mbox{Incondizionata Stabilità}
	$$
	
		
	Poiché il fattore di Stern dipende da $g_S$ e $g_L$ può essere fornito dal costruttore che, in genere,	fornisce il fattore di Linvill al variare della frequenza. Nel range di frequenze in cui C è compreso tra 0 e 1 il quadripolo è caratterizzato da Incondizionata Stabilità (IS).
	
	\subsection{Effetto della stabilità incondizionata sui guadagni}
	
	Dalla I.S. discende che, qualunque sia la coppia di impedenze di carico e di sorgente, purché a parte
	reale positiva, risulta:
	\[
	\begin{cases}
	\Re{ Y_{IN} } > 0\\
	\Re{ Y_{OUT} } > 0
	\end{cases}
	\]
	Pertanto: $ G_P > 0 \quad G_A > 0 \quad G_T > 0$.
	
	È possibile dimostrare che, se un quadripolo è incondizionatamente stabile, è possibile realizzare contemporaneamente l'adattamento complesso coniugato in ingresso e in uscita, ovvero esiste (ed è unica) la soluzione del sistema di equazioni:
	\[
	\begin{cases}
	 Y_{IN} ( Y_L ) = Y_S^*\\
	 Y_{OUT} ( Y_S ) = Y_L^*
	\end{cases}
	\]
	È anche possibile dimostrare che i valori di $Y_S$ e $Y_L$ soluzioni del sistema coincidono con il punto di massimo della funzione $G_T (Y_S, Y_L)$, ovvero sono i valori di ammettenza di sorgente e di carico che massimizzano il guadagno di trasduttore.
	Detto ancora in altri termini: se si studia $G_T$ come una funzione di 4 variabili e limitatamente al caso $g_L >0,~ g_S >0$, la ricerca del massimo ha soluzione, unica se e solo se il quadripolo è incondizionatamente stabile.
	\[\exists (Y_{S_{opt}}; Y_{L_{opt}})
	: G_T (Y_{S_{opt}}, Y_{L_{opt}}) = G_{T_{max}}
	\Leftrightarrow 
	\mbox{il quadripolo è Incondizionatamente Stabile}
	\]
	
	\subsubsection{Massimizzazione dei guadagni}
	Il problema di ricerca del massimo è prettamente analitico e non lo trattiamo nel dettaglio.	Le ammettenze ottime di carico e sorgente, ovvero quelle che massimizzano $G_T$, sono anche quelle	che realizzano l'adattamento complesso coniugato in ingresso e uscita.
	\[
	\begin{cases}
	Y_{IN} (Y_{L_{opt}}) = Y_{S_{opt}}^*\\
	Y_{OUT} (Y_{S_{opt}}) = Y_{L_{opt}}^*
	\end{cases}
	\]
	
	Dato l'adattamento vale $G_{T_{max}} = G_A(Y_{S_{opt}}) = G_{P}(Y_{L_{opt}})$, inoltre $G_A(Y_{S_{opt}}) = G_{A_{max}}$.
	Dimostriamolo supponendo, per assurdo, di avere una $\overline{Y}_S \neq Y_{S_{opt}}$ per cui il guadagno $G_A$ sia maggiore rispetto al caso ottimo.
	\\
	Effettuiamo l'adattamento complesso coniugato in uscita, ponendo $\overline{Y}_L = Y_{OUT}^*(\overline{Y}_S)$:
	\[\Rightarrow G_T(\overline{Y}_S, \overline{Y}_L)=
	G_A(\overline{Y}_S) \overset{\mbox{per HP}}{>}
	G_A(Y_{S_{opt}}) = G_{A_{max}} = G_{T_{max}}\]
	Ma questo è assurdo.
	
	\subsubsection{Terminazioni ottime}
	Si può dimostrare che, dati i parametri Y di un quadripolo incondizionatamente stabile, le sue terminazioni ottime sono:
	\begin{align*}
	&g_{S_{opt}} = \frac{\sqrt{\left[
	2g_Ig_O - \Re{Y_RY_F} \right]^2
	-|Y_R Y_F|^2}}
	{2g_O}\\
	&g_{L_{opt}} = g_{S_{opt}} \frac{g_O}{g_I}\\
	&b_{S_{opt}} = -b_I + \frac{\Im{Y_RY_F}}{2g_O}\\
	&b_{L_{opt}} = -b_O + \frac{\Im{Y_RY_F}}{2g_I}
	\end{align*}
	\textbf{Nota:} dire che l'argomento della radice presente sia in $g_{S_{opt}}$ che in $g_{L_{opt}}$ è positivo significa imporre la condizione di Linvill.
	
	\section{Reti di adattamento}
	Quando si progetta un amplificatore il generatore e il carico sono fissati. In genere viene richiesto di	massimizzare il guadagno di trasduttore e/o di minimizzare la cifra di rumore.	Per fare ciò si possono utilizzare opportune reti di trasformazione d'impedenza, che fanno sì che il quadripolo \textit{veda} le impedenze opportune al conseguimento dell'obiettivo fissato a specifica. I quadripoli utilizzati come trasformatori di impedenza prendono il nome di Reti di Adattamento.
	Tali reti dovranno avere le seguenti caratteristiche:
	\begin{itemize}
		\item essere reti lineari;
		\item essere passive per non introdurre ulteriori stadi con componenti attivi che sono causa di dissipazione di potenza e introduzione di rumore;
		\item essere non dissipative (ovvero prive di resistenze) per non causare attenuazione di potenza e non introdurre sorgenti di rumore termico.
	\end{itemize}

	Esse risultano necessariamente reciproche (fatto salvo l'improbabile caso di impiego di componenti passivi non isotropi, quali, ad esempio, le ferriti che dissimmetrizzano la matrice delle
	impedenze della rete).
	
	\begin{multicols}{2}
		\includegraphics[width=0.8\linewidth]{img/trasformatore-impedenza}
		
		Una semplice rete di adattamento si può fare utilizzando un trasformatore. Purtroppo questa soluzione è difficilmente integrabile.
		
		$$R_V = \left( \frac{N_1}{N_2} \right) R$$
		
	\end{multicols}
	
	\subsection{Teorema delle reti di adattamento}
	In un quadripolo passivo, non dissipativo e reciproco, se si realizza adattamento complesso coniugato su una delle due porte allora anche sull'altra porta si ottiene adattamento complesso coniugato.
	
	\paragraph{Dimostrazione}
	Per ipotesi la potenza in ingresso coincide con la potenza disponibile perché si è effettuato l'adattamento:
	$Z_{IN} = Z_1^* \Rightarrow
	P_{IN} = P_{A_{IN}} = \frac{V_{1_m}^2}{8R_1}$
	
	La rete è non dissipativa:
	$P_{IN} = P_{OUT} = R_2 \frac{I_{1_m}^2}{2}
	\Rightarrow \left( \frac{I_{2_m}}{V_{1_m}} \right) ^2 = \frac{1}{4 R_1 R_2}$
	
	La rete è reciproca, quindi scambiando l'ingresso con l'uscita non si hanno variazioni su tensioni e correnti:
	
	$\left( \frac{I_{1_m}}{V_{2_m}} \right) ^2 = \frac{1}{4 R_1 R_2} \Rightarrow
	I_{1_m}^2 = \frac{V_{2_m}^2}{4 R_1 R_2}$
	
	$P_1 = \frac{I_{1_m}^2}{2} R_1 = \frac{V_{2_m}^2}{4 R_1 R_2} \frac{R_1}{2} = \frac{V_{2_m}^2}{8R_2}$
	
	Siccome la rete è passiva non dissipativa $P_1 = P_2 = P_{A_2}$.
	
	Siccome il generatore sta erogando una potenza pari a quella disponibile si sta verificando la condizione di adattamento in uscita.
	
	\paragraph{Corollario:} Il guadagno di potenza disponibile di una rete passiva non dissipativa e reciproca è unitario ($G_A = 1$)
	
	Si sceglie $Z_L$ in modo da avere adattamento complesso coniugato in uscita. In base al teorema precedente questo comporta adattamento anche in ingresso: il generatore eroga la massima potenza $P_{A_{IN}}$, che coincide con $P_{A_{OUT}}$ perché la rete è passiva non dissipativa.\\
	Dunque $G_A = \frac{P_{A_{OUT}}}{P_{A_{IN}}} = 1$
	
	\subsection{Quadripoli in cascata}
	Ponendo più quadripoli in cascata sarà utile conoscere il guadagno complessivo del sistema a partire dai guadagni dei singoli stadi. Questo ci sarà utile sia per valutare l'effetto dell'inserzione di reti di adattamento, sia per studiare il comportamento di amplificatori multistadio.
	\\
	Calcoliamo il guadagno di trasduttore $G_T$ nel caso di un sistema a due blocchi:
	
	\begin{figure}[hbt]
		\centering
		\includegraphics[width=0.7\linewidth]{img/adattamento}
		\caption{}
		\label{fig:adatttamento}
	\end{figure}
	
	
	\[
	G_{T_{TOT}} = \frac{P_L}{P_{A_{IN_1}}}=
	\frac{P_{A_{IN_2}}}{P_{A_{IN_1}}}
	\frac{P_L}{P_{A_{IN_2}}} =
	\frac{P_{A_{OUT_1}}}{P_{A_{IN_1}}}
	\frac{P_L}{P_{A_{IN_2}}}
	=
	G_{A_1} G_{T_2}
	\]
	
	Generalizzando al caso di N quaripoli,
	$G_{T_{TOT}} = G_{T_N} \prod_{n=1}^{N-1} G_{A_n}$,
	ossia il guadagno di trasduttore totale è pari al guadagno di trasduttore dell'ultimo stadio moltiplicato per i guadagni di potenza disponibile di tutti gli stadi precedenti.
	
	
	Vediamo, come caso particolare, come si modificano le potenze di un amplificatore con reti di adattamento in ingresso ed uscita.
	
	\begin{figure}[hbt]
		\centering
		\includegraphics[width=0.7\linewidth]{img/adattamento-2}
		\caption{}
		\label{fig:adatttamento1}
	\end{figure}
	\[
	G_{T_{TOT}} = \frac{P_L}{P_{A_{IN}}}
	=
	\frac{P_{OUT}}{P_{A_{IN}}}
	=
	G_{A_1} G_{T_Q}(Y_{S_V}, Y_{L_V})
	= G_{T_Q}(Y_{S_V}, Y_{L_V})
	\]
	
	Per il corollario prima dimostrato il $G_A$ delle reti di adattamento è unitario, pertanto il guadagno di trasduttore dell'amplificatore con le reti di adattamento coincide con quello del quadripolo attivo, ma calcolato in corrispondenza delle ammettenze viste (che sono in genere diverse da quelle effettive di sorgente e di carico $Y_S$ e $Y_L$). Si possono, quindi, scegliere valori opportuni per $Y_{S_V}$ e $Y_{L_V}$ in modo da ottenere il valore di $G_T$ desiderato.
%	Il problema, quindi, si riduce a quello di progettare opportunamente le reti di adattamento in modo da trasformare Y S e Y L in Y SV e Y LV rispettivamente.
	
	\subsection{Trasformazioni serie $\Leftrightarrow$ parallelo}
		
	\begin{figure}[h!]
		\centering
		\includegraphics[width=0.7\linewidth]{img/parallelo-serie}
		\caption{}
		\label{fig:parallelo-serie}
	\end{figure}
	
	Dato un gruppo RC parallelo, è possibile trovarne un equivalente serie ad una frequenza fissata.
	
	\begin{align*}
	&Y_P = \nicefrac{1}{R_P} + j \omega C_P\\
	&Z_S = \nicefrac{1}{Y_P} =
	\frac{1}{\nicefrac{1}{R_P} + j \omega C_P} =
	\frac{R_P}{1 + j \omega R_P C_P} = 
	\frac{R_P (1- j \omega R_P C_P)}{1 + \omega^2 R_P^2 C_P^2} = \frac{R_P}{1 + \omega^2 R_P^2 C_P^2} - j \frac{\omega R_P^2 C_P}{1 + \omega^2 R_P^2 C_P^2}\\
	&\mbox{Si definisce } Q_P = \omega_0 R_P C_P\\
	& Z_S = \frac{R_P}{1 + Q_P^2} - j \frac{R_P Q_P}{1 + Q_P^2} = 
	\frac{R_P}{1 + Q_P^2} + \frac{Q_P^2}{j \omega_0
		C_P (1 + Q_P^2)}
	\end{align*}
	
	Affinché i due bipoli siano equivalenti bisogna che abbiano uguale parte reale e parte immaginaria.
	\begin{equation}
	\Rightarrow ~~~ R_S = \frac{R_P}{1+Q_P^2}
	\qquad
	C_S = C_P \frac{(1+Q_P^2)}{Q_P^2}
	\end{equation}
	
	\paragraph{Esempio:} Progettare una opportuna rete che, alla frequenza $f_0 = 100MHz$, trasformi una resistenza $Z_1 = 100 + 25j \Omega$ in una $Z_2 = 50 +15j \Omega$.
	
	Poiché $R_2 < R_1$ la trasformazione è \textbf{in discesa}, dunque poniamo in parallelo a $Z_1$ un bipolo che ne riduca il valore della resistenza.
	La trasformazione è, pertanto, da parallelo a serie, e conviene lavorare in termini di ammettenze su $Z_1$ ed in termini di impedenze su $Z_2$.
	Nota: per praticità si impone $R_S = R_2$ e $R_P = \frac{1}{\Re{Y_1}}$
	
	\begin{minipage}{0.7\linewidth}
	\begin{align*}
	& Y_1 = \frac{1}{100+25j} = 9.4-2.3j mS\\
	& R_P = \frac{1}{\Re{Y_1}} = 106.4 \Omega\\
	&\mbox{Innanzitutto si elimina la componente reattiva di $Y_1$}\\
	& B_X = -B_1 = 2.3 mS\\
	&\mbox{Si pone in parallelo una capacità, in modo da avere}\\
	&\mbox{l'equivalente serie con resistenza $R_S$ desiderata.}\\
	&\mbox{Dalla relazione fra $R_S$ ed $R_P$ si ricava...}\\
	& Q_P = \sqrt{\frac{R_P-R_S}{R_S}} = 1.06\\
	& Q_P = R_P \omega_0 C_P
	\quad\Rightarrow\quad
	C_P = \frac{Q_P}{R_P \omega_0} = 15.9 pF\\
	& C_S = C_P \frac{(1+Q_P^2)}{Q_P^2} = 30 pF
	\end{align*}
	Dunque, la trasformazione serie parallelo introduce in serie alla resistenza da noi voluta una capacità del valore di 30pF, che non è la componente reattiva desiderata. Questa può essere ``aggiustata" inserendo in serie una reattanza apposita:
	\begin{align*}
	&X_2 = 15\Omega = -\frac{1}{\omega_0C_S} + X_S\\
	&X_S = X_2 +\frac{1}{\omega_0C_S} = 15+68 \Omega
	= 83\Omega > 0 \\
	&\mbox{Poiché la reattanza è positiva si tratta di un'induttanza}\\
	&L = \frac{X_S}{\omega_0} = 132nH
	\end{align*}
	Si può compiere una ulteriore semplificazione nel circuito, accorpando il condensatore $C_P$ e la suscettanza $B_X$, ottenendo:
	\begin{align*}
	&B_{TOT} = B_X + \omega_0C_P = 12.3mS > 0\\
	&\mbox{Una suscettanza negativa è una capacità, dunque...}\\
	&C_{P_TOT} = \frac{B_{TOT}}{\omega_0} = 19pF
	\end{align*}
	\end{minipage}
	\begin{minipage}{0.3\linewidth}
	\centering
	
	\includegraphics[width=0.7\linewidth]{img/adattamento-esempio-1}
	\vspace{2em}
	
	\includegraphics[width=0.7\linewidth]{img/adattamento-esempio-2}
	
	\vspace{2em}
	\includegraphics[width=0.7\linewidth]{img/adattamento-esempio-3}
	
	\vspace{2em}
	\includegraphics[width=0.7\linewidth]{img/adattamento-esempio-4}
	
	\vspace{2em}
	\includegraphics[width=0.7\linewidth]{img/adattamento-esempio-5}
	\end{minipage}
	
	Dunque, per realizzare la rete di adattamento servono soltanto una capacità da $19pF$ ed un'induttanza da $132nH$.
	
	\subsection{Trasformazioni parallelo $\Leftrightarrow$ serie}
	
	\begin{figure}[h!]
		\centering
		\includegraphics[width=0.7\linewidth]{img/serie-parallelo}
		\caption{all'incontro}
		\label{fig:serie-parallelo}
	\end{figure}
	
	Dato un gruppo RC serie, è possibile trovarne un equivalente parallelo ad una frequenza fissata.
	
	\[Z_S = {R_S} + \frac{1}{j \omega C_S}\]
	\begin{align*}
	& Y_P  = \nicefrac{1}{Z_P} =
	\frac{1}{R_S + \frac{1}{j \omega C_S}} =
	\frac{j \omega C_S}{1+j\omega R_S C_S}
	\cdot
	\frac{1-j\omega R_S C_S}{1-j\omega R_S C_S}
	=
	\frac{\omega R_S^2 C_S^2 + j\omega C_S}{1 + \omega^2 R_S^2 C_S^2}
	\\
	&\mbox{Si definisce } Q_S = \frac{1}{\omega_0 R_S C_S}
	\\
	&Y_P = \frac{\nicefrac{1}{R_S Q_S^2} - j\omega C_S}{1 + \nicefrac{1}{Q_S^2}}
	= \frac{1}{R_S} \frac{1}{1+Q_S^2}
	+ j \omega C_S \frac{Q_S^2}{1+Q_S^2}
	\end{align*}
	
	Poiché il parallelo è $Y_P = \nicefrac{1}{R_P} + j\omega C_P$, affinché le due reti siano uguali si impone l'uguaglianza delle parti reali e delle parti immaginarie:
	\begin{equation}
	\Rightarrow ~~~ R_P = R_S (1+Q_P^2)
	\qquad
	C_P = C_S \frac{Q_P^2}{(1+Q_P^2)}
	\end{equation}
	
	\chapter{Oscillatori a radiofrequenza}
	
	Gli oscillatori sono sistemi in grado di generare autonomamente senza sollecitazioni esterne una forma d'onda periodica. Se la forma d'onda è sinusoidale si parla di oscillatori sinusoidali.
%	La teoria degli oscillatori è basata sul Teorema di Scomposizione e sulle condizioni di Barkhausen.
	\\
	La teoria degli oscillatori si basa sul risultato del $\beta A$ ricavato col teorema di scomposizione:
	\[\beta A = \frac{Y_F Y_R}{(Y_S+Y_I)(Y_O+Y_L)}\]
	e sulle condizioni di Barkhausen:
	\[
	\begin{cases}
	| \beta A (Y_S,Y_L) | = 1\\
	\angle \beta A (Y_S,Y_L)  = 0
	\end{cases}
	\]
	
	Nel caso in cui il quadripolo sia un transistore bipolare i suoi parametri Y possono essere ricavati dal circuito di Giacoletto. Ad esempio per un BJT in configurazione CE si ottiene:
	
	\begin{multicols}{2}
		\includegraphics[width=0.9\linewidth]{img/giacoletto}
		
		\[
		\begin{aligned}
		Y_{Ie} &
		= \nicefrac{1}{R_{b'e}} + j \omega (C_{b'e} + C_T)\\
		Y_{Re} &
		= - j \omega C_T\\
		Y_{Fe} &
		= g_m - j \omega C_T\\
		Y_{Oe} &
		= j \omega C_T
		\end{aligned}
		\]
	\end{multicols}
	
	Vogliamo vedere sotto quali condizioni, scegliendo opportunamente $Y_S$ e $Y_L$ riusciamo a far si che le condizioni di Barkhausen vengano soddisfatte.
	
	\section{Oscillatore di Hartley}
%	\begin{minipage}{0.7\linewidth}
	Poniamo $Y_S = 0$ (ingresso aperto) e $Y_L =0$ (uscita aperta) e verifichiamo la posizione di fasori\footnote{Teniamo presente che, per il 2N4957 le parti reali di $Y_{Re}$ ed $Y_{Oe}$ sono pressoché nulle, se confrontate con gli altri parametri.} che rappresentano in numeratore ed il denominatore del $\beta A$, infatti la condizione necessaria è che i due fasori risultino sovrapposti in modo tale da ottenere fase nulla ($\angle\beta A = 0$). 
	
	Bisogna dunque variare $Y_S$ e $Y_L$ in modo che il fasore del mumeratore si sovrapponga a quello del numeratore ed osservando la figura \ref{fig:oscillatore-hartley-fasori} (\textit{a sinistra}) una possibile soluzione è:
	\begin{itemize}
		\item $Y_{Ie} + Y_{S}$ deve sovrapporsi a $Y_{Fe}$;
		\item $Y_{Oe} + Y_{L}$ deve sovrapporsi a $Y_{Re}$;
	\end{itemize}
	
	Graficamente si vede che $Y_S$ e $Y_L$ sono ammettenze negative pure, quindi due induttanze.
%	\end{minipage}
%	\begin{minipage}{0.3\linewidth}
%		\includegraphics[width=\linewidth]{img/raster/hartley-senza_carico}
%	\end{minipage}


	\begin{figure}[htb]
		\centering
		\hspace{\fill}
		\includegraphics[width=0.25\linewidth]{img/oscillatore-hartley-senzacarico}
		\hspace{\fill}
		\includegraphics[width=0.25\linewidth]{img/oscillatore-hartley-concarico}
		\hspace{\fill}
		\caption{Progetto di un oscillatore di Hartley}
		\label{fig:oscillatore-hartley-fasori}
	\end{figure}

%	\footnote{Dal Teorema dei tre punti è noto che sono necessari almeno 3 componenti reattivi per instaurare un'oscillazione: in questo caso le due induttanze e la $C_T$ intrinseca del BJT.
%che è il ben noto teorema dei tre punti. È quindi possibile realizzare un oscillatore, a
%partire da un transistore, utilizzando tre componenti reattivi, di cui due dello stesso tipo (2
%induttanze, 1 condensatore oppure 1 induttanza, 2 condensatori).
%}
	A questo punto è garantito il verificarsi della condizione sulla fase e, per ottenere le condizioni di
	innesco, bisognerà che sia garantita anche quella sul $\beta A > 1$. Questa configurazione può essere implementata sia ad emettitore comune che a base comune, poiché si traggono le stesse considerazioni in entrambe le situazioni.
	
	Bisogna osservare che aggiungendo il carico $R_L$ l'ammettenza $Y_L$ non risulta più puramente
	immaginaria e il vettore $Y_O +Y_L$ non risulta più sovrapposto a $Y_R$. Per compensare ciò
	bisognerà scegliere una $Y_S$, sempre puramente induttiva, ma di valore maggiore (induttanza minore)
	rispetto al caso precedente, come si può desumere dalla costruzione grafica in figura \ref{fig:oscillatore-hartley-fasori} (\textit{a destra}).
	
	\begin{figure}[hbt]
		\includegraphics[height=19em]{img/oscillatore-hartley-CE}
		\hspace{\fill}
		\includegraphics[height=19em]{img/oscillatore-hartley-CB}
		\caption{Oscillatore di Hartley in configurazione Common Emitter e Common Base. Nel CE si è evidenziata la capacità intrinseca del BTJ per ricordare che sono presenti tre elementi reattivi.}
		\label{fig:oscillatore-hartley-ce}
	\end{figure}
	
	
	\section{Oscillatore di Colpitts}
	
	L'oscillatore di Hartley necessita di due induttanze esterne, mentre può essere preferibile limitare l'uso degli induttori che risultano ingombranti, costosi e poco accurati. In questi casi è conveniente una seconda configurazione di oscillatore detta di Colpitts. A tale configurazione si perviene aggiungendo tra collettore e base una induttanza (che risulta in parallelo alla capacità $C_T$ ) scelta in modo da \textit{far cambiare di segno} la parte immaginaria dei parametri del quadripolo ($\frac{1}{\omega L_X} > \omega (C_\pi + C_T)$). Al limite supponiamo che sia molto maggiore.
	
	% L fa cambiare il segno della parte immaginaria dei parametri
	
	\begin{figure}[tbh]
		\centering
		\includegraphics[width=0.35\linewidth]{img/oscillatore-colpitts-ce-variat}
		\caption{}
		\label{fig:colpitts-ce-analisi}
	\end{figure}
	
	Studiando il quadripolo come parallelo fra CE e induttore, come fatto al capitolo \ref{sec:quadripoli-parallelo}, si ottiene la seguente matrice Y:
	$$
	\begin{aligned}
	Y_{IT} & = Y_{Ie} - \frac{j}{\omega L_X} =
	\nicefrac{1}{R_\pi} + j \omega (C_\pi + C_T) - \frac{j}{\omega L_X} & \simeq&
	\nicefrac{1}{R_\pi} - \frac{j}{\omega L_X}\\
	Y_{FT} & = Y_{Fe} + \frac{j}{\omega L_X} =
	g_m - j \omega C_T + \frac{j}{\omega L_X} &  \simeq &
	g_m + \frac{j}{\omega L_X}
	\\
	Y_{OT} & = Y_{Oe} - \frac{j}{\omega L_X} =
	\nicefrac{1}{R_0} + j \omega C_T - \frac{j}{\omega L_X} & \simeq&
	\nicefrac{1}{R_0} - \frac{j}{\omega L_X}
	\\
	Y_{RT} & = Y_{Re} + \frac{j}{\omega L_X} =
	- j \omega C_T + \frac{j}{\omega L_X} & \simeq&
	\frac{j}{\omega L_X}
	\end{aligned}
	$$
	
	La condizione imposta ci fa ricadere in una situazione analoga alla precedente. Studiando i fasori dei quattro parametri si deduce che, affinché siano verificate le condizioni di Barkhausen, $Y_S$ e $Y_L$ devono essere suscettanze pure e positive, ossia capacità.
	
	\begin{figure}[tbh]
		\hspace{\fill}
		\includegraphics[width=0.2\linewidth]{img/oscillatore-colpitts-fasori}
		\hspace{\fill}
		\includegraphics[width=0.35\linewidth]{img/oscillatore-colpitts-CE}
		\hspace{\fill}
		\caption{Oscillatore di Colpitts ad emettitore comune. La capacità di bypass in serie all'induttanza è necessaria per non destabilizzare il punto di riposo.}
		\label{fig:oscillatore-colpitts-fasori}
	\end{figure}
	
	Analogamente a quanto fatto per quello di Hartley si può costruire una versione dell'oscillatore di
	Colpitts a base comune.
	
	\begin{figure}[tbh]
		\centering
		\includegraphics[width=0.4\linewidth]{img/oscillatore-colpitts-CB}
		\caption{Circuito per l'oscillatore di Colpitts a Base comune}
		\label{fig:oscillatore-colpitts-CB}
	\end{figure}
	
	\subsection{Analisi e progetto di un Oscillatore di Colpitts CB}
	
	Per quanto detto finora, la frequenza di oscillazione è fortemente dipendente dalle caratteristiche del componente attivo (dipendenti, a loro volta, da punto di riposo e da parametri ambientali): con alcuni accorgimenti vediamo come si può dimensionare un oscillatore di Colpitts a base comune in modo che $f_0$ dipenda dai soli componenti passivi.
	Utilizziamo nello studio il Teorema di Scomposizione per individuare un anello e calcolare il relativo guadagno $\beta$A.
	
	\begin{figure}[htb]
		\centering
		\includegraphics[width=0.7\linewidth]{img/oscillatore-colpitts-cb-variat}
		\caption{}
		\label{fig:oscillatore-colpitts-cb-variat}
	\end{figure}
	
	Si faranno 3 ipotesi, che poi provvederemo a verificare:
	\begin{itemize}
		\item $|Z_{IN}| \gg \nicefrac{1}{\omega_0 C_2}$
		\item $Z_{IN} \in \Real$
		\item $\mbox{guadagno in corrente del CB } = -1$
	\end{itemize}
	
\begin{align*}
	\displaybreak[2]
	&Z_P = R_L \parallel j \omega_0 L \parallel \frac{1}{j \omega_0 C_S}~~~~~~~~
	\mbox{dove } C_S = \frac{C_1 C_2}{C_1 + C_2} 
	\mbox{   applicando l'ipotesi 1}\\
	&\beta A = \left. \frac{V_R}{V_P} \right|_{V_S = 0}\\
	&V_{IN} = V_P \frac{C_1}{C_1 + C_2} ~~ \mbox{partitore capacitivo}\\
	&I_{IN} \overset{HP2}{=} \nicefrac{V_{IN}}{Z_{IN}} \overset{HP3}{=} - I_2\\
	&V_R = -I_2 Z_P = I_{IN} Z_P = \frac{V_{IN}}{Z_{IN}} Z_P = V_P\frac{C_1}{C_1 + C_2} \frac{Z_P}{Z_{IN}} \\
	&\beta A \simeq \frac{C_1}{C_1 + C_2} \frac{Z_P}{Z_{IN}}
\end{align*}
	
	La condizione di Barkhausen $\angle\beta A = 0$ si ha solo se $Z_P$ è reale, ossia alla frequenza di risonanza del gruppo LC:
	$$\omega_0 = \sqrt{\frac{1}{LC_S}}$$
	La frequenza di risonanza è così indipendente dal componente attivo.
	
	\paragraph{Verifica delle ipotesi}
	\begin{itemize}
		\item \textbf{HP 3} - $A_I = -1$: bisogna valutare dalle caratteristiche del componente attivo. Essendo in configurazione a base comune questa condizione viene solitamente rispettata;
		\item \textbf{HP 2} - questa condizione solitamente non è verificata. Prendiamo come esempio il 2N4957 a 150MHz: dalle caratteristiche si osserva che $Z_{IN} \simeq \frac{1}{Y_{IB}} = \frac{1}{(56-7j) mS}$ non è puramente reale e soprattutto ha un valore di resistenza molto piccolo (circa $20 \Omega$). Si risolve il problema inserendo una resistenza serie in reazione $R_e \gg \left| \frac{1}{Y_{IB}} \right|$, per esempio $R_e = 200\Omega$;
		\item \textbf{HP 1} - poiché $Z_{IN} \simeq R_e$, $C_2$ si dimensiona di conseguenza.
		$$(f_0 = 150MHz) ~~~~~ 
		C_2 \gg \nicefrac{1}{\omega_0 R_e} \simeq 5pF ~~ \Rightarrow ~~ C_2 = 50pF$$
	\end{itemize}
	
	\paragraph{Massimizzazione del $\beta A$}
	Per ottenere un oscillatore bisogna verificare anche la condizione di Barkhausen sul modulo del $\beta A$.
	
%	C'è un paio di cose che non tornano
	
	$$\beta A \simeq \frac{C_1}{C_1 + C_2} \frac{Z_P}{Z_{IN}} ~~~~~~
	\mbox{ per massimizzare si pone } \frac{C_1}{C_1 + C_2} \rightarrow 1 ~~ \mbox{ ossia } ~~~
	C_1 \gg C_2$$
	
	Al limite, $C_1$ è un cortocircuito:
	$$Z_P = \omega L \parallel \nicefrac{1}{\omega C_2} \parallel R_L \parallel R_{IN} \overset{\omega = \omega_0}{=} R_L \parallel R_{IN}$$
	$$\Rightarrow ~ \beta A = \frac{Z_P}{Z_{IN}} =
	\frac{R_L \parallel R_{IN}}{R_{IN}} < 1 ~~~
	\mbox{Paradosso!}$$
	
	L'incongruenza si ottiene supponendo che l'intero gruppo abbia impedenza infinita alla frequenza di risonanza, trascurando così $I_{IN}$.
	
	Ai fini del calcolo del guadagno è necessario studiare in modo esatto la $Z_P$ applicando le trasformazioni serie $\Leftrightarrow$ parallelo. Questo non altera le precedenti considerazioni in merito alla frequenza di risonanza.
	
	\begin{minipage}{0.7\linewidth}
	\begin{align*}
	&R_S = \frac{R_{IN}}{1 + Q_P^2} \approx \frac{R_{IN}}{Q_P^2}
	\\
	&C'_S = C_2 \frac{1 + Q_P^2}{Q_P^2} \approx C_2
	\\
	&R_P = R_S (1 + Q_S^2) = \frac{R_{IN}}{Q_P^2} (1 + Q_S^2)
	\\
	&Q_S = \frac{1}{\omega_0 C_S R_S} = \frac{Q_P^2}{\omega_0 C_S R_{IN}} = 
	\frac{\omega_0^2 R_{IN}^2 C_2^2}{\omega_0 \frac{C_1 C_2}{C_1 + C_2} R_{IN}} = \frac{C_1 + C_2}{C_1} \omega_0 R_{IN} C_2
	\\
	&C_P = C_S \frac{Q_S^2}{Q_S^2 + 1} \approx C_S
	\\
	&R_P = R_S (1+Q_S^2) \approx R_S Q_S^2 = R_{IN} \frac{Q_S^2}{Q_P^2} = R_{IN} \underbrace{\left(\frac{C_1 + C_2}{C_1} \right) ^2}_{\alpha^2}
	\\
	&Z_P = R_L \parallel j \omega L \parallel
	\frac{1}{j \omega C_S} \parallel R_{IN} \alpha^2
	\end{align*}
	\end{minipage}
	\begin{minipage}{0.3\linewidth}
	\includegraphics[width=0.8\linewidth]{img/oscillatore-colpitts-cb-variat-1}
	
	\vspace{1em}
	
	\includegraphics[width=0.8\linewidth]{img/oscillatore-colpitts-cb-variat-2}
	
	\vspace{1em}
	
	\includegraphics[width=0.8\linewidth]{img/oscillatore-colpitts-cb-variat-3}
	\end{minipage}
	
	\[
	\beta A = \frac{C_1}{C_1 + C_2} \frac{R_L \parallel R_{IN} \alpha^2}{R_{IN}} = 
	\nicefrac{1}{\alpha}
	\frac{\frac{R_L R_{IN} \alpha^2}{R_L + R_{IN} \alpha^2}}{R_{IN}}=
	\frac{R_L \alpha}{R_L + R_{IN} \alpha^2}
	\]
	
	È adesso chiaro che il massimo $\beta A$ non è per $C_1 \gg C_2$ ($\alpha \rightarrow 1$), condizione che porta ad avere un guadagno d'anello inferiore all'unità. Il valor massimo al variare delle capacità si trova derivando in $\alpha$:
	\begin{align*}
	&\frac{d(\beta A)}{d\alpha} = \frac{(R_L + R_{IN} \alpha^2) R_L - 2 R_{IN} \alpha (R_L \alpha)}{(R_L + R_{IN}\alpha^2)^2} = 0
	\\
	&R_L^2 + R_{IN} R_L \alpha^2 - 2 R_{IN} R_L \alpha^2 = 0
	~~~ \Rightarrow ~~~
	R_L R_{IN} \alpha^2 = R_L^2
	~~~ \Rightarrow ~~~
	\alpha = \sqrt{\frac{R_L}{R_{IN}}}
	\\\\
	&\beta A |_{max} =
	\frac{R_L \sqrt{\frac{R_L}{R_{IN}}}}{R_L + R_{IN} \frac{R_L}{R_{IN}}}=
	\frac{1}{2}\sqrt{\frac{R_L}{R_{IN}}}
	\end{align*}
	
	Dunque, affinché $\beta A > 1$ bisogna che $R_L> 4R_{IN}$.
%	dimensionamenti ...
	
	\textbf{Nota:} $C_1$ e $C_2$ implementano un trasformatore a presa centrale a condensatori, tale per cui $R_V = \alpha^2 R_{IN}$.
	
	\section{Autoregolazione del guadagno}
	Lo studio dei fenomeni che intervengono all'autoregolazione dell'ampiezza dell'oscillazione coinvolge l'analisi in zona non lineare del componente attivo, complessa senza l'aiuto di un simulatore circuitale, ma in questa sede se ne può dare una descrizione intuitiva.\\
	Supponiamo che l'oscillazione si sia innescata e che la $V_{BE}$ assuma un andamento sinusoidale di ampiezza crescente intorno al suo valor medio iniziale $V_{BE_Q}$ come in figura \ref{fig:oscillatore-punto-riposo} (\textit{a sinistra}).
	
	\begin{figure}[hbt]
		\centering
		\includegraphics[width=0.3\linewidth]{img/oscillatore-p-riposo}
		\includegraphics[width=0.3\linewidth]{img/raster/oscillatori-autoguadagno}
		\caption{Caratteristica d'ingresso (approssimata) del BTJ, con il punto di riposo evidenziato}
		\label{fig:oscillatore-punto-riposo}
	\end{figure}
	
	Quando l'ampiezza dell'oscillazione supera il valore $V_{BE_Q}-V_T$ (dove $V_T$ è la tensione di soglia del dispositivo) la giunzione base-emettitore va in interdizione per una frazione crescente del periodo e, di conseguenza, la corrente $I_B$ risulta tagliata in basso come in figura \ref{fig:oscillatore-onda}.	Lo stesso accade per le correnti $I_C$ e $I_E$.
	\begin{figure}[hbt]
		\centering
		\includegraphics[width=.75\linewidth]{img/oscillatore-onda}
		\caption{}
		\label{fig:oscillatore-onda}
	\end{figure}
	Questo fenomeno fa sì che il valor medio di tali correnti tenda a crescere. Poiché la componente di valor medio di una corrente non può attraversare, a regime, i condensatori di accoppiamento e	bypass, essa deve richiudersi attraverso le maglie resistive (partitore d'ingresso e resistenza di emettitore) causando una caduta in continua in eccesso rispetto a quella che si aveva a riposo.	La tensione di base $V_B$ decresce e quella di emettitore $V_E$ tende a crescere: la $V_{BE}$ diminuisce. Il transistor tende a \textit{spegnersi} ed a ridurre i valor medi delle correnti in gioco.\\
	Si raggiunge, dunque, una situazione di equilibrio che vede il trasistor attraversare zone di non linearità (tra cui l'interdizione), e pertanto l'oscillatore è detto \textit{in classe C}\footnote{Si parla di classe C quando il componente attivo conduce per meno di metà del periodo. L'argomento verrà approfondito nel capitolo \ref{ch:trasmettitori}}.
	
	Infine, è opportuno precisare per quale motivo si è supposto che la componente variabile della tensione $V_{BE}$ continui a presentare un andamento sinusoidale alla frequenza di oscillazione. Poiché la base è a massa alle variazioni, questa componente è dovuta solamente alla componente variabile della $V_{E}$, che è una partizione della tensione ai capi del gruppo $LC_S$. Il parallelo è alimentato dalla corrente pulsante $I_C$ (che ha lo stesso andamento della $I_B$ di figura \ref{fig:oscillatore-onda}). Se ipotizziamo
%	che il gruppo $R_LLC_S$ sia caratterizzato da un elevato valore del fattore di qualità Q, ecco, allora, che le componenti
	che il fattore Q sia molto elevato, è chiaro che le 	armoniche della corrente $I_C$ sono filtrate dal parallelo che risuona alla frequenza di oscillazione, e solo la prima armonica contribuisce in modo apprezzabile alla caduta di tensione su $R_L$.
	
	\subsection{Oscillatori controllati in tensione} \label{sub:VCO}
	Per ottenere un oscillatore la cui frequenza sia controllabile/modulabile mediante una tensione si
	utilizzano elementi circuitali che presentano una capacità variabile con la tensione di polarizzazione, ovvero, dei varicap. Esistono moltissime soluzioni circuitali di questo tipo: ne esaminiamo in dettaglio una tra le tante che prende il nome di Oscillatore di Clapp.
	
	\begin{figure}[hbt]
		\centering
		\includegraphics[width=0.50\linewidth]{img/oscillatore-clapp-colpitts}
		\caption{}
		\label{fig:clapp}
	\end{figure}
	
	Consideriamo l'oscillatore di Colpitts, dove si è inserita in serie all'induttanza $L$ una capacità variabile $C_V$ la cui implementazione sarà illustrata a breve.
	Il gruppo $LC_V$ serie presenta una reattanza pari a
	\[
	\omega L' = \omega L - \frac{1}{\omega C_V}
	  = \frac{\omega^2 LC_V-1}{j \omega C_V}
	\]
	Se $\omega L > \frac{1}{\omega C}$ allora la serie ha comunque reattanza induttiva e l'oscillatore continua a comportarsi come un Colpitts a base comune. Abbiamo la possibilità di variare la frequenza di oscillazione (pari a $\omega_0 = \sqrt{\frac{1}{L'C_S}}$) variando $C_S$.
	
	\begin{figure}[hbt]
		\centering
		\includegraphics[width=0.40\linewidth]{img/oscillatore-clapp}
		\includegraphics[width=0.40\linewidth]{img/oscillatore-clapp-varicap}
		\caption{}
		\label{fig:varicap}
	\end{figure}
	
	Esaminiamo più in dettaglio l'implementazione della capacità variabile: $V_S(t)$ rappresenta la tensione di controllo della capacità (o modulante), che ipotizziamo lavorare ad una frequenza di molto inferiore a quella di oscillazione. L'induttanza RFC serve ad isolare l'oscillatore vero e proprio dalla parte di controllo (è un corto circuito alle basse frequenze ed un circuito aperto alle radiofrequenze).
	
	Il diodo varicap, polarizzato in inversa attraverso la batteria $E$, si comporta come una capacità variabile con $V_S$, con caratteristica illustrata in figura \ref{fig:varicap}:
	\begin{itemize}
	\item in continua tutte le capacità sono aperte, L è un circuito chiuso e la tensione ai capi del diodo è $V_{C_Q} = \frac{R_L}{R_L + R_0} E$;
	\item nel range di frequenze di $V_S$, $C_A$ può essere considerato un cortocircuito, dunque al valore di riposo si somma una componente variabile
	$v_{C}(t) = \frac{R_0 \parallel R_L }{R_S + R_0\parallel R_L} V_S(t)$, che va a modificare il valore di $C_V$.
	\end{itemize}
	Per piccole variazioni di $V_S(t)$ si ottiene una modulazione \textit{quasi} lineare della frequenza di oscillazione intorno alla frequenza centrale.

	\section{Oscillatori al quarzo}
	Con l'oscillatore di Colpitts non si riescono a raggiungere accuratezze sotto il ppm a causa di effetti parassiti non trattati in precedenza:
	$C_1$ e $C_2$ sono note con una certa indeterminazione a causa di tolleranze di produzione, e possono variare con il tempo o con le condizioni ambientali.
	Inoltre anche le capacità intrinseche del transistor, non note a priori, possono aggiungere ulteriori incertezze.
	
	In definitiva, $\nicefrac{1}{\omega_0 C_S}$ è una famiglia di curve funzione dei precedenti effetti, compresa fra un valore minimo ed un valore massimo di $C_S$. Come rappresentato in figura, anche la frequenza di oscillazione ha un valore compreso tra un minimo e un masssimo.
	
	Lo stesso si può dire per gli effetti parassiti sull'induttanza, ed anche $\omega L$ rappresenta una famiglia di curve funzione di parametri parassiti.
	
	Si può rimediare sostituendo l'induttanza con un componente a caratteristica approssimativamente verticale nell'intorno di $\omega_0$, così da ottenere una frequenza di oscillazione più accurata indipendentemente dalle variazioni di $C_S$.
	Tale caratteristica è propria dei quarzi.
	
	\begin{figure}[hbt]
		\centering
		\includegraphics[width=.40\linewidth]{img/oscillatore-colpitts-incertezze}
		\hfill
		\includegraphics[width=.40\linewidth]{img/oscillatore-quarzo-incertezze}
		\caption{A sinistra l'incertezza sulla pulsazione di oscillazione introdotta da parassiti o scostamenti dai valori nominali. A destra, si è sostituita l'induttanza con un componente a caratteristica ripida.}
		\label{fig:quarzo}
	\end{figure}
	
	Un quarzo è un materiale che presenta caratteristiche piezoelettriche: sottoponendo due facce di un parallelepipedo ad una forza si rileva sulle facce ortogonali una differenza di potenziale; l'effetto piezoelettrico è reversibile, applicando una tensione si osserva una micro deformazione. Da un punto di vista elettrico, due facce non contigue del quarzo presentano, in prima approssimazione, un circuito equivalente rappresentato in figura \ref{fig:oscillatore-quarzo-equivalente}. In realtà nel quarzo reale sono presenti anche degli elementi dissipativi assimilabili nel circuito equivalente a resistenze.
	
	\begin{figure}[tbh]
		\centering
		\includegraphics[height=15em]{img/oscillatore-quarzo-equivalente}
		\caption{}
		\label{fig:oscillatore-quarzo-equivalente}
	\end{figure}
	
	L'impedenza $Z_Q$ vista ai capi è calcolata nel seguito:
	$$\begin{aligned}
	Z_Q(s) &=
	  \frac{\left( \frac{1}{C_S s} + Ls\right)
	  \frac{1}{C_P s}}{\frac{1}{C_S s} + Ls+
	  \frac{1}{C_P s}}
  	  =
  	  \frac{1 + LC_Ss^2}{C_Ss+C_Ps+LC_PC_Ss^3}\\
  	Z_Q(j \omega) &=
  	\frac{1 - \omega^2 LC_S}{j \omega (C_S + C_P) - j\omega (\omega^2 L C_P C_S)}
  	=
  	\frac{1}{j\omega (C_P+C_S)}
  	\frac{1-\omega^2 LC_S}{1 - \frac{\omega^2 L C_P C_S }{C_P + C_S}}
	\end{aligned}
	$$
	
	Si definiscono le due pulsazioni $\omega_S^2 = \frac{1}{LC_S}$ e $\omega_P^2 = \frac{1}{L\frac{C_PC_S}{C_P + C_S}}$.
	
	$$
	Z_Q(j\omega) = \frac{1}{j\omega (C_P+C_S)}
	\frac{1-\left(\nicefrac{\omega}{\omega_S}\right)^2}{1 - \left(\nicefrac{\omega}{\omega_P}\right)^2}
	$$
	Per le proprietà del quarzo vale $C_P \gg C_S
	~~ \Rightarrow ~~ \frac{C_PC_S}{C_P+C_S} \lesssim C_S
	~~ \Rightarrow ~~ \omega_P \gtrsim \omega_S$
	\begin{figure}[hbt]
		\centering
		\includegraphics[width=.8\linewidth]{img/oscillatore-quarzo-impedenza}
		\caption{Modulo e fase dell'impedenza caratteristica del quarzo.}
		\label{fig:quarzo}
	\end{figure}
	
	
	\chapter{Mixer}
	Un mixer è un sistema tempo invariante e senza memoria\footnote{la cui tensione di uscita all'istante t dipende solo dal valore assunto allo stesso istante dalle tensioni di ingresso e non dai valori assunti negli istanti precedenti} che, alimentato da due o più segnali in ingresso, presenta in uscita un segnale con componenti non lineari degli ingressi:\\
	$v_{IF}(t) = a_0 + [c_{11}v_{RF}(t) + c_{21}v_{OL}(t)] + [c_{12}v_{RF}(t) + c_{22}v_{OL}(t)]^2 + ...$.
	
	Nella sua realizzazione più semplice l'uscita contiene un solo termine proporzionale al prodotto tra due segnali d'ingresso.\\
	Poiché per il prodotto di due oscillazioni vale la relazione
	
	$$cos(\omega_{RF} t) cos(\omega_{OL} t) = \frac{1}{2} cos[(\omega_{RF} + \omega_{OL}) t] + \frac{1}{2} cos[(\omega_{RF} - \omega_{OL}) t]$$
	
	si comprende subito che l'applicazione principale del mixer è quella di traslare un segnale ad una frequenza maggiore oppure minore. Senza perdere di generalità si considera come oscillazione di uscita quella a frequenza $f_{IF} = f_{RF} - f_{OL}$.
	
	Per motivi \textit{storici} e in dipendenza da quella che risulta essere l'applicazione più frequente del mixer nei sistemi a radiofrequenza, le due porte di ingresso
	prendono il nome di \textit{porta a radiofrequenza} e \textit{porta dell'oscillatore locale}, mentre quella di
	uscita prende il nome di \textit{porta a frequenza intermedia}. In figura è rappresentata l'applicazione
	classica del mixer utilizzato per traslare in basso la frequenza del segnale ricevuto dall'antenna di
	un ricevitore.
	\begin{figure}[h!]
		\centering
		\includegraphics[width=0.5\linewidth]{img/MixerGeneric}
		\caption{}
		\label{fig:mixer-001}
	\end{figure}
	
	
	Un circuito che realizza in maniera estremamente semplice questo risultato fa uso di un JFET, grazie alla sua
	caratteristica parabolica: $I_D = I_{DSS} ( 1- \frac{V_{GS}}{V_P}  ) ^ 2$.
	
	\begin{figure}[h!]
		\hspace{\fill}
		\includegraphics[height=0.4\linewidth]{img/FETMixer1}
		\hspace{\fill}
		\includegraphics[height=0.4\linewidth]{img/FETMixer2}
		\hspace{\fill}
		\caption{Due possibili alternative per un mixer a JFET}
	\end{figure}
	
	Nell'ipotesi che, alla	radiofrequenza, la capacità $C_{A}$ si comporti come un corto circuito e l'induttanza di blocco come un circuito aperto, si ha $V_{GS}(t) = -E_0 + V_{RF_m} cos(\omega_{RF}t) - V_{OL_m} cos(\omega_{OL}t)$, e quindi
	
	$$I_D(t) = \frac{I_{DSS}}{{V_P}^2} \left( {V_P}^2 - 2 V_P V_{GS} + {V_{GS}}^2 \right) $$
	
	Il termine $V_{GS}^2$ darà luogo alla componente a frequenza intermedia $f_{IF}$. Le altre armoniche sono filtrabili dimensionando un gruppo LC parallelo in uscita in modo da farlo risuonare alla frequenza intermedia\footnote{Il gruppo ha un'impedenza bassa per $f \neq f_{IF}$ e la corrente non scorre nel carico.}:
	
	\begin{align*}
	i_D(t) &\simeq \frac{I_{DSS}}{V_P^2} ~ V_{RF_m} V_{OL_m} ~ cos (\omega_{IF} t)
	\\
	V_{IF_m} &= \frac{I_{DSS}}{V_P^2} ~ V_{RF_m} V_{OL_m} R_L
	\end{align*}
	
	
	
	
	\section{Parametri caratterizzanti}
	
	\paragraph{Guadagno di Conversione} $G_C = \frac{P_{IF}}{{P_{A_{RF}}}}$
	
	Nell'esempio del FET si ha:
	
	$$ P_{IF} = \frac{V_{IF_m}^2}{2 R_L} = \frac{I_{DSS}^2 V_{{RF}_m}^2 V_{{OL}_m}^2 R_L^{\bcancel{2}} }{2 V_P^4 \bcancel{R_L}} ~~~~~~ {P_{A_{RF}}} = \frac{V_{RF_m}^2}{8R_S}$$
	$$ G_C = \frac{P_{IF}}{P_{A_{RF}}} = \frac{I_{DSS}^2 \cancel{V_{{RF}_m}^2} V_{{OL}_m}^2 R_L }{2 V_P^4} \cdot \frac{8R_S}{\cancel{V_{RF_m}^2}} \overset{\mathrm{R_S = R_L}}{=} \frac{4 R_L^2 I_{DSS}^2 V_{OL_m}^2}{V_P^4} $$
	Si osservi che il guadagno di conversione non dipende dall'ampiezza del segnale a radiofrequenza; pertanto, a $V_{OL_m}$ costante la componente a frequenza intermedia risulta proporzionale a quella a radiofrequenza, ovvero
	$P_{IF} = G_C {P_{A_{RF}}}$.
	
	Su un grafico con grandezze espresse in dBm\footnote{In ambito delle radiofrequenze si usa esprimere la potenza in dB milliWatt: $dBm = 10 ~ log(P_{in~mW})$} si ottiene
	
	$$\left. P_{IF}\right|_{dBm}  = 10~log(G_C {P_{A_{RF}}}) = 10~log(G_C) + \left.{P_{A_{RF}}}\right|_{dBm} $$
	
	\begin{figure}[htb]
		\centering
		\includegraphics[height=0.3\linewidth]{img/1dbcp}
		\caption{}
		\label{fig:mixer-002}
	\end{figure}
	
	\paragraph{Punto di compressione a 1 dB} (1dBCP) si ricava attraverso
	il seguente esperimento: si alimenta la porta a radiofrequenza con un segnale di ampiezza crescente misurando la potenza a frequenza intermedia.
	Il grafico costruito per via sperimentale (tratteggiato) presenta una deviazione dall'andamento lineare previsto (linea continua). Il punto di compressione a 1 dB è il valore della potenza disponibile a radiofrequenza in cui la curva sperimentale si discosta di 1 dB dall'andamento ideale.
	
	Si tratta di un	effetto in genere dovuto a non linearità di ordine superiore i cui effetti, oltre un certo livello del
	segnale a radiofrequenza, non possono più essere trascurati.
	Di norma il mixer viene usato con una ${P_{A_{RF}}}$ tale da mantenere il funzionamento al di sotto del punto
	di compressione (da 3 a 6 dB sotto 1dBCP).
	
	\paragraph{Isolamento}
	Su ciascuna	porta del mixer è desiderabile avere, per diversi motivi, soltanto la componente che a quella porta compete, ma in realtà ciò non accade. L'isolamento fornisce una misura delle componenti \textit{indesiderate} su ciascuna porta.
	
	Si possono definire fino a 6 tipi di isolamento, anche se nella pratica solo 3 sono di effettivo interesse.
	
	\textbf{isolamento della porta RF sull'uscita IF} $I_{RF\rightarrow IF} = \frac{P_{A_{RF~RF}}}{P_{RF~IF}}$\\
	rapporto tra la potenza disponibile a RF e la potenza media della componente a radiofrequenza misurata sulla porta IF.
	
	\textbf{isolamento della porta OL sull'uscita IF} $I_{OL\rightarrow IF} = \frac{P_{A_{OL~OL}}}{P_{OL~IF}}$
	
	\textbf{isolamento della porta OL sull'uscita RF} $I_{OL\rightarrow RF} = \frac{P_{A_{OL~OL}}}{P_{OL~RF}}$
	
	
	L'effetto dell'oscillatore locale sulla porta a RF può essere particolarmente \textit{fastidioso} nei ricevitori poiché quello dell'oscillatore locale è sempre un segnale di notevole potenza (anche	qualche decina di dBm) ed un cattivo isolamento può	essere indice di un segnale che viaggia in direzione dell'antenna, che da questa può essere irradiato con conseguenze negative sia in termini di consumi che di interferenze e inquinamento elettromagnetico.
	
	Il costruttore del mixer fornisce questi parametri, per ciascuna porta, all'interno di range frequenziali ben determinati. In figura è rappresentata la configurazione circuitale per la misura di $I_{RF~IF}$. Tipicamente un buon mixer ha isolamento di 30dB.
	
	\begin{figure}[h!]
		\centering
		\includegraphics[width=0.7\linewidth]{img/isolamento}
		\caption{}
		\label{fig:mixer-004}
	\end{figure}
	
	\paragraph{Cifra di rumore} $NF=\frac{S_{RF}/N_{RF}}{S_{IF}/N_{IF}}$\\
	È un parametro importante per il calcolo del rapporto Segnale Rumore dello stadio di ingresso. Il mixer è un sistema abbastanza rumoroso, tipicamente la NF si aggira fra i 6 ed i 13 dB, contro i 3dB tipici di un LNA.
	
	È noto, dalle formule di Friis, che la cifra di rumore di una cascata di quadripoli dipende soprattutto dai parametri del primo stadio.
	
	$$NF_{tot} = NF_{LNA} + \frac{NF_{mixer} - 1}{{G_A}_{LNA}}$$
	
	Amplificare a radiofrequenza è un'operazione poco efficiente. Si realizza quindi un guadagno abbastanza alto da rendere trascurabile il rumore dello stadio successivo ma anche abbastanza basso da non consumare troppa potenza inutilmente:
	
	$$NF_{LNA} \gg \frac{NF_{mixer} -1}{{G_A}_{LNA}}
	~~ \Rightarrow ~~
	{G_A}_{LNA} \gg \frac{NF_{mixer} -1}{NF_{LNA}} $$ 
	
	\section{Mixer a moltiplicatore}
	Il mixer a FET sfrutta una proprietà di distorsione del componente attivo che introduce \textit{anche} l'effetto di traslazione frequenziale. Tale operazione si può realizzare con soluzioni circuitali che effettuano il solo prodotto fra i due segnali di ingresso.\\
	Frequentemente il segnale RF è moltiplicato per un'onda quadra $q(t)$ a frequenza fondamentale $f_{OL}$, poiché l'uso di componenti azionati \textit{in commutazione} comporta molte semplificazioni circuitali e vantaggi in termini di dissipazione.
	
	\subsection{Mixer a diodi singolarmente bilanciato}
	\begin{figure}[h]
		\includegraphics[height=0.2\linewidth]{img/MixerDiodi1}
		\hfill
		\includegraphics[height=0.2\linewidth]{img/Mixer-quadraunipol}
		\caption{}
		\label{fig:mixer-005}
	\end{figure}
	
	Immaginiamo di poter aprire e chiudere il tasto con frequenza $f_{OL} = \nicefrac{1}{T_{OL}}$. L'uscita si può scrivere come:
	\begin{align*}
	&V_{IF}(t) =
	\begin{cases}
	v_{RF}(t) \frac{R_L}{R_L+R_S} & \mbox{se $V_{OL}$ è alto}\\
	0 & \mbox{se $V_{OL}$ è basso}
	\end{cases} = v_{RF}(t) \frac{R_L}{R_L+R_S} q(t)
	\\
	&\mbox{Con } q(t) = \frac{1}{2} + \sum_{n=1}^{\infty} \frac{\sin(n\frac{\pi}{2})}{n\frac{\pi}{2}} \cos(n\omega_{OL} t)
	\\
	& V_{IF}(t) = \underbrace{\frac{1}{2}~\frac{R_L}{R_L + R_S} V_{RF}cos(\omega_{RF}t)}_{Componente~\omega_{RF}}
	+ \underbrace{V_{RF_m} cos(\omega_{RF} t) ~ \frac{R_L}{R_L + R_S} ~ \frac{2}{\pi} cos(\omega_{OL} t)}_\text{Componenti somma e differenza} + ...
	\end{align*}
	
	Si considera la sola armonica fondamentale ($n=1$) dello sviluppo di Fourier di $q(t)$ con il prodotto fra le oscillazioni $\omega_{RF}$ e $\omega_{OL}$, che dà luogo all'uscita a frequenza intermedia:
	\[
	V_{IF~IF}(t) = \frac{1}{\pi}~ \frac{R_L}{R_L + R_S} ~ V_{RF_m} cos(\omega_{IF} t)
	\]
	
	Naturalmente al tasto deve essere sostituito un circuito che svolga una funzione analoga. Una possibile realizzazione fa uso di diodi: 
	quando $V_{OL}$ è \textit{alta} i diodi sono in conduzione e si è nella condizione di tasto chiuso; viceversa, se $V_{OL}$ è bassa i diodi sono interdetti.
	Per il corretto funzionamento, l'ampiezza dell'oscillazione deve poter polarizzare i diodi (ordine di grandezza di $2 V_\gamma$).
	
	
	\begin{figure}[hbt]
		\centering
		\includegraphics[width=0.5\linewidth]{img/MixerDiodi2}
		\caption{Si preferisce avere tutti gli ingressi riferiti a massa, quindi si inserisce un trasformatore con rapporto spire 1:1}
		\label{fig:mixer-007}
	\end{figure}
	
	\paragraph{Parametri}
	
	Si ipotizza $R_L = R_S$.
	\begin{align*}
	&V_{IF} = \frac{1}{2\pi} ~ V_{RF_m} cos(\omega_{IF} t)\\
	&P_{IF} = \frac{1}{(2 \pi)^2} ~ \frac{V_{RF_m}^2}{2 R_L} ~~~~ {P_{A_{RF}}} = \frac{V^2_{{RF}_m}}{8R_S}\\
	&G_C = \frac{P_{IF}}{{P_{A_{RF}}}} = \frac{1}{\bcancel{2}} ~ \frac{\cancel{V_{RF_m}^2}}{\bcancel{4}\pi^2 ~ R_L} \cdot \frac{\bcancel{8}R_S}{\cancel{V_{RF_m}^2}} = \frac{R_S}{\pi^2 R_L} = \frac{1}{\pi^2} \approx 0.1
	\end{align*}
	
	Solo il 10\% della potenza a radiofrequenza viene convertita in frequenza intermedia: guadagno di conversione basso!
	
	In questo tipo di mixer è rilevante l'\textbf{isolamento} della porta a RF sull'uscita IF: nell'espressione di $V_{IF}(t)$ è presente anche un termine a pulsazone RF:
	$$
	V_{RF~IF} = \frac{1}{2} \frac{R_L}{R_L + R_S} V_{{RF}_m} cos(\omega_{RF} t) ~~ \Rightarrow ~~ V_{{RF~IF}_m} = \frac{V_{{RF}_m}}{4}$$
	$$I_{RF~IF} = \frac{P_{A_{RF~RF}}}{P_{RF~IF}} = 
	\frac{V^2_{{RF}_m}}{8R_S} \cdot
	\frac{2 R_L}{V_{{RF~IF}_m}^2} =
	\frac{V^2_{{RF}_m}}{8R_S} \cdot
	\frac{16 \cdot 2 R_L}{V_{{RF}_m}^2} = 4
	$$
	
	$\nicefrac{1}{4}$ della potenza disponibile a RF si ritrova in uscita sulla porta a IF. L'isolamento è scadente!
	%	"Mixer Bilanciato" nei confronti dell'oscillatore locale: isolamento buono solo rispetto all'OL
	
	\subsection{Mixer a diodi doppiamente bilancianto}
	Si tratta di una delle configurazioni più frequentemente utilizzate, quanto meno in realizzazioni
	ibride (non integrate), anche fino a diversi GHz.
	
	Considerando lo schema semplificato di figura \ref{fig:mixer-diodi-doppiamente-semplificato} l'uscita è il prodotto fra il segnale RF ed un'onda quadra bipolare a frequenza $f_{OL}$.
	
	\begin{figure}[h]
		\hspace{\fill}
		\raisebox{-0.5\height}{\includegraphics[width=0.35\linewidth]{img/mixer-diodi-doppiamente_simpl}}
		\hspace{\fill}
		\raisebox{-0.5\height}{\includegraphics[width=0.6\linewidth]{img/MixerDiodi3}}
		\hspace{\fill}
		\caption{Gli interruttori sono azionati a frequenza $f_{OL}$}
		\label{fig:mixer-diodi-doppiamente-semplificato}
	\end{figure}
	
	$$
	V_u = \begin{cases}
	V_{RF}(t) \frac{R_L}{R_L+R_S}\\
	-V_{RF}(t) \frac{R_L}{R_L+R_S}
	\end{cases}
	=
	V_{RF}(t) \frac{R_L}{R_L+R_S} q_b(t) = \frac{1}{2} V_{RF}(t) q_b(t)
	$$
	
	\begin{figure}[htb!]
		\hspace{\fill}
		\includegraphics[width=0.4\linewidth]{img/MixerDiodi-semionda_positiva}
		\hspace{\fill}
		\includegraphics[width=0.4\linewidth]{img/MixerDiodi-semionda_negativa}
		\hspace{\fill}
		\caption{Semionda positiva e semionda negativa}
		\label{fig:mixer-diodi-doppiamente-semplificato-variazioni}
	\end{figure}
	
	Nella pratica, ai deviatori viene sostituito un ponte diodi e tutti gli ingressi sono disaccoppiati mediante trasformatori a doppio secondario\footnote{In questo caso prendono il nome di \textit{balun} (Balanced to Unbalanced)} con $N_1 = 2N_2$.
	
	I diodi conducono a coppie per effetto del segnale di comando sulla porta dell'oscillatore locale.
	Quando $V_{OL}$ è nel semiperiodo positivo conducono i diodi 3 e 4 (se i due diodi sono identici si ha, per simmetria, un punto di massa virtuale), mentre i diodi 1 e 2 sono interdetti.\\
	Dallo schema semplificato di figura \ref{fig:mixer-diodi-doppiamente-semplificato-variazioni} si osserva che $V_{IF}(t) = V_{{RF}_2}(t)$.
	
	Analogamente, quando $V_{OL}$ è nel semiperiodo negativo conducono i diodi 1 e 2 (al solito, per simmetria si ha un punto di massa virtuale), mentre i diodi 2 e 3 sono interdetti.
	In questo caso si ha $V_{IF}(t) = -V_{{RF}_2}(t)$.
	
	Dunque, a parte le attenuazioni dovute al partitore d'ingresso ed al rapporto spire del trasformatore, il segnale a radiofrequenza viene trasferito sulla porta di uscita per metà periodo col suo segno e per metà periodo cambiato di segno.
	
	Valutiamo tale attenuazione: in entrambi i semiperiodi la resistenza sul secondario è sempre $R_L$, connessa fra la presa centrale ed una delle altre due prese.
	La resistenza vista dal primario dunque è $R_L$ moltiplicata per il quadrato del rapporto spire:
	
	\begin{align*}
	&R_{L_1} = \left( \frac{N_1}{N_2} \right)^2 R_L =
	4 R_L
	\\
	&V_{{RF}_1}(t) = V_{RF}(t) ~ \frac{R_{L_1}}{R_{L_1} + R_S} = V_{RF}(t) ~ \frac{4 R_L}{4 R_L + R_S} \overset{R_S = R_L}{=}
	\frac{4}{5} V_{RF}(t)
	\\
	&V_{{RF}_2}(t) = \frac{N_2}{N_1} ~ V_{{RF}_1}(t) =
	\frac{2}{5} V_{RF}(t)
	\end{align*}
	
	\paragraph{Parametri}
	
	\begin{align*}
	&\mbox{L'onda quadra bipolare si può scrivere come }
	q_b(t) = 2\sum_{n=1}^{\infty} \frac{\sin(n\frac{\pi}{2})}{n\frac{\pi}{2}} \cos(\omega_{OL} t)
	\\
	&V_{IF}(t) = {V_{RF_2}}_m \cos(\omega_{RF} ) q_b(t) = \frac{2}{5} {V_{RF}}_m \cos(\omega_{RF} t)  q_b(t)
	\\
	&\mbox{Componente a }\omega_{IF}:~ {V_{IF}}_m =
	\frac{2}{5} {V_{RF}}_m \cdot 2 \frac{2}{\pi} \cdot \frac{1}{2} = {V_{RF}}_m~\frac{4}{5\pi}
	\\
	&P_{IF} = \frac{1}{2} \cdot \frac{16~{V^2_{RF}}_m}{25\pi^2 R_L} ~~~~~~~~ {P_{A_{RF}}} = \frac{{V^2_{RF}}_m}{8 R_S}
	\\
	& G_C = \frac{P_{IF}}{{P_{A_{RF}}}} =
	\cdot \frac{8 ~\cancel{{V^2_{RF}}_m}}{25 \pi^2 \bcancel{R_L}} \cdot
	\frac{8 \bcancel{R_S}}{\cancel{{V^2_{RF}}_m}} = \frac{64}{25\pi^2} \simeq 0.25
	\end{align*}
	
	Per quanto riguarda gli isolamenti di interesse, in questo caso risultano idealmente infiniti.
	Mentre il mixer precedente era isolato solo nei riguardi dell'OL (singolarmente bilanciato),
	questo lo è sia nei riguardi dell'OL sia nei riguardi dell'RF (doppiamente bilanciato).
	
	\subsection{Mixer attivo singolarmente bilanciato}
	I mixer precedenti, essendo realizzati con componenti passivi, presentano guadagno inferiore all'unità. Talvolta si preferisce sfruttare configurazioni che introducano guadagno in modo da rilassare le specifiche su altri componenti che seguono.
	
	
	\begin{figure}[h]
		\hspace{\fill}
		\raisebox{-.5\height}{\includegraphics[width=0.2\linewidth]{img/mixer-BJT-singolarmente_simpl}}
		\hspace{\fill}
		\raisebox{-.5\height}{\includegraphics[width=0.7\linewidth]{img/MixerBJT1}}
		\hspace{\fill}
		\caption{Circuito e schema semplificato.}
		\label{fig:mixer-attivo-sb}
	\end{figure}
	
	La coppia differenziale ha sempre un transistor in conduzione ed uno interdetto. I due si scambiano alla frequenza $f_{OL}$:
	
	$$
	\begin{cases}
	V_u^+ = V_{CC} & \mbox{1 interdetto}\\
	V_u^- = V_{CC} - R_L I_0 & \mbox{2 saturo}
	\end{cases}
	~~~\Rightarrow~~~
	V_u = R_L I_0
	$$
	
	Per l'altro semiperiodo si ha $V_u = -R_L I_0$, dunque
	$V_u(t) = R_L I_0 ~ q_b(t)$
	
	\paragraph{Polarizzazione dei BJT}
	Affinché, a riposo, possa comunque scorrere una corrente di polarizzazione nei transistor, è ovviamente necessario mantenere $Q3$ in zona attiva erogando una opportuna corrente di base (equivalente al classico partitore pesante).\\
	Solo questo non è sufficiente: anche la coppia differenziale deve essere accesa, e questo si può fare imponendo una tensione di pochi volt sulla presa centrale del balun, sufficiente a mantenere la $V_{BE_Q} > V_\gamma$.
	
	\paragraph{Linearizzazione della transconduttanza} Il generatore di corrente si realizza con un singolo BJT pilotato dalla tensione a radiofrequenza.
	Per evitare una forte dipendenza dalle caratteristiche del transistor è opportuno usare una resistenza di emettitore:
	
	\begin{figure}[h]
		\centering
		\begin{circuitikz} \draw
			(0,0) node[cground]{}
			to [short, -*] (0,1)
			to [short, - ] (0,2)
			to [I<=$h_{fe}i_b$] (0,3)
			to (0,4) node{}
			(0,1) to [R = $h_{ie}$, i<=$i_b$ ,*-]  (3,1);
		\end{circuitikz}
		\begin{circuitikz} \draw
			(0,0) node[cground]{}
			to [R=$R_E$, -*] (0,2)
			to [I<=$h_{fe}i_b$] (0,4)
			(0,2) to [R = $h_{ie}$, i<=$i_b$ ,*-]  (3,2);
		\end{circuitikz}
	\end{figure}
	
	\[\mbox{Per $R_E = 0$ si ha   }i_c=h_{fe}i_b=h_{fe}\frac{v_{be}}{h_{ie}}=g_mv_{be}\]
	
	Inserendo la $R_E$:
	\begin{align*}
	&{R_V}_b = h_{ie}+(h_{fe}+1)R_E\\
	&i_c=h_{fe}i_b=h_{fe}\frac{v_{be}}{h_{ie}+(h_{fe}+1)R_E}\simeq \frac{v_{be}}{R_E}
	\end{align*}
	
	Con l'ultima approssimazione ipotizzando $h_{ie}$ trascurabile e $h_{fe}$ molto maggiore dell'unità.
	
	Applicando ciò al circuito, e nell'ipotesi che la resistenza sorgente a radiofrequenza sia trascurabile ($R_S \ll h_{ie} + (h_{FE}+1)R_E$):
	
	\begin{align*}
	&I_0 (t) = {I_0}_Q + \frac{V_{RF}(t)}{R_E}\\
	&V_{IF}(t) = R_L I_0(t) q_b(t) = R_L \left( {I_0}_Q + \frac{V_{RF}(t)}{R_E} \right) \cdot 2 \sum_{n=1}^{\infty}\frac{sin \left( n \frac{\pi}{2} \right)}{n \frac{\pi}{2}} cos(n \omega_{OL} t)
	\end{align*}
	
	Il termine di corrente a riposo ${I_0}_Q$ comporta in uscita una componente a frequenza $f_{OL}$, dunque l'isolamento fra la porta di uscita e l'oscillatore locale non è infinito:
	$${V_{IF~OL~}}_m = R_L {I_0}_Q \cdot \frac{4}{\pi}$$
	
	Frequenza intermedia
	\begin{align*}
	&{V_{IF}}_m = \frac{1}{2} \cdot R_L \frac{{V_{RF}}_m}{R_E} \cdot \frac{4}{\pi}\\
	&P_{IF}=\frac{1}{2} \cdot  R_L^{\bcancel{2}} \frac{{V^2_{RF}}_m}{R^2_E} \cdot \frac{4}{\pi^2} \cdot \frac{1}{\bcancel{R_L}}\\
	&G_C = R_L \frac{{V^2_{RF}}_m}{R^2_E} \cdot \frac{2}{\pi^2} \cdot \frac{8 R_S}{{V^2_RF}_m} = \frac{16}{\pi^2} \cdot \frac{R_L R_S}{R^2_E}
	\end{align*}
	
	La $R_E$ migliora la linearità ma penalizza il guadagno, essendo uno stadio attivo è auspicabile che il segnale venga, almeno minimamente, amplificato. Togliendo $R_E$ la resistenza vista dalla base è adesso $h_{ie}$, e non vale più la precedente ipotesi $R_S\ll h_{ie}$. Per semplicità immaginiamo $R_S = h_{ie}$.
	
	\begin{align*}
	&I_0(t) = I_{0_Q} + g_m \frac{V_{RF_m}}{2} cos(\omega_{RF}t)\\
	&V_{IF}(t) = R_L I_0(t) q(t) = R_L \left[ {I_{0_Q}} + g_m \frac{V_{RF_m}}{2} cos(\omega_{RF}t) \right] \cdot 2 \sum_{n=1}^{\infty}\frac{sin \left( n \frac{\pi}{2} \right)}{n \frac{\pi}{2}} cos(n \omega_{OL} t)
	\\
	&V_{IF~IF_m}(t) = R_L~g_m \frac{V_{RF_m}}{2} \cdot 2 ~ \frac{1}{2} ~ \frac{2}{\pi} = R_{L} g_m \frac{V_{RF_m}}{\pi}\\
	&G_C = \frac{V_{IF~IF_m}^2}{2R_L}
	\cdot \frac{8R_S}{V_{RF_m}^2}
	= \frac{R_L^2 g_m^2 V_{RF_m}^2}{2\pi^2 R_L}
	\cdot \frac{8R_S}{V_{RF_m}^2}
	= \frac{4R_S R_L g_m^2}{\pi^2}
	\\\\
	& \mbox{Con $R_L= 50\Omega$, $R_S = h_{ie}$, $g_m = \frac{h_{fe}}{h_{ie}}=50~\nicefrac{mA}{V}$ e $h_{fe}=50$ si ha...}
	\\
	&G_C = \frac{4g_m h_{fe} R_L}{\pi^2} = 50 \approx 17dB
	\end{align*}
	
	Omettendo $R_E$ si ha un guadagno maggiore, penalizzando però la linearità e la stabilità del sistema.
	
	\subsection{Mixer attivo doppiamente bilanciato}
	
	\begin{figure}[h!]
		\centering
		\includegraphics[width=0.55\linewidth]{img/MixerBJT2}
		\caption{}
		\label{fig:mixer-008}
	\end{figure}

	Questa configurazione sfrutta il circuito moltiplicatore analogico a cella di Gilbert. Si omette la discussione del punto di riposo supponendo che il generatore di corrente $I_0$ polarizzi correttamente tutti i transistor.
	Come per il precedente, tutti gli ingressi sono disaccoppiati mediante balun.
	
	Lo stadio inferiore è pilotato in modo differenziale, dunque:
	\[
	\begin{cases}
	I_1 = \nicefrac{I_0}{2} + i_1\\
	I_2 = \nicefrac{I_0}{2} + i_2\\
	\end{cases}
	\mbox{dove $i_2 = -i_1$ sono le componenti alle variazioni}
	\]
	
	La tensione di uscita si può scrivere come:
	\[V_u = (V_{CC} - I^+ R_L) - (V_{CC} - I^- R_L) = 
	(I^- - I^+) R_L\]
	
	L'oscillatore locale è un'onda quadra bipolare con ampiezza tale da far saturare o interdire i transistor:
	\begin{align*}
	&V_{OL} \mbox{ alta } \Rightarrow \mbox{ $Q_3$ e $Q_6$ saturi, $Q_4$ e $Q_5$ interdetti } \Rightarrow I^- = I_1, I^+ = I_2\\
	&V_{OL} \mbox{ bassa } \Rightarrow \mbox{ $Q_4$ e $Q_5$ saturi, $Q_3$ e $Q_6$ interdetti } \Rightarrow I^- = I_2, I^+ = I_1\\
	&\mbox{Dunque } V_u = \begin{cases}
	(I_1 - I_2) R_L = + 2 i_1 R_L & \mbox{se $V_{OL}$ è alta}
	\\
	(I_2 - I_1) R_L = - 2 i_1 R_L & \mbox{se $V_{OL}$ è bassa}
	\end{cases}
	= 2 i_1 R_L \cdot q_b(t)
	\end{align*}
	
%	\pagebreak % aggiustamento ammaiale
	
	\begin{multicols}{2}
	
	Il legame di proporzionalità fra la corrente $i_1$ ed il segnale a radiofrequenza è analogo a quello ricavato per il precedente mixer singolarmente bilanciato:
	
	$$i_1 = g_m V_{RF_2}(t) = g_m \frac{N_2}{N_1} V_{RF_2}(t)
	= \frac{g_m}{2} V_{RF_1}(t)$$
	
	Supponendo di aver effettuato adattamento complesso coniugato sull'ingresso ($R_{V_1} = R_S$) si ha che la tensione sul primario è metà della tensione a radiofrequenza, e dunque:
	
	$$i_1 = \frac{g_m}{4} V_{RF}(t)$$
	
	\columnbreak
	\null \vfill
	\includegraphics[width=\linewidth]{img/mixer-bjt2-analisi_adattamento}
	\vfill \null 
	
	\end{multicols}
	
	In definitiva...
	
	\begin{align*}
	&V_u(t) = R_L g_m \frac{{V_{RF}}_m}{2} cos(\omega_{RF}t) \cdot 2\sum_{n=1}^{\infty} \frac{sin(n\frac{\pi}{2})}{n\frac{\pi}{2}} cos(\omega_{OL} t)\\
	&{V_{u_m}} = g_m R_L ~ \frac{{v_{RF}}_m}{2} \cdot 2 \frac{2}{\pi} \cdot \frac{1}{2} = \frac{g_m R_L V_{{RF}_m}}{\pi}\\
	&P_{IF} = \frac{V_{u_m}^2}{2 R_L} =
	\frac{g_m^2 R_L^2 V_{{RF}_m}^2}{2 \pi^2 R_L}
	\qquad\qquad
	P_{A_{RF}} = \frac{V_{{RF}_m}^2}{8 R_S} \\
	&G_C = \frac{g_m^2 R_L ~ {V_{RF}}_m^2}{2\pi^2} \cdot \frac{8 R_S}{{V^2_{RF}}_m} =
	\frac{4 g_m^2 R_S R_L }{\pi^2}
	\\\\
	&\mbox{Con $g_m = \frac{I_C}{V_T} = \frac{I_0}{2 V_T}$, $h_{ie} = \frac{h_{fe}}{g_m} = \frac{V_T h_{fe}}{I_C}$ e $R_S = 2h_{ie}$}
	\\
	&G_C = 2 R_L \left(\frac{I_0}{2V_T}\right)^2
	2 \frac{V_T}{I_B} \frac{1}{\pi^2}=
	\frac{2R_L}{\pi^2} \frac{I_0}{V_T} h_{fe} \approx 50
	\end{align*}
	
\subsubsection{Adattamento integrato}
Possiamo fare in modo da adattare direttamente l'ingresso del mixer in modo da vedere $100\Omega$ dal primario del balun (ovvero $25\Omega$ dal secondario) senza dover inserire reti esterne, ma variando i parametri della coppia differenziale a livello integrato. 

\begin{figure}[tbh]
	\includegraphics[height=13em]{img/mixer-BJT-dopp-adattamento-1}
	\hspace{\fill}
	\includegraphics[height=12em]{img/mixer-BJT-dopp-adattamento}
	\caption{Schema di massima dell'adattamento da effettuare, con le varie resistenze viste (alle variazioni!). A destra: circuito equivalente di uno dei BJT della coppia differenziale in cui si è inserita l'induttanza $L_E$ per l'adattamento.}
	\label{fig:mixer-bjt-dopp-adattamento}
\end{figure}

Inserendo una induttanza sull'emettitore dei transistor Q1 e Q2 l'impedenza $Z_{IN}$ vista da ciascuno dei due ingressi diventa
\begin{align*}
&V_{IN} = I_{IN} \frac{1}{j\omega C_{\pi}} + j\omega L_E \left( I_{IN} + \frac{g_m I_{IN}}{j \omega C_\pi} \right)
\\
&Z_{IN} = \frac{1}{j\omega C_{\pi}} + j\omega L_E + \frac{L_E g_m}{C_\pi} = j \left( \omega L_E - \frac{1}{\omega C_\pi} \right) + \omega_T L_E
\\	
\end{align*}
Si noti che il termine $\frac{g_m}{C_\pi}$ ha le dimensioni di una pulsazione ed è pari, per definizione, ad $\omega_T$. È interessante che il termine $\omega_T L_E$ sia un'impedenza costante in frequenza.

$L_E$ deve essere dimensionata in modo che la parte reale di $Z_{IN}$ sia $50 \Omega$:
\[
\Re{Z_{IN}} = \omega_T L_E = 50\Omega ~~~ \Rightarrow ~~~ L_E = \frac{50 \Omega}{2\pi f_T} \approx 50pH
\]
	
Poiché è comunque presente una parte immaginaria non nulla, per completare l'adattamento bisogna porre un ulteriore componente reattivo in serie all'ingresso che la azzeri.
\[
X_B = \omega_0 L_B = - \omega_0 L_E \left( 1 - \frac{1}{\omega_0 C_\pi} \right) \overset{\frac{1}{\omega_0C_\pi}\gg\omega_0L_E}{\simeq} \frac{1}{\omega C_\pi} = 100\Omega
\quad \Rightarrow \quad
L_B = \frac{X_B}{\omega_0} = \frac{1}{\omega_0^2 C_\pi}= 1nH
\]
Il circuito risultante è il seguente:
\begin{figure}[tbh]
	\centering
	\includegraphics[height=13em]{img/mixer-BJT-dopp-adattamento-2}
	\caption{}
	\label{fig:mixer-bjt-dopp-adattamento-completo}
\end{figure}
	
Valutiamo di quanto varia il guadagno di conversione in seguito all'adattamento (ricordando che la $R_\pi$ dei BJT, in parallelo a $\nicefrac{1}{\omega C_{\pi}}$, è trascurabile rispetto a quest'ultima).
\begin{align*}
&{V_1}_m = \frac{{V_{RF}}_m}{2} ~~~~~ {V_2}_m = \frac{{V_{RF}}_m}{4} ~~~~~ {I_1}_m = \frac{{V_{RF}}_m}{4Z_0}\\
& I_1(t) = \frac{I_0}{2} + \frac{V_{RF_m}}{4 Z_0} h_{fe} cos (\omega_{RF} t)
= \frac{I_0}{2} + \frac{V_{RF_m}}{4 Z_0} \frac{g_m }{\omega_0 C_\pi} cos (\omega_{RF} t)\\
&V_{IF}(t) = I_1(t) 2R_L q(t) =
\left[\frac{I_0}{2} + g_m \frac{{V_{RF}}_m}{4 Z_0} \frac{1}{\omega_0 C_\varpi}\right] 2R_L cos (\omega_{RF} t) ~ 2 \sum_{n=1}^{\infty} \frac{sin \left( n \frac{\pi}{2} \right)}{n\frac{\pi}{2}}
\\
&{V_{IF~IF}}_m = \frac{g_m {V_{RF}}_m}{4 Z_0 \omega_0 C_\pi} ~ 2R_L~ \frac{1}{2} ~ 2 \frac{2}{\pi} = \frac{g_m {V_{RF}}_m}{\omega_0 C_\pi \pi}\\
&G_C = \frac{g_m^2 {V_{RF}^2}_m}{4 R_L \omega_0^2 C_\pi^2 \pi^2} \cdot \frac{8 R_S}{{V^2_{RF}}_m} = 
\frac{4g_m^2}{\omega_0^2 C_\pi^2 \pi^2}
=
\left(\frac{\omega_T}{\omega_0}\right)^2
\frac{4}{\pi^2}
\approx 40
\end{align*}

\chapter{Parametri S}

Il set di parametri S è il preferito nel campo delle alte frequenze dove la descrizione mediante modelli circuitali a parametri concentrati incontra dei limiti e risulta particolarmente utile parlare in termini di onde di potenza diretta e riflessa.
\\
Caratterizzando un quadripolo sarà utile trattare le connessioni con il resto del sistema come linee di trasmissione, lungo cui si propagano i flussi di potenza.

\section{Linee di trasmissione}


\begin{multicols}{2}
	Fissato un sistema di riferimento su una linea di trasmissione con impedenza caratteristica $Z_0$, chiusa su un generico carico $Z_L$, si possono scrivere le equazioni che descrivono l'andamento lungo la linea dei fasori di tensione e corrente. Si faccia l'ipotesi che la linea sia non dispersiva (e costante con la frequenza) e priva di perdite (non si dissipa potenza lungo la linea).
	
	\columnbreak
	\centering
	\null\vfill
	\includegraphics[width=0.8\linewidth]{img/Lineaditrasmissione}
	\vfill\null
\end{multicols}

	Le equazioni dei telegrafisti permettono di esprimere i fasori di tensione e corrente alla generica ascissa $\ell$:
	\[\begin{cases}
	V(\ell) = V^+ e^{j \beta \ell}+V^- e^{-j \beta \ell}\\
	I(\ell) = \frac{V^+}{Z_0} e^{j \beta \ell} -  \frac{V^-}{Z_0} e^{-j \beta \ell}
	\end{cases}\]
	Dove:
	\begin{itemize}
	\begin{multicols}{2}
		\item $V^+$ è il fasore dell'onda incidente;
		\item $V^-$ è il fasore dell'onda riflessa;
		\item $\beta = \frac{2 \pi}{\lambda}$ è la costante di fase;
		\columnbreak
		\item $\lambda = \frac{v_f}{f_0}$ è la lunghezza d'onda del segnale;
		\item $v_f = \frac{c}{\sqrt{\varepsilon_r}}$ è la velocità di propagazione lungo la linea.
	\end{multicols}
	\end{itemize}
	Si può ricavare, inoltre, l'impedenza vista in un punto generico della linea $\ell$:
	\[Z(\ell) = Z_0 \frac{Z_L + jZ_0 tg(\beta \ell)}{Z_0 + jZ_L tg(\beta \ell)}\]
%$$\Gamma = \frac{V^-}{V^+} = \frac{Z_L - Z_0}{Z_L + Z_0}$$
Poiché la linea è senza perdite, la potenza media lungo la linea è costante con $\ell$, ed è pratico calcolarla per $\ell = 0$:
\[
\begin{aligned}
P_L & =
\frac{1}{2} \Re{V I^*} =
\frac{1}{2}
\Re{(V^+ +  V^-)
	\left(\frac{V^{+*}}{Z_0}-\frac{V^{-*}}{Z_0}\right)}=
\\
&=
\frac{1}{2 Z_0} \Re{|V^+|^2 - |V^-|^2 - V^+ V^{-*}+ V^{+*} V^-} = \frac{1}{2 Z_0} (|V^+|^2 - |V^-|^2)
= \frac{1}{2} \left(a^2 - b^2\right)
\end{aligned}
\]
Dove $- V^+ V^{-*}+ V^{+*} V^-$ è la differenza i due termini l'uno complesso coniugato dell'altro: il risultato è puramente immaginario e viene pertanto eliminato dall'operazione di parte reale.

$|a|^2 = \frac{|V^+|^2}{Z_0}$ e $|b|^2 = \frac{|V^-|^2}{Z_0}$ prendono il nome di potenza incidente e potenza riflessa.

\section{Caratterizzazione a parametri S}

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.5\linewidth]{img/quadripolo_paramS}
	\caption{Il due porte in esame, con ingressi ed uscite connessi a linee di trasmissione di impedenza caratteristica $Z_0$}
	\label{fig:quadripolo-paramS}
\end{figure}

Si considera un circuito due porte, connesso tramite linee di trasmissione, come mostrato in figura \ref{fig:quadripolo-paramS}. Applicando le equazioni dei telegrafisti agli ingressi ed alle uscite è possibile scrivere:

$$
\begin{cases}
V_1 = V_1^+ + V_1^-\\
I_1 = \frac{V_1^+}{Z_0} - \frac{V_1^-}{Z_0}
\end{cases}
\qquad\qquad
\begin{cases}
V_2 = V_2^+ + V_2^-\\
I_2 = \frac{V_2^+}{Z_0} - \frac{V_2^-}{Z_0}
\end{cases}
$$

Soffermiamoci su una delle due coppie. Effettuando somma e sottrazione membro a membro e riprendendo la precedente definizione di $a$ e $b$:

\begin{equation}
\begin{cases}
V_1 + Z_0 I_1 = 2V_1^+\\
V_1 - Z_0 I_1 = 2V_1^-
\end{cases}
\qquad
\Rightarrow
\qquad
\begin{cases}
\frac{V_1 + Z_0 I_1}{2\sqrt{Z_0}} = \frac{\bcancel{2}V_1^+}{\bcancel{2}\sqrt{Z_0}} = a_1\\
\frac{V_1 - Z_0 I_1}{2\sqrt{Z_0}} = \frac{\bcancel{2}V_1^-}{\bcancel{2}\sqrt{Z_0}} = b_1
\end{cases}
\label{eq:prog_regr}
\end{equation}

Applicando lo stesso procedimento anche all'uscita ricaviamo quattro grandezze, affini a tensioni e correnti utilizzate nei precedenti parametri.\\
Si definiscono i parametri S in modo da esprimere i $b$, ossia i termini proporzionali alle potenze \textit{riflesse} sul due porte, in funzione degli $a$, proporzionali alle potenze \textit{incidenti}. 

\begin{equation}
\begin{cases}
b_1 = S_{11} a_1 + S_{12}a_2\\
b_2 = S_{21} a_1 + S_{22}a_2\\
\end{cases}
\ 
\Rightarrow
\quad
\underline{b} = \underline{\underline{S}}~ \underline{a}
\quad
dove
\ 
S =
\left(
\begin{array}{cc}
S_{11} & S_{12}\\
S_{21} & S_{22}
\end{array}
\right)
\quad
\begin{array}{c}
Matrice\\
di~Scattering
\end{array}
\label{eq:scattering}
\end{equation}


Come si ricavano i parametri?

\[
\begin{array}{cccc}
S_{11} = \left. \frac{b_1}{a_1} \right|_{a_2 = 0}
&
S_{12} = \left. \frac{b_1}{a_2} \right|_{a_1 = 0}
&
S_{21} = \left. \frac{b_2}{a_1} \right|_{a_2 = 0}
&
S_{22} = \left. \frac{b_2}{a_2} \right|_{a_1 = 0}
\end{array}
\]

%	\overset{oppure}{=}
%	\left. \frac{V_1^-}{V_1^+}\right|_{...} = 
%	\left. \Gamma_1 \right|_{...} = 
%	\frac{
%		\left.Z_{IN}\right|_{...} - Z_0}{\left.Z_{IN}\right|_{...} + Z_0}
%	= \Gamma_{IN} |_{a_2 = 0}$$

Imporre $a_2 = 0$ (o $a_1 = 0$) significa annullare la componente incidente sulla porta di uscita (o sulla porta di ingresso). Questa condizione è verificata nel caso in cui la porta è chiusa su un carico di impedenza pari all'impedenza $Z_0$ (d'ora in poi detta \textit{impedenza di normalizzazione}), infatti:
$$0 = a_2 = \frac{V_2^+}{\sqrt{Z_0}}
\quad \Rightarrow \quad
V_2 + Z_0 I_2 = 2V_2^+ = 0
\quad \Rightarrow \quad
V_2 = -Z_0 I_2
\quad \Rightarrow \quad
Z_{OUT} = - \frac{V_2}{I_2} = Z_0
$$

Per misurare i set di parametri h, y, z ecc., occorreva aprire o cortocircuitare le porte del quadripolo; la misurazione dei parametri S si effettua chiudendo le porte su un carico di impedenza $Z_0$.

A questo punto $S_{11}$ si ricava sostituendo ad $a_1$ e $b_1$ le definizioni, dalle formule \ref{eq:prog_regr}:

\begin{align*}
S_{11} &= \left. \frac{b_1}{a_1} \right|_{a_2=0} =
\left. \frac{V_1^-}{\cancel{\sqrt{Z_0}}} \cdot
\frac{\cancel{\sqrt{Z_0}}}{V_1^+} \right|_{a_2=0} 
=
\left.
\frac{V_1 - Z_0 I_1}{V_1 + Z_0 I_1}
\right|_{a_2=0}
=\\
&=
\left.
\frac{\frac{V_1}{I_1} - Z_0}{\frac{V_1}{I_1} + Z_0}
\right|_{a_2=0}
=
\frac{\left.Z_{IN}\right|_{Z_{OUT}=Z_0} - Z_0}
{\left.Z_{IN}\right|_{Z_{OUT}=Z_0} + Z_0} 
\end{align*}

\textbf{Osservazione:} poiché si sta stimolando il quadripolo dalla porta 1, $\nicefrac{b_1}{a_1}$ risulta essere il \textit{coefficiente di riflessione} sulla porta d'ingresso ($\Gamma_{IN}$). Dunque il parametro $S_{11}$ rappresenta il coefficiente di riflessione sulla porta di ingresso quando la porta di uscita è chiusa su un carico di impedenza $Z_0$.

In modo simmetrico si ricava $S_{22}$:

$$S_{22} = \left.\frac{b_2}{a_2}\right|_{a_1=0}
= \left.\frac{V_2^-}{V_2^+}\right|_{a_1=0}
=
\frac{\left.Z_{OUT}\right|_{Z_{IN}=Z_0} - Z_0}
{\left.Z_{OUT}\right|_{Z_{IN}=Z_0} + Z_0}$$



\paragraph{Dispositivo adattato sulla porta j} Il dispositvo è adattato sulla porta $j$ se $S_{jj} = 0$, ossia si ha che l'impedenza vista dalla porta $j$ quando tutte le altre sono chiuse su un carico adattato è $Z_0$.
\paragraph{Dispositivo adattato} Se la diagonale ha soli valori nulli allora il dispositivo si dice adattato.


Procediamo con il calcolo dei parametri \textit{incrociati}:

$$S_{21} = \left. \frac{b_2}{a_1} \right|_{a_2 = 0}
=
\left. \frac{V_2^-}{V_1^+} \right|_{a_2 = 0}
=
\left. \frac{V_2 - Z_0 I_2}{V_1 + Z_0 I_1} \right|_{a_2 = 0}
= \frac{2V_2}{V_1 + Z_0 I_1}$$

Se il dispositivo è adattato anche $a_1 = 0$, dunque $Z_0 I_1 = -V_1$ e la relazione si riduce a:

\[
\left. S_{21} \right|_{adatt.} =
\left. \frac{2V_2}{V_1 + Z_0 I_1} \right|_{adatt.} = \frac{V_2}{V_1}
\]

Quindi, in caso di adattamento, $S_{21}$ rappresenta la funzione di trasferimento dalla porta 1 alla 2.

Nel caso generale, tramite alcune elaborazioni, si può scrivere il parametro anche in funzione della impedenza d'ingresso:
$$S_{21} =
\frac{2 V_2}{V_1 \left( 1 + \frac{Z_0}{Z_{IN}} \right)}$$

In modo analogo si ricava $S_{12}$:
\[
\left. S_{12} \right|_{adatt.} =
\left. \frac{2V_1}{V_2 + Z_0 I_2} \right|_{adatt.} = \frac{V_1}{V_2}
\]


\paragraph{Dispositivo unilaterale} Si definisce unilaterale un circuito a due porte con $S_{12} = 0$. 

\paragraph{Proprietà:}
La rete è reciproca $\Leftrightarrow$ la matrice $S$ è simmetrica (rispetto alla diagonale principale)

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.5\linewidth]{img/quadripolo_paramS1}
	\caption{Significato fisico dei parametri S su un quadripolo adattato}
	\label{fig:lineaditrasmissione2}
\end{figure}

\vfill %Aggiustamento grafico inserito manualmente

% sostituire se fa le bizze col minipage e vaffanc
\begin{minipage}{.75\linewidth}
	\paragraph{Esempio: tratto di filo ideale}
	È reciproco perché scambiando ingresso con uscita non si apprezzano variazioni, quindi la matrice $S$ è simmetrica ($S_{12} = S_{21}$).
	
	È un quadripolo adattato, perché mettendo $Z_0$ in uscita (o in ingresso) si vede sempre $Z_0$ dall'altra porta, quindi gli elementi sulla diagonale principale sono nulli. È sufficiente calcolare solo $S_{21}$:
	
	$$S_{21} = \left. \frac{b_2}{a_1} \right|_{a_2=0}=
	\frac{V_2}{V_1} = 1$$
\end{minipage}
\begin{minipage}{.25\linewidth}
	\centering
	\includegraphics[width=0.8\linewidth]{img/paramS-cortocircuito}
\end{minipage}

\begin{minipage}{.65\linewidth}
	\paragraph{Esempio: tratto di linea di trasmissione con impedenza $Z_0$}
	
	È un quadripolo reciproco, e per definizione di impedenza caratteristica, mettendo $Z_0$ in uscita si vede $Z_0$ in ingresso, quindi il quadripolo è adattato.
	
	$$
	\begin{aligned}
	S_{21} &= \left. \frac{b_2}{a_1} \right|_{a_2=0} = \left.\frac{V_2}{V_1} \right|_{a_2 = 0}\\
	V_2 &= V(0) = V^+ + V^- \\
	V_1 &= V(L) = V^+ e^{j\beta L} + V^- e^{-j\beta L}\\
	\end{aligned}$$
	Dato che è adattato si avrà $V^- = 0$ quindi:
	\[S_{21} = e^{-j \beta l}\]
\end{minipage}
\begin{minipage}{.35\linewidth}
	\centering
	\includegraphics[width=.8\linewidth]{img/paramS-linea}
\end{minipage}

%\vfill %Aggiustamento grafico inserito manualmente
%\newpage % interruzione introdotta manualmente
\paragraph{Esempio: tratto di linea di trasmissione con impedenza $Z_x \neq Z_0$}

È un quadripolo reciproco, ma non adattato.

$$
\begin{aligned}
S_{11} &= \left. \Gamma_{IN} \right|_{a_2 = 0} =
\frac{Z_{IN} - Z_0}{Z_{IN} + Z_0} = S_{22}\\
Z_{IN} &= Z_x \frac{Z_0-jZ_x\tan(\beta L)}{Z_x-jZ_0\tan(\beta L)}
\end{aligned}
$$
$$
\begin{aligned}
S_{21} &= \left. \frac{b_2}{a_1} \right|_{a_2=0} = \left.\frac{V_2 - Z_0 I_2}{V_1 + Z_0 I_1} \right|_{a_2 = 0} = 
\frac{2V_2}{V_1 \left(1+\frac{Z_0}{Z_{IN}} \right)}\\
V_2 &= V(0) = V^+ + V^- \\
V_1 &= V(L) = V^+ e^{j\beta L} + V^- e^{-j\beta L}\\
\Gamma &= \frac{V^-}{V_+} \qquad\Rightarrow\qquad
\begin{aligned}
V_2 &= V^+ (1 + \Gamma)\\
V_1 &= V^+ (e^{j\beta L} + \Gamma e^{-j\beta L})
\end{aligned}\\
S_{21} &= \frac{2(1+\Gamma)}{V^+ (e^{j\beta L} + \Gamma e^{-j\beta L})} \cdot \frac{1}{1+\frac{Z_0}{Z_{IN}}}
\end{aligned}$$

%	\newpage

\begin{minipage}{.65\linewidth}
	\paragraph{Esempio: attenuatore}
	Quadripolo reciproco ma non adattato. È sufficiente calcolare due parametri, e per comodità scegliamo $S_{11}$ e $S_{21}$ (sono entrambi con $a_2 = 0$).
	\begin{align*}
	S_{11} &= \left. \frac{b_1}{a_1} \right|_{a_2=0}
	=\frac{V_1 - Z_0 I_1}{V_1 + Z_0 I_1}
	= \frac{Z_{IN} - Z_0}{Z_{IN} + Z_0}\\
	Z_{IN} &= R_S + \frac{(R_S + Z_0)R_P}{R_S + Z_0 + R_P}\\
	\\
	S_{21} &= \frac{2V_2}{
		V_1\left( 1+\frac{Z_0}{Z_{IN}} \right)
	} = 
	\frac{2}{1+\frac{Z_0}{Z_{IN}}} \cdot
	\frac{R_P Z_0}{Z_{IN}(R_P+R_S+Z_0)}
	\end{align*}
\end{minipage}
\begin{minipage}[t]{.35\linewidth}
	\centering
	\includegraphics[width=.8\linewidth]{img/attenuatore}
\end{minipage}

\vspace{1em}
\begin{minipage}{.65\linewidth}
	\paragraph{Esempio: rete attiva} utilizzando il modello semplificato di Giacoletto
	
	\begin{align*}
	S_{11} &= \frac{Z_{IN} - Z_0}{Z_{IN} + Z_0}
	\overset{Z_{IN}\rightarrow\infty}{=} 1 \\
	S_{22} &= \frac{Z_{out} - Z_0}{Z_{out}+Z_0} = 1
	\\
	S_{21} &= \frac{2V_2}{V_1 \left(
		1+\cancel{\frac{Z_0}{Z_{IN}}}
		\right)}
	=
	-2 g_m Z_0
	\\
	S_{12} &= 0 \qquad \mbox{È unilaterale}
	\end{align*}
\end{minipage}
\begin{minipage}[t]{.35\linewidth}
	\centering
	\includegraphics[width=.8\linewidth]{img/circuitoFET}
\end{minipage}


\section{Coefficienti di riflessione}
\begin{figure}[bht]
	\centering
	\includegraphics[width=0.8\linewidth]{img/quadripolo_coefficienti}
	\caption{}
	\label{fig:coefficienti}
\end{figure}
Dal circuito in figura \ref{fig:coefficienti} è possibile ricavare i coefficienti di riflessione sull'ingresso del quadripolo e sul carico:
\begin{align}
\Gamma_{IN} &= \frac{b_1}{a_1} = \frac{Z_{IN} - Z_0}{Z_{IN} + Z_0}\\
\Gamma_L &=  \frac{a_2}{b_2} = \frac{Z_{L} - Z_0}{Z_{L} + Z_0}
\end{align}
Fissata $Z_0$ esiste una corrispondenza biunivoca fra impedenze (di ingresso e di carico) e i relativi coefficienti di riflessione. In termini di parametri S si preferisce far riferimento a questi ultimi tramite le relazioni che andremo a ricavare.
\\
Le linee di trasmissione in analisi non sono dissipative, dunque gli $a_i$ e $b_i$ sono costanti lungo le linee.

Riprendendo le equazioni \ref{eq:scattering}:
\[
\begin{cases}
b_1 = S_{11}a_1 + S_{12}a_2\\
b_2 = S_{21}a_1 + S_{22}a_2
\end{cases}
\quad\Rightarrow\quad
\begin{cases}
\frac{b_1}{a_1} = S_{11} + S_{12}\frac{a_2}{a_1}=
S_{11} + S_{12}\frac{a_2}{b_2}\frac{b_2}{a_1}\\
\frac{b_2}{a_1} = S_{21} + S_{22}\frac{a_2}{a_1}=
S_{21} + S_{22}\frac{a_2}{b_2}\frac{b_2}{a_1}
\end{cases}
\]
Manipolando la seconda equazione e sostituendo nella prima:
\begin{align}
\frac{b_2}{a_1} &= S_{21} + S_{22}\Gamma_L\frac{b_2}{a_1}
\Rightarrow
\frac{b_2}{a_1}(1-S_{22}\Gamma_L) = S_{21}
\quad\Rightarrow\quad
\frac{b_2}{a_1}= \frac{ S_{21}}{1-S_{22}\Gamma_L}
\n
\Gamma_{IN} &= S_{11} + \frac{S_{12} S_{21} \Gamma_L}{1-S_{22}\Gamma_L}
\label{eq:gammain}
\end{align}
Tale relazione è analoga a quanto fatto a parametri Y: l'impedenza vista dall'ingresso è funzione del carico $Y_{L}$.
%	 si vede che il coefficiente di riflessione d'ingresso è funzione del coefficiente di riflessione sul carico.
Si può inoltre osservare che chiudendo l'uscita su $Z_0$ ($\Gamma_L = 0$) otteniamo la definizione del parametro $S_{11} = \nicefrac{b_1}{a_1}$.


Tramite analoghi passaggi si ricava l'espressione del coefficiente di riflessione di uscita:
\begin{equation}
\Gamma_{OUT} = S_{22} + \frac{S_{21} S_{12} \Gamma_S}{1-S_{11}\Gamma_S}
\label{eq:gammaout}
\end{equation}

\section{Guadagni}

\paragraph{Guadagno operativo di potenza}
\[G_P = \frac{P_L}{P_{IN}} = \frac{\frac{1}{2} \left( |b_2|^2 - |a_2|^2 \right)}{\frac{1}{2} \left( |a_1|^2 - |b_1|^2 \right)} = \frac{|b_2|^2}{|a_1|^2}\frac
{1-\left|\frac{a_2}{b_2} \right|^2}
{1-\left|\frac{b_1}{a_1} \right|^2}
=\]
Dato che $\frac{a_2}{b_2} = \Gamma_{L}$, $\frac{b_1}{a_1} = \Gamma_{IN}$, $\frac{b_2}{a_1} = \frac{S_{21}}{1-S_{22}\Gamma_{L}}$:

\begin{equation}\label{eq:gp}
G_P = 
\left| \frac{S_{21}}{1 - S_{22}\Gamma_L} \right|^2
\frac{1- |\Gamma_L|^2}{1- |\Gamma_{IN}|^2}
\end{equation}

Facciamo alcune considerazioni per commentare il risultato ottenuto:

\begin{itemize}
	\item Se il carico è puramente reattivo ($|\Gamma_L| = 1$) $G_P = 0$. Infatti non si dissipa potenza in uscita.
	\item Se l'impedenza vista dall'ingresso quadripolo è puramente reattiva ($|\Gamma_{IN}| = 1$) $G_P \rightarrow \infty$: infatti non entra alcuna potenza.
	\item  Se il carico è pari all'impedenza di normalizzazione $Z_0$ si ha $\Gamma_L = 0$, quindi $G_P = \frac{|S_{21}|^2}{1-|\Gamma_{IN}|^2}$
	\item Se il due porte è adattato $\Gamma_{IN} = 0$ e si ha $G_P = |S_{21}|^2$
	\item Se $|\Gamma_{IN}|>1$ (impedenza vista dal quadripolo con parte reale minore di zero) allora il $G_P < 0$.
\end{itemize}

\paragraph{Guadagno di trasduttore}

\begin{equation}
\begin{aligned}
G_T = \frac{P_L}{P_{A_{IN}}} &= 
\frac{|S_{21}|^2(1-|\Gamma_S|^2)(1-|\Gamma_L|^2)}
{|1-\Gamma_{OUT}\Gamma_L|^2|1-S_{11}\Gamma_S|^2}\\
&=
\frac{|S_{21}|^2(1-|\Gamma_S|^2)(1-|\Gamma_L|^2)}
{|1-\Gamma_{IN}\Gamma_S|^2|1-S_{22}\Gamma_L|^2}
\end{aligned}
\end{equation}

Si può verificare che se $\Gamma_S = \Gamma_{IN}^*$ allora $G_T = G_P$:

$$
G_T(\Gamma_S = \Gamma_{IN}^*) = \frac{|S_{21}|^2(1-|\Gamma_S|^2)(1-|\Gamma_L|^2)}
{\Mod{1-\Mod{\Gamma_S}^2}^2|1-S_{22}\Gamma_L|^2}
= 
\frac{|S_{21}|^2(1-|\Gamma_L|^2)}
{(1-|\Gamma_S|^2)|1-S_{22}\Gamma_L|^2} = G_P
$$

Se chiudiamo l'ingresso e l'uscita del quadripolo su un carico pari a $Z_0$ (il che implica $\Gamma_S = 0$ e $\Gamma_L = 0$) otteniamo:
\[G_T(\Gamma_S = 0, \Gamma_L = 0) = |S_{21}|^2 \]

%$$G_{TU} = \frac{(1-|\Gamma_S|^2) S_{21}(1-|\Gamma_L|^2)}{|1-S_{22}\Gamma_L|^2
%	|1-S_{11}\Gamma_S|^2}$$

%Il massimo si ha per adattamento complesso coniugato, quindi %$\Gamma_S = S_{..}$ e 
%$\Gamma_L = S_{..}$:

%	$$G_{TU_{max}} = \frac{(1-|\Gamma_S|^2) S_{21}(1-|\Gamma_L|^2)}
%	{|1-|S_{22}|^2|^2
%		|1-|S_{11}|^2|^2} =
%	\frac{\cancel{(1-|\Gamma_S|^2)} S_{21}\cancel{(1-|\Gamma_L|^2)}}
%	{|1-|S_{22}|^2|^\cancel{2}
%		|1-|S_{11}|^2|^\cancel{2}}$$

\paragraph{Guadagno di potenza disponibile}
\[G_A = \frac{P_{A_{OUT}}}{P_{A_{IN}}} = G_T (\Gamma_L = \Gamma_{OUT}^*) = \frac{(1-|\Gamma_S|^2 )|S_{21}|^2(1-|\Gamma_L|^2)}{| 1-|\Gamma_L|^2 |^2 \; |1- S_{11}\Gamma_S|^2} = \frac{(1-|\Gamma_S|^2 )|S_{21}|^2}{\left[ 1-|\Gamma_L|^2 \right] \; |1- S_{11}\Gamma_S|^2} \]

Notiamo che con un'impedenza di ingresso puramente reattiva ($|\Gamma_S| = 1$) si ha $G_A = 0$, infatti la potenza in ingresso diverge poiché $R_S = 0$.

%	$$G_{TU} = \frac{(1-|\Gamma_S|^2) S_{21}(1-|\Gamma_L|^2)}{|1-S_{22}\Gamma_L|^2
%		|1-S_{11}\Gamma_S|^2}$$
%	
%	Il massimo si ha per adattamento complesso coniugato, quindi $\Gamma_S = S_{..}$ e 
%	$\Gamma_L = S_{..}$:
%	
%		$$G_{TU_{max}} = 
%		\frac{(1-|\Gamma_S|^2) S_{21}(1-|\Gamma_L|^2)}
%		{|1-|S_{22}|^2|^2
%			|1-|S_{11}|^2|^2} =
%		\frac{\cancel{(1-|\Gamma_S|^2)} S_{21}\cancel{(1-|\Gamma_L|^2)}}
%		{|1-|S_{22}|^2|^\cancel{2}
%			|1-|S_{11}|^2|^\cancel{2}}$$
\paragraph{Esempio} Progettare un attenuatore con fattore di attenuazione noto pari a 10dB ($\frac{P_{A_{IN}}}{P_L} = \frac{1}{G_T}$).
Deve essere adattato, quindi $G_T = S_{21}$.

Affinché sia adattato, si deve imporre $Z_{IN} = Z_0$:

\begin{align*}
Z_{IN} &=
R_S + \frac{(R_S + Z_0)R_P}{R_S+Z_0+R_P} = Z_0
\\
R_S^2 &+\cancel{Z_0R_S}+R_PR_S + R_SR_P+\bcancel{Z_0R_P} = \cancel{Z_0R_S} + Z_0^2 + \bcancel{Z_0)R_P}                                   	\\
R_P &= \frac{Z_0^2 - R_S^2}{2R_S}
\\
\\
S_{21} &= \frac{2}{1+\cancel{\frac{Z_0}{Z_{IN}}}_1} \cdot
\frac{R_P Z_0}{Z_{IN}(R_P+R_S+Z_0)}=
\frac{R_P Z_0}{Z_{IN}(R_P+R_S+Z_0)}=
\frac{\frac{Z_0^2 - R_S^2}{2R_S} \cancel{Z_0}}
{\cancel{Z_0}(\frac{Z_0^2-R_S^2}{2R_S}+R_S+Z_0)}
\\&=
\frac{Z_0^2 - R_S^2}
{Z_0^2-\bcancel{R_S^2}+\bcancel{2}R_S^2+2Z_0R_S} =
\frac{(Z_0 - R_S)(Z_0 + R_S)}
{(Z_0 + R_S)(Z_0 + R_S)} = \frac{Z_0-R_S}{Z_0+R_S}
\\
&Z_0-R_S = S_{21} (Z_0+R_S) \quad\Rightarrow\quad
R_S = \frac{Z_0(1-S_{21})}{1+S_{21}}
\end{align*}
Se si vuole una attenuazione di 20dB bisogna imporre $\nicefrac{1}{|S_{21}|^2}=100 \Rightarrow S_{21}=0.1$:
\begin{align*}
R_S &= \frac{Z_0(1-0.1)}{1+0.1}
\overset{Z_0 = 50\Omega}{=}
40.9\\
R_P &= \frac{Z_0^2 - R_S^2}{2R_S} = 10.11\Omega
\end{align*}

\hfill	$\square$

\paragraph{Guadagno di potenza unilateralizzato}
Se prendiamo nuovamente in esame la formula del $G_T$ e imponiamo che il dispositivo sia unilaterale ($S_{12}=0 \Rightarrow \Gamma_{OUT} = S_{22} $):

\[G_{TU} = \frac{|S_{21}|^2(1-|\Gamma_S|^2)(1-|\Gamma_L|^2)}
{|1- S_{22}\Gamma_L|^2|1-S_{11}\Gamma_S|^2}  \]

Si ottiene il $G_{TU}$ massimo adattando in ingresso e uscita ($\Gamma_L = S_{22}^*$, $\Gamma_S = S_{11}^*$ )

\[G_{TU_{MAX}} = \frac{|S_{21}|^2}{(1-|S_{22}|^2)(1-|S_{11}|^2)}\]

\section{Stabilità}
Si possono ripetere considerazioni analoghe a quelle espresse in termini di parametri Y: a partire dalle definizioni di stabilità si giungerà ad un criterio che consenta di valutare se un sistema è incondizionatamente stabile o meno.

\begin{itemize}
	\item Un dispositivo è stabile in ingresso ad una frequenza $f_0$ se, per ogni $|\Gamma_S| \leq 1$, si ha sempre $|\Gamma_{OUT}(\Gamma_S)| < 1$.
	
	\item Un dispositivo è stabile in uscita ad una frequenza $f_0$ se, per ogni $|\Gamma_L| \leq 1$, si ha sempre $|\Gamma_{IN}(\Gamma_L)| < 1$.
	
	\item Si ha Incondizionata Stabilità se sono verificate le precedenti due condizioni.
\end{itemize}

Si possono motivare tali affermazioni con un esempio intuitivo a partire dalla teoria delle linee di trasmissione. Immaginiamo di applicare al quadripolo un gradino di tensione: l'onda che incide sulla porta d'ingresso darà luogo, in funzione del coefficiente di riflessione $\Gamma_{IN}$, ad una componente trasmessa (che attraversa il quadripolo) e ad una componente riflessa verso la sorgente. Quest'ultima torna alla sorgente e viene (parzialmente) riflessa verso il quadripolo, innescando un fenomeno ricorsivo e potenzialmente divergente.

Per definizione di stabilità di ingresso si vuole che, qualsiasi sia l'impedenza di sorgente (purché sia passiva, ossia $|\Gamma_S|<1$), non si abbiano oscillazioni. Poniamoci dunque nel caso più sfavorevole, ossia quando si ha totale riflessione ($|\Gamma_S| = 1$, sorgente puramente reattiva): se il quadripolo ha $|\Gamma_{IN}|<1$, pur avendo numerose riflessioni, queste avranno ampiezza sempre ridotta finché tutta l'energia inviata dalla sorgente attraverserà il quadripolo.
Se invece $|\Gamma_{IN}|>1$ l'onda riflessa sarà amplificata ad ogni rimbalzo.

\paragraph{Osservazione 1}
nell'ipotesi che il quadripolo non sia unilaterale, se $\Gamma_S \Gamma_{IN} = 1$ allora $\Gamma_L \Gamma_{OUT}=1$, e viceversa

Dimostriamolo riprendendo le espressioni \ref{eq:gammain} e \ref{eq:gammaout} dei coefficienti di riflessione al quadripolo in funzione di carico e sorgente:

\begin{align*}
\Gamma_{IN} &= S_{11} + \frac{S_{12} S_{21} \Gamma_L}{1-S_{22}\Gamma_L}=
\frac{S_{11}-S_{11}S_{22}\Gamma_L+S_{12}S_{21}\Gamma_L}{1-S_{22}\Gamma_L} =
\frac{S_{11} - D\Gamma_L}{1-S_{22}\Gamma_L}
\\
\Gamma_{OUT} &= S_{22} + \frac{S_{12} S_{21} \Gamma_S}{1-S_{11}\Gamma_S}=
\frac{S_{22}-S_{11}S_{22}\Gamma_S+S_{12}S_{21}\Gamma_S}{1-S_{11}\Gamma_S} =
\frac{S_{22} - D\Gamma_S}{1-S_{11}\Gamma_S}
\end{align*}

Possiamo scrivere l'ipotesi $\Gamma_S\Gamma_{IN} = 1$ anche come $\Gamma_S = \nicefrac{1}{\Gamma_{IN}}$.

\[
\Gamma_{OUT} =
\frac{S_{22} - D \frac{1}{\Gamma_{IN}}}{1-S_{11} \frac{1}{\Gamma_{IN}}}
=
\frac{S_{22}- D \frac{1-S_{22}\Gamma_L}{S_{11} - D\Gamma_L}}{1-S_{11}\frac{1-S_{22}\Gamma_L}{S_{11} - D\Gamma_L}} =
\frac{S_{11}S_{22} -\cancel{ D S_{22}\Gamma_L} -D+ \cancel{DS_{22}\Gamma_L}}{\bcancel{S_{11}} - D\Gamma_L -\bcancel{S_{11}}+S_{11}S_{22} \Gamma_L}
= \frac{1}{\Gamma_L}
\]

%	È chiaro che se il dispositivo è unilaterale ($S_12 = 0$)  si ha divisione per 0, ma comunque è abbastanza improbabile avere un dispositivo in alta frequenza che non sia unilaterale.

%	Vale anche il viceversa

\paragraph{Osservazione 2} Se il dispositivo è Incondizionatamente Stabile in ingresso, allora è Incondizionatamente Stabile in uscita, e viceversa. In modo più formale si può dire:
%	IS in input $\Leftrightarrow$ IS in output (se non è possibile trovare una coppia di terminazioni che verifichino le condizioni di barkhousen in ingresso, allora non le verificano nemmeno in uscita, e viceversa)
\[
\forall \Gamma_S \leq 1 \Rightarrow
|\Gamma_{OUT}| <1
\quad
\Leftrightarrow
\quad
\forall \Gamma_L \leq 1 \Rightarrow
|\Gamma_{IN}| <1
\]

Ai fini della dimostrazione è più pratico ragionare in termini potenziale instabilità di ingresso e uscita. Supponiamo dunque che il dispositivo sia Potenzialmente Instabile in ingresso per dimostrare che lo è anche in uscita.
\[
\exists |\overline{\Gamma}_S| \leq 1 : |\Gamma_{OUT}| \geq1
\]
Si chiude l'uscita su un particolare carico tale che $\overline{\Gamma}_L =\frac{1}{\Gamma_{OUT}(\overline{\Gamma}_S)} \overset{per HP}{<} 1$
\\
Avendo posto $\overline{\Gamma}_L \Gamma_{Out}(\overline{\Gamma}_S) = 1$, per l'osservazione prima dimostrata si deve avere necessariamente $\overline{\Gamma}_S \Gamma_{IN} = 1$. Siccome la sorgente è passiva per ipotesi ($\Gamma_S < 1$), affinché sia soddisfatta bisogna che $\Gamma_{IN}(\overline{\Gamma}_L) \geq 1$, dunque il dispositivo è potenzialmente instabile anche in uscita.

\subsection{Criteri per l'analisi della stabilità}

Soffermiamoci sulla stabilità di ingresso.

\[\Gamma_{OUT} = \frac{S_{12}S_{21} \Gamma_S}{1-S_{11}\Gamma_S}+S_{22}\]

Come si vede chiaramente dalla formula il $\Gamma_{OUT}$ è funzione di $\Gamma_S$. Poniamoci nella condizione limite per la stabilità:
\[|\Gamma_{OUT}(\Gamma_S)|^2 = 1 = \Gamma_{OUT}\Gamma_{OUT}^*  \]

Dato che il coefficiente di riflessione è un numero complesso si può scrivere $\Gamma_S = u + jv$ e andare a risolvere la seguente equazione:

\[ 1 = \left| \frac{S_{12}S_{21} (u+jv)}{1-S_{11}(u+jv)}+S_{22} \right| ^2\]

Tramite alcuni passaggi qui non riportati è possibile dimostrare che la curva descritta sul piano complesso dei $\Gamma_S$ tale che $\Gamma_{OUT} = 1$ è una circonferenza, che prende il nome di \textbf{cerchio di stabilità di ingresso}. Si ottengono i seguenti valori per centro e raggio della circonferenza:

%Dalla formula \ref{eq:gp} è nota la relazione che sussiste fra $\Gamma_{IN}$ e $\Gamma_L$. Tramite alcuni passaggi qui non riportati è possibile dimostrare che la curva descritta sul piano complesso dei $\Gamma_L$ tale che $\Gamma_{IN} = 1$ è una circonferenza, che prende il nome di \textbf{cerchio di stabilità di ingresso}.

\begin{equation}
\begin{dcases}
C_S &= \frac{(S_{11} - S_{22}^*D)^*}{|S_{11}|^2 - |D|^2}\\
r_S &= \frac{|S_{12}S_{21}|}{||D|^2 - |S_{11}|^2|}\\
\end{dcases}
\qquad
\mbox{con } D = \det \underline{\underline{S}} = S_{11} S_{22} - S_{21} S_{12}
\end{equation}

Con conti analoghi è possibile ricavare un \textbf{cerchio di stabilità di uscita}. 

\begin{equation}
\begin{dcases}
C_L &= \frac{(S_{22} - S_{11}^*D)^*}{|S_{22}|^2 - |D|^2}\\
r_L &= \frac{|S_{12}S_{21}|}{||D|^2 - |S_{22}|^2|}\\
\end{dcases}
\qquad
\mbox{con } D = \det \underline{\underline{S}} = S_{11} S_{22} - S_{21} S_{12}
\end{equation}

Per l'analisi della stabilità si può procedere disegnando sul piano dei $\Gamma_S$	la circonferenza di stabilità: essa fa da confine tra una zona stabile, detta \textbf{area di stabilità di ingresso} e una instabile. Per riconoscere la zona \textit{buona} basta fare una verifica nell'origine degli assi:

\[\Gamma_{OUT}(\Gamma_S = 0) = S_{22}\]

Quindi se $S_{22} < 1$ l'area di stabilità è quella che contiene questo punto. Se, invece, $S_{22} > 1$ l'area che contiene questo punto è di instabilità.

Poiché siamo interessati ai soli carichi passivi, è opportuno disegnare anche il cerchio tale per cui $|\Gamma_S| \leq 1$, che prende il nome di cerchio di Smith.\\
Come mostrato in figura \ref{fig:cerchi-stabilita} le posizioni relative delle due circonferenze possono condurre a quattro diverse situazioni, ed è facile verificare graficamente se un certo $\Gamma_S$ comporti potenziale instabilità. 
%	
%	Si calcola il caso semplice $\Gamma_{OUT} (\Gamma_S = 0) = S_{22}$. Se è minore di 1 e lo 0 è fuori, allora è stabile fuori (e nella circonferenza di Smith (?)). o viceversa per gli altri 3 possibili casi.
%	
%	Ci possono essere 4 situazioni diverse:
%	zona stabile interna al cerchio di stabilità oppure esterna. Basterà dunque calcolare il valore di $\Gamma_{OUT} (\Gamma_S= 0) = S_{22}$.

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.7\linewidth]{img/raster/cerchi-stabilita}
	\caption{È intuitivo che la stabilità incondizionata si può avere soltanto in due casi}
	\label{fig:cerchi-stabilita}
\end{figure}

I due casi di Incondizionata Stabilità si possono caratterizzare matematicamente nel modo seguente:

\begin{itemize}
	\item Cerchio di stabilità esterno al cerchio di Smith ($|C_S| - r_S > 1$) e area di stabilità esterna ($|S_{22}|<1$);
	\item
	Cerchio di Smith interno al cerchio di stabilità ($r_S - |C_S| > 1$) e area di stabilità interna ($|S_{22}|<1$).
\end{itemize}

Oppure, compattando in una sola espressione:
\begin{equation}
\begin{dcases}
\Mod{\Mod{C_S} - r_S} \geq 1\\
|S_{22}| <1
\end{dcases}
\end{equation}

Questo criterio di verifica della stabilità è detto criterio topologico. Si possono ripetere le stesse considerazioni appena fatte per la porta di uscita.

%	
%	 $\Gamma_S = u + jv$ sul piano di Gauss, fissando $\Gamma_{OUT}$, si vede che i punti stanno su una circonferenza, che prende il nome di cerchio di stabilità di ingresso.
%	
%	 ( insieme dei $\Gamma_S \mbox{per cui} \Gamma_{OUT} = 1$).
%	
%	Centro della circonferenza  dove  (ovviamente è complesso, è il centro nel piano di Gauss)
%	
%	Raggio 
%	
%	Area di stabilità di ingresso: insieme dei $\Gamma_S$ tali che $|\Gamma_{OUT}(\Gamma_S)|<1$ 
%	
%	Achtung: l'area di stabilità può essere l'interno della circonferenza ma anche l'esterno.
%	Come si capisce?
%	
%	Si calcola il caso semplice $\Gamma_{OUT} (\Gamma_S = 0) = S_{22}$. Se è minore di 1 e lo 0 è fuori, allora è stabile fuori (e nella circonferenza di Smith (?)). o viceversa per gli altri 3 possibili casi.
%	
%	Ci possono essere 4 situazioni diverse:
%	\begin{itemize}
%		\item circonferenza di stabilità e di smith non hanno punti in comune (Non si intersecano)
%		\item ... si intersecano
%		\item cerchio di stabilità interno a smith
%		\item il contrario
%	\end{itemize}
%	
%	
%	\begin{figure}[h]
%		\centering
%		\includegraphics[width=0.5\linewidth]{img/raster/smithbruttissimo}
%		\caption{}
%		\label{fig:smithbruttissimo}
%	\end{figure}
%	
%	In almeno due casi è escluso a priori che sia incondizionatamente stabile:
%	
%	nel caso 3 e nel caso 2 (variando punti nel cerchio di smith becco sempre dei punti di instabilità, quindi esiste una cinfigurazione che mi dà instabilità, quindi non è incondizionatamente stabile)
%	
%	
%	caso 1
%	$|C_S| - r_S > 1$ (cerchio di smith fuori dalla circ di stabilità) e $|S_{22}|<1$ (stabile fuori dal cerchio di stabilità, valore per $\Gamma_S = 0$ che è fuori dal cerchio) incondizionatamente stabile (in ignresso)
%	
%	caso 4: $r_S - |C_S| > 1$ (circonferenze una dentro l'altra) e $|S_{22}|<1$ ( stabilità dentro, valore per $\Gamma_S = 0$ che è dentro dal cerchio)) allora incondizionata stabilità (in ingresso)
%	
%	In un colpo solo... Criterio topologico


Con ulteriori elaborazioni è possibile ricavare una condizione di stabilità basata su un parametro che prende il nome di Fattore di stabilità a microonde K:

\begin{equation}
\begin{dcases}
K = \frac{1- |S_{11}|^2-|S_{22}|^2+|D|^2}{2 |S_{12} S_{21}|} > 1\\
|D| = |S_{11} S_{22} - S_{21} S_{12}| < 1
\end{dcases}
\end{equation}

Con questo metodo si verifica la stabilità evitando il calcolo di centro e raggio dei cerchi di stabilità, ma risulta inefficace quando si vuol valutare se una particolare combinazione di impedenze è interna alle aree di stabilità: in tal caso bisognerà ricorrere al metodo grafico.

\section{Cerchi equi-guadagno}

Nella progettazione di amplificatori viene spesso fornito, come dato di progetto, il minimo guadagno che lo stadio deve avere. Analizziamo quindi una metodologia per ottenere un certo guadagno da uno stadio di amplificazione applicando le definizioni ricavate finora.

\subsection{Cerchi equi-$G_P$ e equi-$G_A$}
Studiamo come varia il $G_P$ al variare della stabilità:

\[ G_P = \left| \frac{S_{21}}{1 - S_{22}\Gamma_L} \right|^2
\frac{1- |\Gamma_L|^2}{1- |\Gamma_{IN}|^2} \Rightarrow g_p = \frac{G_P}{|S_{21}|} = \left| \frac{1}{1 - S_{22}\Gamma_L} \right|^2
\frac{1- |\Gamma_L|^2}{1- |\Gamma_{IN}|^2}\]

Si può dimostrare che il luogo dei punti sul piano complesso dei $\Gamma_L$, fissato un certo $\overline{g}_P(\Gamma_L)$, descrive una circonferenza caratterizzata dalle seguenti espressioni di centro e raggio:

%	Per praticità si definisce un $g_P = \frac{G_P}{|S_{21}|^2} = ...$
%	
%	Facendo assumere al $g_P(\Gamma_{L})$ un valore fisso $\overline{g}_P$ si vede che i luoghi di punti equi$g_P$ sono circonferenze con le seguenti espressioni:

\begin{equation}
\begin{dcases}
C_{P} =\frac{\overline{g}_P (S_{22} - S_{11}^* D)^*}
{1+\overline{g}_P(|S_{22}|^2 - |D|^2)}\\
r_{P} = {\frac{\sqrt{1 - 2 k |S_{12}S_{21}|\overline{g}_P + \overline{g}_P^2 |S_{12} S_{21}|^2}}{|1+\overline{g}_P(|S_{22}|^2 - |D|^2)|}}
\end{dcases}
\quad
%con~\overline{g}_P = \frac{G_P}{|S_{21}|^2}
\end{equation}

%	$$\mbox{Centro del cerchio di stabilità di uscita: } C_2 = \frac{(S_{22}- S_{11}^*D)^*}{|S_{22}|^2 -|D|^2}$$
%	$$\mbox{Centro del cerchio di stabilità di ingresso: } C_1 = C_S = \frac{(S_{11}- S_{22}^*D)^*}{|S_{11}|^2 -|D|^2}$$
%	
Confrontando il vettore $C_P$ con il vettore centro del cerchio di stabilità in ingresso $C_L = \frac{(S_{22} - S_{11}^*D)^*}{|S_{22}|^2 - |D|^2}$, si può notare che hanno a comune il termine complesso $(S_{22} - S_{11}^*D)^*$, moltiplicato per fattori reali diversi: questo significa che il centro del cerchio di stabilità e il centro del cerchio equi-$G_P$ stanno sulla stessa retta.\\
Non è superfluo sottolineare che $C_P$ non descrive un singolo punto, bensì un insieme di punti che si muovono al variare di $\overline{g}_P$.
Non tutti i valori danno però effettivamente luogo ad una circonferenza: nel raggio è presente una radice il cui radicando può assumere valori negativi.
%	Il radicando del raggio è una parabola in funzione di gp, che può essere negativa. Dunque per alcuni valori di gp non si trova un raggio e non esiste nessun cerchio (disegnino parabola, se <1 la radice non esiste e r non esiste)

Analizziamo l'espressione del $G_P$ per verificare la possibile presenza di punti di singolarità al variare di $\Gamma_L$:

$$G_P = \frac{|S_{21}|^2}{|1-S_{22}\Gamma_L|^2}
\frac{1-|\Gamma_L|^2}{1-|\Gamma_{IN}|^2}$$

\begin{itemize}
	\item se $\Gamma_L = \nicefrac{1}{S_{22}}$ il $G_P$ diverge, ma è una condizione che non ci interessa dato che $\frac{1}{\Gamma_L}$ è un punto al di fuori del cerchio di Smith;
	\item se $|\Gamma_{IN}| = 1$, ossia ci troviamo sul bordo del cerchio di stabilità, il guadagno diverge;
	\item se il cerchio di stabilità di ingresso e il cerchio di Smith si intersecano, abbiamo una forma indeterminata $\frac{0}{0}$ in corrispondenza delle intersezioni, poiché sia  $|\Gamma_{IN}| = 1$ che  $|\Gamma_{L}| = 1$. Da questi punti passano tutti i cerchi equi-$G_P$, in quanto la forma indeterminata vale $+\infty$ o $-\infty$ a seconda del punto da cui si arriva e perciò in quei punti si attraversano in un $\varepsilon \rightarrow 0$ tutti i valori possibili di $G_P$;
	\item se il cerchio di stabilità è esterno alla circonferenza di Smith e fuori dal cerchio $|\Gamma_{IN}|<1$ allora il $g_p$ è sempre positivo all'interno della carta di Smith, le circonferenze equi-$G_P$ sono concentriche e una di esse è il cerchio di Smith. Infine dato che i cerchi sono concentrici tutti i valori assunti da $G_P$ sono sulla retta che passa per i centri.
\end{itemize}

Il massimo del $G_P$ si ha quando la circonferenza equi-$G_P$ degenera in un punto. Si ricava facilmente ponendo il raggio uguale a zero:
\begin{align*}
&1 - 2K|S_{12} S_ {21}| \overline{g}_{P_{max}} + \overline{g}_{P_{max}}^2 |S_{12} S_{21}|^2 = 0
\\
&\overline{g}_{P_{max}} =
\frac{2K|S_{12}S_{21}| \pm \sqrt{4K^2|S_{12}S_{21}|^2 - 4 |S_{12}S_{21}|^2}}{2|S_{12}S_{21}|^2} = \frac{K \pm \sqrt{K^2 -1}}{|S_{12}S_{21}|}
\\
&\overline{G}_{P_{max}} = \overline{g}_{P_{max}} |S_{21}|^2 =  \Mod{\frac{S_{21}}{S_{12}}} (K \pm \sqrt{K^2 -1})
\end{align*}

\textbf{Osservazione:} si ottengono due punti. In uno il $G_P$ è massimo, nell'altro è minimo. Si noti anche che questa formula è valida solo per $K<1$. Si può verificare che il massimo si ottiene con il segno ``-":
\[\overline{G}_{P_{max}} =  \Mod{\frac{S_{21}}{S_{12}}} (K - \sqrt{K^2 -1})  \]

Si possono ripetere le stesse considerazioni per il $G_A(\Gamma_S)$. Risulta tutto analogo, fatta eccezione per i pedici invertiti.
\begin{align}
&\overline{g}_A = \frac{\overline{G_A}}{|S_{21}|^2}
\n
&
\begin{dcases}
	C_{A} =\frac{\overline{g}_A (S_{11} - S_{22}^* D)^*}
	{1+\overline{g}_A(|S_{11}|^2 - |D|^2)}\\
	r_{A} = {\frac{\sqrt{1 - 2 k |S_{12}S_{21}|\overline{g}_A + \overline{g}_A^2 |S_{12} S_{21}|^2}}{|1+\overline{g}_A(|S_{11}|^2 - |D|^2)|}}
\end{dcases}
\\
&\overline{G}_{A_{max}} =  \Mod{\frac{S_{12}}{S_{21}}} (K - \sqrt{K^2 -1})
\nonumber
\end{align}
Quindi, se esistono, $G_{A_{max}} = G_{P_{max}}$

Riassumendo, in un dispositivo Incondizionatamente Stabile:
\[G_P (\Gamma_{Lopt}) = G_{P_{max}}\]
\[G_A (\Gamma_{Sopt}) = G_{A_{max}}\]

Se si realizza l'adattamento complesso coniugato su entrambe le porte ($\Gamma_{Sopt} = \Gamma_{IN}^* (\Gamma_{Lopt})$ e $\Gamma_{Lopt} = \Gamma_{OUT}^* (\Gamma_{Sopt})$) entrambe le condizioni sono vere e si ha massimo trasferimento di potenza:
\[G_{T_{max}} = G_{P_{max}} = G_{A_{max}} \]
\textit{(dimostrazione omessa)}
%Verifichiamo che questa ultima asserzione è vera:
%da qui buio totale...

%Se un dispositivo è IS allora il GP(gammaL) ha un punto di massimo, e GP(gammaLopt)=GPmax = $G_{P_{max}} = |\frac{S_{21}}{S_{12}}| (K \pm \sqrt{K^2 -1})$\\
%&idem per il GA max

%se un dispositivo è IS
%\begin{itemize}
%\item $G_{T_{max}}=G_{A_{max}}=G_{P_{max}}$
%\item $\Gamma_{Sopt} = \Gamma^*_{in}(\Gamma_{lopt})$ e $\Gamma_{Lopt} = \Gamma^*_{out}(\Gamma_{sopt})$
%\end{itemize}

%esperimento sul fogliaccio

\subsection{Cerchi equi-$G_T$}

$$G_T = \frac{(1-|\Gamma_S|^2) |S_{21}|^2 (1-|\Gamma_L|^2)}{|1-\Gamma_{OUT}\Gamma_{L}|^2|1-S_{11}\Gamma_{S}|^2}$$

Nel progetto di un LNA a minima cifra di rumore è necessario che l'impedenza sorgente sia l'impedenza ottima dal punto di vista del rumore. Fissata quindi l'impedenza sorgente, per massimizzare il $G_T$ si può agire sul $\Gamma_L$.
%	Se voglio progettare un LNA a minimo rumore (minima cifra di rumore) bisogna che l'impedenza sorgente sia quella ottima (reale nel range medio basso di funzionamento dei dispositivi, tende ad avere parte immaginaria al crescere della frequenza di funzionamento).

%	Operativamente: si fissa $\Gamma_S$ e ci si muove di conseguenza variando $\Gamma_L$. È interessante studiare come varia il $G_T$.
%	
%	Come sono fatti i luoghi equiGT? ossia: a $\Gamma_S$ fissato, variando $\Gamma_L$ esistono punti a $G_T$ costante? 

Cerchiamo allora sul piano dei $\Gamma_L$ il luogo dei punti a $G_T$ e $\Gamma_S$ fissati e dimostriamo che, ancora una volta, si tratta di circonferenze.
Per semplificare i calcoli manipoliamo l'espressione del $G_T$ raccogliendo tutti i fattori costanti sotto un unico termine, che chiameremo $G_{TI}$.

\begin{align*}
&\overline{G}_T  = \frac{(1-|\Gamma_S|^2) |S_{21}|^2 (1-|\Gamma_L|^2)}{|1-\Gamma_{OUT}\Gamma_{L}|^2|1-S_{11}\Gamma_{S}|^2}\\
&\overline{G}_T \frac{|1-S_{11}\Gamma_{S}|^2}
{|S_{21}|^2 (1-|\Gamma_S|^2)} = G_{TI} =  \frac{1-|\Gamma_L|^2}{|1-\Gamma_{OUT}\Gamma_{L}|^2}
\end{align*}

Si scompongono i termini complessi $\Gamma_L$ e $\Gamma_{OUT}$ nella loro rappresentazione cartesiana:
%	Luogo dei punti che soddisfa questa equazione ($\Gamma_{OUT}$ si pesca dalle formule prima in funzione dei parametri S e di gammaS, ma ci frega il giusto perche lo scriviamo come parte reale e parte immaginaria)
\begin{align*}
\Gamma_L &= u + jv\\
\Gamma_{OUT} &= a + jb
\end{align*}
\begin{align*}
& G_{TI}~|1-\Gamma_{OUT} \Gamma_L|^2 =
1-|\Gamma_L|^2
\\
& G_{TI}~|1-\left[ua - vb + j(ub + va) \right]|^2 = 
1 - u^2 - v^2
\end{align*}
Consideriamo il modulo quadro a sinistra:
\begin{align*}
& (1-ua+vb)^2 + (ub+va)^2 =\\
&= 1 + u^2a^2 + v^2b^2 -2ua + 2vb - \cancel{2uvab}
+ u^2b^2 + v^2a^2 + \cancel{2 uvab}
\end{align*}
Uguagliando al secondo membro della equazione e raccogliendo tutti i termini in $u$ e $v$:

\begin{align*}
&(G_{TI}a^2 + G_{TI}b^2 +1)u^2
+ (G_{TI}b^2 + G_{TI}a^2 + 1)v^2
- 2G_{TI}ua + 2G_{TI}vb + G_{TI} -1 = 0\\
&(G_{TI}~|\Gamma_{OUT}|^2 +1)u^2
+ (G_{TI}~|\Gamma_{OUT}|^2 + 1)v^2
- 2G_{TI}ua + 2G_{TI}vb + G_{TI} -1 = 0
\end{align*}
Che può essere riportata nella forma canonica, da cui si ricavano poi centro e raggio
\begin{align*}
u^2 + v^2 -
\frac{2 G_{TI}a}{G_{TI} |\Gamma_{OUT}^2|+1} u+
\frac{2 G_{TI}b}{G_{TI} |\Gamma_{OUT}^2|+1} v
+ \frac{G_{TI} -1}{G_{TI} |\Gamma_{OUT}^2|+1} = 0
\end{align*}

\[
\begin{dcases}
C_T = \frac{G_{TI}}{G_{TI}~|\Gamma_{OUT}|^2 + 1}\Gamma_{OUT}^*\\
r_T = \sqrt{
	\frac{G_{TI}^2 |\Gamma_{OUT}|^2}{\left(G_{TI}|\Gamma_{OUT}|^2 +1\right) ^2} + 
	\frac{1 - G_{TI}}{G_{TI}|\Gamma_{OUT}|^2 +1}
}		
\end{dcases}
\]


Il cerchio equi-$G_T$ esiste se il radicando del raggio è positivo. L'unico elemento di possibile negatività è il termine $1-G_{TI}$, che potrebbe essere negativo se $1-|\Gamma_L|^2 < 0$.
%	
%	-- recap--\\
%	Fissando l'impedenza di ingresso, mi chiedo il luogo dei $\Gamma_L$ (terminazioni di uscita) che rendano GT pari a un certo valore
%	
Occorre prestare attenzione a un particolare: abbiamo calcolato un serie di cerchi equi-$G_T$ fissando un certo $\Gamma_{S}$. Se troviamo un massimo di questa serie di cerchi esso non necessariamente sarà il massimo di tutti i $G_T$ possibili. Esso infatti si raggiungerà solo se l'ingresso e l'uscita sono le terminazioni ottime e quindi sarà il massimo della serie di cerchi ottenuta fissando $\Gamma_{S} = \Gamma_{Sopt}$. Se, invece, il dispositivo è Potenzialmente Instabile, e per esempio si fissa l'ingresso, ha senso cercare il massimo del $G_T$ variando l'uscita.


%\paragraph{Esempio}
%Realizzare con il transistor MRF571, per $\Gamma_S = 0$ (impedenza sorgente a $50\Omega$), un amplificatore con $G_T = 8dB$ a frequenza $f_0 = 500Mhz$, con $V_{CE} = 6V$ e $I_C = 5mA$
%
%%figurina sul fogliaccio (polarizzazione)
%
%%$$V_{CE} = 6 \Rightarrow V_E = 6V \Rightarrow R_E = 1.2k \Omega$$
%%$$V_B = 6.7V \Rightarrow R_1 = 5.3k ~~ R_2 = 6.7k\Omega$$
%%Verifica partitore pesante
%%$$R_1 I_B \ll V_{CC} \Rightarrow h_{FE} \overset{dallecaratteristiche}{=}
%%50 \Rightarrow
%%6.7k\Omega \cdot 100\mu A \ll 12V ~~~ OK$$
%
%%Come al solito il condensatore $C_E$ si realizza con un'impedenza di $0.1\Omega$ a frequenza di lavoro.
%
%Per la polarizzazione richiesta si ottengono i seguenti parametri dal datasheet:
%\[
%\begin{array}{cccc}
%	S_{11} = 0.62 \angle-143
%	&
%	S_{12} = 0.08 \angle33
%	&
%	S_{21} = 5.50 \angle97
%	&
%	S_{22} = 0.41 \angle-58
%\end{array}
%\]
%
%\begin{figure}[h!]
%	\centering
%	\includegraphics[width=0.7\linewidth]{img/raster/parametri1}
%	\caption{si intersecano: potenziale instabilità}
%	\label{fig:parametri1}
%\end{figure}
%
%
%Esperimento:si prende un $\Gamma_S$ che stia nella zona di instabilità (ad esempio, con fase pari a quella del centro del cerchio di instabilità e modulo quasi 1): si ottiene un $\Gamma_{OUT}>1$ ed è quello che ci si aspettava
%
%Lo stesso giochino si può fare col cerchio di stabilità in uscita, scegliendo l'opportuno $\Gamma_L$ e trovando 
%$\Gamma_{IN}>1$
%
%Effettuando i calcoli si ricavano 
%Inserendo il $G_T = 8dB$ e il $\Gamma_S = 0$ si cerca una $\Gamma_L$ che dà il GT che ci vole
%
%Un qualsiasi valore sulla circonferenza va bene, basta che poi sia facile da adattare ($25 Z_0$ oppure $0.08Z_0$)
%
%Adattamento (impedenza di arrivo $25 Z_0$, di partenza $Z_0$):
%
%$Z_{\nicefrac{\lambda}{4}} = \sqrt{Z_0 Z_0 \cdot 25} = 250 \Omega $
%
%
%
%
%Rete di polarizzazione MRF571-572

\subsection{Analisi del rumore e cerchi equi-noise}

Al solito, trattando dispositivi rumorosi conviene schematizzare il quadripolo come privo di rumore, riportando le componenti in ingresso tramite opportuni generatori di rumore equivalenti (di tensione e di corrente). In generale, alle basse frequenze, $e_n$ ed $i_n$ risultano approssimativamente indipendenti.
%(il quadripolo è unilaterale e lo studio del circuito equivalentee l'approssimazione di indipendenza tiene).
Con l'analisi a parametri Y si è cercato di rispettare questa condizione.
\\
Alle alte frequenze il quadripolo (in genere) non è più unilaterale, ed intervengono effetti che non consentono di considerare l'indipendenza.

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.7\linewidth]{img/quadripolo-rumore}
	\caption{generatori di tensione: della resistenza (di ingresso) e del quadripolo (euivalente), generatore di corrente e quivalente}
	\label{fig:rumorebruttissimo}
\end{figure}


L'analisi del rumore in un transistor (e la conseguente schematizzazione con generatori equivalenti in ingresso) si fa a partire dal circuito di Giacoletto comprensivo di generatori di rumore (circuito di van der Ziel)

%
%
%\[
%NF = \frac{N_{U_{TOT}}}{NU_{IN}}
%= \frac{NU_{IN} + NU_Q}{NU_{IN}}
%= 1+ \frac{NU_Q}{NU_{IN}}
%\]
%Conviene schematizzare


\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.7\linewidth]{img/quadripolo-van-der-ziel}
	\caption{Circuito di Van der Ziel
		%	. Nota: S3 è il generatore pilotato del BJT. generatore di tensione et, generatore di corrente ibn (sx) e ien(dx)
	}
	\label{fig:rumorebruttissimo1}
\end{figure}

Si può scomporre il contributo a $e_n$ in due parti: una direttamente data da generatori di rumore in tensione ($e_i$) ed una che deriva da contributi di generatori di rumore in corrente, dove $Z_{cor}$ ne è il fattore di correlazione:

\[
e_n = e_i + Z_{COR}i_n
\]

Si calcola l'equivalente di Thevenin (per poter calcolare la potenza di rumore dovuta al quadripolo):
\[e_n + i_nZ_S = e_i + Z_{cor}i_n + i_n Z_S =
e_n + (Z_{cor}+Z_S)i_n\]

In termini di densità spettrale di potenza (tenendo conto che l'impedenza di Thevenin è $R_S$):

\begin{align*}
S_{n} &= \frac{S_i + |Z_{cor} + Z_S|^2 S_{i_n}}{4R_S}\\
N_{U_Q} &= S_{n} \cdot G_T \cdot \Delta f\\
N_{U_{IN}} &= 4kT R_S \cdot G_T \cdot \Delta f\\
NF&=1+\frac{N_{U_Q}}{N_{U_{IN}}} =
1+ \frac{S_i + |Z_{cor} + Z_S|^2 S_{i_n}}{4R_S}\cancel{G_T} \bcancel{\Delta f} \cdot \frac{1}{kT \bcancel{\Delta f} \cancel{G_T}}=
1+\frac{S_i + |Z_{cor} + Z_S|^2 S_{i_n}}{4kT R_S}
\end{align*}

Per calcolare la potenza di rumore si è supposta la densità spettrale costante in frequenza, moltiplicando dunque per $\Delta f$. Non è detto che il rumore del quadripolo sia costante, ma si suppone di fare questo conto a una frequenza dove questa approssimazione non risulta pesante.
\[
|Z_{COR} + Z_S|^2 = (R_{COR} + R_S)^2 + (X_{COR} + X_S)^2
\]

Si agisce sulla impedenza di sorgente per minimizzare il rumore. Sicuramente si può cercare di annullare il termine di reattanza, ponendo $X_{S_{ON}} = - X_{COR}$.
Si può osservare che, a causa della non indipendenza dei generatori, l'impedenza ottima non è una resistenza pura.\\
A questo punto la R ottima si potrebbe calcolare analiticamente imponendo nulla la derivata della cifra di rumore.
\[
\frac{d}{dR_S} \frac{S_i + (R_{COR} + R_S)^2 S_{i_n}}{4kT R_S} = 0
\]

Per completare questo calcolo basterà ricavare dalle caratteristiche del dispositivo i quattro parametri $S_i$, $S_{i_n}$, $R_{COR}$ e $X_{COR}$. In realtà, a livello di progettazione a microonde si preferisce una differente formulazione (derivabile da quella appena descritta) in termini di coefficienti di riflessione in luogo delle impedenze.

\[
NF(\Gamma_S) = NF_{MIN} + \frac{4 ~r_n |\Gamma_S - \Gamma_{S_{ON}}|^2}{(1-|\Gamma_S|^2) ~|1+\Gamma_{S_{ON}}|^2}
\]

Il costruttore fornisce i quattro parametri tipici del componente, ossia l'impedenza sorgente ottima $\Gamma_{S_{ON}}$ (modulo e fase), la minima cifra di rumore che si può ottenere $NF_{MIN}$ ed il coefficiente adimensionale $r_n$. Quest'ultimo viene talvolta dato come $R_n = r_n \cdot Z_0$, che ha dimensioni di Ohm.
\\
In alcuni datasheet viene dato anche il parametro $NF_{50}$, che corrisponde a $NF(\Gamma_S = 0)$ ossia la cifra di rumore quando si ha adattamento in ingresso.
%GLi altri 3 parametri sono NFmin e $\Gamma_{S_{ON}} = modulo e fase$.

Si può verificare facilmente, ponendo $\Gamma_S = \Gamma_{S_{ON}}$, che la cifra di rumore minima si ottiene usando l'impedenza sorgente ottima.\\
Se invece $\Gamma_S$ tende all'unità, ossia in caso di sorgente puramente reattiva, la cifra di rumore tende ad infinito: in termini pratici significa annullare il rumore prodotto dalla sorgente, termine presente al denominatore di NF.

L'impedenza sorgente ottima per il rumore non coincide con l'impedenza sorgente che massimizza il guadagno, dunque sarà necessario un criterio che permetta di studiare un buon compromesso fra amplificazione e qualità del segnale.
È dimostrabile che, per un valore fissato della cifra di rumore, i $\Gamma_S$ descrivono una circonferenza sul piano complesso.

\[
\frac{(NF - NF_{MIN})|1+\Gamma_{ON}|^2}{4r_n} = N_i =
\frac{|\Gamma_S - \Gamma_{ON}|^2}{1-|\Gamma_S|^2}
\]

Si scrive $\Gamma_s = u+jv$, $\Gamma_{s_{ON}} = a+jb$
\begin{align*}
& (1-|u+jv|^2)N_i =|u+jv-(a+jb)|^2\\
& (1-u^2-v^2) N_i = (u-a)^2+(v-b)^2\\
& (1-u^2-v^2 ) N_i = u^2 +a^2 -2ua +v^2 +b^2-2vb\\
& (N_i+1) u^2 + (N_i+1)v^2
-(2N_ia) u -(2N_ib) v + N_i = 0\\
& u^2 + v^2 + \frac{2N_ia}{N_i+1}u
+ \frac{2N_ib}{N_i+1}v + \frac{N_i -1}{N_i+1}=0
\end{align*}

%\begin{figure}[h]
%	\centering
%	\includegraphics[width=0.7\linewidth]{img/raster/giovannistorti}
%	\caption{la dimostrazione è lasciata al lettore}
%	\label{fig:giovannistorti}
%\end{figure}

Dall'equazione canonica della circonferenza si ricava:
\begin{equation}
\begin{dcases}
C_i = \frac{\Gamma_{S_{ON}}}{1+N_i}\\
r_i = \sqrt{\frac{(1+N_i)N_i + N_i|\Gamma_{ON}|^2}{(1+N_i)^2}}
\end{dcases}
\end{equation}

Poiché tutti i possibili valori di NF sono sempre maggiore di $NF_{ON}$, i centri delle relative circonferenze sono compresi fra la circonferenza di Smith ($|\Gamma_S|=1$, cifra di rumore che tende ad infinito) e il punto $NF_{ON}$.

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.4\linewidth]{img/raster/mrf571}
	\caption{Cerchi equi-$G_A$ ed equi-noise per il transistor MRF571 alla frequenza di 1GHz}
	\label{fig:equinoise-datasheet}
\end{figure}

I cerchi equi-noise sono utili a livello di progettazione. Facciamo riferimento alla figura \ref{fig:equinoise-datasheet}: le specifiche di progetto richiedono la realizzazione di un amplificatore a basso rumore che guadagni almeno 12dB. Se si sceglie la $\Gamma_S$ per il rumore ottimo si ha un guadagno inferiore a 12dB, dunque ci si posiziona sulla circonferenza equi-guadagno e si localizza il $\Gamma_S$ che dia la cifra di rumore minima (indicativamente individuata in figura).


\section{Progettazione a microstriscia}
A microonde, l'implementazione di adattatori d'impedenza si fa utilizzando la carta di Smith. Principalmente si useranno metodi che fanno uso di soli due tratti di microstriscia.

\paragraph{Metodo 1 - trasformatore a $\nicefrac{\lambda}{4}$:} trasformare 25+15j$\Omega$ in 150$\Omega$.

\begin{figure}[hbt]
	\centering
	\raisebox{-.5\height}{\includegraphics[width=0.45\linewidth]{img/smith-chart-1}}
	\hfill
	\raisebox{-.5\height}{\includegraphics[width=0.45\linewidth]{img/adattamento-trasformatore}}
	\caption{Adattamento con trasformatore a $\nicefrac{\lambda}{4}$}
	\label{fig:adattamento-trasformatore}
\end{figure}

Si individua sulla carta di Smith il punto \ding{172} dell'impedenza di partenza, facendo riferimento alle curve equi-resistenza ed equi-reattanza.
\\
Muovendosi su un cerchio a $\Gamma$ costante si annulla la componente reattiva, corrispondente al punto \ding{173}.
% Fisicamente corrisponde ad una rotazione di fase che l'onda compie lungo la microstriscia, 
La rotazione su un cerchio a coefficiente di riflessione costante corrisponde ad una rotazione di fase dell'onda: dalla carta di Smith si può leggere la lunghezza di striscia in frazioni di $\lambda$ corrispondente allo sfasamento voluto. Nell'esempio si ha $0.192\lambda$.
\\
A questo punto bisogna \textit{correggere} la resistenza e spostarsi al punto \ding{173}, operazione fattibile con un trasformatore a $\nicefrac{\lambda}{4}$\footnote{Si tratta di un tratto di microstriscia lungo un quarto della lunghezza d'onda (non altera la fase perché si compie un giro completo della circonferenza di Smith), ma ad impedenza caratteristica in generale diversa da $Z_0$}. Vale la seguente relazione:

\[
Z_0' = \sqrt{Z_1 Z_2}
\qquad
con
\begin{array}{l}
Z_0' \mbox{ impedenza caratteristica del trasformatore}
\\
Z_1 \mbox{ impedenza prima del trasformatore}
\\
Z_2 \mbox{ impedenza dopo il trasformatore}
\end{array}
\]

Nel'esempio si vuole impedenza di 150$\Omega$ ($3Z_0$), partendo dal punto \ding{173} a $2.2Z_0$.
L'impedenza caratteristica del trasformatore sarà $Z_0' = Z_0\sqrt{2.2\cdot3} = 128.4\Omega$.

La rete di adattamento è illustrata in figura \ref{fig:adattamento-trasformatore}.

%\begin{figure}[hbt]
%	\centering
%	\includegraphics[width=0.7\linewidth]{img/raster/adattamento}
%	\caption{}
%	\label{fig:adattamento}
%\end{figure}

\paragraph{Metodo 2 - Stub parallelo:}
trasformare 100-15j$\Omega$ in 20+15j$\Omega$.

Di solito a microstriscia si preferisce far uso di stub paralleli, poiché uno stub serie comporterebbe una \textit{estrusione} della striscia in direzione ortogonale alla scheda. Poiché avremo a che fare con uno stub parallelo, conviene ragionare in termini di ammettenze. L'operazione è facile da fare sulla carta di Smith: per ricavare l'espressione dell'ammettenza di un punto basta individuarne il simmetrico rispetto all'origine.\\
L'ammettenza di partenza è pari a $(9.78 +1.47j) mS=(0.49+0.07)Y_0$ mentre l'ammettenza di arrivo è $(32-24j) mS=(1.6-1.2j)Y_0$.

Innanzitutto si corregge la conduttanza, da $0.49 Y_0$ a $1.6 Y_0$: utilizzando un tratto di microstriscia si può spostare l'ammettenza lungo un cerchio a $\Gamma$ costante. Questo interseca in due punti il cerchio a conduttanza $1.6 Y_0$, e si sceglie quello che darà una lunghezza di microstriscia inferiore (che sarà pari a $D=(0.202-0.014)\lambda=0.188\lambda$).

L'ammettenza vista verso il carico a questo punto è $(1.6+0.7j)Y_0$, resta da correggere la suscettanza da $0.7Y_0$ a $1.2Y_0$, fattibile utilizzando uno stub parallelo chiuso o in corto circuito (verso il piano di massa) o in circuito aperto. La suscettanza dello stub $B_{stub}$ dovrà essere tale da verificare la seguente relazione:
\[
1.2Y_0 = 0.7Y_0 + B_{stub} \quad\Rightarrow\quad
B_{stub} = (1.2-0.7)Y_0 = 0.5 Y_0
\]
Con l'aiuto della carta di Smith è facile calcolare la lunghezza dello stub: siccome stiamo trattando suscettanze pure bisogna ruotare in senso orario sul cerchio a $\Gamma=1$ dal punto di corto circuito (ammettenza infinita) oppure di circuito aperto (ammettenza nulla) verso la suscettanza $B_{stub}$. Si vede che il percorso più breve si ha chiudendo lo stub in corto circuito, e la lunghezza sarà pari a $L=0.25\lambda-0.218\lambda=0.032\lambda$
%In definitiva, la rete di adattamento è la seguente:

\begin{figure}[tbh]
	\centering
	\raisebox{-.5\height}{\includegraphics[width=0.45\linewidth]{img/smith-chart-stub}}
	\hfill
	\raisebox{-.5\height}{\includegraphics[width=0.45\linewidth]{img/stub}}
	\caption{Adattamento con stub}
	\label{fig:adattamento-stub}
\end{figure}


% dell'onda, nell'esempio pari a $...\lambda$, ed è realizzabile con un tratto di striscia ad impedenza $Z_0$.
%\begin{itemize}
%	\item Tratto di microstriscia, per effettuare una rotazione di fase sul coefficiente di riflessione;
%	\item Trasformatore a $\nicefrac{\lambda}{4}$, per trasformare una certa resistenza pura in un'altra;
%	\item Stub parallelo, per variare la reattanza.
%\end{itemize}

%Trasformare 25+15j$\Omega$ in 50$\Omega$.


%A microstriscia non si fanno stub serie, perché altrimenti verrebbe una specie di scheda 3D


%
%Adattamento d'impedenza
%
%
%
%da 0 a A: l'impedenza del trasformatore a lamda quarti ha media geometrica fra 0 e A (?)
%
%$$Z_C = \sqrt{Z_0 \cdot 1.6Z_0} = 50\sqrt{1.6} = 63\Omega$$
%
%da A a B si valuta la rotazione di fase ($\lambda$) in senso orario. (con un pezzo di linea)
%
%Viene 0.236$\lambda$.
%
%supponiamo $\varepsilon = 2$

\subsection{Dimensionamento fisico}
\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.22\linewidth]{img/raster/adattamento1}
	\includegraphics[width=0.22\linewidth]{img/raster/adattamento4}
	\caption{A sinistra: esempio di linea a microstriscia e relativi parametri. A destra: stripline, particolare guida d'onda completamente immersa nel dielettrico.}
	\label{fig:microstriscia}
\end{figure}
Una linea a microstriscia è una guida d'onda costituita da un conduttore metallico esteso (genericamente denominato \textit{piano di massa})  e da una striscia conduttrice di larghezza finita, separate da un dielettrico.
Nella produzione di circuiti RF i materiali si differenziano proprio in base al valore della costante dielettrica relativa, da cui poi dipende il costo. Da una parte si hanno materiali a basso $\varepsilon_R$, detti \textit{soft} (come ad esempio il teflon), che hanno una $\varepsilon_R \sim 2$. Dall'altra, i materiali \textit{hard} (come l'allumina, $Al_2O_3$) con $\varepsilon \sim 10$.

I materiali soft hanno un costo ridotto, e sono preferiti a frequenze più basse (indicativamente fino a 10GHz), poiché oltre iniziano ad introdurre perdite. Con i materiali hard si trovano applicazioni fino ai 60GHz. 

Poiché le linee a microstriscia si trovano all'interfaccia fra due materiali con $\varepsilon_R$ molto diverse (aria e dielettrico), le onde non si propagano in modo TEM. Però, nelle situazioni più comuni le componenti non-TEM sono evanescenti, dunque è possibile approssimare la propagazione come se fosse TEM, sfruttando poi opportune tabelle per ricavare una costante dielettrica equivalente $\varepsilon_{R_{eq}}$ per effettuare le dovute correzioni.
%Queste approssimazioni sono opportune finché il rapporto fra larghezza della microstriscia e spessore del dielettrico h è minore di 10.

Vediamo dunque come dimensionare una microstriscia. I dati di progetto, solitamente, sono lo spessore del dielettrico, la costante dielettrica relativa e la frequenza di lavoro (supponiamo, ad esempio $h=0.8mm, \ \varepsilon_R = 2 \ e\ f=1GHz$).\\
Si vuol realizzare la microstriscia con $Z_0=50\Omega$ e lunghezza $0.192\lambda$ del precedente esempio. Dal primo grafico ($Z_0(\nicefrac{w}{h})$) si ricava che per la data impedenza caratteristica bisogna avere un rapporto larghezza/spessore circa pari a 3 (e dunque uno spessore $w = 3h = 2.4mm$).\\
Con questa informazione, sul secondo grafico ($\nicefrac{\lambda}{\lambda_{TEM}}(\nicefrac{w}{h})$) si ricava il rapporto fra $\lambda$, la lunghezza d'onda effettiva nel materiale, e $\lambda_{TEM}$, la lunghezza d'onda calcolata come se la propagazione fosse TEM.
\[
\lambda_{TEM} = \frac{\lambda_0}{\sqrt{\varepsilon_R}}
=
\frac{c}{f \sqrt{\varepsilon_R}}
= \frac{3\cdot10^8}{10^9 \cdot \sqrt{2}} = 21.2 cm
\quad
\Rightarrow
\quad
\lambda = 1.08 \lambda_{TEM} = 22.9cm
\]

Da cui si ricava la lunghezza effettiva della microstriscia, pari a $0.192\lambda = 4.4 cm$.


\begin{figure}[hbt]
	\centering
	\includegraphics[height=12em]{img/raster/adattamento2}
	\includegraphics[height=12em]{img/raster/adattamento3}
	\caption{Grafici per il dimensionamento delle microstrisce.}
	\label{fig:microstriscia-grafici}
\end{figure}
%Dire che $\nicefrac{w}{h}$ è molto grande significa dire che w è molto grande rispetto a h, dunque le linee di campo sono confinate nel dielettrico della board, quindi praticamente il modo di trasmissione è TEM. Infatti le curve del grafico al crescere di $\nicefrac{w}{h}$ si appiattiscono verso $1 \Rightarrow \lambda_{TEM} = \lambda$
%Nota: $\frac{\sqrt{\varepsilon_R}}{\sqrt{\varepsilon_{R_eff}}} = \frac{\lambda}{\lambda_{TEM}}$
%Ma non serve
%A questo punto si calcola il secondo tratto di linea: l'impedenza caratteristica è 50$\Omega$, si procede col secondo grafico:
%
%....
%
%C'è un'altra tecnologia: stripline
%
%
%fine dell'esercizio: voglio un $G_T = .... = 10.5$
%siccome il carico è 75ohm , bisogna andare da un punto qualsiasi equigt a 75. SI può fare con un'unica rotazione da 75

%Calcolare la potenza erogata dal generatore:
%si inserisce il gammaL prima elaborato nel calcolatore e si ottiene il GP. A questo punto $G_P = \frac{P_{out}}{P_{in}}$ con ${P_{out}}$ noto. SI calcola $P_{in}$.
\subsection{Cenni di oscillatori a microonde}

All'inizio della trattazione della stabilità si è detto che, per valori maggiori dell'unità dei coefficienti di riflessione del quadripolo si possono instaurare delle oscillazioni. Affinché il sistema si comporti realmente da oscillatore è necessario che siano verificate anche le condizioni di Barkhausen su entrambe le porte\footnote{Si può dimostrare che le condizioni di Barkhausen sono verificate su una porta $\Leftrightarrow$ sono verificate anche sull'altra}:

\[
\mbox{All'innesco}
\quad
\begin{array}{l}
\begin{cases}
|\Gamma_S \Gamma_{IN}| > 1\\
\angle\Gamma_S = -\angle\Gamma_{IN}
\end{cases}
\\\\
\begin{cases}
|\Gamma_L \Gamma_{OUT}| > 1\\
\angle\Gamma_L = -\angle\Gamma_{OUT}
\end{cases}
\end{array}
\qquad
\mbox{A regime}
\quad
\begin{array}{l}
\begin{cases}
|\Gamma_S \Gamma_{IN}| = 1\\
\angle\Gamma_S = -\angle\Gamma_{IN}
\end{cases}
\\\\
\begin{cases}
|\Gamma_L \Gamma_{OUT}| = 1\\
\angle\Gamma_L = -\angle\Gamma_{OUT}
\end{cases}
\end{array}
\]

In questa sede ci si limita ad analizzare questa particolare configurazione in cui l'oscillazione si instaura senza una retroazione esterna. Non si approfondirà l'implementazione di oscillatori con componenti che realizzano reazioni esterne poiché lo studio a parametri S risulta particolarmente complesso.

%Il dispositivo deve essere PI
%(indicazioni minimali: $f_0$ e $\Gamma_L$)

A livello di progettazione sono note la frequenza di oscillazione $f_0$ e l'impedenza di carico in termini di $\Gamma_L$. Per poter avere un'oscillazione è innanzitutto necessario che il nostro sistema sia potenzialmente instabile a frequenza $f_0$. Appurato questo, non è comunque detto che il $\Gamma_L$ che ci ritroviamo dia effettivamente luogo a instabilità, dunque con opportune reti di adattamento bisogna variare il coefficiente di riflessione del carico finché $\Gamma_{IN}$ non diventi maggiore dell'unità. Questo significa spostare $\Gamma_{L}$ nella zona di instabilità.\\ 
\\
%Scelgo un $\Gamma_LU$ interno alla zona di instabilità. Trasformo $\Gamma_L$ (es 50 ohm, quindi al centro della circ.) in $\Gamma_LU$.
%Dunque calcolo il $\Gamma_{IN}(\Gamma_LU)$ (che sicuramente ha modulo maggiore di uno perché è instabile)
Solo a questo punto è possibile impostare le condizioni di Barkhausen all'innesco in ingresso.
%\[
%\Gamma_{IN} \Gamma_S >1
%\]
%\[
%\angle\Gamma_{IN} = -\angle\Gamma_S
%\]
Poiché già $\Gamma_{IN}>1$ conviene scegliere una sorgente puramente reattiva ($|\Gamma_{S}|=1$) in modo da non dissipare potenza e da non introdurre rumore termico. La fase di $\Gamma_S$ è fissata perché bisogna che sia verificata la condizione di Barkhausen $\angle\Gamma_{IN} = -\angle\Gamma_S$.
Ciò è riassunto in figura \ref{fig:oscllatore-cartasmith}.

L'impedenza sorgente, in base al segno della reattanza, si può progettare con una microstriscia di opportuna lunghezza:
\begin{itemize}
	\item in cortocircuito se la reattanza è capacitiva;
	\item in circuito aperto se la reattanza è induttiva.
\end{itemize}

\begin{figure}[hbt]
	\centering
	\includegraphics[height=0.45\linewidth]{img/oscillatore-S-smith}
	%	\includegraphics[height=0.45\linewidth]{img/raster/precisione-oscillatori}
	\caption{}
	\label{fig:oscllatore-cartasmith}
\end{figure}

La frequenza di oscillazione dipende dal valore della impedenza sorgente, dunque delle incertezze possono pregiudicare il corretto funzionamento dell'oscillatore.
\begin{align*}
\mbox{Se si usa una capacità}
&
\qquad
\Gamma_S = \frac{\frac{1}{j\omega C} - Z_0}{\frac{1}{j\omega C} + Z_0}
\\
\mbox{Se si sceglie invece un gruppo LC}
&
\qquad
\Gamma_S = \frac{Z_Q - Z_0}{Z_Q + Z_0}
\end{align*}
%
%causa delle variazioni di valore di gammaIN si ha una certa incertezza sul valore della frequenza. Avendo un componente con una fase molto ripida si ha una oscillazione precisa
%
%Se uso un condensatore, com'è fatta la fase di gammaS?
%
%
%
%BOOH?
%
%Se scelgo un gruppo LC
%
%
%
Analizziamone l'andamento sulla carta di Smith: per $f=0$ si ha un corto circuito, al crescere della frequenza predomina l'effetto induttivo, dunque si ruota sulla parte alta del cerchio. Alla frequenza di risonanza si ha circuito aperto, ed infine si torna verso il corto circuito.\\
Se la squadra LC presenta delle perdite (componenti resistive) la circonferenza si incurva verso il centro della carta.
%A frequenza 0 corto circuito. Cresce la frequenza: si ruota sul bordo di smith (parte alta, predomina l'induttanza). risonanza: circuito aperto (altro bordo della circonferenza) (o se presente una resistenza di perdita, curva un po').
%All'infinito torna al punto iniziale
%
%Quindi la fase ha una brusca discesa in prossimità della frequenza di risonanza
%
%Gli oscillatori a microonde si possono realizzare con:

In ogni caso, una squadra LC ha una brusca discesa di fase nei pressi della frequenza di risonanza, quindi risulta più adatta della singola capacità per la realizzazione di un oscillatore.

In termini di risorse, un oscillatore si può realizzare con:
\begin{itemize}
	\item componenti a parametri concentrati (capacità, induttanza, etc...). Non sono molto precisi a causa delle tolleranze;
	\item a microstriscia, si realizzano componenti più precisi, ed è una tecnologia a basso costo perché rientra nella produzione della PCB;
	\item a cavità risonante o con risuonatore dielettrico (particolari strutture che risuonano quando sollecitate). Si riescono a raggiungere elevate precisioni, costi elevati;
	%	microstriscia a 50ohm di lunghezza 5 10 mm e si incolla un bottone ceramico a una distanza dalla microstriscia di circa mezzo millimetro. Questo trabiccolo risuona. Costa una fraccata di soldi (1k). Ha rumore di fase molto limitato perché il Q del risuonatore è altissimo)
	\item VCO + YIG (Yttrium Iron Garnet) - bipolo che se immerso in un campo magnetico produce frequenza di risonanza variabile (proporzionale alla corrente del filo, quindi al campo magnetico)
\end{itemize}

\newpage
\section{Dispositivi passivi}
Analizziamo adesso, in termini di matrice S, una particolare categoria di quadripoli: passivi, non dissipativi, reciproci e adattati. Questi trovano applicazione per l'implementazione a microonde di reti di adattamento, accoppiatori direzionali (sistemi di distribuzione della potenza) e balun.

\paragraph{Proprietà:}  traslazione dei piani di riferimento

\begin{figure}[tbh]
	\centering
	\includegraphics[width=0.7\linewidth]{img/quadripolo_traslazione-piani-riferimento}
	\caption{}
	\label{fig:quadripolotraslazione-piani-riferimento}
\end{figure}

È dato un dispositivo due porte (generalizzabile a N) caratterizzato a parametri S e interconnesso mediante tratti di linea. Si vuole ricavare la matrice S' del sistema complessivo.

Applicando le equazioni dei telegrafisti:

\[
\begin{cases}
a_1 = a_1' e^{-j\beta \ell_1}\\
a_2 = a_2' e^{-j\beta \ell_2}
\end{cases}
\quad
\Rightarrow
\quad
\overrightarrow{a} =
\underbrace{
	\left(
	\begin{array}{cc}
	e^{-j\beta \ell_1} & 0\\
	0 & e^{-j\beta \ell_2}
	\end{array}
	\right)
}_\text{\underline{\underline{A}}}
\overrightarrow{a'}
\]
\[
\begin{cases}
b_1' = b_1 e^{-j\beta \ell_1}\\
b_2' = b_2 e^{-j\beta \ell_2}
\end{cases}
\quad
\Rightarrow
\quad
\overrightarrow{b'} =
\underbrace{
	\left(
	\begin{array}{cc}
	e^{-j\beta \ell_1} & 0\\
	0 & e^{-j\beta \ell_2}
	\end{array}
	\right)
}_\text{\underline{\underline{B}}}
\overrightarrow{b}
\]

Siccome $b = Sa \Rightarrow b' = Bb = BSa = \underbrace{BSA}_\text{S'}a'$

\textbf{Attenzione:} le matrici $\underline{\underline{A}}$ e $\underline{\underline{B}}$ non rappresentano le matrici S delle linee di trasmissione.

\paragraph{Esempio} $\ell_1 = \ell_2 = \nicefrac{\lambda}{4}$

Per definizione della costante di fase, $\beta = \nicefrac{2\pi}{\lambda}$, quindi moltiplicando per la lunghezza scelta $\beta\ell = \nicefrac{\pi}{2}$. 

\[
S' = \left(
\begin{array}{cc}
-j &  0\\
0  & -j
\end{array}
\right)
S
\left(
\begin{array}{cc}
-j &  0\\
0  & -j
\end{array}
\right)
=
\left(
\begin{array}{cc}
-j &  0\\
0  & -j
\end{array}
\right)
\underbrace{\left(
	\begin{array}{cc}
	-S_{11}j &  -S_{12}j\\
	-S_{21}j  & -S_{22}j
	\end{array}
	\right)
}_{\text{$-j\underline{\underline{S}}$}}
=
-S
\]

Dunque, questa coppia di spezzoni di linea a $\nicefrac{\lambda}{4}$ dà uno sfasamento di 180°.

\subsubsection{Proprietà della matrice S di dispositivi conservativi (a N porte)}

La potenza sull'i-esima porta si può scrivere come:
$P_i = \frac{1}{2}\left(|a_i|^2-|b_i|^2\right)$

Poiché il dispositivo è conservativo la somma di tutte le potenze è nulla: \[\frac{1}{2}\sum_{i=1}^{N}\left(|a_i|^2-|b_i|^2\right) = 0
\qquad ossia \qquad
\sum_{i=1}^{N}|a_i|^2=\sum_{i=1}^{N}|b_i|^2
\]
I due termini possono essere scritti, in forma vettoriale, come segue:
\begin{align*}
&\sum_{i=1}^{N}|a_i|^2 = |a_1|^2+|a_2|^2+...=a^Ta^*
\\
&\sum_{i=1}^{N}|b_i|^2 = |b_1|^2+|b_2|^2+...=b^Tb^*
\end{align*}
Dunque $a^Ta^* = b^Tb^* = [Sa]^Tb^* = a^TS^Tb^* =
a^TS^TS^*a^*$

Quindi, un dispositivo è conservativo $\Leftrightarrow S^TS^*=I$

\paragraph{Esempio} Dispositivo a 3 porte (N=3)

\[
S = \left(\begin{array}{ccc}
S_{11}&S_{12}&S_{13}\\
S_{21}&S_{22}&S_{23}\\
S_{31}&S_{32}&S_{33}
\end{array}\right)
\qquad
S^TS^* = \left(\begin{array}{ccc}
S_{11}&S_{21}&S_{31}\\
S_{12}&S_{22}&S_{32}\\
S_{13}&S_{23}&S_{33}
\end{array}\right)
\left(\begin{array}{ccc}
S_{11}^*&S_{12}^*&S_{13}^*\\
S_{21}^*&S_{22}^*&S_{23}^*\\
S_{31}^*&S_{32}^*&S_{33}^*
\end{array}\right)
=
\left(\begin{array}{ccc}
1&0&0\\
0&1&0\\
0&0&1
\end{array}\right)
\]

\begin{align}
&\begin{cases}
|S_{11}|^2 + |S_{21}|^2 + |S_{31}|^2 = 1\\
|S_{12}|^2 + |S_{22}|^2 + |S_{32}|^2 = 1\\
|S_{13}|^2 + |S_{23}|^2 + |S_{33}|^2 = 1\\
\end{cases}
\label{eq:conservativo1}
\\
&\begin{cases}
S_{11}S_{12}^* + S_{21}S_{22}^* + S_{31}S_{32}^*=0\\
S_{11}S_{13}^* + S_{21}S_{23}^* + S_{31}S_{33}^*=0\\
S_{12}S_{13}^* + S_{22}S_{23}^* + S_{32}S_{33}^*=0\\
\end{cases}
\label{eq:conservativo2}
\end{align}

Si può dimostrare che le altre 3 equazioni (qui non riportate) conducono allo stesso risultato.

\subsection{Dispositivi a 3 porte conservativi, adattati, reciproci}
Sappiamo già che se un dispositivo adattato ha gli elementi sulla diagonale principale nulli, mentre se è reciproco ha matrice simmetrica.

\[
S = \left(\begin{array}{ccc}
0&S_{12}&S_{13}\\
S_{12}&0&S_{23}\\
S_{13}&S_{23}&0
\end{array}\right)
\]

Applichiamo le equazioni per un dispositivo conservativo prima ricavate:

\begin{align*}
&\begin{cases}
|S_{12}|^2 + |S_{13}|^2 = 1 & \mbox{\ding{172}}\\
|S_{12}|^2 + |S_{23}|^2 = 1 & \mbox{\ding{173}}\\
|S_{13}|^2 + |S_{23}|^2 = 1 & \mbox{\ding{174}}\\
\end{cases}
\\
&\begin{cases}
S_{13}S_{23}^* = 0 & \mbox{\ding{175}}\\
S_{12}S_{23}^* = 0 & \mbox{\ding{176}}\\
S_{12}S_{13}^* = 0 & \mbox{\ding{177}}\\
\end{cases}
\end{align*}

Il secondo sistema ci dice che uno dei tre termini S deve essere nullo. Ipotizziamo che sia $S_{13} = 0$.
Poiché dalla \ding{174} si ha $|S_{23}|^2 = 1$, per la \ding{176} necessariamente deve essere $S_{12} = 0$. Ma si giunge ad un assurdo, perche per la \ding{172} $|S_{13}| = 1$.

Si può ripetere il ragionamento con altre ipotesi arrivando comunque ad una contraddizione. Se ne evince che non è possibile realizzare un dispositivo a 3 porte conservativo, adattato e reciproco.

\subsection{Circolatore}
Per la sua realizzazione si può ricorrere a componenti come le ferriti, dove le onde non si propagano in egual modo in entrambe le direzioni. In questo modo si ottiene un dispositivo conservativo, adattato, non reciproco.
\[
S=
\left(\begin{array}{ccc}
0&S_{12}&S_{13}\\
S_{21}&0&S_{23}\\
S_{31}&S_{32}&0
\end{array}\right)
\]

Applichiamo dunque le condizioni di conservatività: 
\begin{align*}
&\begin{cases}
|S_{21}|^2 + |S_{31}|^2 = 1\\
|S_{12}|^2 + |S_{32}|^2 = 1\\
|S_{13}|^2 + |S_{23}|^2 = 1\\
\end{cases}
\\
&\begin{cases}
S_{31}S_{32}^*=0\\
S_{21}S_{23}^*=0\\
S_{12}S_{13}^*=0\\
\end{cases}
\end{align*}

Ipotizziamo $S_{31} = 0 \ \Rightarrow \ |S_{21}| = 1 \ \Rightarrow \ S_{23} = 0 \ \Rightarrow \ |S_{13}| = 1
\ \Rightarrow \ S_{12} = 0
\ \Rightarrow \ |S_{32}| = 1$ \\
dunque la matrice risultante è del tipo:
\[
\underline{\underline{S}}=
\left(
\begin{array}{ccc}
0 & 0 & e^{j\phi_3}\\
e^{j\phi_1} & 0 & 0\\
0 & e^{j\phi_2} & 0
\end{array}
\right)
\]

Senza perdere di generalità si può porre i $\phi_i=0$.

%Il dispositivo che implementa questa matrice è detto circolatore.

Ricavata la matrice, studiamo le proprietà del dispositivo così ottenuto. Innanzitutto è facile verificare che il dispositivo è \textbf{adattato}. Consideriamo la porta 1 e calcoliamo la componente riflessa $b_1$:
\[b_1 = \cancel{S_{11}}a_1+\cancel{S_{12}}a_2+S_{13}\bcancel{a_3} = 0\]
$a_3 = 0$ perché, studiando l'adattamento sulla porta 1, si chiudono tutte le altre porte su $Z_0$. Dunque, poiché sulla porta 1 non c'è componente riflessa, questa è adattata.\\
Le stesse considerazioni si possono ripetere sulle altre due porte.

\begin{figure}[tbh]
	\centering
	\includegraphics[width=0.3\linewidth]{img/passivi-circolatore}
	\caption{}
	\label{fig:passivi-circolatore}
\end{figure}

Si può dire di più: in condizioni di adattamento la porta 1 è isolata dalla porta 3 (o, in altri termini, la potenza \textit{immessa} dalla porta 1 viene tutta convogliata in uscita alla porta 2). Si verifica facilmente:
\begin{align*}
P_{IN_1} &= \frac{1}{2} \left( |a_1|^2-\cancel{|b_1|^2}\right)
= \frac{1}{2} |a_1|^2\\
P_{OUT_2} &= \frac{1}{2} \left( |b_2|^2-\cancel{|a_2|^2}\right)
= \frac{1}{2} \left( |S_{21}a_1+\cancel{S_{22}}a_2+\cancel{S_{23}}a_3|^2 \right)
= P_{IN_1}
\end{align*}
Si verifica facilmente che non si ha potenza in uscita dalla porta 3:
\[
P_{OUT_3} = \frac{1}{2} \left( |b_3|^2-\cancel{|a_3|^2}\right)
= \frac{1}{2}|b_3|^2
= \frac{1}{2}|\cancel{S_{31}}a_1 + S_{32}\bcancel{a_2} + \cancel{S_{33}}a_3|^2 = 0
\]

Lo stesso si può dire della porta 2 (è isolata dalla porta 1) e della porta 3 (è isolata dalla porta 2), come riassunto nell'immagine \ref{fig:passivi-circolatore-1}.
\begin{figure}[tbh]
	\centering
	\includegraphics[width=0.25\linewidth]{img/passivi-circolatore-1}
	\caption{}
	\label{fig:passivi-circolatore-1}
\end{figure}

%S_{12} = 0
%\]
%\[
%S_{32} = 1
%\]
%Dunque la porta 1 è isolata dalla porta 2
%
%\textbf{Porta 3}
%
%\[
%S_{13} = 1
%\]
%\[
%S_{23} = 0
%\]
%Dunque la porta 2 è isolata dalla porta 3

È interessante valutare come varia l'impedenza vista dalla porta 1 quando non si è più in condizioni di adattamento, in particolare quando si pone una generica impedenza $Z_X$ sulla porta 2. Calcoliamo adesso la componente riflessa:
\[b_1 = \cancel{S_{11}}a_1 +\cancel{S_{12}}a_2+S_{13}\bcancel{a_3} = 0 \]
Dunque, possiamo concludere che se almeno la porta 3 è chiusa su $Z_0$, la porta 1 è sempre adattata.
Questa particolare configurazione di circolatore prende il nome di \textbf{isolatore}, e può essere anche schematizzabile come il bipolo a fianco. Anche se è un dispositivo che dall'ingresso mostra sempre un'impedenza $Z_0$, non è una rete di adattamento in senso stretto poiché, includendo una resistenza, è una rete dissipativa.

\begin{figure}[bph]
	\centering
	\includegraphics[width=0.3\linewidth]{img/passivi-circolatore-2}
	\includegraphics[width=0.4\linewidth]{img/passivi-circolatore-ap}
	\caption{}
	\label{fig:passivi-circolatore-2}
\end{figure}


Utile negli PA perché se l'uscita è in condizioni non previste (non è adattata) si rischia di avere un ritorno di potenze elevate che danneggerebbero il circuito.


In realtà l'isolamento di un isolatore reale non è infinito, ma si attesta intorno ai 25$\div$30dB.


\subsection{Divisore (o accoppiatore) di potenza}
Si tratta di un dispositivo a 3 porte passivo, reciproco, e non conservativo. Vediamo come primo esempio il cosiddetto \textbf{divisore resistivo}:

\begin{figure}[htb]
	\centering
	\includegraphics[width=0.4\linewidth]{img/accoppiatore-direzionale-resistivo}
	\caption{Divisore resistivo, collegato in modo da verificarne l'adattamento sulla porta \ding{172}}
	\label{fig:accoppiatore-direzionale-resistivo}
\end{figure}

Si verifica facilmente che è adattato: si fa solo per la porta \ding{172} data la simmetria del dispisitivo.
\[
Z_{vista_1} = \frac{Z_0}{3} + \frac{1}{2} \left(\frac{Z_0}{3} + Z_0\right) =
\frac{Z_0}{3} + \frac{1}{2} \frac{4Z_0}{3} =
Z_0
\]

Ricaviamone la matrice S: poiché è adattato i parametri in diagonale principale sono nulli. È una rete puramente resistiva, dunque reciproca, quindi la matrice è simmetrica. Data la simmetria dell'oggetto è sufficiente calcolare un solo parametro (ad esempio $S_{21}$): è facile verificare che gli altri saranno uguali.
\[
S_{21} = \left. \frac{V_2}{V_1}\right|_
{\substack{a_2=0\\a_3=0}}
\qquad
V_2 = -I_2 Z_0 = -\frac{1}{2} I_1 \cdot Z_0
=-\frac{V_1}{2Z_0} \cdot Z_0 = -\frac{1}{2}V_1
\quad
\Rightarrow
\quad
S = \left(
\begin{array}{ccc}
0                 & -\nicefrac{1}{2} & -\nicefrac{1}{2}\\
-\nicefrac{1}{2}  &         0        & -\nicefrac{1}{2}\\
-\nicefrac{1}{2}  & -\nicefrac{1}{2} & 0
\end{array}
\right)
\]


Studiamo la proprietà di divisore di potenza supponendo (in condizioni di adattamento!) di pilotare dalla porta \ding{172}. Il bilancio delle potenze risulta:
\begin{align*}
P_{E_1} &= \frac{1}{2} \left( |a_1|^2 -\cancel{|b_1|^2} \right) =\frac{1}{2}|a_1|^2\\
P_{U_2} &= \frac{1}{2} \left(|b_2|^2 -\cancel{|a_2|^2}\right)=
\frac{1}{2}|b_2|^2 =
\frac{1}{2}|S_{21}a_1 + \cancel{S_{22}}a_2 + \cancel{S_{23}}a_3|^2 =
\frac{1}{4}\cdot \frac{1}{2} |a_1|^2\\
P_{U_3} &= \mbox{ con analoghi calcoli...} = \frac{1}{4}\cdot \frac{1}{2} |a_1|^2
\end{align*}

Dunque, della potenza d'ingresso \nicefrac{1}{4} fluisce dalla porta \ding{173}, \nicefrac{1}{4} fluisce dalla porta \ding{174}, mentre la restante aliquota è dissipata sulle resistenze. È chiaro che tale dispositivo trovi scarsa applicazione pratica dato il dispendio di potenza.

\subsubsection{Accoppiatore (o divisiore) Wilkinson}
Si tratta comunque di un dispositivo adattato non conservativo, ma che non dissipa potenza sotto particolari condizioni che andremo ad imporre.
\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.25\linewidth]{img/accoppiatore-direzionale-wilkinson}
	\includegraphics[width=0.25\linewidth]{img/accoppiatore-direzionale-wilkinson-1}
	\caption{}
	\label{fig:accoppiatore-direzionale-wilkinson}
\end{figure}

Si hanno due parametri inizialmente liberi (l'impedenza caratteristica delle linee $Z_X$ ed il valore della resistenza R), che andiamo a fissare imponendo che il dispositivo sia adattato.

\paragraph{Adattamento alla porta \ding{172}} Si fa riferimento alla figura 	\ref{fig:accoppiatore-direzionale-wilkinson} (\textit{a destra}). I due rami dell'accoppiatore sono pilotati in modo simmetrico, ai capi della resistenza R si ha la stessa tensione e quindi possiamo ometterla in questa analisi. La resistenza vista dall'ingresso sarà pertanto
\[
Z_{V_1} = \frac{1}{2} \cdot Z_X \frac{Z_0 + j Z_X tg(\beta\ell)} {Z_X + j Z_0 tg(\beta\ell)}
\overset{\beta\ell=\nicefrac{\pi}{2}}{=}
\frac{Z_X^2}{2Z_0}
\]
Affinché sia adattato, bisogna imporre $Z_{V_1} = \frac{Z_X^2}{2Z_0} = Z_0$, ricavando il valore dell'impedenza caratteristica $Z_X =\sqrt{2} Z_0$.

\begin{figure}[hbt]
	\raisebox{-.5\height}{\includegraphics[width=0.45\linewidth]{img/accoppiatore-direzionale-wilkinson-2}}
	\hfill
	\raisebox{-.5\height}{\includegraphics[width=0.45\linewidth]{img/accoppiatore-direzionale-wilkinson-5}}
	\caption{}
	\label{fig:accoppiatore-direzionale-wilkinson-1}
\end{figure}

\paragraph{Adattamento alla porta \ding{173}} (e, per simmetria, anche alla \ding{174}). La situazione è rappresentata in figura \ref{fig:accoppiatore-direzionale-wilkinson-1} (\textit{a sinistra}), per poter semplificare l'analisi si fa in modo da ricondursi in una condizione di simmetria (in figura \textit{a destra}): si aggiunge una impedenza $Z_0$ anche in serie al generatore di prova e si divide la $Z_0$ in una coppia di impedenze in parallelo. In questo è possibile applicare un'analisi con segnali pari/dispari.

Studiamo il caso \textit{pari}. Dato che le sollecitazioni sono in fase non può scorrere corrente né fra i punti \ding{173} e \ding{174}, né nel corto circuito sulla porta \ding{172}. Dunque i due rami sono \textit{virtualmente} isolati e dalla porta \ding{173} si vede solamente la linea di trasmissione terminata su $2Z_0$
\[
Z_{V_2}' = \frac{Z_X^2}{2Z_0} = Z_0
\]
Per simmetria lo stesso accade sulla porta \ding{174}, la corrente erogata dai generatori è identica e pari a $I_3' = I_2' = \frac{\nicefrac{V}{2}}{2Z_0} = \frac{V}{4Z_0}$.

Nel caso \textit{dispari} le sollecitazioni sono antisimmetriche e sono a massa sia il punto centrale della resistenza $R$ che il corto circuito sulla porta \ding{172}. L'impedenza vista sarà $\nicefrac{R}{2}$ in parallelo all'impedenza della linea terminata in corto circuito. Poiché la linea è un trasformatore a $\nicefrac{\lambda}{4}$ avrà impedenza tendente ad infinito\footnote{L'impedenza della linea è pari a $Z_X \frac{Z_L + Z_X\tan(\beta\ell)}{Z_X + Z_L\tan{\beta\ell}}$. Poiché questa linea è terminata con un corto circuito ($Z_L = 0$) l'espressione si semplifica in  $Z_X\tan(\beta\ell)$. Trattandosi di un trasformatore a $\nicefrac{\lambda}{4}$, $\beta\ell = \nicefrac{\pi}{2}$ e l'impedenza diverge.}
\begin{align*}
Z_{V_2}'' &= \frac{R}{2}
\\
I_2'' &= \frac{\nicefrac{V}{2}}{Z_0+\frac{R}{2}} = \frac{V}{2Z_0+R}
\end{align*}
Essendo la sollecitazione dispari, la corrente nell'altro generatore è uguale in modulo, ma ha verso opposto.

Per sovrapposizione degli effetti, la corrente totale erogata dal generatore alla porta \ding{173} è $I_2= I_2'+I_2''=\frac{V}{4Z_0}+\frac{V}{2Z_0+R}$. Affinché l'ingresso sia adattato ($R_{V_2} = Z_0$) il generatore $V_2$ deve vedere un'impedenza pari a $2Z_0$, ossia $I_2=\frac{V}{2Z_0}$. Uguagliando le due relazioni si ricava anche il valore della resistenza: $R=2Z_0$.\\
È interessante osservare che, pilotando sulla porta \ding{173} in condizione di adattamento la corrente alla porta \ding{174} è nulla ($I_3 = I_2'-I_2'' = 0$), quindi i parametri $S_{23}$ e $S_{32}$ sono entrambi nulli.

A questo punto è possibile completare il calcolo dei restanti elementi della matrice S. Per la simmetria del circuito $S_{21}$ ed $S_{31}$ sono uguali e siccome è reciproco ed abbiamo imposto l'adattamento la matrice è simmetrica ed ha zeri sulla diagonale principale.
\begin{align*}
S_{21} &= \left. \frac{V_2}{V_1}\right|_{\substack{a_2 = 0\\ a_3=0}}
\\
V &= V^+ e^{j\beta\ell}+ V^- e^{-j\beta\ell} =
V^+ (e^{j\beta\ell}+\Gamma e^{-j\beta\ell})
=
V^+ \left(e^{j\beta\ell}+ \frac{\cancel{Z_0} - \sqrt{2} \cancel{Z_0}}{\cancel{Z_0} + \sqrt{2} \cancel{Z_0}} e^{-j\beta\ell}\right)
%\\
%& \overset{\beta\ell = \nicefrac{\pi}{2}}{=} V^+ \left(j - j\right) =
%jV^+ \left(1 - \frac{1 - \sqrt{2}}{1 + \sqrt{2}}\right) =
%jV^+ \frac{2\sqrt{2}}{1+\sqrt{2}}
\\
V_2 &= V(\ell = 0) =
V^+ \left(1+\frac{1-\sqrt{2}}{1+\sqrt{2}}\right)
= V^+ \frac{2}{1+\sqrt{2}}
\\
V_1 &= V(\ell = \nicefrac{\lambda}{4}) = 
V^+ \left(j-\frac{1-\sqrt{2}}{1+\sqrt{2}}j\right)
= jV^+ \frac{2\sqrt{2}}{1+\sqrt{2}}
\\
S_{21} &= \frac{-j}{\sqrt{2}}
\end{align*}

In definitiva
\[
S = -\frac{j}{\sqrt{2}}\left(
\begin{array}{ccc}
0 &1&1\\
1 &0&0\\
1 &0&0
\end{array}
\right)
\]

\paragraph{Verifica:} il dispositivo è conservativo? 
Affinché lo sia devono essere verificate le condizioni \ref{eq:conservativo1} e \ref{eq:conservativo2}, ma non è così: le norme della seconda e terza colonna sono diverse da 1.

\paragraph{Isolamento delle porte \ding{173} $\Leftrightarrow$ \ding{174}}
Chiudiamo la porta \ding{174} su un'impedenza generica $Z_Y$ e la porta \ding{172} su $Z_0$:
\[
b_2 = S_{21}\cancel{a_1} + \cancel{s_{22}}a_2 +\cancel{S_{23}}a_3 = 0
\]
Non essendo presente alcuna componente riflessa, dalla porta \ding{173} si vede sempre $Z_0$ qualunque sia l'impedenza su \ding{174}, dunque la porta \ding{174} è isolata dalla \ding{173}. Per simmetria è vero anche il viceversa.

\paragraph{Applicazione: divisore di potenza}
Supponendo di pilotare il dispositivo dalla porta \ding{172} in condizioni di adattamento (come in figura \ref{fig:accoppiatore-direzionale-wilkinson}), calcoliamo il bilancio delle potenze.
\begin{align*}
\displaybreak[3]
P_{E_1} &= \frac{1}{2} (|a_1|^2 - |b_1|^2) = \frac{1}{2} |a_1|^2
\\
P_{U_2} &= \frac{1}{2} (|b_2|^2 - |a_2|^2) = \frac{1}{2} |b_2|^2
= \frac{1}{2} |S_{21} a_1 +\cancel{S_{22}}a_2+\cancel{S_{23}} a_3|^
= \left|\frac{-j}{\sqrt{2}} a_1\right|^2 = \frac{1}{2} \cdot \frac{1}{2}|a_1|^2 = \frac{1}{2} P_{E_1}
\\
P_{U_3} &= \mbox{... analogamente ...}
%= \frac{1}{2} \cdot \frac{1}{2}|a_1|^2
= \frac{1}{2} P_{E_1}
\end{align*}

Dunque, in questo caso il dispositivo non è dissipativo e ripartisce equamente la potenza d'ingresso fra le due uscite.

\subparagraph{Applicazione: combinatore} Supponiamo di pilotare il dispositivo dalle porte \ding{173} e \ding{174} con due generatori $V(t)$ in fase. Tutte le porte sono chiuse su impedenze $Z_0$.
%
%\[
%V_1 = V_{12} + V_{13}
%\]
%
%ossia sovrapposizione degli effetti (generatore 2 sulla porta 1 e generatore 3 sulla porta 1).
Applichiamo la sovrapposizione degli effetti:
si era dimostrato che la porta \ding{173} è adattata, dunque l'impedenza vista sarà $Z_0$ e la tensione applicata è una partizione di $V$: $V_2 = \frac{V}{2}$.
\[
V_{1}' = S_{12}V_2 =  S_{12}\frac{V}{2} = -\frac{j}{2\sqrt{2}} V 
\]
Analogamente $V_{1}'' = S_{13}V_3 = -\frac{j}{2\sqrt{2}}V$.
\\
Dunque, sommando i due contributi, si ha:
\[
V_1 = V_1'+V_1'' = -\frac{j}{\sqrt{2}}V
\quad\Rightarrow\quad
P_{U_1} = \frac{|V_1|^2}{2Z_0} = \frac{|V|^2}{4Z_0}
\]
Poiché le potenze disponibili dei due generatori sono uguali e pari a $\frac{|V|^2}{8Z_0}$, se ne deduce che l'uscita è pari alla somma, ed è il massimo trasferibile.

Se i due generatori fossero in controfase la potenza in uscita sarebbe nulla e andrebbe tutta dissipata su R, a riprova del fatto che il dispositivo non è privo di perdite.

%Dimostrazione del''isolamento
%
%Ponendo impedenze Z0 s tutte le porte tranne la 2
%
%\[
%b_2 = S_{21}\cancel{a_1} + \cancel{S_{22}}a_2 + S_{23} \cancel{a_3}
%\]
%
%e se sulla 3 ci metto zx?
%
%\[
%b_2 = S_{21}\cancel{a_1} + \cancel{s_{22}}a_2 + \cancel{S_{23}} a_3
%\]
%
%Quindi dalla porta 2 vedo sempre z0. Si era anche premesso che sul ramo 3 non passa corrente, se si rispettano le ipotesi.
%
%La porta 3 è isolata dalla 2 e viceversa

\subsection{Accoppiatori direzionali}
Si tratta di dispositivi a 4 porte non dissipativi, reciproci e adattati. La loro matrice S è simmetrica (per reciprocità) e presenta diagonale a valori nulli (per l'adattamento).
%... matrice S con 0 sulla diagonale (adattato) e simmetrica (reciproco)...
Bisogna ricavare le relazioni per la conservatività ad un 4 porte (che qui omettiamo), che combinate con le precedenti condizioni portano a due possibili soluzioni. La prima è una banale coppia di cortocircuiti, caratterizzata da
\[\underline{\underline{S}}=
\left(
\begin{array}{cccc}
0& 0& 0& 1\\
0& 0& 1& 0\\
0& 1& 0& 0\\
1& 0& 0& 0
\end{array}
\right)
\]
La seconda soluzione rappresenta effettivamente gli accoppiatori direzionali, che possono avere due forme:

\begin{minipage}{0.5\linewidth}
	Accoppiatore Direzionale Simmetrico
	
	\[
	\underline{\underline{S}}=
	\left(
	\begin{array}{cccc}
	0     & \alpha& j\beta& 0\\
	\alpha& 0     & 0     & j\beta\\
	j\beta& 0     & 0     & \alpha\\
	0     & j\beta& \alpha& 0
	\end{array}
	\right)
	\]
\end{minipage}
\begin{minipage}{0.5\linewidth}
	Accoppiatore Direzionale Antisimmetrico
	\[
	\underline{\underline{S}}=
	\left(
	\begin{array}{cccc}
	0     & \alpha& \beta& 0\\
	\alpha& 0     & 0     & -\beta\\
	\beta& 0     & 0     & \alpha\\
	0     & -\beta& \alpha& 0
	\end{array}
	\right)
	\]
\end{minipage}
\begin{center}
	Per la conservatività deve valere in entrambi i casi $|\alpha|^2+|\beta|^2 = 1$	
\end{center}

%\[
%\left(
%\begin{array}{cccc}
%0      & \alpha &  j \beta&0\\
%\alpha & 0 & 0 & j\beta\\
%j\beta & 0 & 0 & \alpha\\
%0      & j \beta &  \alpha&0\\
%\end{array}
%\right)
%\]
%Affinché sia conservativo $\alpha^2 + \beta^2 = 1$
%
%\[
%\left(
%\begin{array}{cccc}
%0 & \alpha&\beta &0\\
%\alpha& 0 & 0 & -\beta\\
%\beta& 0 & 0 & \alpha\\
%0 & -\beta & \alpha&0\\
%\end{array}
%\right)
%\]
%Affinché sia conservativo $\alpha^2 + \beta^2 = 0$ (?)
%
%Nomenclatura: $\alpha$ fattore di attenuazione, $\beta$ fattore di accoppiamento.

\begin{figure}[tbh]
	\centering
	\includegraphics[width=0.3\linewidth]{img/accoppiatore-direzionale-4porte}
	\caption{}
	\label{fig:accoppiatore-direzionale-4porte}
\end{figure}


Studiamo il comportamento di questo oggetto in condizioni di adattamento, pilotandolo dalla porta \ding{172}. È facile verificare che la porta \ding{175} è isolata dalla \ding{172}:
\[b_4 = S_{41}a_1 + S_{42}a_2 + S_{43}a_3+S_{44}a_4 = 0\]
e questa proprietà vale indipendentemente dall'impedenza su cui è chiusa \ding{175}\footnote{Ossia, anche se $a_4\neq0$ non si ha potenza in uscita dalla porta \ding{175} perché $S_{44}=0$. Ovviamente in caso reale il parametro non è nullo, per cui si definisce il parametro \textbf{isolamento} come $20\log S_{41}$.}.
La potenza d'ingresso si ripartisce dunque fra le porte \ding{173} e \ding{174}, secondo i coefficienti $\alpha$ e $\beta$.

%Anche in questo oggetto si individuano porte isolate: 1 e 4, 2 e 3.  è definito isolamento, che nel caso ideale $\rightarrow\infty$.

%La potenza che entra da 1 va su 2  e 3
%vedi la foto di jacopo
%misurare roba del DUT

\paragraph{Applicazione} Analizzatore di Reti Vettoriale (VNA) - utilizzato per misurare i parametri del Device Under Test
\begin{figure}[bh]
	\centering
	\includegraphics[width=0.7\linewidth]{img/accoppiatore-direzionale-4porte-VNA}
	\caption{}
	\label{fig:accoppiatore-direzionale-4porte-vna}
\end{figure}

\begin{align*}
b_1 = \alpha a_2 + \beta \cancel{a_3}\\
b_2 = \alpha a_1 - \beta \cancel{a_4}\\
b_3 = \beta a_1 +\alpha \cancel{a_4}\\
b_4 = -\beta a_2 + \alpha \cancel{a_3}\\
\end{align*}

$S_{11_D} = \frac{a_2}{b_2}
=
-\frac{b_4}{\beta} \cdot \frac{1}{\alpha a_1}
=
-\frac{b_4}{\beta} \cdot \frac{\beta}{\alpha b_3}
=
-\frac{1}{\alpha}\cdot\frac{b_4}{b_3}
=
-\frac{1}{\alpha}\cdot\frac{\frac{2V_4}{2\sqrt{z_0}}}{\frac{2V_3}{2\sqrt{z_0}}}
=
-\frac{1}{\alpha}\cdot\frac{V_4}{V_3}$

Misurando con un voltmetro vettoriale le due tensioni, allora ricavo il parametro $S_{11_D}$ del DUT.
\begin{align*}
\displaybreak[3]
&S_{21_D} = \left.
\frac{b_{2_D}}{a_{1_D}}\right|_{a_{2_D}=0}\\
&b_{2_D} = \frac{V_{2_D} - Z_0I_{2_D}}{2\sqrt{Z_0}} = \frac{2V_{2_D}}{2\sqrt{Z_0}}\\
& b_2 = \alpha a_1\\
& b_3 = \beta a_1\\
& b_2 = \frac{\alpha}{\beta} b_3\\
& S_{21_D} = \frac{b_{2_D}}{b_2} = \frac{\beta}{\alpha} \frac{b_{2_D}}{b_3} = \frac{\beta}{\alpha} \frac{V_{2_D}}{V_3}
\end{align*}

Nell'immagine è riassunto l'analizzatore, dove si sono evidenziate le tensioni rilevanti, che devono essere misurate attraverso un voltmetro vettoriale (bisogna tener di conto, infatti, anche dei possibili sfasamenti).
Gli altri parametri si possono misurare scambiando ingresso e uscita del DUT.\\
Prima di una misura è necessaria una calibrazione in ambiente controllato dei cavi/sonde utilizzando un calibration kit con terminazioni prefissate.

\subsubsection{Accoppiatori Direzionali ibridi}
Si tratta di particolari accoppiatori dove vale l'uguaglianza $\alpha = \beta$, da qui il nome ``ibridi". Siccome, per conservatività, si è imposto $\alpha^2+\beta^2=1$ allora $\alpha = \beta = \frac{1}{\sqrt{2}}$. Si possono individuare due topologie, realizzabili a microstriscia.

\paragraph{Ibrido Simmetrico} \textit{o Branch Line}
\begin{figure}[tbh]
	\centering
	\includegraphics[height=15em]{img/branchline}
	\caption{Implementazione a microstriscia di un ibrido simmetrico}
	\label{fig:branchline}
\end{figure}

%\[
%\frac{1}{\sqrt{2}}
%\begin{array}{cccc}
%0&1&-j&0\\
%1&0&0&-j\\
%-j&0&0&\\\
%0&-j&1&0\\
%\end{array}
%\]
%Nota: i segni sono diversi da come ha fatto a lezione, ma sul pozar sono messi così, mi fido più del signor Pozar
\[
\underline{\underline{S}}
=
-\frac{1}{\sqrt{2}}
\left(
\begin{array}{cccc}
0&1&j&0\\
1&0&0&j\\
j&0&0&1\\\
0&j&1&0\\
\end{array}
\right)
\]

%Si può realizzare a microstriscia con una topologia detta brenchline.
Verifichiamo l'adattamento alla porta \ding{172}. Come già fatto per l'accoppiatore Wilkinson, si simmetrizza il circuito (nell'immagine è evidenziato l'asse di simmetria) e si usa il metodo delle sollecitazioni pari/dispari studiando separatamente i due rami.

\textit{Sollecitazione pari:} gli ingressi \ding{172} e  \ding{175} sono allo stesso potenziale dunque nella linea che li interconnette non scorre corrente, lo stesso vale per la linea che interconnette \ding{174} e \ding{173}.
Pertanto, i punti centrali delle due linee sono equivalenti a circuiti aperti.

\begin{figure}[tbh]
	\centering
	\includegraphics[width=0.9\linewidth]{img/branchline-sollecitazione-pari}
	\caption{Sollecitazione pari}
	\label{fig:accopp-dir-pozar1}
\end{figure}

\begin{align*}
\displaybreak[3]
&Z_{open} = Z_0 \frac{Z_L + jZ_0 \tan (\beta\ell)}{Z_0 + jZ_L \tan (\beta\ell)}
\overset{Z_L \rightarrow \infty}{=}
\frac{Z_0}{j\tan(\beta\ell)}
\overset{\ell = \nicefrac{\lambda}{8}}{=}
-jZ_0
\\
&Z_{\parallel} = Z_{open} \parallel Z_0 =
\frac{-jZ_0^2}{-jZ_0 + Z_0} = \frac{jZ_0}{j-1}
\\
&Z_{IL} = \frac{\left(\nicefrac{Z_0}{\sqrt{2}}\right)^2}{Z_{\parallel}} = 
Z_0^2 \cdot \frac{j-1}{2jZ_0} = Z_0 \frac{(1+j)}{2}
\\
&Z_V' = Z_{open}\parallel Z_{IL}
= \frac{Z_0 \frac{(1+j)}{2}~(-jZ_0)}
{Z_0 \frac{(1+j)}{2}-jZ_0}
=
Z_0 \frac{-j+1}{1+j-2j} = Z_0
\\
&I_1 = \frac{\nicefrac{V}{2}}{2Z_0} = I_4
\end{align*}

\textit{Sollecitazione dispari:} i punti \ding{172} e  \ding{175} sono a potenziali opposti, dunque il punto centrale della linea che li interconnette è a massa. Lo stesso vale per la linea che interconnette \ding{174} e \ding{173}. Pertanto, i punti centrali delle due linee sono equivalenti a cortocircuiti.

\begin{figure}[tbh]
	\centering
	\includegraphics[width=0.9\linewidth]{img/branchline-sollecitazione-dispari}
	\caption{Sollecitazione dispari}
	\label{fig:accopp-dir-pozar2}
\end{figure}

\begin{align*}
\displaybreak[3]
&Z_{close} = Z_0 \frac{Z_L + jZ_0 \tan (\beta\ell)}{Z_0 + jZ_L \tan (\beta\ell)}
\overset{Z_L = 0}{=}
Z_0 j\tan(\beta\ell)
\overset{\ell = \nicefrac{\lambda}{8}}{=}
jZ_0
\\
&Z_{\parallel} = Z_{close} \parallel Z_0 =
\frac{jZ_0^2}{jZ_0 + Z_0} = \frac{jZ_0}{j+1}
\\
&Z_{IL} = \frac{\left(\nicefrac{Z_0}{\sqrt{2}}\right)^2}{Z_{\parallel}} = 
Z_0^2 \cdot \frac{j+1}{2jZ_0} = Z_0 \frac{(1-j)}{2}
\\
&Z_V' = Z_{close}\parallel Z_{IL}
= \frac{jZ_0 \cdot Z_0 \frac{(1-j)}{2}}{jZ_0 + Z_0 \frac{(1-j)}{2}}
= Z_0 \frac{j+1}{2j+1-j} = Z_0
\\
&I_1 = \frac{\nicefrac{V}{2}}{2Z_0} = -I_4
\end{align*}

Per sovrapposizione degli effetti si ottiene $I_1 = 2 \cdot \frac{\nicefrac{V}{2}}{2Z_0} = \frac{\nicefrac{V}{2}}{Z_0}$. L'impedenza vista dalla porta \ding{172} è pari dunque a $R_V = \frac{V}{I_1} - Z_0 = 2Z_0 - Z_0 = Z_0$.\\
La verifica sulle altre porte è esattamente identica, si conclude che il dispositivo è adattato.

\paragraph{Ibrido Antisimmetrico} \textit{o Rat Race}
\begin{figure}[tbh]
	\centering
	\includegraphics[width=0.5\linewidth]{img/ratrace}
	\caption{Implementazione di un A.D. ibrido antisimmetrico a microstriscia}
	\label{fig:ratrace}
\end{figure}

\[
\underline{\underline{S}}
=
-\frac{j}{\sqrt{2}}
\left(
\begin{array}{cccc}
0&1&1&0\\
1&0&0&-1\\
1&0&0&1\\\
0&-1&1&0\\
\end{array}
\right)
\]

Analizziamo, intuitivamente, le caratteristiche di questo dispositivo. Pilotando attraverso la porta \ding{172} avremo:
\begin{itemize}
	\item alle porte \ding{173} e \ding{174} due segnali in fase fra loro, ma sfasati rispetto ad \ding{172}. L'onda può attraversare il \textit{rat-race} sia in senso orario che antiorario; prendendo come esempio la porta \ding{174}, l'onda in senso \textit{orario} si muove di $\nicefrac{5\lambda}{4}$, mentre in senso \textit{antiorario} di $\nicefrac{\lambda}{4}$. In entrambi i casi lo sfasamento che subisce è pari ad un quarto di periodo e, raggiunta l'uscita, dà luogo ad interferenza costruttiva.
	\item alla porta \ding{175} uscita nulla. Infatti l'onda che si propaga in senso \textit{orario} arriva all'uscita con sfasamento nullo (compie un percorso pari a $\lambda$), mentre l'onda che si propaga in senso \textit{antiorario} viene sfasata di metà periodo (la distanza percorsa è, questa volta, $\nicefrac{\lambda}{2}$). La somma delle due dà interferenza distruttiva.
\end{itemize}

	Si verifica che la potenza in ingresso si ripartisce equamente alle due uscite, svolgendo quindi funzione di \textbf{divisore di potenza}.
	
	\begin{align*}
	\displaybreak[3]
	&P_{E_1} = \frac{1}{2} |a_1|^2\\
	&P_{U_2} = \frac{1}{2} \left(|b_2|^2 - \cancel{|a_2|^2}\right)
	= \frac{1}{2} \left|S_{21} a_1 + \cancel{S_{22}} a_2 + \cancel{S_{23}} a_3 + S_{24} \cancel{a_4}\right|^2
	= \frac{1}{2} \left|-\frac{j}{\sqrt{2}}a_1\right|^2
	= \frac{1}{2} \cdot \frac{1}{2} |a_1|^2 =  \frac{1}{2} P_{E_1}\\
	& P_{U_3} = ...analogamente... = \frac{1}{2} P_{E_1}
	\end{align*}
	
	È interessante valutare, inoltre, come si comporta il dispositivo se si chiude la porta \ding{175} su una generica impedenza $Z_X$.
	\[
	b_1 = \cancel{S_{11}}a_1 + S_{12}\cancel{a_2} + 
	S_{13}\cancel{a_3} + \cancel{S_{14}}a_4 = 0
	\]
	Dunque dalla porta \ding{172} si continua a vedere un'impedenza $Z_0$. Valutiamo se viene dissipata potenza dalla porta \ding{175}:
	\begin{align*}
	b_4 &= \cancel{S_{41}}a_1 + S_{42}\cancel{a_2} + 
	S_{43}\cancel{a_3} + \cancel{S_{44}}a_4 = 0\\
	    &= \frac{V_4 - Z_0I_4}{\sqrt{Z_0}}\\
	V_4 &= Z_0 I_4 
	\end{align*}
	Dove si è utilizzata la relazione fra $b$, corrente e tensione (eq. \ref{eq:prog_regr}). Poiché alla porta \ding{175} deve valere anche la legge di Ohm $V_4 = Z_X I_4$, l'unica soluzione possibile è che $I_4=0$, e che venga dissipata potenza sul relativo carico.
	
	Il \textit{rat-race} può essere utilizzato anche come \textbf{balun inverso}\footnote{Da segnale non bilanciato, con riferimento a massa, a segnale bilanciato.} Ciò si ottiene pilotando il dispositivo dalla porta \ding{173} e chiudendo le altre su $Z_0$.
	\begin{align*}
	&\frac{V_1}{V_2} = S_{12}
	\quad\Rightarrow\quad
	V_1 = S_{12} V_2 = \frac{1}{\sqrt{2}}V_2
	\\
	&\frac{V_4}{V_2} = S_{42}
	\quad\Rightarrow\quad
	V_4 = S_{42} V_2 = -\frac{1}{\sqrt{2}}V_2
	\end{align*}
	Le porte \ding{172} e \ding{175} sono in opposizione di fase, e rappresentano la coppia bilanciata in uscita dal balun inverso.
	
	Infine, il \textit{rat-race} può essere utilizzato per effettuare \textbf{somma o differenza} fra due segnali. Ciò si ottiene utilizzando  come ingressi le porte \ding{173} e \ding{174} (che devono essere opportunamente adattate), mentre la coppia di uscite si prende da \ding{172} e \ding{175} (anch'esse adattate a $Z_0$). Procediamo per sovrapposizione degli effetti:
	\begin{align*}
	&V_1 = S_{12} V_2 + S_{13}V_3 =
	\frac{1}{\sqrt{2}} (V_2 + V_3)
	\\
	&V_4 = S_{42} V_2 + S_{43}V_3 =
	\frac{1}{\sqrt{2}} (-V_2 + V_3)
	\end{align*}
	L'uscita sulla porta \ding{172} è proporzionale alla somma dei due segnali (difatti prende il nome di $\Sigma$ - porta somma), mentre la porta \ding{175} è proporzionale alla differenza dei due segnali (e prende il nome di $\Delta$ - porta differenza).
%	\\
%	Si verifica anche che la potenza di uscita è anche la massima trasferibile (perché pari alla potenza disponibile). Verifichiamolo in un caso semplice, ossia per $V_2(t) = V_3(t) = V(t)$:
%	\begin{align*}
%	&P_{A_2} = \frac{V_M^2}{8Z_0}\\
%	&P_{A_3} = \frac{V_M^2}{8Z_0}\\
%	&P_{OUT} = P_1 + \cancel{P_4} = \frac{V_{1_M}^2}{2Z_0}
%	= \frac{\left(\frac{2V_M}{\sqrt{2}}\right)^2}{2Z_0} = P_{A_2}+P_{A_3}
%	\end{align*}
	
	\chapter{PLL}
	Il PLL (Phase Locked Loop - anello ad aggancio di fase) è un sistema la cui uscita è un segnale con frequenza pari a quella del segnale di ingresso ed una relazione di fase fissa rispetto a questo. La forma d'onda del segnale di uscita (ovvero il suo contenuto armonico) può essere diversa	da quella del segnale di ingresso: si piò avere, ad esempio, un'onda quadra in ingresso e una sinusoide in uscita, agganciata alla prima armonica di dell'ingresso.\\
	Il PLL è molto usato nei sistemi di telecomunicazioni, ad esempio come sintetizzatore di frequenza o modulatore.
	In questo capitolo dapprima sarà illustrato il funzionamento di un semplice PLL, e successivamente
	saranno illustrate alcune applicazioni.
	
	\begin{figure}[hb]
		\centering
		\includegraphics[width=0.7\linewidth]{img/PLL}
		\caption{}
		\label{fig:pll}
	\end{figure}
	
	In figura \ref{fig:pll} è mostrato lo schema a blocchi semplificato di un PLL. L'anello ad aggancio di fase è
	costituito da:
	\begin{itemize}
		\item un Phase Detector (PD), che dà in uscita un segnale proporzionale allo sfasamento fra il segnale di riferimento $V_{REF}$ e l'uscita $V_{OUT}$;
		\item un filtro passa basso $F(s)$, solitamente realizzato con una rete RC a polo dominante a bassissima frequenza. È usato per estrarre un segnale $V_D (t)$ continuo a partire dall'uscita del Phase Detector;
		\item un oscillatore controllato in tensione (VCO) con frequenza di riposo $\omega_0$ che genera una sinusoide a una frequenza che si discosta da quella di riposo di una quantità proporzionale a $V_D (t)$;
	\end{itemize}
	
	\section{Funzione di trasferimento del PLL}
	Il segnale in uscita è dato da $V_{OUT} (t) = V_{{OUT}_m} cos \left[ \omega_0 t + \theta_0(t) \right]$, dove $\theta_0(t)$ è un termine di fase aggiuntivo dipendente da $V_D(t)$.
	
	La pulsazione istantanea del segnale in uscita dal VCO è definita come:
	\[\omega_i = \omega_0 + \frac{d \theta_0}{dt}\]
	\[\frac{d\theta_0}{dt} = K_D V_D(t)\]
	
	Lo scostamento è inoltre definito come:
	\[\omega_i - \omega_0 = \frac{d \theta_0}{dt} = K_D V_D (t)\]
	
	Integrando la relazione $\frac{d\theta_0}{dt} = K_D V_D(t)$:
	\[\theta_0(t) = K_D \int_{0}^{t} V_D (\tau) d \tau\]
	
	Passando nel dominio di Laplace e ricordando che un'integrazione nel tempo corrisponde in $\mathscr{L}$ a una divisione per s:
	\[\theta_0(s) = \frac{K_D}{s} V_D(s)\]
	
	All'ingresso del Phase Detector avremo $V_{REF} (t) = V_{{REF}_m} cos\left[ \omega_0 (t) + \theta_{REF}(t)\right]$ e $V_{OUT}(t)= V_{{OUT}_m} cos\left[ \omega_0 (t) + \theta_0 (t) \right]$. L'uscita è pari alla differenza di fase a meno di un coefficiente $K_E$ dipendente dal Phase Detector scelto:
	\[V_E(s) = K_E\left[ \theta_{REF} (s) - \theta_0 (s)\right] = K_E \theta_E (s) \] 
	\[V_D (s) = V_E (s) F(s) = K_E \theta_E (s) F(s)\]
	
	Riprendendo il risultato precedente:
	\[\theta_0(s) = \frac{K_D}{s} V_D(s) = \frac{K_D}{s} K_E \theta_E (s) F(s) = \frac{K_D}{s} K_E\left[ \theta_{REF} (s) - \theta_0 (s)\right] F(s)\]
	\[\theta_0(s) \left[ s + K_D K_E F(s) \right] = K_D K_E F(s) \theta_{REF} (s)\]
	
	Possiamo dunque ricavare la funzione di trasferimento del PLL:
	\[H(s) = \frac{\theta_0}{\theta_{REF}} = \frac{K_D K_E F(s)}{s + K_D K_E F(s)}\]
	
	\section{Risposta al gradino di fase}
	Supponiamo ora che a un certo istante la fase del segnale in ingresso passi da $0$ a $\Delta\theta$. La trasformata di Laplace di questo gradino di fase sarà $\frac{\Delta\theta}{s}$.
	\[\theta_0 = \frac{\Delta\theta}{s} H(s) \]
	$$\mbox{Teorema del valore finale: } \lim\limits_{t \rightarrow \infty} \theta_0 (t) = 
	\lim\limits_{s \rightarrow 0} s \cdot \frac{\Delta\theta}{s} H(s) = 
	\lim\limits_{s \rightarrow 0} s \cdot \frac{\Delta \Theta}{s} \frac{K_D K_E F(s)}{s + K_D K_E F(s)} =
	\Delta \theta
	$$
	
	Dunque, al termine del transitorio anche la fase in uscita avrà subito una variazione $\Delta\theta$.
	L'andamento esatto del transitorio dipende, ovviamente, dall'andamento della funzione F(s), ma il
	valore finale è, comunque, $\Delta \theta$.\\
	Attenzione! Non è detto che la fase di uscita e la fase di ingresso abbiano stesso valore a regime. Quanto ricavato dice che ogni \textbf{variazione} di fase sull'ingresso viene replicata sull'uscita. In base a come si realizzano il \textit{phase detector}, il \textit{filtro} $F(s)$ ed il \textit{VCO} è possibile ricavare l'esatto rapporto di fase fra ingresso e uscita.
	
	\begin{figure}[tbh]
		\centering
		\includegraphics[width=0.5\linewidth]{img/PLL-gradino}
		\caption{Gradino di fase e di frequenza}
		\label{fig:pll-gradino}
	\end{figure}
	
	
	\section{Risposta al gradino di frequenza}
	La funzione di trasferimento del PLL che lega le frequenze dei segnali in uscita ed in ingresso al PLL è la medesima di quella che lega le fasi:
	
	$$\begin{array}{lr}
	\Delta \Omega_0 = \mathscr{L} \left\lbrace 
	\Delta \omega_0
	\right\rbrace=
	s \theta_0\\
	\Delta \Omega_{REF} = \mathscr{L} \left\lbrace 
	\Delta \omega_{REF}
	\right\rbrace=
	s \theta_{REF}
	\end{array}
	~~
	\Rightarrow
	~~
	\frac{\Delta \Omega_0}{\Delta \Omega_{REF}} =
	\frac{\theta_0}{\theta_{REF}} = H(s)
	$$
	
	Si supponga che la pulsazione istantanea del segnale in ingresso al PLL (inizialmente pari a $\omega_0$) subisca una variazione brusca pari a $\Delta \omega$:
	$$V_{REF}(t) = V_{{REF}_m} cos \left[ (\omega_0 + \Delta \omega) t \right]
	$$
	
	La trasformata di Laplace del gradino di frequenza è pari a $\frac{\Delta \omega}{s}$. Come già visto nel caso del gradino di fase, applicando il teorema del valore finale si vede come la frequenza del segnale di uscita a regime tende ad agganciarsi a quella dell'ingresso.
	
	$$
	\lim\limits_{t \rightarrow \infty} \omega_0 (t) = \lim\limits_{s \rightarrow 0} s \cdot \frac{\Delta \omega}{s} H(s) =
	\lim\limits_{s \rightarrow 0} s \cdot \frac{\Delta \omega}{s} \frac{K_D K_E F(s)}{s + K_D K_E F(s)}
	= \Delta \omega$$
	
	A regime (per $t \rightarrow \infty$) dunque, la pulsazione del segnale di uscita avrà un valore $\omega_i \neq \omega_0$; ciò vuol dire che il segnale in ingresso al VCO sarà $V_D(t) \neq 0$ e più precisamente
	\[V_D ( s ) K_D = \Delta\omega \] 
	
	Il segnale in ingresso al VCO a regime sarà pari a:
	\[V_D (s) = K_E \left[\theta_{REF} (0) - \theta_0 (0)\right] F(0)\]
	
	Sostituendo a $V_D(s)$ il termine $\frac{\Delta \omega}{K_D}$ si ha:
	
	$$
	\Delta \omega = K_D K_E \left[ \theta_{REF}(0) - \theta_0(0) \right] F(0)
	$$
	$$
	\theta_{REF}(0) - \theta_0(0) = \frac{\Delta \omega}{K_D K_E F(0)}
	$$
	
	Affinché il PLL assuma la stessa fase a regime del segnale in ingresso, deve essere $\theta_{REF}(0) - \theta_0(0) = 0$. Da quest'ultima espressione si può vedere che l'unico modo affinché il PLL	possa agganciare la fase del segnale in ingresso di riferimento anche ad una pulsazione $\omega_i \neq \omega_0$ è che risulti $F (0) \rightarrow\infty$. Un quadripolo che ha un guadagno che tende all'infinito per $s \rightarrow 0$ è l'integratore, che ha una risposta del tipo:
	$$F(s) = \frac{A_0}{s}$$
	
	La funzione di trasferimento risulta quindi:
	\[H(s) = \frac{K_D K_E \frac{A_0}{s}}{s+ K_D K_E \frac{A_0}{s}} = \frac{K_D K_E A_0}{s^2 + K_D K_E A_0}\]
	
	Notiamo che i poli sono immaginari puri e che di conseguenza il sistema è marginalmente stabile. Dovremo introdurre compensazione.
	\[\beta A (s) = - \frac{K_E K_D A_0}{s^2}\]
	\[\beta A (j\omega) = \frac{K_E K_D A_0}{\omega^2}\]
	
%	\begin{figure}[tbh]
%		\centering
%		\includegraphics[width=0.5\linewidth]{img/pll-integratore-compensato}
%		\caption{}
%		\label{fig:pll-integratore-compensato}
%	\end{figure}
	
	
%	Immaginando di lavorare con un integratore ad amplificatore operazionale per semplicità. Inserendo R per compensare si ottiene:
%	\[ F(s) = F_{\infty} \frac{s-s_0}{s} = - \frac{R_1 + R}{R_1} \frac{\frac{1}{(R_1 + R)C} + s}{s}\]

Effettuando la compensazione inserendo uno zero si ottiene una funzione di trasferimento dell'integratore con la seguente forma:
\[ F(s) = F_{\infty} \frac{s-s_0}{s}\]
	
Adesso:
\[H(s) = \frac{K_D K_E F_{\infty} \frac{s-s_0}{s}}{s+K_D K_E F_{\infty} \frac{s-s_0}{s}} = \frac{K_D K_E F_{\infty} (s-s_0)}{s^2 + K_D K_E F_{\infty} s - K_D K_E F_{\infty} s_0}\]
	
Applicando la regola di Cartesio si vede che il polinomio al denominatore adesso presenta due permanenze di segno ($s_0$ è minore di zero). Le radici sono allora entrambe negative e quindi il sistema è stabile.
\\
In certi casi può essere utile, per eliminare disturbi interni al PLL, scegliere un polo a bassa frequenza mentre per una risposta rapida può essere più efficace  scegliere un polo ad alte frequenze.
%Dai diagrammi di Bode si vede bene che il margine di fase è $\frac{\pi}{2}$. Non è possibile spostare troppo in alto $\omega_0$, altrimenti il margine peggiora ma possiamo vedere cosa succede a 45 gradi:
%\[\arrowvert \beta A (j\omega) \arrowvert = 1\]
%	\[K_E K_D \frac{F_{\infty}}{\omega_0 ^2} \sqrt{\omega_0^2+\omega_0^2} = 1   \Rightarrow \omega_0 = K_E K_D F_{\infty} \sqrt{2}\]
%	
%Che forma di $H(s)$ preferisco? 
%\[H(s) = \frac{K_D K_E F_{\infty} (s-s_0)}{s^2 + K_D K_E F_{\infty} (s-s_0)} \]	
	
	\section{Parametri Caratterizzanti di un PLL}
	\paragraph{Ordine del PLL:} grado del polinomio al denominatore della funzione di trasferimento $H(s)$.
	
	\paragraph{Variabile di aggancio:} $V_A = \begin{cases}
	1 & \mbox{se il PLL è agganciato}\\
	0 & \mbox{se il PLL non è agganciato}
	\end{cases}$
	
	\paragraph{Range di aggancio:} intervallo frequenziale per cui il PLL riesce ad \textit{agganciarsi}, ovvero a generare un segnale in uscita che insegue quello in ingresso.
	\paragraph{Range di mantenimento:} intervallo frequenziale per cui il PLL riesce a mantenere l'uscita agganciata all'ingresso. In genere il range di mantenimento è maggiore del range di aggancio.
	
	\begin{figure}[thb]
		\centering
		\includegraphics[width=0.5\linewidth]{img/PLL-caratteristica}
		\caption{Caratteristica del PLL}
		\label{fig:caratteristica del PLL}
	\end{figure}
	
	
	\section{Implementazioni del Phase Detector}
	I blocchi interni al PLL sono quasi tutti oggetti noti: il Voltage Controlled Oscillator si può fare con un oscillatore di Clapp, visto al capitolo \ref{sub:VCO}, il blocco $F(s)$ si può fare con una generica rete passiva (a massimo 3 poli).\\
	L'unico blocco ancora non analizzato è il Phase Detector, di cui si illustrano 3 possibili implementazioni.
	
	
	\subsection{Moltiplicatore (PLL analogico)}
	Questo Phase Detector è di tipo analogico perché realizzato a partire da un mixer i cui ingressi sono la pulsazione di riferimento $V_{REF}(t)$ e l'uscita $V_{OUT}(t)$. Al solito, dal segnale di uscita si seleziona la sola componente a frequenza differenza, ipotizzando che tale operazione introduca un fattore moltiplicativo C.
	
	\begin{figure}[hbt]
		\centering
		\includegraphics[width=0.55\linewidth]{img/PLL-moltiplicatore}
		\caption{}
		\label{fig:pll-moltiplicatore}
	\end{figure}
	
	\begin{align*}
	V_E(t) & =  C \cdot V_{REF}(t) V_{OUT}(t) = C \cdot  V_{{REF}_m} cos \left[ \omega_0 t + \theta_{REF}(t)\right]
	V_{{OUT}_m} cos \left[ \omega_0 t + \theta_0(t)\right]
	\\
	V_D(t) & = \frac{1}{2} \cdot C \cdot V_{{REF}_m}V_{{OuT}_m} cos \left[ \theta_{REF}(t) -\theta_0(t) \right]
	\end{align*}
	
	
	\begin{multicols}{2}
		Il PLL è a regime quando la tensione applicata al VCO è nulla, ossia per $V_D(t) = 0$. Dal grafico in figura a lato si vede che questo si ha per\\ $\theta_{REF} (t) - \theta_0(t) = \begin{cases}\nicefrac{\pi}{2}\\\nicefrac{3\pi}{2}\end{cases}$
		\\ma $\nicefrac{\pi}{2}$ è un punto di equilibrio instabile\footnote{La derivata della caratteristica è negativa, dunque una piccola variazione dal punto di stabilità comporta effetti che tendono a destabilizzare ulteriormente il sistema}.
		
		Poiché la fase è definita a meno di una costante, si può porre $\theta_{REF} = 0$. Ne consegue che $\theta_0 = \theta_{REF} - \frac{3}{2}\pi$, quindi $\theta_0 = \frac{\pi}{2}$: l'oscillazione di riferimento e quella di uscita sono una coppia di segnali in quadratura.	
		
		\columnbreak
		\centering
		\null\vfill
		\includegraphics[width=0.8\linewidth]{img/cosx}
		\vfill\null
	\end{multicols}
	
	\subsection{XOR}
	\begin{figure}[hbt]
		\centering
		\includegraphics[width=0.7\linewidth]{img/PLL-xor}
		\caption{}
		\label{fig:pll-XOR}
	\end{figure}
	
	
	In questo caso il PD è realizzato a partire da una porta XOR che prende in ingresso le due oscillazioni. Poiché è un componente digitale si provvede a \textit{squadrare} i segnali attraverso opportuni comparatori. Ciò non influenzerà la forma dell'uscita, poiché il VCO produce sempre segnali sinusoidali.
	
	A regime, l'uscita della XOR è un treno di impulsi a frequenza $f_0$ e con larghezza correlata allo sfasamento fra riferimento e oscillazione d'uscita. Il filtro passa basso estrae il valor medio del segnale (anch'esso proporzionale allo sfasamento), che una volta traslato($V_D$) funge da segnale pilota per il VCO.
	
	La traslazione è necessaria perché il VCO ha bisogno di una tensione sia positiva che negativa.
	
	\begin{figure}[htb]
		\centering
		\includegraphics[width=0.45\linewidth]{img/PLL-XOR-waveform}
		\includegraphics[width=0.45\linewidth]{img/PLL-XOR-charat}
		\caption{Si sono indicate con $V'_{REF}$ e $V'_{OUT}$
			le ``versioni squadrate'' dei rispettivi segnali.}
		\label{fig:pll-xor-waveform}
	\end{figure}
	
	Supponendo che l'uscita della XOR $V_E$ vada da 0 a $V_0$, analizziamone l'andamento e il conseguente valor medio:
	\begin{itemize}
		\item se le oscillazioni sono perfettamente in fase l'uscita è sempre nulla. Il valor medio traslato è, pertanto, $-\nicefrac{V_0}{2}$;
		\item con un certo sfasamento l'uscita è un treno di impulsi, per cui il valor medio cresce;
		\item quando $V'_REF$ e $V'_OUT$ sono in quadratura l'uscita è esattamente un'onda quadra. Il suo valor medio è $\nicefrac{V_0}{2}$, pertanto in ingresso al VCO arriva un segnale nullo: questo è un potenziale punto di stabilità;
		\item al crescere dello sfasamento l'uscita aumenta, fino ad arrivare al massimo quando i segnali sono in opposizione di fase: l'uscita della XOR è costante a $V_0$;
		\item aggiungendo ulteriore sfasamento l'andamento è simmetrico.
	\end{itemize}
	
	Tracciando l'andamento di $V_D$ (l'uscita della XOR filtrata e traslata) in funzione dello sfasamento si ottiene la curva illustrata in figura \ref{fig:pll-xor-waveform}, e si può constatare che il punto effettivo di stabilità non è in $\nicefrac{3 \pi}{2}$ bensì in $\nicefrac{\pi}{2}$. Anche con questa configurazione l'uscita è in quadratura con l'ingresso.
	% si può accennare al fatto che il funzionamento è non lineare al picco
	
	\subsection{Flip Flop SR}
	\begin{figure}[hbt]
		\centering
		\includegraphics[width=0.7\linewidth]{img/PLL-flipflop}
		\caption{}
		\label{fig:pll-SR}
	\end{figure}
	
	\begin{figure}[htb]
		\centering
		\includegraphics[width=0.45\linewidth]{img/PLL-SR-waveform}
		\includegraphics[width=0.45\linewidth]{img/PLL-SR-charat}
		\caption{}
		\label{fig:pll-SR-waveform}
	\end{figure}
	
	Il principio di funzionamento è analogo alla precedente configurazione, per cui si può passare direttamente all'analisi a regime:
	\begin{itemize}
		\item se le oscillazioni sono perfettamente in fase l'uscita è sempre nulla e l'ingresso del VCO è $-\nicefrac{V_0}{2}$;
		\item quando i segnali sono in opposizione di fase l'uscita è un'onda quadra: il valor medio è $\nicefrac{V_0}{2}$ e in ingresso al VCO arriva un valore nullo;
		\item la larghezza degli impulsi cresce con lo sfasamento, e torna bruscamente a zero quando si raggiunge nuovamente la condizione di pari fase (o di sfasamento a $2\pi$).
	\end{itemize}
	
	Qui si ha un solo punto con ingresso nullo al VCO, ossia per sfasamento $\theta_{REF} - \theta_0 = \pi$, ed è un punto di equilibrio stabile.
	Questa configurazione da' luogo a due segnali in opposizione di fase.
	% si può dire che la zona lineare è il doppio di quella a XOR
	
	\section{Applicazioni del PLL}
	Abbiamo visto che possiamo configurare il PLL come generatore di oscillazioni in fase e quadratura. Vediamo adesso qualche altra applicazione tipica.
	\subsection{Sintetizzatore di frequenza}
	Una delle configurazioni più diffuse del PLL è il sintetizzatore di frequenza: un sistema in grado di generare un insieme discreto di valori di frequenza a partire da un'oscillazione di riferimento fissata. Questo oggetto trova impiego negli oscillatori locali, nelle reti per il clock per i circuiti digitali integrati e nella strumentazione di precisione.
	
	Esso consente, al variare di N, di ottenere, a partire da una oscillazione generata mediante un oscillatore stabile (in genere un oscillatore al quarzo), un set di frequenze caratterizzate dalla stessa stabilità relativa dell'oscillatore di riferimento e distanti l'una dall'altra di una quantità pari a $\frac{\omega_0}{M}$ che rappresenta la risoluzione in frequenza del sintetizzatore.
	
	\begin{figure}[hbt]
		\centering
		\includegraphics[width=0.8\linewidth]{img/PLL-sintetizzatore}
		\caption{}
		\label{fig:pll-sintetizzatore}
	\end{figure}
	
	
	Lo schema a blocchi prevede l'introduzione di due divisori di frequenza agli ingressi del Phase Detector. All'equilibrio:
	
	\[\frac{\omega_0}{N} = \frac{\omega_{REF}}{M} \Rightarrow \omega_0 = \frac{N}{M} \omega_{REF}  \]
	
	$\omega_0$, al fine del corretto funzionamento del sistema, deve comunque rimanere nei range di aggancio e mantenimento. Si osservi inoltre che il PD lavora ad una frequenza pari alla risoluzione ed a fronte di una variazione dell'ingresso è necessario un tempo almeno dello stesso ordine di grandezza del periodo $\frac{2 \pi M}{\omega_Q}$ perché l'uscita vada a regime.
	\subsection{Traslatore di frequenza}
	
	\begin{figure}[hbt]
		\centering
		\includegraphics[width=0.7\linewidth]{img/PLL-traslatore}
		\caption{}
		\label{fig:pll-traslatore}
	\end{figure}
	
	Inseriamo stavolta un moltiplicatore all'uscita del VCO, seguito da un filtro passa basso che elimina la componente in uscita a frequenza $f_0 + f_1$. All'equilibrio si ottiene:
	
	\[ f_{REF} = f_0 - f_1 \Rightarrow f_0 = f_{REF} + f_1 \]
	
	Se $V_{REF}(t)$ è un segnale modulato in frequenza vado a traslarlo a una frequenza più alta. Vediamo perché può essere più comodo: il mixer lavora in commutazione quindi in uscita ottengo una serie di armoniche che va filtrata per ottenere un segnale che non vada a interferire con i canali adiacenti. Se si necessita di cambiare la frequenza portante di trasmissione il filtro dovrà essere accordabile. Il traslatore di frequenza permette di evitare il filtro accordabile: si modula il segnale a una frequenza nota e si varia la frequenza di trasmissione accordando $f_1$
	
	\subsection{Demodulatore FM}
	\begin{figure}[htb]
		\centering
		\includegraphics[width=0.7\linewidth]{img/PLL-demodulatoreFM}
		\caption{}
		\label{fig:pll-traslatore}
	\end{figure}
	
	Prendiamo stavolta la configurazione classica del PLL e scegliamo $V_D$ come uscita. Se l'ingresso è un segnale FM si ottiene:
	\[V_{REF}(t) = V_{FM} \cdot cos\left[ \omega_0 t + \omega_D \int_{0}^{t} x(\tau) d\tau \right]  \]
	
	La frequenza istantanea del segnale in ingresso è:
	\[ \omega_I (t) = \omega_0 + \omega_D x(t) \]
	
	Passando nel dominio di Laplace:
	\[\omega_D \frac{x(s)}{s} = \theta_{REF}(s)  \]
	\[V_E = K_E (\theta_{REF} - \theta_0) = K_E \left[\omega_D \frac{x(s)}{s} - \theta_0\right] \]
	\[V_D = F(s) K_E \left[\omega_D \frac{x(s)}{s} - \theta_0\right] \]
	
	Ricordando dai risultati precedenti che $\theta_0 s = K_D V_D $:
	\[V_D = F(s) K_E \left[\omega_D \frac{x(s)}{s} - \frac{K_D V_D}{s} \right] \]
	\[V_D \left[ 1+\frac{K_E K_D}{s} F(s) \right] = K_E \frac{\omega_D F(s)x(s)}{s}  \]
	\[V_D(s) = \frac{K_E \omega_D F(s)}{s+K_E K_D F(s)} x(s) \]
	\[V_D(j\omega) = \frac{K_E \omega_D F(j\omega)}{s+K_E K_D F(j\omega)} x(j\omega) \]
	
	Se immaginiamo $F(s)$ costante in banda di $x(t)$, ovvero che $B_x$ è molto minore della frequenza di taglio del passa basso:
	\[ V_D(j\omega) = \frac{K_E \omega_D F(0)}{s+K_E K_D F(0)} x(j\omega) \]
	
	La funzione di trasferimento $V_D (j\omega)$ ha un polo in $\omega_p$. Se $B_x \ll \omega_p$ allora:
	
	\[ V_D(j\omega) = \frac{K_E \omega_D F(0)}{K_E K_D F(0)} x(j\omega) = \frac{\omega_D}{K_D} x(j\omega)\]
	
	Quindi mettendo un segnale FM in ingresso otteniamo il segnale modulante in uscita. Possiamo vedere lo stesso risultato nel dominio del tempo. Se il VCO riesce a inseguire l'ingresso si ha:
	\[\omega_I = \omega_0 + \omega_D x(t)  \]
	\[\omega_D x(t) = K_D V_D \Rightarrow V_D = \frac{\omega_D}{K_D} x(t)\]
	
	\subsection{Modulatore FM Indiretto}
	
	\begin{figure}[hbt]
		\centering
		\includegraphics[width=0.7\linewidth]{img/PLL-modFM}
		\caption{}
		\label{fig:pll-modfm}
	\end{figure}
	
	
	In questo caso l'oscillazione di riferimento viene fornita da un oscillatore stabile (ad esempio un
	oscillatore al quarzo) ed il segnale modulante $x(t)$ viene prima integrato, quindi inserito nell'anello
	di controllo attraverso un sommatore. 
	La tecnica di modulazione non si basa sulla variazione di un parametro circuitale dell'oscillatore e per questo si parla di modulatore indiretto. La soluzione opposta, il modulatore diretto, si basa invece su una stimolazione diretta di un parametro circuitale (solitamente un varicap inserito in un oscillatore di Clapp). Questa operazione risulta poco precisa in quanto la caratteristica del varicap, sebbene linearizzabile in un intorno di $f_0$, non è perfettamente rettilinea. In più gli errori di processo e gli effetti di deriva dei parametri dovuti alla temperatura e all'invecchiamento contribuiscono a peggiorare la qualità della modulazione. Vedremo che con una soluzione diretta a PLL sarà possibile esulare dai problemi sopra citati e ottenere una modulazione molto più precisa.
	
	Imponendo, senza perdita di generalità $\theta_{REF} = 0$: 
	\[V_E (s) = K_E(\theta_{REF} - \theta_{0}) = -K_E\theta_{0}\]
	\[V_E'(s) = -K_E\theta_{0} + \omega_D \frac{x(s)}{s} \]
	\[V_D (s) = F(s)\left(-K_E\theta_{0} + \omega_D \frac{x(s)}{s}\right) \]
	\[\theta_{0}s = K_D V_D (s) = K_D F(s)\left(-K_E\theta_{0} + \omega_D \frac{x(s)}{s}\right) \]
	\[\theta_{0}s = \frac{K_D F(s) \omega_D}{s+K_D K_E F(s)} x(s)\]
	
	Ipotizzando nuovamente che $B_x \ll f_t$ (e quindi $F(s) \simeq F(0)$) e che $B_x \ll \omega_p$:
	\[\dot{\theta_{0}} \simeq \frac{\omega_D}{K_E} x(t)\]
	
	Ho quindi realizzato una modulazione in frequenza dipendente solo da parametri costanti del circuito, quali $K_E$ e $\omega_D$.
		
	\section{Effetti del rumore sul PLL}
	
	\begin{figure}[hbt]
		\centering
		\includegraphics[width=0.7\linewidth]{img/PLL-noise}
		\caption{}
		\label{fig:pll-noise}
	\end{figure}
	
	Osservando una qualsiasi oscillazione sinusoidale generata da un sistema reale si può verificare che questa oscillazione non si mantiene sempre perfettamente periodica ma, aleatoriamente, la fase subisce delle variazioni che perturbano l'andamento temporale. Questo avviene a causa del cosiddetto rumore di fase (Jitter) e le variazioni che subisce la fase sono tanto più grandi quanto il rumore è alto. Chiaramente questo costituisce un problema importante nella generazione di un'oscillazione precisa: una componente di rumore di fase alta può ad esempio provocare campionamenti imprecisi in un un ricevitore radio digitale\footnote{in un sistema di trasmissione digitale con simboli a coseno rialzato, per rispettare la condizione di Nyquist per la cancellazione dell'interferenza intersimbolica, è necessario avere un campionamento idealmente privo di errore} e conseguentemente peggiorare la qualità della ricezione. Possiamo esprimere un'oscillazione affetta da rumore di fase nel seguente modo:
	\[V_{OL}(t) = V_{OL_{m}} cos(\omega_0 t + \theta_n (t))  \]
	
	Si può misurare l'ammontare del rumore di fase con un analizzatore di spettro a scansione: si manda in ingresso al sistema la sinusoide generata dall'oscillatore. Così facendo l'analizzatore restituisce sul display la forma del filtro a frequenza intermedia. Si procede dunque a restringere il filtro a frequenza intermedia, passando dal meno selettivo al più selettivo. Quando, nonostante si abbassi la selettività del filtro, non si noteranno variazioni nel display si sarà valutata l'entità del rumore di fase.
	
	Un PLL può essere affetto da rumore di fase in diversi punti del circuito. Immaginiamo che il rumore sia dovuto al Phase Detector inserendo, con un sommatore, il rumore dopo di esso:
	\[V_E(s) = -K_E \theta_0 \]
	\[V_E' (s) = -K_E \theta_0 + v_n  \]
	\[V_D (s) = F(s)\left(-K_E \theta_0 + v_n\right)\]
	\[\theta_0 s = K_D V_D = K_D F(s)\left(-K_E \theta_0 + v_n\right)\]
	\[\theta_0 = \frac{v_n K_D F(s)}{s + K_D K_E F(s)} \]
	\[\frac{\theta_0}{v_n} = \frac{K_D F(s)}{s + K_D K_E F(s)} = \frac{H(s)}{K_E} = H_{n1}(s)\]
	
	Con $F(s) = F_{\infty}\frac{s-s_0}{s}$:
	\[H(s) = \frac{K_D K_E F_{\infty} (s-s_0)}{s^2 + K_D K_E F_{\infty} s - K_D K_E F_{\infty} s_0} \]
	\[H_{n1}(s) = \frac{K_D F_{\infty} (s-s_0)}{s^2 + K_D K_E F_{\infty} s - K_D K_E F_{\infty} s_0}  \]
	
	Come si scelgono i poli? Se si prendono a basse frequenze (PLL a banda stretta) cala il rumore di fase ma si rallentano i transitori di cambio frequenza e si rischia di alterare la stabilità.
	
	Se invece immaginiamo che sia il VCO il dispositivo affetto da rumore di fase, allora otteniamo dei risultati diversi:
	
	\[V_E(s) = -K_E \theta_{0} \]
	\[V_D(s) = -K_E \theta_{0}F(s)\]
	
	In uscita dal VCO si avrà:
	\[\omega_I =\omega_0 + \dot{\theta_0} = \omega_0 + K_D V_D + \dot{\theta_n} (t)  \]
	\[ \theta_{0}s = K_D V_D + \theta_n s \Rightarrow V_D = \frac{\theta_{0}-\theta_n}{K_D} s = -K_E \theta_{0}F(s)\]
	\[\theta_0 = \frac{\theta_n s}{s + K_D K_E F(s)}\]
	\[\frac{\theta_0}{\theta_n} = \frac{s}{s + K_D K_E F(s)}\]
	
	Questa è la funzione di trasferimento del rumore di fase riportato sull'uscita. Sostituendo l'espressione completa di $F(s)$:
	\[\frac{\theta_0}{\theta_n} = \frac{s^2}{s^2 + K_D K_E s F_{\infty} -K_D K_E F_{\infty} s_0} \]
	
	Adesso conviene inserire poli più alti possibile: in questo modo si filtra più possibile il rumore di fase alle basse frequenze. Si parla in questo caso di PLL a banda larga.
	
	

	\chapter{Trasmettitori}
	\label{ch:trasmettitori}
	Lo stadio trasmettitore di un sistema di ricetrasmissione deve essere in grado di effettuare almeno le seguenti operazioni sul segnale in banda base:
	\begin{itemize}
		\item utilizzarlo per modulare in ampiezza e/o in fase la portante;
		\item filtrare eventuali componenti spurie frutto della modulazione;
		\item amplificare il segnale modulato per portarlo al livello di potenza richiesto dalle specifiche della particolare applicazione;
		\item trasmetterlo utilizzando un'antenna con un diagramma di radiazione appropriato.
	\end{itemize}
	Talvolta l'operazione di modulazione e quella di amplificazione di potenza vengono effettuate contemporaneamente all'interno di un unico stadio: in questo caso si parla di modulazione ad alto livello. Quando, invece, si può individuare uno stadio di modulazione separato da quello di amplificazione, allora si parla di modulazione a basso livello. Lo schema a blocchi di massima di un trasmettitore che utilizza un modulatore a basso livello è rappresentato in figura. Nella fattispecie, si tratta di un trasmettitore a conversione diretta, in quanto la modulazione avviene alla stessa frequenza della portante di trasmissione. Nel caso in cui vi sia, prima dell'antenna, un mixer utilizzato per una traslazione in alto della frequenza, allora si parla di trasmettitori a doppia conversione o, più in generale, a conversione multipla.
	
	\begin{figure}[hbt]
		\centering
		\includegraphics[width=0.7\linewidth]{img/AP}
		\caption{}
		\label{fig:aprf}
	\end{figure}
	
	Mentre l'architettura dello stadio di modulazione dipende, ovviamente, dal tipo di modulazione	utilizzata, l'amplificatore di potenza presenta alcune caratteristiche comuni a tutti gli stadi di	potenza e, quindi, indipendenti dal tipo di modulazione. Come si vedrà nel seguito, comunque, il	fatto che la modulazione agisca sull'ampiezza del segnale o sul suo argomento (modulazioni ad	inviluppo costante) pone delle condizioni imprescindibili sulla scelta dell'amplificatore di potenza.
	
	\section{Amplificatori di potenza}
	In un sistema di ricetrasmissione il power amplifier (PA) è presente esclusivamente in trasmissione.
	Le potenze che esso sarà chiamato a gestire, nel caso in cui si tratti di un amplificatore allo stato
	solido, vanno da qualche mW (10dBm) fino a centinaia di Watt (20dB$\div$50dBm). Per potenze
	superiori si utilizzano componentistica e soluzioni circuitali diverse il cui studio non è contemplato
	tra gli obiettivi del presente corso.
	I problemi nuovi che sorgono in amplificatori destinati a trattare potenze da alcune decine di mW
	in su sono abbastanza diversi da quelli che caratterizzano gli amplificatori per piccoli segnali. Ne daremo nel seguito una rapida rassegna facendo riferimento all'utilizzo di transistori bipolari, sebbene questi ultimi possano essere sostituiti da transistori MOS oppure da MESFET, cosa che accade sempre più spesso.
	
	\subsection{Definizioni}
	\paragraph{Efficienza di conversione}
	\[  \eta = \frac{P_U}{P_E} \]
	È il rapporto fra la potenza utile in uscita $P_U$ e la potenza erogata dall'alimentazione $P_E$. Fornisce una misura del rendimento con cui la potenza dall'alimentazione viene convertita in potenza utile trasmessa. Ovviamente si ha sempre $\eta \leq 1$.
	
	\[P_{E} = P_{DISS} + P_{U} \Rightarrow P_{DISS} = P_{U} \frac{1-\eta}{\eta}  \]	
	
	È opportuno osservare che un elevato valore dell'efficienza di conversione oltre che risultare
	vantaggioso dal punto di vista del consumo di potenza e dell'autonomia delle batterie, ha come
	conseguenza la riduzione della dissipazione sul componente attivo con evidenti vantaggi sul suo
	costo e su quello di eventuali sistemi necessari ad asportare il calore generato al suo interno
	onde evitarne il danneggiamento irreversibile.
	
	\paragraph{Fattore di utilizzo}
	\[\theta_U = \frac{P_U}{V_{CE_{max}} I_{C_{max}}}\]
	
	È il rapporto tra la potenza utile ed il prodotto tra i valori massimi istantanei della tensione $V_{CE}$ e della corrente di collettore.\\
	Sebbene quest'ultimo prodotto abbia le dimensioni di una potenza, non rappresenta alcuna potenza effettivamente osservabile nell'amplificatore. Infatti non esiste alcun istante del ciclo di funzionamento in cui $V_{CE}$ e $I_{C}$ assumono contemporaneamente il loro valore massimo.
	\\
	$\theta_U$ ha il significato di fattore di merito: più esso è grande e più, a parità di potenza utile in uscita, il transistore sarà chiamato a sopportare tensioni/correnti massime più piccole.
	Di fatto questo significa che il transistore avrà un costo inferiore	poiché ad esso saranno richieste prestazioni più limitate. I transistori per applicazioni di	potenza possono sopportare dissipazioni di centinaia di Watt.
	
	\paragraph{Classe di funzionamento}
	Come si vedrà nel seguito per motivi di efficienza si può ricorrere a soluzioni circuitali nelle quali il transistore si trova in zona attiva solo per una frazione del periodo. Si definisce \textbf{l'angolo di circolazione $\theta$} come la metà della frazione di periodo, misurata il radianti,
	durante il quale il transistore è in zona attiva. A seconda del valore di $\theta$ si parlerà di
	amplificatore in classe A ($\theta = \pi$), in classe B ($\theta = \nicefrac{\pi}{2}$), in classe
	AB ($\nicefrac{\pi}{2}<\theta<\pi$) oppure in classe C ($0<\theta<\nicefrac{\pi}{2}$).
	
	Nel seguito esamineremo alcune configurazioni circuitali e modalità di funzionamento tra le più
	diffuse e, per ciascuna, calcoleremo i parametri prima definiti. Si continuerà a fare riferimento al
	caso di amplificatori a transistori bipolari, ma con semplici modifiche può applicarsi al caso di componenti attivi diversi.
	
\subsection{Amplificatori in classe A}

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.5\linewidth]{img/AP-classA}
	\caption{}
	\label{fig:ap-classa}
\end{figure}

Si tratta di una configurazione ben nota e sempre utilizzata dagli amplificatori per piccolo segnale.
In figura \ref{fig:ap-classa} è rappresentato il circuito corrispondente con una rete di polarizzazione	semplificata dalla eliminazione della resistenza di emettitore $R_E$ che è stata omessa, sia per
semplicità di calcolo, sia perché l'obiettivo che ci prefiggiamo è quello di verificare quale sia la
massima efficienza di conversione conseguibile con questa soluzione: la $R_E$ , dissipando potenza in
continua non utile alla trasmissione, non può far altro che ridurre l'efficienza.
Possiamo immaginare valori tipici della corrente di collettore nel range delle centinaia di
milliampere o maggiori. Nei transistori di potenza il guadagno di corrente $h_{FE}$ è piccolo rispetto a quello degli amplificatori per piccolo segnale.

\begin{figure}[htb]
	\centering
	\includegraphics[width=0.6\linewidth]{img/caratteristica-classeA}
	\caption{}
	\label{fig:caratteristica-classea}
\end{figure}
	
Infatti, per sopportare elevati valori di corrente dovranno avere aree attive molto grandi e, su superfici così ampie, è più difficile garantire spessori di base molto piccoli, requisito necessario ad un alto valore di $h_{FE}$ che, in genere, è nell'intervallo 10 $\div$ 100. A questi valori di corrente di collettore il ruolo stabilizzante della $R_E$ è svolto già parzialmente dalla resistenza parassita di dispersione.
	
Dall'analisi della maglia di ingresso e con l'utilizzo della caratteristica di ingresso del componente attivo si ricava il valore della corrente di base a riposo $I_{BQ}$.
La retta di carico statico è verticale e, in continua, $V_{CE_Q} = V_{CC}$, pertanto il valore di $I_{B_Q}$ fissa il punto di riposo.
A partire dal punto di riposo una variazione di $v_{CE}(t)$ determina una variazione di $i_C (t)$ che fa
muovere il punto istantaneo di lavoro sulla retta di carico dinamica rappresentata in figura. Se la sollecitazione è simmetrica lo spostamento lungo la retta sarà simmetrico. Finché il transistore è in zona attiva si considereranno costanti i suoi parametri differenziali e pari ai loro valori medi.
L'escursione massima della $V_{CE} (t)$ e della $I_C(t)$ dipendono dall'inclinazione della retta di carico
dinamico, quindi dal valore della $R_L$. Ipotizzando trascurabile la tensione di saturazione $V_{CE_{sat}}$ si può facilmente dimostrare che il valore di $R_L$ per cui si può consegnare al carico la massima potenza è $R_L = \frac{V_{CE_Q}}{I_{C_Q}}$.

Sotto queste condizioni calcoliamo l'efficienza di conversione $\eta$ precisando che $P_U$, potenza utile sul carico, è relativa alla frequenza di trasmissione di prima armonica. Ai fini del calcolo non si considerano né eventuali componenti in continua né quelle derivante da componenti armoniche di ordine superiore rispetto alla fondamentale:

\[ P_{L_{MAX}} = \frac{V_{CE_Q}^2}{2R_L} = \frac{V_{CE_Q}I_{C_Q}}{2} \]

Se trascuriamo la potenza dissipata in base e sulle resistenze di polarizzazione di base (comunque
piccola rispetto alle altre potenze in gioco), $P_E$ dipende solo dalla corrente $I_{C_Q}$ e dalla tensione di alimentazione. Infatti, una eventuale componente variabile (comunque non presente a causa del blocco introdotto dall'induttanza RFC) essendo a valor medio nullo non produrrebbe alcun contributo alla potenza media erogata dalla batteria.

$$P_E = V_{CE_Q} I_{C_Q}$$

$$ \eta = \frac{V_{CE_Q}I_{C_Q}}{2} \frac{1}{V_{CE_Q} I_{C_Q}} = \frac{1}{2}$$

La massima efficienza di conversione è del 50\%, dunque (nella migliore delle ipotesi) metà della potenza erogata dall'alimentazione viene effettivamente sfruttata. A causa di fattori quali $V_{CE_{sat}}\neq 0$ e la presenza di elementi reattivi che riducono l'ampiezza utile della retta di carico (che assume, per essere più precisi, la forma di un'ellisse), $\eta$ è destinato a decrescere, arrivando tipicamente al $10\div12\%$.\\
Inoltre, poiché la potenza erogata dalla batteria è indipendente dal segnale, se l'ampiezza diminuisce si ottiene un valore minore di $\eta$. Di fatto l'efficienza dipende dall'ampiezza del segnale.

Calcoliamo, adesso, il fattore di utilizzo a partire dalla sua definizione:
\[ \theta_U = \frac{P_U}{V_{CE_{max}} I_{C_{max}}}=
\frac{V_{CC}^2}{2 R_L} \frac{1}{2V_{CC} 2I_{C_Q}}=
\frac{V_{CC}}{8R_L} \frac{R_L}{V_{CC}} = \frac{1}{8}\]

\subsection{Amplificatori in classe B}

Per migliorare l'efficienza di conversione bisogna esplorare modalità di funzionamento diverse da
quelle tipiche della classe A, cercando di rendere l'erogazione di potenza da parte delle batterie
indipendente dalla presenza o meno del segnale.
Esaminiamo nel seguito un esempio di
amplificatore in cui i singoli componenti attivi operano in classe B ($\theta = \nicefrac{\pi}{2}$). Si tratta di una configurazione tra le più diffuse negli stadi di potenza che va sotto il nome di amplificatore push-pull.

\subsubsection{Push-Pull}

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.5\linewidth]{img/AP-classB}
	\caption{}
	\label{fig:ap-classb}
\end{figure}

Risulta evidente che i due transistori non potranno essere contemporaneamente in zona attiva poiché sono caratterizzati dallo stesso valore della tensione base-emettitore e, di conseguenza, quando questa è positiva risulterà \ding{172} in zona attiva e \ding{173} in interdizione, quando è negativa il
viceversa.

Analizziamo la situazione a riposo, ovvero per $v_S = 0$. I transistori risultano ambedue interdetti: se ipotizziamo per assurdo che \ding{172} sia in zona attiva
(e \ding{173} interdetto) avremo corrente in $R_L$ e, di conseguenza $$ V_{E1} > 0 
~~\Rightarrow~~
V_{B1} = V_{E1} + V_\gamma > 0$$

La corrente di base risulterà $I_{B1} = - \frac{V_{B1}}{R_S} < 0$ ovvero corrente di base negativa in un transistore NPN in zona attiva: conclusione ovviamente non accettabile.\\
Si può fare lo stesso ragionamento con ipotesi \ding{172} interdetto e \ding{173} in zona attiva, pertanto l'unica soluzione possibile è che ambedue i transistori risultino interdetti.

In definitiva, a riposo:
$$
\begin{aligned}
v_u & = 0\\
I_C & = 0
\end{aligned}
~~\Rightarrow~~
\mbox{punto di riposo}
~~~
\begin{aligned}
V_{CE_1} & = V_{CC}\\
I_{C_{Q1}} & = 0
\end{aligned}
$$

Lo stesso vale per il transistore 2:
$$
\begin{aligned}
	V_{CE_2} & = -V_{CC}\\
	I_{C_{Q2}} & = 0
\end{aligned}
$$

Esaminiamo adesso cosa accade alle variazioni. Nella figura seguente sono indicate la tensione $V_S$ e le correnti di collettore (quella del transistore \ding{173} è rappresentata con segno opposto a quello convenzionale e risulta, pertanto positiva).

Nel semiperiodo positivo conduce \ding{172} e \ding{173} è interdetto. Il transistore \ding{172} funziona in configurazione inseguitore di emettitore e, se $R_L (h_{fe} +1 ) \gg h_{ie} + R_S$, risulta $V_U \simeq V_S$.

La corrente sul carico è $I_L = I_{C_1}$.

Nel semiperiodo negativo \ding{173} conduce e \ding{172} è interdetto. Il transistore \ding{173} funziona in configurazione inseguitore di emettitore e, se $R_L (h_{fe} +1) \gg h_{ie} + R_S$, risulta ancora:
$V_U \simeq V_S$.

La corrente sul carico è $I_L = -I_{C_2}$.
Ciascun transistore funziona in classe B.
Il punto istantaneo di lavoro del transistore \ding{172} percorre la traiettoria tracciata a tratto continuo nella
figura seguente:

Calcoliamo adesso l'efficienza di conversione $\eta$. Anche in questo caso la calcoliamo in corrispondenza della massima escursione consentita al punto istantaneo di funzionamento senza entrare in zona di saturazione. Il calcolo viene fatto ancora una volta supponendo trascurabile la tensione di saturazione $V_{CE_{SAT}}$. Con $I_{C_{max}} = \frac{V_{CC}}{R_L} $:

\[P_U = \frac{I_{C_{max}}^2}{2}R_L = \frac{V_{CC}^2}{2R_L}\]

Per quanto riguarda la potenza erogata, bisogna tener conto che l'alimentazione è duale:

\[P_E = 2 V_{CC} \bar{I}_{C_1}\]

$\bar{I}_{C_1}$ è il valor medio della sinusoide raddrizzata:
\[\bar{I}_{C_1} = \frac{I_{C_{max}}}{\pi} = \frac{V_{CC}}{\pi R_L}\]
\[ \eta = \frac{\frac{V_{CC}^2}{2R_L}}{2 V_{CC} \bar{I}_{C_1}}  = \frac{\pi}{4} \simeq 0.78 = 78 \% \]

In conclusione: in classe B l'efficienza di conversione massima migliora del $28\%$ rispetto a quella
ottenibile in classe A, mentre la potenza dissipata sui due transistori, a parità di potenza utile,
risulta più che dimezzata (meno di $\nicefrac{1}{4}$ su ciascun transistore rispetto alla classe A).

Passiamo al calcolo del fattore di utilizzo:

\[\begin{aligned}
V_{CE_{max}} & = V_{CC}\\
I_{CE_{max}} & = \frac{V_{CC}}{R_L}\\
\Rightarrow ~~ \theta & = \frac{V_{CC}^2}{2 R_L} \frac{R_L}{2 V_{CC}^2} = \frac{1}{4} = 0.25
\end{aligned}\]

Il fattore di utilizzo aumenta, ma non è direttamente
confrontabile con quello della classe A poiché bisogna tenere conto del fatto che, nel push-pull, sono necessari 2 transistori invece che 1.

\subsubsection{Push-Pull a transistor omologhi}

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.7\linewidth]{img/AP-classB-omologhi}
	\caption{}
	\label{fig:ap-classb-omologhi}
\end{figure}


Una seconda possibile architettura in classe B fa uso di soli transistor di tipo NPN e necessita di una sola batteria per funzionare. Per raggiungere questo obiettivo si utilizzano due Balun che permettono a $Q_2$ di svolgere il lavoro del PNP nella precedente configurazione.\\
Durante la semionda positiva la tensione base emettitore di $Q_1$ è positiva mentre quella di $Q_2$ è negativa (quindi sarà interdetto). La corrente nella maglia di uscita di $Q_1$ scorre ovviamente nel senso della batteria e quindi in senso antiorario, inducendo, grazie al secondo Balun, una semionda positiva amplificata sul carico.\\
Durante la semionda negativa, invece, $Q_1$ è spento e $Q_2$ è in conduzione. La corrente nella maglia di uscita di $Q_2$ scorre stavolta in senso orario (sempre seguendo il verso della batteria) e ciò induce una semionda negativa sul carico.\\
Questa configurazione non introduce miglioramenti nell'efficenza o nel fattore di utilizzo in quanto l'amplificazione di potenza è perfettamente analoga a quella di un push-pull ma risulta comunque utile in casi di singola alimentazione, o per tecnologie integrate dove non si dispone di transistori PNP.

\[ P_U = \frac{{V_{CC}}^2}{2{R_L}'} \]
\[ P_E = V_{CC} \bar{I_C} = V_{CC} 2 \frac{V_{CC}}{\pi {R_L}'} \]
\[ \eta = \frac{{V_{CC}}^2}{2{R_L}'} \frac{{R_L}'}{ 2{V_{CC}}^2 } \]

$R_L'$ è la resistenza vista dai collettori di $Q_1$ e $Q_2$ sull'uscita: dato che i balun sono rispettivamente 2:1 sull'ingresso e 1:2 sull'uscita la $R_L$ sarà demagnificata di un fattore 4 sul lato sinistro del secondo balun. Questo risulta in ogni caso uno schema di principio e deve essere corredato di opportune reti di polarizzazione per $Q_1$ e $Q_2$ per garantire il funzionamento in zona attiva.

\subsection{Amplificatori in classe C}

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.7\linewidth]{img/AP-classC}
	\caption{}
	\label{fig:ap-classc}
\end{figure}


Passiamo adesso ad esaminare il caso del funzionamento in classe C. In realtà il circuito e la conseguente analisi che seguiranno sarebbero applicabili a qualunque classe di funzionamento, al variare della tensione di polarizzazione $E_B$.\\
Ciononostante la topologia circuitale utilizzata trova applicazione pratica (a fini dell'efficienza di conversione) quasi esclusivamente nel caso di funzionamento in classe C, e ne prende il nome. 

%Per ottenere il funzionamento in classe C dobbiamo fare in modo che risulti ? < ?/2.
%... ci si possono mettere tutti
	
Nell'ipotesi di $C_A$ di valore sufficientemente elevato e caduta trascurabile su $R_S$ si ottiene:
\[
\begin{aligned}
V_B &= V_S(t) + E_B\\
V_S(t) &= V_{S_M} cos ( \omega_0 t )
\end{aligned}
\]

Se immaginiamo la caratteristica di ingresso del transistore caratterizzata da un valore della
tensione di soglia $V_T$ al di sotto del quale le correnti di base e di collettore risultano nulle (il
discorso può essere esteso a transistori MOS), si può osservare quanto segue:

\[
\begin{aligned}
&E_B + V_{S_M } < V_T& & \mbox{Dispositivo sempre spento}\\
&E_B < V_T < E_B + V_{S_M }& & \mbox{Classe C}\\
&E_B - V_{S_M } < V_T < E_B & & \mbox{Classe AB}\\
&E_B = V_T& & \mbox{Classe B}\\
&E_B - V_{S_M} > V_T& & \mbox{Classe A}\\
\end{aligned}
\]

%Con riferimento alla tensione in ingresso $V_S = V_{S_M}cos(\omega_0t)$ la corrente di collettore avrà il seguente andamento:
%
%\[I_C = 
%\begin{cases}
%\begin{aligned}
%&g_m (V_{BE} - V_T)& &V_{BE} \ge V_T&\\
%&0& &V_{BE} \le V_T&
%\end{aligned}
%\end{cases}
%\]

Possiamo, in maniera compatta, esprimere la corrente di collettore come:
\[I_C = I_0 + I_{CM} cos(\omega_0t) ~~~~ |\omega_0t|<\theta \]

\begin{figure}[tbh]
	\centering
	\includegraphics[width=0.5\linewidth]{img/AP-classC-andamento}
	\caption{}
	\label{fig:ap-classc-andamento}
\end{figure}

Otteniamo così una forma d'onda tagliata, dove il valore massimo è $I_M = I_0 + I_{CM}$ e l'uscita è zero per $I_{CM}cos(\theta) + I_0 = 0$, ovvero per un angolo uguale a quello di conduzione.  Manipolando queste due relazioni si ottiene un'espressione di $I_C$ dipendente solo dall'angolo di conduzione e da $I_M$:

\[I_{CM} = I_M - I_0\]
\[I_0 + (I_M - I_0)cos(\theta) = 0 \Rightarrow I_0 = - \frac{I_Mcos(\theta)}{1-cos(\theta)}\] 
\[I_M = I_{CM} - \frac{I_Mcos(\theta)}{1-cos(\theta)} \Rightarrow 
I_{CM} = I_M \frac{1}{1-cos(\theta)}  \]

\[I_C = 
\begin{cases}
\begin{aligned}
&I_M \frac{cos(\omega_0t)-cos(\theta)}{1-cos(\theta)}& &|\omega_0t|\le \theta &\\
&0& &altrove&
\end{aligned}
\end{cases}
\]

%Dal bilancio delle correnti al nodo di collettore risulta:
%
%\[
%I_{RFC} - I_C - I_{C_A} = 0
%~~~
%\Rightarrow
%~~~
%I_{C_A} = I_{RFC} - I_C
%\]

La $I_C$ è quindi periodica e consta di una componente continua, $I_{C_0}$, e di una componente alternativa, $i_C$. L'induttanza RFC è un blocco per le radiofrequenze e le rispettive armoniche, quindi è attraversata
solo dalla componente continua $I_{C_0}$ , infatti la corrente $I_{C_A}$ che attraversa il condensatore avrà
componente continua nulla.\\
%$I_C$ è periodica, quindi sviluppabile in serie di Fourier con un termine continuo $I_{C_0}$ più tutte le
%armoniche.
Risulta:
$I_{RFC} = I_{C_0} = \bar{I}_C$ ossia il valor medio della $I_C$ coincide con la corrente erogata dalla batteria

Detta $i_C(t)$ la componente a valor medio nullo della corrente di collettore, risulta:
$$
\begin{aligned}
I_C     &=I_{C_0} + i_C\\
I_{RFC} &=I_{C_0}\\
I_{C_A} &=I_{RFC} -I_C = -i_C (t)
\end{aligned}
$$
Ovvero la corrente nel condensatore $C_A$ è l'opposto della componente variabile della corrente di
collettore.
Il gruppo RLC viene dimensionato in modo da risuonare alla frequenza della fondamentale e,
pertanto, alla frequenza di risonanza, LC è un circuito aperto.
$$\omega_0 = \frac{1}{\sqrt{LC}}$$
La prima armonica della $I_{C_A}$ passa tutta nel carico $R_L$. Le armoniche successive si ripartiscono nei tre rami R, L e C in proporzione inversa al modulo dell'impedenza di ciascun ramo. Ad esempio, per
quanto riguarda la 3 a armonica si ha:
$$
3 \omega_0 L = 9 \frac{1}{3 \omega_0 C}
$$
Pertanto la corrente in C predomina su quella in L (è 9 volte maggiore). Per le armoniche superiori
la differenza è ulteriormente accentuata a favore della componente che scorre i C rispetto a quella
che scorre in L. Se si tiene conto del valore del fattore di qualità Q definito come:
$$
Q = \omega_0 R_L C = \frac{R_L}{\frac{1}{\omega_0 C}}
$$
Risulta evidente che, se Q è abbastanza elevato (almeno 10), allora le componenti armoniche della tensione ai capi del gruppo
RLC risultano evanescenti rispetto alla fondamentale e, pertanto, la tensione sul carico è quasi
sinusoidale. Procediamo dunque al calcolo dell'efficienza:

\[\eta = \frac{P_U}{P_E}\]
\[P_U = \frac{V_{U_{1_M}}^2}{2R_L} = \frac{(I_{C_{1_M}} R_L)^2}{2R_L} = \frac{{I_{C_{1_M}}^2 R_L}}{2}\]
\[P_E = V_{CC}I_{C_0}\]

Dato che la $I_C$ è periodica è possibile svilupparla in serie di Fourier. Si ottengono, con conti che non riportiamo, le seguenti espressioni del valor medio e dalla prima armonica:
\[ I_{C_0} = I_M \frac{sin(\theta)-\theta cos(\theta)}{\pi \left[1-cos(\theta)\right]} \]
\[ I_{C_{1_M}} = I_M \frac{2\theta-sin(2\theta)}{2\pi \left[1-cos(\theta)\right]} \]
\[\eta = \frac{I_{C_{1_M}}^2 R_L}{2V_{CC}I_{C_0}} = \frac{R_L}{2V_{CC}} \left( I_M \frac{2\theta-sin(2\theta)}{2\pi \left[1-cos(\theta)\right]} \right)^2 
\frac{\pi \left[1-cos(\theta)\right]}{I_M\left[sin(\theta)-\theta cos(\theta)\right]}
\]
\[\eta = \frac{I_M}{8\pi} \frac{\left[2\theta - sin(\theta)\right]^2}{1-cos(\theta)} \frac{R_L}{V_{CC}\left[sin(\theta)-\theta cos(\theta)\right]} \]

Si noti che non è possibile far aumentare troppo la tensione di uscita. La massima ampiezza dovrà essere $V_{CC}$: con un'ampiezza più grande infatti il BJT passa in interdizione dato che sul collettore ho una tensione continua pari a $V_{CC}$ sommata alla forma d'onda in uscita.

\[ V_{U_{1_M}} =  I_{C_{1_M}} R_L \le V_{CC}\]
\[I_{M_{MAX}} \frac{2\theta-sin(2\theta)}{2\pi \left[1-cos(\theta)\right]} = \frac{V_{CC}}{R_L} \Rightarrow 
I_{M_{MAX}} = \frac{V_{CC}}{R_L} \frac{2\pi \left[1-cos(\theta)\right]}{2\theta-sin(2\theta)}
\]

Possiamo calcolare dunque l'efficienza massima in funzione di $\theta$:
\[\eta_{MAX} =  \frac{V_{CC}}{R_L} \frac{2\pi \left[1-cos(\theta)\right]}{2\theta-sin(2\theta)} \frac{\left[2\theta - sin(\theta)\right]^2}{8\pi \left[1-cos(\theta)\right]} \frac{R_L}{V_{CC}\left[sin(\theta)-\theta cos(\theta)\right]}\]
\[\eta_{MAX} = \frac{2\theta - sin(2\theta)}{4\left[ sin(\theta) - \theta cos(\theta)\right]}\]

Si noti che se $\theta = \pi$ (classe A) si ha $\eta_{MAX} = 0.5$: il risultato è consistente con quanto ricavato precedentemente. Possiamo adesso ricavare anche il $\theta_{u_{MAX}}$:

\[I_{C_{MAX}} = I_M\]
\[V_{CE_{MAX}} = 2V_{CC} \]
\[\theta_{u_{MAX}} = \frac{2\theta - sin(2\theta)}{8\pi\left[  1-cos(\theta)\right]}\]

%Se $\theta \rightarrow 0$ allora $\theta_{u_{MAX}} \rightarrow 0$: stiamo usando un angolo di conduzione così piccolo che la potenza viene fornita al carico in istanti infinitesimi e $I_{C_{MAX}}$ aumenta moltissimo portando a 0 $\theta_{u_{MAX}}$. Un buon compromesso tra efficienza e fattore di utilizzo è $\theta = \frac{\pi}{3}$. A causa delle capacità parassite un amplificat



%Si osservi che $\theta_U = \frac{P_U}{V_{CE_{max}} I_{C_{max}}}$, a parità di $P_U$, se $\theta_U \rightarrow 0, \Rightarrow V_{CE_{max}} I_{C_{max}} \rightarrow \infty$

\begin{figure}[tbh]
	\centering
	\includegraphics[width=0.5\linewidth]{img/AP-classC-andamento-3}
	\caption{}
	\label{fig:ap-classc-andamento-3}
\end{figure}


Per $\theta \rightarrow 0$ si ha $\theta_U \rightarrow 0$, ovvero il transistore è chiamato a sopportare tensioni e/o correnti che tendono all'infinito. Poiché
ciò non è ammissibile, è necessario utilizzare valori di $\theta$ significativamente maggiori di 0. Questo
stato di cose è chiaramente comprensibile se si osserva che il transistore trasmette potenza al carico
solo negli intervalli di tempo in cui è $I_C \neq 0$. Se lo deve fare in tempi che rappresentano frazioni
trascurabili del periodo, allora il picco di corrente dovrà avere valore massimo estremamente
elevato (al limite la corrente dovrebbe essere una delta di Dirac se l'angolo di circolazione tendesse
a zero): questo spiega come mai il fattore di utilizzo tenda a zero al diminuire di $\theta$ oltre un certo
limite.

Un buon compromesso si ha per $\theta \simeq 60^\circ$ che fornisce un $\eta_{max} \simeq 85\%$.

Gli amplificatori in classe C vengono utilizzati per potenze fino ad alcune centinaia di Watt e
frequenze prossime al GHz.
Nel campo delle microonde (da qualche GHz in su) non si trovano amplificatori in classe C perché
gli effetti capacitivi intrinseci non permettono, di fatto, di interdire il transistore.
Contrariamente a quanto accade per gli amplificatori in classe A e B, quelli in classe C non
possono essere utilizzati per amplificare segnali modulati in ampiezza poiché il loro comportamento
nei riguardi dell'ampiezza del segnale di ingresso non è lineare. Dimostriamo che questo è vero:

\[V_S(t) = V_{S_M} cos(\omega_0 t)\]
\[V_{BE}(t) = E_B +  V_{S_M} cos(\omega_0 t)\]
\[I_C(t) = g_m (E_B +  V_{S_M} cos(\omega_0 t) - V_T )\]
Valutiamo due casi particolari:
\[I_C(0) = g_m(E_B + V_{S_M} - V_T ) = I_M \]
\[I_C(\theta) = g_m(E_B + V_{S_M}cos(\theta) - V_T ) = 0 \Rightarrow cos(\theta) = \frac{V_T - E_B}{V_{S_M}}\]
\[V_{U_{1_M}} = I_{C_{1_M}} R_L = R_L I_M \frac{2\theta-sin(2\theta)}{2\pi \left[1-cos(\theta)\right]} \]

Sostituendo in quest'ultima espressione il valore di $cos(\theta)$ ricavato poco fa:

\[V_{U_{1_M}} = R_L g_m(E_B + V_{S_M} - V_T )\frac{2\theta-sin(2\theta)}{2\pi\frac{V_{S_M}-V_T-E_B}{V_{S_M}}} = g_m R_L \frac{2\theta - sin(2\theta)}{2\pi}V_{S_M}\]

Sembrerebbe una funzione lineare di $V_{S_M}$ ma anche $\theta$ è dipendente da $V_{S_M}$ quindi l'uscita risulta pesantemente non lineare rispetto all'ingresso se non per due casi particolari: se $\theta = \frac{\pi}{2}$ (classe B) l'angolo di conduzione non è determinato dall'ampiezza di $V_S$ e se $\theta = \pi$ (classe A) invece amplifico direttamente tutto il segnale e non ci sono distorsioni. Questo risultato implica che non è possibile realizzare un'amplificazione di un segnale modulato in ampiezza con un amplificatore in classe C. 

\subsection{Amplificatori in classe D}
L'amplificatore in classe D fa parte di una classe di amplificatori detti \textit{ad alta efficienza}, capaci,
almeno in linea teorica, di lavorare con efficienza di conversione unitaria. Per fare ciò si deve
ridurre al minimo la potenza dissipata sul componente attivo, facendo in modo, al limite, che
$V_{CE} (t) I_C (t) = 0$ per ogni t. Quindi quando il dispositivo attivo è in conduzione ($I_C \neq 0$) la tensione ai
suoi capi deve essere nulla, mentre quando la tensione è diversa da zero esso deve risultare
interdetto (corrente nulla). In altre parole il suo comportamento deve essere simile a quello di un
interruttore.
Lo schema di principio di un amplificatore in classe D è rappresentato in figura \ref{fig:ap-classd}

\begin{figure}[htb]
	\centering
	\includegraphics[width=0.55\linewidth]{img/AP-classD}
	\caption{}
	\label{fig:ap-classd}
\end{figure}

La tensione che aziona l'interruttore è un'onda quadra derivata da una sinusoide:
$V_0 \cos ( \omega_0 t )$. Il gruppo RLC serie risuona alla pulsazione $\omega_0$ e si suppone sia caratterizzato da un valore di Q abbastanza elevato (almeno 10).
$$
\begin{aligned}
Q & =\frac{\omega_0 L}{R_L} = \frac{1}{\omega_0 C R_L}\\
T_0 &= \frac{2 \pi}{\omega_0} \mbox{ periodo di commutazione del tasto fra le posizioni \ding{172} e \ding{173}}
\end{aligned}
$$

\begin{multicols}{2}
\null\vfill
La tensione $V_C$ risulta, pertanto, un'onda quadra di ampiezza $V_{CC}$ e valor medio $\nicefrac{V_{CC}}{2}$. Il suo andamento è rappresentato nella figura. Si osservi che alla frequenza della fondamentale il
gruppo LC risuona serie e, pertanto, si comporta come un corto circuito. Ciò significa che la componente di prima armonica di $V_C$ e quella della tensione ai capi del carico $R_L$ sono uguali.
\vfill\null
\columnbreak
\centering
\includegraphics[width=0.8\linewidth]{img/sinusiode-rect}
\end{multicols}

Alle armoniche superiori, nella serie tra L e C prende il sopravvento la componente induttiva che,
già alla terza armonica, assume un valore di reattanza 9 volte maggiore rispetto a quello della
componente capacitiva il cui effetto decresce ulteriormente al crescere dell'ordine dell'armonica.
Sviluppando in serie di Fourier la tensione $V_C (t)$ si ottiene:

$$V_C = \left[ \frac{1}{2} +
\sum_{n=1}^{\infty} \frac{\sin \left( n \frac{\pi}{2} \right)}{n \frac{\pi}{2}} \cos (n \omega_0 t) \right] V_{CC}$$

La componente continua viene bloccata dal condensatore C e, pertanto, il suo effetto sul carico è
nullo. La prima armonica della tensione di uscita, in base a quanto prima osservato, risulta:

$$V_{U_{1M}} = V_{CC} \frac{2}{\pi}$$

Se si calcolano le componenti armoniche superiori si ottiene, per esempio, per la terza armonica:

\[V_{C_{3M}} = V_{CC} \frac{2}{3 \pi} \Rightarrow V_{U_{3M}} = 
V_{CC} \frac{2}{3 \pi} \frac{R_L}{\frac{1}{3j\omega_0 C} + 3j\omega_0 L + R_L}
 \]
 
Posso trascurare nella frazione $\frac{1}{3j\omega_0 C}$ perché, se $\omega_0 L = \frac{1}{\omega_0 C}$, aumentando $\omega_0$ a $3\omega_0$ l'impedenza induttiva diventa 9 volte più grande di quella capacitiva. Posso anche trascurare $R_L$ perché $\omega_0 L = Q R_L$ e a $3\omega_0$ c'è un fattore 30 di differenza.

\[V_{U_{3M}} = \frac{R_L}{9\omega_0 L} \frac{2V_{CC}}{\pi}\]

Con $Q=10$ si ottiene allora:
\[V_{U_{3M}} = \frac{1}{90} \frac{2V_{CC}}{\pi} = \frac{1}{90} V_{U_{1M}} \]

Possiamo quindi trascurare tranquillamente le armoniche successive a $\omega_0$ nel bilancio di potenza. Vediamo, adesso, come realizzare il commutatore utilizzando dei componenti attivi che lavoreranno
in commutazione. Una possibile soluzione è rappresentata in figura:

\begin{figure}[htb]
	\centering
	\includegraphics[width=0.7\linewidth]{img/AP-classD-2}
	\caption{}
	\label{fig:ap-classd-2}
\end{figure}

La $V_{BE_1}$ e la $V_{BE_2}$ sono sempre in opposizione di fase: se l'ampiezza della tensione di controllo $V_0$ è sufficiente, alternativamente, uno dei due transistori è interdetto e l'altro è in saturazione. $V_0$ sarà una sinusoide oppure un'onda quadra (la sua forma non ha effetti diretti sul funzionamento del sistema purchè l'ampiezza sia in grado di commutare opportunamente i transistori). Nella realtà i tempi di commutazione non saranno mai nulli, quindi si avrà comunque dissipazione di potenza sui
transistori negli intervalli di tempo in cui corrente e tensione risulteranno contemporaneamente
diversi da zero. Con questi sistemi non si ottiene quindi un'efficienza di conversione effettiva del
100\%. Un buon risultato è considerato un valore di $\eta$ = 80\% a frequenze di qualche centinaio di
MHz.
Sebbene in prima approssimazione se il commutatore si comporta in maniera ideale ci si potrebbe
aspettare un'efficienza di conversione unitaria, in realtà bisogna ricordare
che, ai fini della potenza utile, anche quella dissipata sul carico, ma alla frequenza delle armoniche,
è da considerarsi persa. Infatti nella definizione di potenza utile si fa, correttamente, riferimento
alla sola potenza di prima armonica sul carico. Pertanto, è opportuno calcolare l'efficienza di
conversione tenendo conto di questa considerazione.

$$
\begin{aligned}
\eta &= \frac{P_U}{P_E}\\
P_U  &= \frac{V_{U_1M}^2}{2 R_L} = \frac{4 V_{CC}^2}{2\pi^2 R_L}\\
P_E  &= \frac{1}{T} \int_{0}^{T} V_{CC} I_{CC}(t) dt
= \frac{V_{CC}}{T} \int_{0}^{T} I_{CC}(t) dt
\end{aligned}
$$

Per metà periodo, quando il transistore \ding{172} è interdetto, $I_{CC}(t)$ è nulla e la corrente che attraversa il carico si richiude attraverso il transistore \ding{173} che è in saturazione. Per un calcolo rigoroso della potenza erogata bisognerebbe valutare tutte le armoniche della corrente $I_{CC} (t)$ e calcolare di conseguenza l'integrale che fornisce la potenza media erogata. Ma, se consideriamo trascurabili le armoniche superiori della corrente rispetto alla prima ($Q\rightarrow\infty$), allora la corrente nel carico risulta sinusoidale e, durante il semiperiodo in cui il transistore \ding{172} conduce, la corrente $I_{CC}(t)$ è un arco di sinusoide coincidente con la corrente nel carico $R_L$. Si ottiene, pertanto, quanto di seguito rappresentato:

$$
\begin{aligned}
& \frac{1}{T} \int_{0}^{T} I_{CC}(t) dt = 
\frac{V_{U_{1_M}}}{\pi R_L}\\
P_E  &= \frac{V_{CC} V_{U_{1_M}}}{R_L \pi}=
\frac{V_{CC}}{R_L \pi} \frac{2 V_{CC}}{\pi}\\
\eta &= \frac{2 V_{CC}^2}{R_L \pi^2} \frac{R_L \pi^2}{2 V_{CC}^2} = 1
\end{aligned}
$$

\[\theta_u = \frac{V_{U_{1_M}}}{2R_L} \frac{1}{V_{CC}I_{CC}} = \frac{1}{\pi}\]

\section{Modulatori}
\subsection{Modulatori AM}
Un segnale modulato in ampiezza può essere posto nella seguente forma:

\[V_{AM} (t) = V_{AM_M} \left[ 1 + m_A x(t)\right]cos(\omega_0t)\]

La modulazione AM può essere realizzata con due approcci: con un modulatore a basso livello, dove il segnale viene modulato e poi inviato a un amplificatore di potenza, oppure con un modulatore ad alto livello, dove la modulazione avviene direttamente sull'amplificatore di potenza.

\paragraph{Modulatore AM a basso livello}
Lo schema a blocchi è descritto nella figura seguente. L'uscita modulata a basso livello deve
essere inviata ad un amplificatore di potenza che, in base a quanto affermato durante la trattazione degli amplificatori di potenza, dovrà operare in classe A o in classe B.

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.6\linewidth]{img/Modulatori-AM-lowlevel}
	\caption{}
	\label{fig:modulatori-am-lowlevel}
\end{figure}

Questa soluzione è caratterizzata dai seguenti aspetti negativi: l'efficienza di conversione non sarà
mai quella massima possibile in classe A o in classe B poiché questo risultato è conseguibile solo se
l'ampiezza del segnale è costantemente pari a quella massima accettabile dall'amplificatore senza
andare in saturazione e/o interdizione. Ovviamente un segnale modulato in ampiezza non può
soddisfare ad ogni istante tale condizione (altrimenti sarebbe di ampiezza costante!). In ogni caso il
limite del 50\% e del 78\% rispettivamente per le due classi suddette risulta invalicabile.
Questi aspetti negativi sono controbilanciati da un aspetto positivo: si tratta di una soluzione a larga
banda poiché, contrariamente al caso della classe C e D, non vengono impiegati filtri selettivi.
Questo rende la soluzione a basso livello idonea ad applicazioni in multiplexer frequenziale (molti
canali trasmessi contemporaneamente con grande occupazione di banda), oppure nel caso in cui si
debba di continuo cambiare frequenza di trasmissione spaziando su un range di frequenza
razionalmente ampio (caso delle trasmissioni ionosferiche).

\paragraph{Modulatore AM ad alto livello}
Questa soluzione impiega un amplificatore in classe D nel quale il segnale modulante viene
utilizzato per quella che si chiama ``modulazione per caratteristica di collettore".
\begin{figure}[hbt]
	\centering
	\includegraphics[height=15em]{img/Modulatori-AM-highlevel}
	\caption{}
	\label{fig:modulatori-am-highlevel}
\end{figure}
\begin{align*}
V_{OUT_{1_M}}&=V_{AM_M}\left[ 1 + m_A x(t)\right]cos(\omega_0t)\\
V_{AM_M} &= V_{CC} \\
m_A |x(t)|  & < 1
\end{align*}
Questa soluzione consente di usare un amplificatore ad alta efficienza di conversione. Da osservare,
infine, che l'efficienza è virtualmente unitaria indipendentemente dall'ampiezza del segnale
modulante. Il problema, di fatto, viene, però, spostato sulla realizzazione ad alta efficienza
dell'amplificatore di potenza a bassa frequenza, necessario per pilotare il
primario del trasformatore. Infatti una aliquota considerevole della tensione $V_{CC}$ e, di conseguenza,
un altrettanto considerevole contributo alla potenza erogata, proviene, attraverso l'accoppiamento a
trasformatore, dal segnale modulante il quale deve essere opportunamente amplificato.
L'amplificatore di potenza a bassa frequenza (APLF) nella figura dovrà, a sua volta, essere ad alta
efficienza per non influire negativamente sull'efficienza globale del sistema.

\subsection{Modulatori SSB}
Un segnale modulato SSB ha la seguente forma:
\[V_{SSB}(t) = x(t) cos(\omega t) + q(t) sin(\omega t) \]

Una forma alternativa di questa espressione può essere:
\[V_{SSB} (t) = \sqrt{x(t)^2 + q(t)^2} \left[ cos\left[ \theta (t)\right] cos(\omega_0 t) + sin\left[ \theta (t)\right] sin(\omega_0 t) \right] = \sqrt{x(t)^2 + q(t)^2} cos\left[ \omega_0 t - \theta (t) \right] \]

$q(t)$ si ottiene passando il segnale $x(t)$ in un filtro di Hilbert.

\[H(\omega) = -j sgn(\omega)\]

Per realizzarlo occorrono dei filtri RC polifase che non analizziamo. 
\paragraph{Modulatore SSB a basso livello}
Il modulatore avrà la seguente forma. L'uscita di questo schema a blocchi verrà poi mandata a un APRF (in classe A o B) per la trasmissione in antenna. Per realizzare il blocco che sfasa l'oscillazione di riferimento di $\pi/2$ ci sono due possibili soluzioni. 
\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.6\linewidth]{img/Modulatori-SSB-lowlevel}
	\caption{}
	\label{fig:modulatori-ssb-lowlevel}
\end{figure}

\subparagraph{Soluzione a banda stretta}
Si fa uso di due squadre RC con la stessa frequenza di polo $f_p = \frac{1}{2\pi R C}$. Alla frequenza $f_p$ si avrà $V_{U_1}$ sfasata di $\pi/4$ gradi rispetto all'oscillazione di riferimento mentre $V_{U_2}$ sarà sfasata di $-\pi/4$ gradi rispetto alla stessa oscillazione. I due segnali saranno complessivamente sfasati di $\pi/2$. Questa è detta soluzione a banda stretta perché funziona solo per oscillazioni in ingresso con frequenza pari a $f_p$.

\subparagraph{Soluzione a banda larga}
Si fa uso stavolta di un oscillatore a frequenza $2f_0$, di un inverter e di due divisori di frequenza. Come si vede in figura si ottengono facilmente due oscillazioni sfasate di $\pi/2$.

Lo svantaggio di questa soluzione rispetto alla prima è che si deve partire da una frequenza doppia
rispetto a quella desiderata e questo si paga in termini di massima velocità richiesta al circuito e di
consumi.

\begin{figure}[hbt]
	\centering
	\hspace{\fill}
	\raisebox{-.5\height}{\includegraphics[height=8em]{img/Modulatori-SSB-lowlevel-sfasatore-1}}
	\hspace{\fill}
	\raisebox{-.5\height}{\includegraphics[height=5em]{img/Modulatori-SSB-lowlevel-sfasatore-2}}
	\hspace{\fill}
	\caption{Soluzioni per ottenere due segnali in quadratura: a banda stretta (a sinistra) ed a banda larga (a destra)}
	\label{fig:modulatori-ssb-lowlevel-sfasatore}
\end{figure}

\paragraph{Modulatore SSB ad alto livello}
Una soluzione alternativa è quella denominata a ``eliminazione e ricostruzione dell'inviluppo".
In questo caso dal segnale modulato SSB a basso livello vegono estratti l'inviluppo, $\sqrt{x(t)^2 + q(t)^2}$, utilizzato
per una modulazione per caratteristica di collettore di un classe D e un'onda quadra con fase
\[\theta(t) = arctan\left[\frac{q(t)}{x(t)}\right]  \]
Essa viene utilizzata per comandare il commutatore. Lo schema circuitale è rappresentato in figura e il segnale SSB amplificato viene "ricostruito" sull'uscita $V_U$.
\[V_U (t) = \left[ V_{CC} + \sqrt{x(t)^2 + q(t)^2} \right] \frac{2}{\pi} cos\left[\omega_0 t - \theta (t)\right] \]

\begin{figure}[tbh]
	\centering
	\includegraphics[width=0.7\linewidth]{img/Modulatori-SSB-highlevel}
	\caption{Modulatore SSB ad alto livello}
	\label{fig:modulatori-ssb-highlevel}
\end{figure}


\subsection{Modulatori in frequenza}
Un segnale linearmente modulato in frequenza dal segnale $x(t)$ ha la seguente forma:
\[
V_{FM}(t) = V_{FM_M} \cos \bigg[ \omega_{RF}t
+\underbrace{\omega_D \int_{0}^{t}x(\tau) d \tau}_\text{$\theta(t)$} \bigg]
\]

Per convenzione si assume che $\omega_D \ll \omega_{RF}$ e $|x(t)|<1$. Si definiscono dunque le seguenti grandezze:
\begin{multicols}{2}
	\begin{itemize}
		\item \textbf{Fase istantanea: }
		\inline{\varphi_i=\omega_{RF}t+\theta(t)}
		
		\item \textbf{Pulsazione istantanea: }
		\\\inline{\omega_i = \omega_{RF} + \dot\theta=\omega_{RF}+\omega_Dx(t)}
		
		\item \textbf{Massima deviazione di frequenza: }
		\inline{f_D = \frac{\omega_D}{2\pi}}
		\columnbreak
		
		\item \textbf{banda del segnale modulante\\$x(t)$: }
		$B m$
		
		\item \textbf{Indice di modulazione}\\
		\inline{D = \frac{f_D}{B_m} = \frac{\omega_D}{2\pi B_m}}
		
	\end{itemize}
\end{multicols}

Questa è una modulazione a inviluppo costante, quindi si possono usare indifferentemente amplificatori in classe A, B, C, D.

\paragraph{Modulatori diretti}
La frequenza è proporzionale ad una grandezza circuitale.
Tipicamente è la capacita di un varicap (diodo polarizzato in inversa con C $\propto$ V) come visto nei capitoli precedenti con l'oscillatore di Clapp.
La realizzabilità è semplice, ma il parametro circuitale è soggetto a dispersione delle caratteristiche, sensibilità alle condizioni ambientali e all'invecchiamento. Questo fa sì che a questa soluzione se ne affianchino altre più accurate e con meno non idealità.

\paragraph{Modulatori indiretti}
Il segnale viene prima integrato e poi usato per modulare in fase un oscillatore (tipicamente quarzato). Questa soluzione si realizza molto bene con un PLL e non si ha deriva sull'oscillazione grazie all'accuratezza introdotta dal quarzo.

\subsubsection{Compensazione della deriva della portante}
Per quanto riguarda i modulatori diretti, si può implementare un sistema per la correzione delle derive della frequenza portante, che prende il nome di CAF (Controllo Automatico della Frequenza).
% la quale funziona però solo sotto certe condizioni per altro facilmente verificabili. 
Si osservi che le derive termiche e quelle dovute all'invecchiamento costituiscono un disturbo a bassissima frequenza che risulta sempre separato da quello del segnale modulante. Indichiamo con $\varepsilon(t)$ tale disturbo e con $\varepsilon(f)$ il suo spettro.
L'obiettivo è di richiudere il modulatore di frequenza diretto in reazione in modo da annullare il disturbo. Si farà uso di alcuni blocchi particolari:
\begin{itemize}
\item Un accoppiatore direzionale che permette di smistare la potenza sulle due porte di uscita mantenendo l'adattamento;
\item Un discriminatore di frequenza la cui tensione di uscita è proporzionale allo scostamento della frequenza istantanea rispetto ad una frequenza di riferimento $\omega_{RIF}$, con un certo coefficiente di proporzionalità $K_D$;
\end{itemize}

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.7\linewidth]{img/Modulatori-FM-AFC}
	\caption{}
	\label{fig:caf}
\end{figure}

L'espressione del segnale nei vari nodi dell'anello è riportata nel seguito per ciascun nodo:

\begin{align*}
V_1(t) &= x(t) + V_6(t)\\
V_2(t) &= V_{2_M} cos\left[ \omega_0t + \omega_D\left( \int_{0}^{t} x(\tau) + V_6(\tau) + \epsilon(\tau) d\tau\right)\right]
\end{align*}

Poiché si richiede un modulatore lineare, si mantiene l'indice di modulazione D (e quindi lo scostamento di frequenza) molto ridotto rispetto allo standard. Dovendo poi trasmettere il segnale è necessario inserire il moltiplicatore di frequenza. L'uscita sarà:
%$\epsilon$ è l'errore sulla portante, ed ha contenuto frequenziale prevalentemente alle basse frequenze. $V_3$ è identica a $V_2$ ma con frequenza N volte maggiore (si realizza con un PLL)
$$V_3(t) = V_{3_M} \cos\left[ N\omega_0t + N\omega_D\left( \int_{0}^{t} x(\tau) + V_6(\tau) + \epsilon(\tau) d\tau\right)\right]$$
Lo scostamento di frequenza che si ottiene è N volte maggiore di quello in uscita al modulatore:
\[
f_D = \frac{\omega_D}{2\pi}N
\qquad\Rightarrow\qquad
D' = N D
\]
Nell'anello di controllo viene usato come riferimento un oscillatore quarzato con pulsazione $\omega_Q$:
$$V_4(t) = V_{4_m} \cos\left\lbrace 
\omega_Qt-\left[
N\omega_0t + N\omega_D\left( \int_{0}^{t} x(\tau) + V_6(\tau) + \epsilon(\tau) d\tau\right)\right]
\right\rbrace
$$
L'uscita del mixer va in ingresso ad un discriminatore (demodulatore) di frequenza, con pulsazione di riferimento pari a $\omega_{RIF}=\omega_Q-N\omega_0$. Si ottiene:
%
%$V_4$ ha una componente a frequenza $\omega_Q - N\omega_0$ e una a frequenza $\omega_Q + N \omega_0$. Filtrando la seconda si ottiene:
%V3 è come V2 ma con argomento dell'oscillazione moltiplicato N volte (è un PLL)
%$$V_3(t) = V_{3_m} cos( N\omega_0't + N\omega_D'\left[ \int_{0}^{t} x(\tau) + V_6(\tau) + \epsilon(\tau) d\tau\right])$$
%v4 ha una componente somma e una differenza. pesco solo quella differenza:
%$$\omega_I = \omega_Q -
%N\omega_0 - N\omega_D\left[x(\tau) + V_6(\tau) + \epsilon(\tau)\right]$$
%Se scelgo per il discriminatore di frequenza $\omega_{RIF} = \omega_Q - N \omega_0'$ allora:
$$V_5(t) = - K_D N \omega_D\left[ x(t) + V_6(t) + \epsilon(t) \right]$$
%$$\mbox{Filtro passa basso - sbatto via x: } V_6(t) = - K_D N \omega_D\left[V_6(t) + \epsilon(t) \right]$$
Filtrando infine passa basso per eliminare $x(t)$:
\begin{align*}
&V_6(t) = - K_D N \omega_D\left[V_6(t) + \epsilon(t) \right]
\\
&V_6(t) = - \frac{K_D N \omega_D}{1+K_DN\omega_D} ~ \epsilon(t)
\\
&V_6(\tau) + \epsilon(\tau) = \epsilon(\tau) \left[ 1 - \frac{K_D N \omega_D}{1+K_DN\omega_D} \right] = \epsilon(\tau) \frac{1}{1+K_DN\omega_D}\\
&V_3(t) = V_{3_M} \cos\left[ N\omega_0t + N\omega_D\left( \int_{0}^{t} x(\tau) + \epsilon(\tau) \frac{1}{1+K_DN\omega_D} d\tau\right)\right]
\end{align*}
L'errore quindi è ridotto di un fattore $1+K_DN\omega_D$. Questo funziona correttamente sotto due ipotesi:
\begin{itemize}
	\item Deve esserci separazione in banda tra $x(t)$ e $\epsilon(t)$, altrimenti è impossibile isolare l'errore;
	\item Il discriminatore di frequenza e l'oscillatore al quarzo devono essere privi di errore.
\end{itemize}

%La moltiplicazione per N non è strettamente necessaria ma ci si mette perché poi serve.
\paragraph{Linearizzazione del modulatore}
Un oscillatore di Clapp si comporta in modo lineare soltanto per piccoli scostamenti dalla frequenza centrale. Come già accennato, nel sistema CAF si utilizza un indice di modulazione molto inferiore a quello previsto dallo standard e si provvede successivamente, con appositi moltiplicatori, a riportare il segnale nella forma corretta per la trasmissione.

Lo standard FM prevede:
\begin{itemize}
	\item Intervallo di portanti $f_0 = 88\div108 MHz$;
	\item Banda del segnale modulante $B_M = 15kHz$;
	\item Occupazione spettrale $B_C = 180kHz$
\end{itemize}

Secondo la relazione data da Carson, $D = \frac{B_C}{2B_m} -1 = 5$. Supponiamo che il valore di N sia molto elevato ($N=1024$), ricaviamo che la portante a cui deve lavorare il modulatore è $f_0' = \frac{f_0}{N} \approx 100kHz$: la condizione di banda stretta è poco rispettata e cade la validità della relazione di Carson sulla banda occupata. In altri termini il segnale modulante non risulta sufficientemente ``lento" rispetto alla portante.

\begin{figure}[hb]
	\centering
	\includegraphics[height=5em]{img/Modulatori-FM-linearizzazione}
	\caption{}
	\label{fig:modulazionefmpiumeglio}
\end{figure}

Se invece poniamo $N=32$  si ha $f_0' = \frac{f_0}{N} \approx 3.375MHz$ e $f_D' = \frac{f_D}{N} = \frac{D B_M}{N} = 2.34kHz$. La portante è accettabile, ma si ha uno scostamento di frequenza ancora troppo elevato.
%Si impone D = 5 (in uscita), f out = 108Mhz
%$$f_D' = \frac{f_D}{N} = 73.54Hz$$
%$$D' = \frac{73.24}{B_M} = 4.88 \cdot 10^{-3}$$
%$$\omega_D = N \omega_D' $$
%Questa soluzione non funziona perché il modulatore non è a banda stretta? Boh, forse si vede dal D'. I discorsi sulla banda di Carson non è che tengano più tantissimo (righe con energia non nulla troppo "sparpagliate").
%(15kHz di segnale modulante intorno a 105kHz)
%\subsection{soluzione che forse funziona}
%Proviamo a modificare l'architettura come segue: imponiamo $f_0 = \nicefrac{f_0''}{32}$ e $f_D' = \frac{f_D}{1024}$. In questo modo si 
%In uscita dal primo stadio abbiamo:
%\begin{align*}
%&f_0 = \frac{108MHz}{32} = 3.375MHz\\
%&f_D = \frac{f_D}{1024} = 73.24Hz\\
%&D   = ....
%\end{align*}
%$$f_0' = \frac{108Mhz}{32}  = 3.375MHz$$
%$$f_D' = \frac{f_D}{1024} = 73.24 Hz$$
%$$D' =\nicefrac{f_D'}{B_M} = 4.88\cdot 10^{-3}$$
%$$\nicefrac{f_D'}{f_0'} = 1.9 \cdot 10^{-5}$$
%Questo modulatore è a banda stretta. In uscita dal secondo stadio:
%$$f_D^{''} = 73.24 Hz \cdot 32 = 2344 Hz$$
%$$f_0^{''} =  108 MHz$$
%$$D^{''} = \frac{f_D^{''}}{B_M} = 0.156$$
%Ok, ma D'' non è 5 e fD non è quella che volevo. No x32 perché sennò cresce f0 che va già bene. Allora si mixa con fo'' = 108+3.75 = 111.75MHz. e pesco la freq differenza
Si adotta, allora, la soluzione descritta in figura in cui ad una prima moltiplicazione per $N = 32$ segue una traslazione in basso mediante un mixer ed una successiva moltiplicazione per $N=32$.

\begin{figure}[hb]
	\centering
	\includegraphics[height=5em]{img/Modulatori-FM-linearizzazione-2}
	\caption{}
	\label{fig:modulazionefmpiumeglio-2}
\end{figure}

In uscita, al solito, imponiamo $f_0 = 108Mhz$ e $D = 5$. Attraversando a ritroso il moltiplicatore si ricava $f_{0}' = \frac{f_0}{32} = 3.375Mhz$ e $D' = \frac{D}{32} = 0.156$.

Il mixer, invece, effettua solamente una traslazione in frequenza, agendo sulla portante e lasciando inalterato l'indice di modulazione ($D'' = D' = 0.156$). Poiché il mixer trasla in basso vale la relazione $f' =  f''- f_{OL}$.

Sul modulatore FM vorremmo utilizzare la portante ricavata poco fa, ponendo $N=32$ ($f''' = \frac{f_0}{32} = 3.375MHz$), dunque si impone $f_0''=f_0'''\cdot 32 = f_0$. Allora la frequenza del mixer sarà $f_{OL} = f_0''-f_0'=
f_0 - \frac{f_0}{32} \approx 104MHz$.

Quindi il modulatore di frequenza lavora con un indice di modulazione $D''' = \frac{D''}{32} = \frac{D}{1024}$ e dunque con scostamento di frequenza $f_D''' = \frac{f_D}{1024} = 73.24Hz$.

%ingresso al mixer
%$$V_M cos \left[ \omega_0^{''} t + \omega_D^{''} \int_{0}^{t} x(\tau) d\tau \right]$$
%
%uscita dal mixer ( i segni sono un po' a simpatia)
%$$V_M cos \left[ \cancel{\omega_0^{''}} t + \omega_D^{''} \int_{0}^{t} x(\tau) d\tau  - \cancel{\omega_0^{''}t} + 3.375Mhz \cdot t \right]$$
%
%E quindi la portante è a 3.375Mhz ossia $\frac{f0}{32}$, D rimane costante perché non dipende da f0, e pure fD. Se moltiplico per 32 ora ottengo quello che mi serve:
%$$f_0 out = 3.375MHz \cdot 32 = 108Mhz$$
%$$D out = 0.156 \cdot 32 = 5$$
%$$f_D out = f_D \cdot 32 = 75kHz$$


\chapter{Ricevitori}

Un ricevitore radio è un sistema in grado di ricevere, amplificare e demodulare un segnale radio
avente caratteristiche prefissate in termini di occupazione di banda e di schema di modulazione, all'interno di una o più gamme (intervalli) di frequenza. Per fare ciò il ricevitore deve essere in
grado almeno di:
\begin{itemize}
	\item ricevere il segnale elettromagnetico mediante un'antenna;
	\item amplificarlo mediante un amplificatore a radiofrequenza con cifra di rumore adeguata;
	\item filtrare il singolo canale che si desidera ricevere, introducendo una attenuazione di livello
	adeguato nei confronti di tutti gli altri segnali;
	\item demodularlo estraendo dal segnale modulato le stesse informazioni contenute nel segnale in
	banda base prima della sua modulazione e trasmissione.
\end{itemize}

\section{Parametri caratterizzanti di un ricevitore}
I principali parametri che caratterizzano il front end di un ricevitore sono elencati e brevemente
descritti nel seguito.
\paragraph{Selettività:} misura la capacità del ricevitore di reiettare i canali indesiderati.
Si misura come segue: con un generatore si impone un certo segnale a frequenza $f_{RF}$ e si rileva la
potenza in uscita dall'AFI in condizioni di perfetta sintonia (potenza massima in uscita).
Quindi, mantenendo la sintonia dell'oscillatore locale si varia la frequenza del segnale in ingresso di
una quantità $\Delta f$ e si rileva la nuova potenza del segnale in uscita dall'AFI senza modificare la
sintonia. Adesso il segnale in uscita all'AFI non è più centrato su $f_{IF}$, ma spostato di una quantità
pari a $\Delta f$ e, di conseguenza, l'uscita risulta attenuata rispetto al caso precedente.
La selettività è data dal rapporto, espresso in dB, di queste due potenze rispetto al $\Delta f$ (ad es: 30dB a
100kHz).
\paragraph{Sensibilità:} è la potenza disponibile in ingresso che garantisce un rapporto segnale-rumore
prefissato sull'uscita a frequenza intermedia.
%S FI
%= R
%N FI
In uscita dall'AFI si ha un segnale a cui è sovrapposto del rumore. Il segnale è intelligibile se il
rapporto segnale-rumore è maggiore di una certa soglia. Un valore abbastanza frequente di tale
soglia può essere 10.
Variando l'ampiezza del segnale in ingresso si cerca il valore in corrispondenza del quale il
rapporto segnale-rumore in uscita è proprio quello voluto (ad es 10). La potenza disponibile
corrispondente a tale ampiezza stabilisce la sensibilità.

\paragraph{Cifra di rumore:} con ovvio simbolismo si definisce come segue $NF_{ric} = \frac{\nicefrac{S_{I_{RF}}}{N_{I_{RF}}}}{\nicefrac{S_{U_{RF}}}{N_{U_{RF}}}}$
\paragraph{Reiezione alla frequenza immagine:}
Si definisce con un esperimento. Si mette in ingresso un generatore di segnale a frequenza $f_{RF}$. Si
sintonizza l'OL e si misura la potenza sull'uscita a frequenza intermedia $P_{IF~RF}$. Senza cambiare la
sintonia si manda in ingresso un segnale alla frequenza immagine $f_{IM}$ e si rimisura il nuovo valore
della potenza sull'uscita a frequenza intermedia $P_{IF~IM}$. La reiezione alla frequenza immagine si calcola come $10\log\left(\frac{P_{IF~RF}}{P_{IF~IM}}\right)$

Allo stesso modo si opera inviando in ingresso, invece che la frequenza immagine, quella intermedia $f_{IF}$ . Si definisce, con ovvio simbolismo la \textbf{reiezione alla frequenza intermedia} come $10\log\left(\frac{P_{IF~RF}}{P_{IF~IF}}\right)$. Il fatto che la $f_{IF}$ sia presente sull'uscita a frequenza intermedia è dovuto ad un cattivo isolamento della porta a radiofrequenza su quella a frequenza intermedia del mixer.


\section{Filtri monolitici passivi}
\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.5\linewidth]{img/filtro-monolitico-quarzo}
	\caption{}
	\label{fig:filtro-monolitico-quarzo}
\end{figure}
Esistono diverse tecnologie per realizzare filtri a frequenza fissa con caratteristiche particolarmente
spinte in termini di selettività. Fra queste la più diffusa, anche per il costo abbastanza contenuto, è
quella basata sull'utilizzo di cristalli di quarzo opportunamente sagomati. Il materiale utilizzato ha
caratteristiche piezoelettriche, ovvero a fronte dell'applicazione di una tensione tra due facce
di un parallelepipedo il materiale piezoelettrico presenta una microdeformazione e, viceversa, se,
applicando una forza opportuna si causa una deformazione, allora si osserva su direzioni ortogonali
a quelle della deformazione, una differenza di potenziale. Si tratta, di fatto, di un sistema in grado di
trasformare sollecitazioni elettriche in meccaniche e viceversa. La struttura di un filtro al quarzo è
rappresentata in maniera schematica in figura.


\begin{figure}[hbt]
	\centering
	\includegraphics[height=8em]{img/filtro-monolitico-quarzo-1}
	\hfill
	\includegraphics[height=8em]{img/filtro-monolitico-quarzo-2}
	\caption{}
	\label{fig:filtro-monolitico-quarzo-1}
\end{figure}

La sollecitazione meccanica causata dall'applicazione di
una tensione variabile $V_{IN}$ tra due metallizzazioni deposte ad una estremità del cristallo di quarzo, si propaga attraverso lo stesso e viene rilevata tra due placche metalliche poste all'altra estremità sotto forma di tensione variabile $V_U$.
Il comportamento del sistema è molto selettivo in frequenza
ed il modulo della risposta $\nicefrac{V_U}{V_{IN}}$ ha un andamento del tipo rappresentato in figura.


%I filtri al quarzo, da unto di vista elettrico, possono essere schematizzati con una rete a scala in cui i
%tratti orizzontali sono costituiti da circuiti risonanti serie e quelli verticali da circuiti risonanti
%parallelo, ambedue alla stessa frequenza di risonanza f 0 .

Un'altra tipologia di filtri monolitici per radiofrequenza è quella dei Filtri SAW (Surface Acustic Wave). Si tratta di blocchi di materiale piezoelettrico su cui sono realizzate metallizzazioni con opportune geometrie interdigitate che permettono di ottenerere una risposta in frequenza selettiva e sagomata in maniera particolare. Sono disponibili in commercio fino a frequenze di qualche GHz.

\begin{center}
	\begin{tabular}{|c|c|c|c|c|}
		\hline 
		& $f_0$ & Q & Att. & Costo indicativo \\ 
		\hline 
		Quarzo & $10\div100MHz$ & 1000 & $\simeq1dB$ & qualche euro \\ 
		\hline 
		Ceramico & $1\div10MHz$ & $> 200$ & $\simeq2dB$ & meno di qualche euro \\ 
		\hline 
		SAW & $1GHz$ & 500 & $\simeq1dB$ & più di qualche euro \\ 
		\hline 
		a Microstriscia & $40GHz$ & $> 200$ & $\simeq2\div5dB$ & praticamente gratuiti \\ 
		\hline 
	\end{tabular} 
\end{center}

\section{Ricevitore supereterodina}
L'architettura ampiamente più diffusa della parte frontale (dall'antenna al demodulatore) di un ricevitore è quella nota come supereterodina, che risolve nella maniera più economica e	tecnologicamente abbordabile il problema dell'elevata selettività\footnote{Come vedremo in seguito, per selettività si intende la capacità del ricevitore di trattare il segnale che si desidera ricevere in maniera \textit{differenziata} da quelli che costituiscono interferenza e dovrebbero essere idealmente eliminati.} richiesta in molte applicazioni.
%Questa architettura, affermatasi fin dagli inizi dello sviluppo della radio, fu ideata da Lucien Levy nel 1917 ma fu brevettata da Edwin Howard Armstrong nel 1918. Questi fece sua l'idea di Levy che solo nel 1928, dopo una lunga vertenza giudiziaria, venne riconosciuto come legittimo inventore.
Immaginiamo di avere, nello spettro delle frequenze, un certo numero di stazioni su cui è possibile sintonizzarsi. Utilizzare una batteria di filtri a frequenza fissa, uno per ciascuna stazione, sarebbe antieconomico e limiterebbe il numero massimo di canali. D'altro canto realizzare un solo filtro molto selettivo, a frequenza variabile e che copra tutto lo spettro radio sarebbe troppo difficile e costoso, soprattutto con le tecnologie disponibili agli albori della radio.\\
Sì pensò, quindi, ad un sistema in grado di traslare la banda del canale su cui si vuol sintonizzarsi intorno ad una frequenza fissa più bassa, detta frequenza intermedia $f_{IF}$. Tutti i circuiti di filtraggio e demodulazione successivi opereranno attorno a tale frequenza.

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.7\linewidth]{img/supereterodina}
	\caption{}
	\label{fig:supereterodina}
\end{figure}


%Questo risultato si ottiene utilizzando un mixer e scegliendo opportunamente la frequenza $f_{OL}$ dell'oscillatore locale. Posizionando intorno alla frequenza $f_{IF}$ un filtro selettivo, sarà poi possibile filtrare il segnale desiderato, eliminando tutti quelli che si trovano fuori dalla banda del filtro. Per ottenere lo stesso risultato sarebbe, altrimenti, necessario utilizzare un filtro passa banda con frequenza centrale pari a $f_{RF}$ da posizionare subito dopo l'antenna o il LNA (v. figura). Questa seconda soluzione è estremamente difficile e più costosa da realizzare. .
Per fare un esempio, immaginiamo di voler selezionare un singolo canale per una comunicazione GSM\footnote{Global System for Mobile Communications, standard per la comunicazione mobile.}. Questo protocollo ha canali che si estendono nell'intervallo 930$\div$960MHz, ed ognuno di essi ha una banda $B=200 KHz$. Per ottenere il risultato sarebbe necessario un filtro a frequenza variabile su tutto l'intervallo frequenziale (circa 30Mhz), richiedendo un $Q = \frac{f_{max}}{B} \simeq 5000$. Si tratta di una soluzione non realizzabile in pratica, poiché i componenti reattivi variabili limitano il Q a qualche centinaio.\\
Quindi, invece di spostare il filtro sulle frequenze volute si fa la cosa opposta: si trasla il segnale a bassa frequenza dove può essere filtrato più agilmente.
%Per traslare il segnale lo si moltiplica per un'oscillazione a frequenza opportuna in modo che uno dei prodotti della moltiplicazione (tipicamente il segnale a frequenza differenza) cada in corrispondenza della frequenza intermedia prescelta. Infatti, gli oscillatori variabili sono più facilmente realizzabili dei filtri a frequenza variabile. Lo schema base di un ricevitore supereterodina è rappresentato in figura-

\subsection{Problema della frequenza immagine}
Questa architettura introduce, però, una criticità: sia il canale che si desidera ricevere che un potenziale interferente situato in posizione simmetrica rispetto all'oscillatore locale vengono traslati dal mixer alla medesima frequenza intermedia.
L'effetto è facilmente visibile nell'immagine che segue, relativa allo standard radio AM: al servizio è destinata la banda 540 kHz $\div$ 1.6 MHz, sulla quale sono identificati 106 canali distanziati da 10 KHz di \textit{banda di guardia}. Ciascun canale ``ospita" un segnale modulato in ampiezza da un segnale in banda audio, indicativamente da 300 Hz a 4.5 kHz.

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.7\linewidth]{img/supereterodina-AM-immagine}
	\caption{}
	\label{fig:supereterodina-am-immagine}
\end{figure}


L'operazione di moltiplicazione trasla intorno ad $f_{IF}$ sia il segnale utile, centrato ad $f_{RF}$, sia l'interferente simmetrico rispetto ad $f_{OL}$, centrato intorno alla cosiddetta \textit{frequenza immagine} $f_{IM} = f_{OL}+f_{IF}$.
\\
Per risolvere il problema, basta inserire, prima del mixer, un filtro che introduca una attenuazione adeguata in corrispondenza della frequenza immagine. L'architettura del front end viene modificata come in figura:

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.7\linewidth]{img/supereterodina-singolaIF}
	\caption{}
	\label{fig:supereterodina-singolaif}
\end{figure}


Il filtro per la frequenza immagine (di norma denominato \textit{filtro a radiofrequenza} per distinguerlo
da quello a frequenza intermedia detto anche \textit{filtro di canale}) deve avere selettività adeguata e attenuare la frequenza immagine di una quantità fra 30$\div$70dB, a seconda delle applicazioni.

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.7\linewidth]{img/supereterodina-AM}
	\hfill
	\includegraphics[width=0.2\linewidth]{img/supereterodina-filtro-accordabile}
	\caption{Distribuzione frequenziale per la trasmissione AM. A destra, implementazione di filtro accordabile.}
	\label{fig:supereterodina-am}
\end{figure}

Come si può osservare, l'intervallo su cui sono distribuiti i canali e quello delle frequenze immagine sono parzialmente sovrapposti e questo impedisce l'uso di un filtro a frequenza fissa con una banda che copra tutti i canali. Nel caso in cui la frequenza intermedia sia abbastanza elevata e i due intervalli siano sufficientemente lontani, il filtro RF può essere a frequenza fissa.
\\
Un semplice filtro accordabile può essere realizzato con la topologia illustrata in figura. La capacità variabile era ottenuta in passato con particolari condensatori a facce piane parallele la cui geometria è modificabile meccanicamente; ad oggi è più pratico l'uso di un varicap. In ambedue i casi, comunque, è difficile ottenere fattore di qualità $Q > 30$. Valori più elevati, sempre utilizzando tecnologie a parametri concentrati, possono essere ottenuti in filtri a frequenza centrale fissa: $Q \sim 100 \div1000$. Molto meglio si può fare con filtri monolitici, come quelli al quarzo, che permettono di superare agevolmente il valore di 1000.

\subsection{Architettura a doppia conversione}

Sembrerebbe risolto, con il ricevitore supereterodina e l'utilizzo del filtro a radiofrequenza, il problema della ricezione selettiva del canale. Le cose, invece, non stanno esattamente così poiché la scelta della $f_{IF}$ può comportare delle complicazioni.\\
Facciamo, ancora una volta, riferimento ad un caso reale: il servizio di comunicazione tra stazione a terra e aeromobile usato negli aeroporti. A questo servizio è assegnata la banda 117 $\div$ 136 MHz, e a ciascun canale spetta una $B_{ch} = 10kHz$. Immaginiamo di disporre di filtri RF accordabili con un Q massimo pari a $Q_V = 30$ e filtri a frequenza centrale fissa con $Q_F = 100$.
\\
La frequenza intermedia $f_{IF}$ è legata al fattore di qualità del filtro AFI e alla larghezza di banda del singolo canale $B_{ch}$ secondo la relazione
\[
Q_F =\frac{f_{IF}}{B_{ch}}
\quad\Rightarrow\quad
f_{IF} = \frac{Q_F}{B_{ch}} = \frac{100}{10 kHz} = 1 MHz
\]

Per ricevere le frequenze nell'intervallo [117 $\div$ 136] MHz dovremo traslare il canale da ricevere a 1MHz. La banda coperta dall'OL sarà [118 $\div$ 137] MHz e l'intervallo delle frequenze immagine sarà [119$\div$ 138] MHz. Quanto appena detto è schematizzato nella figura seguente:

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.7\linewidth]{img/supereterodina-aeromobile}
	\caption{}
	\label{fig:supereterodina-aeromobile}
\end{figure}

Gli intervalli di frequenza delle frequenze immagine e delle radiofrequenze si sovrappongono: per questo è necessario
utilizzare un filtro a RF con frequenza centrale variabile, il quale presenterà un $Q_{max} = 30$. In tal caso la banda passante del filtro sarà:
\[
Q = \frac{f_{RF_{max}}}{B_{RF}}
\quad\Rightarrow\quad
B_{RF} =
\frac{f_{RF_{max}}}{Q} = \frac{136 MHz}{30}
= 4.5 MHz
\]
Dunque, il filtro centrato a 136 Mhz ha una banda che comprende anche la frequenza immagine.
%Pertanto la f IM che si trova a 138 MHz, quindi dentro la banda del filtro RF, e non viene attenuata,
%mentre si desidera, tipicamente, introdurre un'attenuazione della f IM di almeno 40dB.

Il problema si risolve modificando la struttura originaria, introducendo la tecnica della doppia conversione. Si utilizza una prima frequenza intermedia più elevata, in modo da allontanare il canale immagine dalla banda a radiofrequenza (si ricordi la relazione $f_{IM} = f_{RF} + 2 f_{IF}$). Qui si può operare un filtraggio di canale.\\
Quindi si opera una seconda traslazione fino ad una seconda frequenza intermedia, questa volta utilizzando un oscillatore locale fisso.

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.7\linewidth]{img/supereterodina-doppiaIF}
	\caption{}
	\label{fig:supereterodina-doppiaif}
\end{figure}


Nella progettazione bisognerà trovare un compromesso nella scelta delle frequenze intermedie: né troppo basse da rendere complessa la reiezione del canale immagine, né elevate a tal punto da richiedere i relativi filtri di canale a Q elevati.
\\
Vediamo un possibile dimensionamento riprendendo l'esempio precedente.

In uscita dal filtro IF \ding{173}, centrato a frequenza $f_{IF_2}$, avremo il canale che si desidera ricevere. Il valore di questa frequenza intermedia è fissato dalla relazione:
\[f_{IF_2} = \frac{Q_F}{B_{ch}} = 1 MHz\]
La prima frequenza intermedia $f_{IF_1}$ si ricava imponendo che la frequenza immagine della prima conversione $f_{IM_1}$ sia sufficientemente lontana dal canale che si desidera ricevere centrato su $f_{RF}$, per esempio:
\[f_{IM_1} = 1.5 \cdot f_{F_{RF}} = 204 MHz
\qquad \mbox{(si è assunto $f_{F_{RF}}$ = 136 MHz che è la situazione peggiore)}\]

L'oscillatore locale si troverà a metà strada tra $f_{RF}$ e $f_{IM}$:
\[
f_{IF_1} = \frac{|f_{RF}-f_{IM}|}{2}=
\frac{204-136}{2} MHz = 34MHz
\]
e dovrà coprire un certo intervallo, dato da:
\begin{align*}
f_{OL_{min}} &= 117+34 = 151MHz\\
f_{OL_{max}} &= 136+34 = 170MHz\\
\end{align*}
Invece, l'oscillatore locale \ding{173} produrrà una frequenza fissa pari a 35MHz, per la traslazione dalla prima frequenza intermedia ($f_{IF_1}= 34MHz$) fino a 1MHz.
Potrebbe ancora verificarsi il problema della frequenza immagine sulla seconda conversione: è opportuno verificare che ciò non accada. Il filtro AFI \ding{172} deve essere in grado di reiettare la seconda frequenza immagine $f_{IM_2}$. È un filtro a frequenza fissa con $Q>100$ per cui:
\[ B_{AFI_1} = 340 kHz = \frac{f_{IF_1}}{Q} = \frac{34Mhz}{100}
\]
La $f_{IM_2}$ è chiaramente fuori dalla banda del filtro che presenterà dei fianchi molto ripidi ($Q>100$) e, pertanto verrà pesantemente attenuata. Per una valutazione esatta bisognerebbe, comunque, conoscere con precisione la tipologia e l'ordine del filtro utilizzato.

Potrebbe accadere (anche se è estremamente raro) che due conversioni non siano sufficienti, in tal
caso si può arrivare a 3 o più. L'attuale disponibilità di filtri monolitici a frequenza centrale fissa e a
basso costo scongiura, di fatto, questa eventualità.

\begin{figure}[htb]
	\centering
	\includegraphics[width=0.3\linewidth]{img/raster/istogrammi-brutti}
	\hspace{2em}
	\includegraphics[width=0.3\linewidth]{img/raster/istogrammi-brutti1}
	\caption{}
	\label{fig:istogrammi-brutti1}
\end{figure}

\section{Omodina}
\begin{figure}[ht]
	\centering
	\includegraphics[width=0.7\linewidth]{img/omodina}
	\caption{il primo filtro (a RF) è bandpass}
	\label{fig:omodina}
\end{figure}
In questo caso la frequenza intermedia è nulla in quanto l'oscillatore locale lavora alla stessa frequenza della portante.
Il segnale è direttamente traslato in banda base, perciò il filtro di canale è un passa-basso. Anche se deve essere molto selettivo è comunque integrabile perché lavora in bassa frequenza (ad esempio 200kHz), e può essere realizzato anche mediante la tecnica dei condensatori commutati.

Il problema della frequenza immagine non sussiste, però al primo stadio si pone comunque un filtro a radiofrequenza che copra la banda di interesse in modo da arrestare i cosiddetti \textit{blockers}, interferenti ad elevata potenza che trasmettono su bande non d'interesse, ma che potrebbero portare l'ARF in saturazione.
%Per limitare questo problema si dovrebbe lavorare con un AFI in grado di filtrare l'intervallo che va dalla continua fino alla frequenza di corner del rumore flicker, ovvero, utilizzare un valore della fIF di alcune centinaia di kHz: tipicamente f IF = 200 kHz ÷ 1 MHz . Questa scelta porta ad una architettura diversa denominata ?Low IF?.

Questa architettura soffre però di alcuni problemi:
\begin{itemize}
	\item Il filtro di canale soffre di rumore flicker. Il che è problematico perché compare già al primo stadio, a differenza del supereterodina dove lo ritroviamo solo nell'ultimo stadio in bassa frequenza, quando il segnale è già stato ``rinforzato". Per ridurre il problema bisognerebbe amplificare immediatamente, a radiofrequenza, ed è ormai noto che amplificatori con alto guadagno sulle alte frequenze siano scarsamente efficienti;
	\item 
	Si ha accoppiamento dell'oscillatore locale con l'ingresso del ricevitore che è sintonizzato sulla stessa frequenza. Essendo il primo un segnale di notevole potenza e l'accoppiamento controllato da fenomeni aleatori (tipo la posizione del ricevitore, l'orientamento dell'antenna, ecc,) questo fenomeno può produrre in uscita al mixer una tensione \textit{quasi continua} (DC offset) nociva alla corretta demodulazione:
	\\
	Ipotizzando l'uso di una cella di Gilbert, $V_{OL}$ deve essere un segnale di 350 mV di ampiezza
	\[
	V_{OL_m} = 350mV \Rightarrow P_{A_{OL}} = ...= \frac{V_{OL_m}^2}{8R_S} \overset{R_S = 50 \Omega}{=} -8dBm)
	\]
	Il segnale che arriva è amplificato di una ventina di dB. Il segnale di oscillatore locale però si accoppia al segnale di ingresso e dà origine ad una componente continua che dipende dall'ampiezza di $V_{OL}$ ($V_{OL} cos (...) \cdot V_{OL} cos (...)$, l'oscillatore locale viene moltiplicato per sé stesso). Dà luogo ad offset del segnale.\\
	Ma l'accoppiamento c'è anche nei mixer usati in eterodina: però in quel caso la frequenza dell'oscillatore locale è diversa da quella del segnale in ingresso, si mette un "filtraccio" a ridosso del moltiplicatore che sbatta via la frequenza di oscillatore locale.
\end{itemize}

%L'oscillatore locale è alla stessa frequenza della portante. Non c'è problema della frequenza immagine

%Attualmente si ha...
%FDMA (Frquency Division Multiple Access)
%Downlink e Uplink su frequenze diverse
%( boh non so che c'entri)

%Il filtro post mixer è un passa basso con limite di banda $f_{MAX}$, tipicamente pari a qualche centinaia di kHz, quindi facilmente integrabile.

%A parte antenna e filtro a radiofrequenza, sta tutto nel chip. Filtro a condensatori commutati

%Problema: oscillazioni con pari distanza $\Delta f$ dall'oscillatore locale vengono riportati sovrapposti in banda base.
%Soluzione: si usa un mixer doppio in fase e quadratura.
%$$cos\alpha cos \beta = \frac{1}{2}  \left[ cos(\alpha + \beta) + cos(\alpha - \beta) \right]$$
%$$
%cos\alpha sin \beta = \frac{1}{2}  \left[ cos(\alpha + \beta - \frac{\pi}{2}) + cos(\alpha - \beta + \frac{\pi}{2}) \right]
%$$

%\begin{figure}[h]
%	\centering
%	\includegraphics[width=0.3\linewidth]{img/raster/omodina1}
%	\caption{fa abbastanza schifo}
%	\label{fig:omodina1}
%\end{figure}

%in ingresso: $cos(\omega_0t \pm 2 \pi \Delta f t)$

%in uscita pesco solo quello a frequenza differenza:
%$$cos(\pm 2 \pi \Delta f t)$$ 
%$$sin(\mp 2 \pi \Delta f t)$$

%Problemi:
\section{Architettura Low IF}
Questa architettura è caratterizzata da un valore della frequenza intermedia talmente basso da rendere praticamente impossibile la realizzazione del filtro a radiofrequenza ($f_{IF} = 100 \div 1000 kHz$, che risulta troppo prossima alla frequenza immagine). Oltre ad essere estremamente selettivo il filtro dovrebbe essere a frequenza centrale variabile perché il range RF si sovrappone al range IM.\\
Il problema si risolve  utilizzando un particolare tipo di mixer denominato \textit{Mixer a Reiezione della Frequenza Immagine} che è in grado di trattare in maniera differenziata il canale centrato sulla $f_{RF}$, che si trova a sinistra della frequenza dell'oscillatore locale, dal canale immagine che si trova in posizione simmetrica a destra.
In questa architettura non si ha più bisogno di un filtro fortemente selettivo per la reiezione della frequenza immagine, ma permane comunque un filtro RF per l'eliminazione dei blockers.

\begin{figure}[h]
	\centering
	\hspace{\fill}
	\raisebox{-.5\height}{\includegraphics[width=0.60\linewidth]{img/lowIF}}
	\hspace{\fill}
	\raisebox{-.5\height}{\includegraphics[width=0.35\linewidth]{img/lowIF-mixer-reiezione}}
	\hspace{\fill}
	\caption{}
	\label{fig:lowif1}
\end{figure}

\paragraph{Mixer a reiezione della frequenza immagine}
Ne è illustrata la struttura di massima in figura \ref{fig:lowif1}. Se non c'è frequenza immagine:

\begin{align*}
\displaybreak[3]
%\omega_{IM} &= \omega_{RF}  + 2(\omega_{OL} - \omega_{RF}) = ... = 2 \omega_{OL} -  \omega_{RF} 
%\\
V_1 &= \frac{1}{2} \cos [(\omega_{OL}-\omega_{RF}) t]
\\
V_2 &= \frac{1}{2} \sin[(\omega_{RF}-\omega_{OL}) t]
\\
V_3 &= \frac{1}{2} \sin[(\omega_{RF}-\omega_{OL})t - \nicefrac{\pi}{2}] = -\frac{1}{2} \cos[(\omega_{OL} - \omega_{RF}) t ]
\\
V_{OUT} &= V_2-V_3 = \cos(\omega_{OL} - \omega_{RF})t
\end{align*}
Se entra anche la frequenza immagine, ossia un'oscillazione a pulsazione $\omega_{IM}$:
\begin{align*}
V_1 &= 
\frac{1}{2} \cos[(\omega_{OL} - \omega_{IM})t]
=\frac{1}{2} \cos[(\omega_{OL} - 2 \omega_{OL} + \omega_{RF})t] = \frac{1}{2}\cos(\omega_{IF}t)
\\
V_2 &= \frac{1}{2} \sin [(\omega_{IM}-\omega_{OL})t] = -\frac{1}{2} \sin [(2 \omega_{OL} - \omega_{RF} - \omega_{OL})t] = - \frac{1}{2} \sin \omega_{IF}t
\\
V_3 &= \frac{1}{2} \cos\omega_{IF}t
\\
V_{OUT} &= 0
\end{align*}

La frequenza immagine viene cancellata.

L'implementazione dei blocchi è in parte nota, le portanti sfasate possono essere realizzate con un PLL. Lo sfasamento del segnale \ding{173} viene effettuato tramite un filtro polifase che emula un filtro di Hilbert.
\\
Affinché il sistema funzioni correttamente bisogna avere
pari attenuazioni o amplificazioni sui due canali, le portanti esattamente in quadratura e sfasamento fra \ding{173} e \ding{174} di $\nicefrac{\pi}{2}$.

Viene utilizzato prevalentemente quando la reiezione della frequenza immagine deve essere compresa fra i $35 \div 50 dB$ (tipicamente 40dB).

%In figura è schematizzato l'intero transceiver integrato che non richiede alcuna uscita intermedia dal chip e permette di conseguire enormi vantaggi in termini di costo, ingombro, consumo ed affidabilità.

%Frequenza intermedia bassa , di poco maggiore a metà della banda di canale. Soluzione totalmente integrata, il filtro di canale si fa a condensatori commutati.

%Amplificatore video: banda dalla continua fino a qualche MegaHz, detto così perché usato nelle televisioni BW che dovevano trasmettere sia immagini fisse che rapidamente variabili.

\section{Esempi di ricevitori per alcuni servizi di radiotrasmissione}
In questa sezione esaminiamo alcuni esempi di ricevitori per determinati standard trasmissivi.

\subsection{Ricevitori per radio AM a onde medie}
Questo standard prevede di utilizzare un range di frequenze fra 540 kHz $\div$ 1.6 MHz. Ciascun canale porta l'informazione modulata in ampiezza a doppia banda laterale con portante relativa ad un segnale audio la cui banda va da 300 Hz a 9.3 kHz e, pertanto, occupa una banda di 9 kHz. Le
frequenze centrali di canali adiacenti distano 10 kHz (banda di guardia).
Nel dimensionare il front-end partiamo dall'ipotesi, realistica ai tempi in cui lo standard è nato, di poter disporre per il filtraggio a frequenza intermedia di filtri con $Q_F = 50$. Sotto queste condizioni la frequenza centrale $f_{IF}$ dello stadio a frequenza intermedia è data dalla seguente relazione:
\[
Q_F = \frac{f_{IF}}{B_{ch}}
\quad\Rightarrow\quad
f_{IF} = Q_{AFI}  B_{ch} = 450 kHz
\qquad
\mbox{Per un accordo fra costruttori si usa $f_{IF}= 455kHz$}
\]
Talvolta il LNA non viene utilizzato su questo tipo di applicazione poiché nel range di frequenze assegnate al servizio i disturbi sono di livello elevato e la potenza disponibile del segnale in antenna deve essere abbastanza alta per permettere la ricezione, per cui non è richiesta bassa cifra di rumore.

.....figura.....

In tal caso il filtro a radiofrequenza è seguito direttamente dal mixer. La demodulazione del segnale AM si può effettuare secondo due modalità: con un rivelatore asincrono costituito da un circuito analogo al raddrizzatore a filtro capacitivo a singola semionda oppure con un rivelatore sincrono (con recupero di portante).

\subsubsection{Rivelatore di inviluppo}
Questo tipo di demodulatore è detto asincrono perché non richiede la ricostruzione della portante. Forniamo alcune indicazioni per il suo corretto dimensionamento:
$\tau=RC$ è la costante di tempo con cui il condensatore si scarica sulla resistenza R quando il diodo si sgancia. R deve essere di valore abbastanza elevato affinché, durante la scarica, la tensione sul condensatore non si discosti troppo dall'inviluppo del segnale in ingresso. Poiché l'equazione della scarica è data da $V_C = V_{max}e^{-\frac{t}{\tau}}$ si deve avere $\tau \gg T_{IF}=\nicefrac{2\pi}{f_{IF}}$ (dunque $RC \gg \nicefrac{2\pi}{\omega_{IF}}$).

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.45\linewidth]{img/ricevitore-rivelatore-inviluppo}
	\includegraphics[width=0.45\linewidth]{img/ricevitore-inviluppo}
	\caption{}
	\label{fig:ricevitore-rivelatore-inviluppo}
\end{figure}


La costante di tempo deve avere anche un limite superiore altrimenti la scarica risulterebbe troppo lenta e la tensione $V_C$ non riuscirebbe a seguire l'inviluppo; in altri termini, il demodulatore tenderebbe a funzionare come rivelatore di picco. Per valutare il massimo valore di $\tau$ compatibile con un corretto funzionamento del demodulatore imponiamo la seguente condizione: la velocità di scarica deve essere, in modulo, maggiore della velocità con la quale varia l'inviluppo (ossia la derivata rispetto al tempo dell'inviluppo medesimo). Supponiamo, per semplificare, che l'inviluppo abbia andamento cosinusoidale con pulsazione $\Omega$. Si suppone che $t^*$ sia l'istante di inizio della scarica.

\begin{align*}
x(t) &= cos(\Omega t)
\\
\left. \frac{\partial}{\partial t}(inviluppo)\right|_{t=t^*} &= - V_{AM}  m_a \Omega\sin(\Omega t^*)
\\
\left. \frac{\partial}{\partial t}(scarica)\right|_{t=t^*} &=
\left. \frac{\partial}{\partial t}
\left\lbrace
V_{AM}[1+m_a\cos(\Omega t^*)]e^{-\frac{t}{\tau}}
\right\rbrace
\right|_{t=t^*}
= -\frac{V_{AM}}{\tau} [1+m_a\cos(\Omega t^*)]
\end{align*}

Ricavati i due termini si impone la condizione:
\[
\frac{V_{AM}}{\tau} [1+m_a\cos(\Omega t^*)]
>
V_{AM}  m_a \Omega\sin(\Omega t^*)
\qquad\Rightarrow\qquad
\tau=\frac{1+m_a\cos(\Omega t^*)}{m_a\Omega\sin(\Omega t^*)}
\]

Per ogni $t^*$ si ottiene un $\tau$ diverso: affinché la condizione sia sempre verificata è necessario e sufficiente che lo sia in corrispondenza del valore di $t^*$ per cui l'espressione a destra della disuguaglianza è minima. Si cerca il minimo in funzione di $t^*$:
\begin{align*}
&
\frac{\partial}{\partial t^*}
\left(
\frac{1+m_a\cos(\Omega t^*)}{m_a\Omega\sin(\Omega t^*)}
\right) = 0
\\&
-m_a\Omega\sin(\Omega t^*) \cdot m_a\Omega\sin(\Omega t^*)
-[1+m_a\cos(\Omega t^*)]\cdot m_a \Omega^2\cos(\Omega t^*)
=0
\\&
-m_a^{\cancel{2}}\bcancel{\Omega^2} \sin^2(\Omega t^*)
- \cancel{m_a} \bcancel{\Omega^2}\cos(\Omega t^*)
- m_a^{\cancel{2}} \bcancel{\Omega^2}\cos^2(\Omega t^*) = 0
\\&
\cos(\Omega t^*) = -m_a \cancel{[\sin^2(\Omega t^*)+\cos^2(\Omega t^*)]}
\end{align*}
Dunque $t^*$ ha il suo massimo quando $\cos(\Omega t^*) = -m_a$. Inserendo quanto ricavato nella condizione sul $\tau$ ricavata in precedenza, si ha che:
\[
\tau < \frac{1-m_a^2}{m_a\Omega\sqrt{1-m_a^2}} = 
\frac{\sqrt{1-m_a^2}}{m_a\Omega}
\]
Nel caso in cui il segnale non sia monocromatico, la valutazione di massimo si fa sostituendo a $\Omega$ la $\Omega_{max}$ del segnale.

%\paragraph{Esempio:} Supponiamo $m_a = 0.9$ e $\Omega_{max}= 2\pi \cdot 500kHz$
%\[
%\tau_{max} = \frac{\sqrt{1-m_a^2}}{m_a\Omega_{max}}
%\simeq 100\mu S
%\]
Facciamo adesso alcune considerazioni sull'ampiezza che l'inviluppo deve assumere per una corretta rivelazione. Immaginando di utilizzare un diodo al germanio con $V_\gamma = 0.3 V$, deve risultare
\[
V_{IN} = V_{AM}[1+m_ax(t)]\cos(\omega_{IF}t) \gg V_\gamma
\quad \forall t
\]
L'inviluppo varia con $x(t)$, ma sappiamo che $|x(t)| < 1$ quindi nel caso peggiore si ha $x(t) = -1$.
%Mantenendo le ipotesi del precedente esempio otteniamo
Supponendo $m_a = 0.9$ otteniamo
\[
V_{AM}(1-0.9) > 10V_\gamma = 3V
\qquad\Rightarrow\qquad
V_{AM} > 30V
\]
Per ottenere questo risultato, ovvero un amplificatore a frequenza intermedia con ampiezza
massima della tensione di uscita pari a 30 V, bisognerebbe utilizzare una tensione di alimentazione
ancora maggiore: soluzione incompatibile con i limiti di ingombro, peso e autonomia di qualunque
sistema portatile. Per ovviare a questo inconveniente si può utilizzare un altro tipo di rivelatore:
quello sincrono

\subsubsection{Rivelatore sincrono}

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.7\linewidth]{img/ricevitore-AM-sincrono}
	\caption{Il filtro passa basso in uscita arresta le componenti a $2\omega_{IF}$.}
	\label{fig:ricevitore-am-sincrono}
\end{figure}

Moltiplicando il segnale AM $V_{AFI} = V_{AM}[1+m_ax(t)]\cos(\omega_{IF}t)$ per la portante $\cos(\omega_{IF}t)$ si ottiene, a seguito dei dovuti filtraggi, una traslazione in banda base di $x(t)$.
\\
Il recupero della portante può essere fatto con un semplice comparatore, anche perché il mixer è solitamente controllato in commutazione.

\subsubsection{Controllo automatico del guadagno}

Esaminiamo, adesso, un problema tipico dei ricevitori per segnali modulati in ampiezza: quello del
fading. Poiché le caratteristiche del canale variano in maniera imprevedibile per diverse ragioni,
l'ampiezza della portante è soggetta ad una variabilità che può essere anche di ordini di grandezza
nel giro di pochi minuti (ad esempio nel caso di un ricevitore su un mezzo che si muove ad alta
velocità in ambiente urbano).
% In realtà V AM è una funzione del tempo lentamente variabile:
%V AM = V AM (t). Si tratta, comunque, di fluttuazioni molto lente il cui spettro è centrato intorno alla
%continua e si estende, al massimo, fino a frequenze di qualche Hertz (v. figura)..

Il problema si risolve utilizzando una retroazione che prende il nome di controllo automatico del guadagno: si preleva, dall'uscita demodulata, un segnale proporzionale all'ampiezza della portante e lo si utilizza per variare il guadagno dell'AFI, come schematicamente rappresentato in figura.

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.6\linewidth]{img/ricevitore-AM-AGC}
	\includegraphics[width=0.35\linewidth]{img/ricevitore-AM-AGC-1}
	\caption{}
	\label{fig:ricevitore-am-agc}
\end{figure}


All'amplificatore dovrà essere aggiunta, dunque, una opportuna rete di regolazione del guadagno controllata in tensione (AGC - Automatic Gain Control). Una possibile implementazione è la seguente, che utilizza un transistor ausiliario per variare il punto di riposo dell'amplificatore in funzione dell'ampiezza della portante: ad una riduzione di ampiezza corrisponderà un aumento del $g_m$ e viceversa.
\\
La portante viene recuperata con un filtro passa basso a partire dal segnale demodulato.


\subsection{Ricevitori per radio FM}
Come si era già visto nel capitolo \ref{ch:trasmettitori}, un segnale FM ha una forma del tipo
\[
V_{FM}(t) = V_{FM_M} \cos \bigg[ \omega_{RF}t
+\underbrace{\omega_D \int_{0}^{t}x(\tau) d \tau}_\text{$\theta(t)$} \bigg]
\]
Calcolarne lo spettro non è facile, per cui si sfrutta una relazione dovuta a Carson che, sotto certe ipotesi, permette di individuare l'intervallo di frequenze che contiene buona parte dell'energia del segnale modulato, detto banda di Carson:
\[
B_C = 2B_m(D+1)
\]
Come esempio di riferimento analizziamo lo standard che regola il servizio di radiodiffusione FM. L'intervallo di frequenze assegnato al servizio dal Piano Nazionale delle fequenze è compreso tra 88 e 108 MHz. È previsto che ogni canale abbia un'occupazione in banda di $B_C = 180kHz$, e che vi si possano trasmettere segnali con una banda compresa fra $B_m = 30Hz\div15kHz$. Se ne ricava che
\[
D = \frac{B_C}{2B_m} -1=  5
\qquad\Rightarrow\qquad
f_D = 75kHz
\]
Esaminiamo una possibile procedura di dimensionamento del front end il cui schema a blocchi è rappresentato nella seguente figura. Come si vedrà, in questo caso, almeno in linea di principio, il filtro a radiofrequenza può essere fisso dal momento che il range della radiofrequenza e quello della frequenza immagine risultano separati.

Il filtro a frequenza intermedia che immaginiamo contenuto all'interno dell'AFI è, come nel caso precedente, quello che seleziona il canale che si desidera ricevere. Supponiamo anche questa volta che, per renderne possibile la realizzazione a basso costo il suo fattore di qualità sia $Q_F \sim 50$,pertanto risulta $f_{IF} = Q_F B_C ~ 10MHz$.
Per mantenere il range della frequenza immagine separato da quello della radiofrequenza (vedi figura) le associazioni di costruttori concordarono agli inizi un valore di $f_{IF} = 10.7MHz$.
Questa scelta, come già detto, consente di usare come filtro di antenna un filtro a frequenza fissa che faccia passare tutto l'intervallo a radiofrequenza reiettando quello a frequenza immagine.
L'utilizzo per il filtro a radiofrequenza di un filtro fisso (eventualmente di tipo monolitico) permette
di contare su una forte reiezione nella banda bloccata (dove cade la frequenza immagine) e, quindi,
di immaginare una soluzione a singola conversione.

%Una volta traslato il segnale a frequenza $f_{IF} = 10.7MHz$ e filtrato il singolo canale, il demodulatore deve estrarre l'informazione che s causate dalle variazioni delle caratteristiche del canale.
Se si fa passare il segnale $V_{FM_{AFI}} = V_{FM} \cos[\omega_{IF}t + \theta(t) ]$ attraverso un derivatore si ottiene in uscita
\[
V_{FM} [\omega_{IF}+\dot\theta(t)] \sin[\omega_{IF}t + \theta(t)]
\]
ovvero, un segnale modulato in ampiezza oltre che in frequenza (si ricordi che $\omega_D \ll \omega_{RF}$, dunque
$\omega_{IF} + \dot\theta(t) > 0 $).

Tramite un rivelatore d'ampiezza si può estrarre l'inviluppo e, quindi, la sua componente variabile proporzionale a x(t). In definitiva il demodulatore può essere realizzato secondo lo schema a blocchi di figura 	\ref{fig:ricevitore-fm-architettura}.

\begin{figure}[hbt]
	\centering
	\raisebox{-.5\height}{\includegraphics[width=0.9\linewidth]{img/ricevitore-FM-architettura}}
	\caption{}
	\label{fig:ricevitore-fm-architettura}
\end{figure}

Non è richiesto il controllo automatico del guadagno purché l'ampiezza della portante sia in grado
di mandare in saturazione l'uscita del limitatore.
Mediante un filtro passa alto con limite inferiore di banda di alcuni Hertz, si può eliminare la componente continua.


Per risolvere il problema del fading che rende $V_{FM}$ una funzione dipendente, sia pure lentamente, dal tempo, si fa passare il segnale modulato, prima della demodulazione, attraverso un limitatore che produce in uscita un'onda quadra di ampiezza $2V_0$ picco-picco indipendentemente dall'ampiezza della portante. La tensione a onda quadra $V_U$ così ottenuta ( si ricordi che si tratta, comunque, di un'onda quadra modulata in frequenza a banda stretta) si filtra con un filtro passa banda centrato sulla frequenza $f_{IF}$ in modo da filtrare la componente spettrale centrata sulla prima armonica.

\subsubsection{Realizzazione del derivatore}

\begin{figure}[hbt]
	\hspace{\fill}
	\raisebox{-.5\height}{\includegraphics[width=0.5\linewidth]{img/ricevitore-FM}}
	\hspace{\fill}
	\raisebox{-.5\height}{\includegraphics[width=0.3\linewidth]{img/ricevitore-FM-caratteristica}}
	\hspace{\fill}
	\caption{}
	\label{fig:ricevitore-fm-derviatore-2}
\end{figure}

Esaminiamo adesso una possibile soluzione circuitale per
la realizzazione del derivatore. Si potrebbe usare un amplificatore trans-conduttivo con carico induttivo come realizzato mediante un FET, come illustrato in figura \ref{fig:ricevitore-fm-derviatore-2}. La tensione di uscita si può scrivere come
\[
V_U (t)= V_{DD} - L\frac{dI}{dt} = V_{DD} - L\frac{d}{dt} g_mV_{gs}(t) = V_{DD} - L g_m \dot V_{gs}(t)
\]
La caratteristica del derivatore è una retta con pendenza proporzionale ad L. Il guadagno di conversione dunque è tanto più elevato quanto più L è grande.

Come già discusso più volte, la realizzazione di induttanze affidabili e la loro integrazione sono operazioni difficoltose, dunque è vantaggioso sostituirle con un bipolo che presenti un andamento lineare della frequenza solo nella banda occupata dal segnale modulato. Questa funzione può essere assolta da un filtro RLC con una frequenza di risonanza prossima, ma non uguale a $f_{IF}$. Se $f_{IF}$ cade nella zona a sinistra della frequenza di risonanza in cui la pendenza risulta molto maggiore di L, si ottiene un significativo aumento del guadagno di conversione senza utilizzare induttanze di valore eccessivamente elevato.

Eventualmente al posto del carico risonante si potrebbe anche usare un quarzo (filtro monolitico) che presenta un Q elevato e quindi fianchi estremamente ripidi.

\begin{figure}[hbt]
	\hspace{\fill}
	\raisebox{-.5\height}{\includegraphics[width=0.5\linewidth]{img/ricevitore-FM-2}}
	\hspace{\fill}
	\raisebox{-.5\height}{\includegraphics[width=0.3\linewidth]{img/ricevitore-FM-caratteristica-2}}
	\hspace{\fill}
	\caption{}
	\label{fig:ricevitore-fm-derviatore-4}
\end{figure}


\subsubsection{FM stereo}

Come è noto la maggior parte delle stazioni che utilizzano questo servizio trasmettono un segnale audio stereofonico. Per garantire la compatibilità tra fra ricevitori predisposti e non, si opera una particolare codifica del segnale a partire da un segnale somma (canale destro + canale sinistro) e da un segnale differenza (canale destro - canale sinistro). Il segnale differenza viene modulato in ampiezza senza portante intorno ad una frequenza di $38 kHz$ e, quindi, sommato al segnale somma. Il segnale così ottenuto (che occupa una banda di $53 kHz$) viene quindi modulato in frequenza alla portante di trasmissione in modo da ottenere una banda di Carson di $180 kHz$ e, quindi, da occupare la stessa banda di un canale monofonico.

Un ricevitore FM non stereo sarà comunque in grado di ascoltare il segnale trasmesso: una volta effettuata la demodulazione sarà presente un filtro passa banda a $15kHz$ che selezionerà la sola componente somma.

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.8\linewidth]{img/trasmettitore-FM-stereo}
	\caption{Struttura del trasmettitore FM stereo}
	\label{fig:tx-fm-stereo}
\end{figure}

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.8\linewidth]{img/trasmettitore-FM-stereo-spettro}
	\caption{Spettro di un segnale FM stereo}
	\label{fig:spettro-fm-stereo}
\end{figure}

\begin{figure}[hbt]
	\centering
	\includegraphics[width=0.8\linewidth]{img/ricevitore-FM-stereo}
	\caption{Struttura del ricevitore FM stereo}
	\label{fig:rx-fm-stereo}
\end{figure}
%
%\subsection{avanzi di eterodina}
%Di solito il primo stadio amplificatore è differenziale. Può capitare di avere un balun (bilanciato a sbilanciato) subito dopo il filtro RF.
%
%Perché si filtra due volte, entrando e riuscendo dal chip ancora in RF?\\
%filtro ingresso attenua Freq. Imm. (un pochino) e arresta segnali broker (interferenti che potrebbero far saturare lo stadio ampli diff di ingresso). Siccome è molto performante (reiezione di tanti db sui bloker), attenua anche in banda e non attenua granché la frequenza immagine. Costruirlo che attenui anche la frequenza immagine ammazzerebbe il segnale (con effetti sulla cifra di rumore, è il primo stadio, vedi Friis)\\
%il filtro interno arresta quel che resta della frequenza immagine dopo aver amplificato il segnale.
%
%\begin{figure}[hb]
%	\centering
%	\includegraphics[width=0.7\linewidth]{img/raster/architettura-1}
%	\caption{cap e xtal non sono integrati}
%	\label{fig:architettura-1}
%\end{figure}

\appendix

%\chapter{Modulazioni numeriche (cenni)}
%
%\section{MSK - Minimum Shift Keying}
%Modulazione di frequenza (BFSK - Binary Frequency SK...), si può scrivere come:
%
%$$V_{MSK} cos \left[ \omega_0 t \pm 2 \pi \Delta f t \right]$$
%
%$$2 \pi \Delta f t = \Delta \omega$$
%
%$$\frac{1}{T_b} = f_b$$
%
%Si sceglie come $\Delta \omega$ il valore minimo a cui corrisponde una rotazione (durante la durata di un bit, tempo di segnalazione) pari a pi/2.
%
%$$\Delta \omega T_b = \frac{\pi}{2} \Rightarrow
%2 \pi \delta f = \frac{\pi }{2 T_b} \rightarrow
%\Delta f = \frac{f_b}{4}$$
%
%
%\begin{figure}[hbt]
%	\centering
%	\includegraphics[width=0.7\linewidth]{img/raster/MSK}
%	\caption{}
%	\label{fig:msk}
%\end{figure}
%
%\begin{figure}[hbt]
%	\centering
%	\includegraphics[width=0.45\linewidth]{img/raster/MSK1}
%	\includegraphics[width=0.45\linewidth]{img/raster/MSK2}
%	\caption{treno di rect (segnale da filtrare) e filtro gaussiano (in frequenza)}
%	\label{fig:msk1}
%\end{figure}
%
%Volendo ridurre l'occupazione in banda di una stringa di bit a impulsi rettangolari si filtrano. Per evitare ISI (a patto di campionare ammodo) si usa un filtro di Nyquist.
%
%Filtro Gaussiano: non di Nyquist (non annulla ISI), ma più tollerante al jitter (errore di campionamento). Si è deciso che è uno standard. Può essere implementato in maniera numerica (GMSK Gaussian MSK)
%
%
%\begin{figure}
%	\centering
%	\includegraphics[width=0.7\linewidth]{img/raster/screenshot001}
%	\caption{il sommatore poi in realtà fa una sottrazione}
%	\label{fig:screenshot001}
%\end{figure}
%
%
%
%Se si vuole usare un $\beta(t)$ per modulare in fase si può usare quel modulatore del capitolo precedente. Se si vuole usare $\beta(t)$ per modulare in frequenza prima si integra e poi si dà al modulatore.
%
%Modulazione numerica: il segnale modulante assume un numero discreto di valori. Può essere usato sempre questo modulatore. La blackbox è una LUT seguita da DAC.
%
%\paragraph{QPSK}
%
%$$V_{QPSK} = V_M cos (\omega_0 t + \theta_i) ~~~~~~ con \theta_i = 0, \nicefrac{\pi}{2}, \pi, \nicefrac{3}{2}\pi$$
%
%$$\beta(t) = \begin{cases}
%00\\
%01\\
%10\\
%11
%\end{cases}$$
%
%esempio: se $\beta(t) = \nicefrac{\pi}{2}$ allora le uscite dalla ... box sono $cos \beta_i \cdot \frac{2 \pi}{4}$ e $sin \beta_i \cdot \frac{2 \pi}{4}$.
%Siccome la fase ha salti bruschi si può voler usare un filtro sagomatore prima della LUT e si usa una LUT più grossa (boh?).
%Si riduce la banda (che sennò sarebbe teoricamente infinita).
%
%Vedi il disegnino sul pezzo di carta
%
%\paragraph{MSK}
%$$V_{FSK}(t) = V_m cos (\omega_0 t \pm 2\pi \Delta f t)$$
%
%È una MSK se $2\pi \Delta f T_b = \nicefrac{\pi}{2}$
%
%vedi disegnino sul pezzo di carta
%
%$$S_{u_I} ( i+1) = \begin{cases}
%S_{u_I} + 1 & se~S_I(i) = 1\\
%S_{u_I} - 1 & se~S_I(i) = 0
%\end{cases}$$
%
%(aggiunge 1 all'uscita se il sengnale in ingresso è 1, toglie 1 se l'ingresso è 0)
%
%16 celle corrispondono a 0-pi/2, siccome l'angolo giro è 2pi servono 16 x 4 celle per coprire tutto.
%
%\paragraph{GMSK} (Gaussian MSK)
%dopo il sovracampionamento c'è un filtro numerico gaussiano.
%
%\subsection{filtri numerici}
%Sistemi in grado di eseguire una manipolazione di un segnale numerico.
%
%Campiono il segnale di ingresso $S_i(t) \rightarrow S_i[n]$. Si immette in un DSP $\rightarrow S_u [k]$. Si riconverte in analogico $\rightarrow S_u(t)$. Con questa struttura si possono compiere operazioni analoghe a quelle fattibili con filtri analogici.\\
%Le operazioni fatte dal DSP su N campioni consistono solitamente in una somma di prodotti.
%(filtri FIR - Finite Impulse Response)
%(filtri IIR - Infinite Impulse Response - è tipo chiuso in reazione, l'uscita viene riportata in ingresso al DSP (ma è stato detto a chiacchiera sottovoce))
%
%Si può dimostrare che un filtro FIR è implementabile come somma di prodotti
%sugli N campioni $S_n$ (ordine N)
%
%$$S_{u_n} = \frac{a_{1} \cdot S_{n} + a_{2} \cdot S_{n+1} + ... + a_{N-1}  \cdot S_{n+N-1}}{N}$$
%
%con $\sum_{i=1}^{N} a_i \leq N$ (coefficienti del filtro)
%
%$$S_{u_{max}} = \frac{S_{max}(a_1+a_2+...+a_N)}{N}  ??$$
%Possibile spiegazione del precedente: il massimo dell'uscita è quando tutto il segnale è all'interno del filtro.
%
%\section{DFT}
%Algoritmo applicato ad N campioni (ottenuti da un segnale tempo continuo), che applica una trasformazione verso il dominio frequenziale (discretizzato).
%
%FFT - trasformata discreta applicabile su N campioni = potenza di 2. Più efficiente.
%prestazioni tipiche: 1024 $\div$ 2048 punti in frazioni di millisecondo.
%
%Il vettore che si ottiene in uscita rappresenta il valore della trasformata discreta di Fourier distanti fra loro $\Delta f = $ risoluzione in frequenza. Spettro fra $- \nicefrac{N}{2}\Delta f$ e $ \nicefrac{N}{2}\Delta f$. $\Delta f$ dipende dal record temporale T. Il segnale viene campionato a intervalli di tempo $T_C$, $T = N T_C$.
%"Minore" la risoluzione in frequenza, maggiore deve essere il record temporale.
%
%Per evitare effetti di aliasing bisogna che $f_C \geq 2 B_{max}$ (banda massima del segnale campionato), condizione di Nyquist.
%
%esempio: DSA HP/Agilent/Keysight (3562?)
%
%$$f_{C_max} = 256~ \nicefrac{kSa}{s} ~~~~~ N = 1024$$
%$$\Rightarrow T = N \cdot T_C = \frac{1024}{256~ \nicefrac{kSa}{s}} = 4ms$$
%$$\Delta f = \nicefrac{1}{T} = 250Hz ~~~~~ \frac{N \Delta f}{2} = 128kHz
%\mbox{ in realtà poi è 100kHz circa}$$
%
%Gli estremi di banda si scartano in quanto potenzialmente inaffidabili per effetti di aliasing dovuti a filtro antialiasing non perfettamente rettangolare.
%
%Lo strumento consente di diminuire la risoluzione in frequenza (es. fino a poche centinaia di $\mu Hz \Rightarrow T = \nicefrac{1}{\Delta F} = 4000 s$. $N_{max} = f_c \cdot 4000 = 1024 MSa$).
%Impossibile gestire questo numero di campioni: si fa un filtraggio antialiasing a frequenza più bassa (solitamente filtro numerico) e si fa una decimazione dei campioni ( = si campiona a frequenza più bassa).

\begin{comment}
\chapter{Formulario}
\section{Parametri Y}
	\begin{align*}
	\displaybreak[3]
	&Y_{IN} = Y_I - \frac{Y_F Y_R}{Y_O + Y_L}\\
	&Y_{OUT} = Y_O - \frac{Y_F Y_R}{Y_I + Y_S}\\
	\\
	&G_P = \frac{|Y_F|^2}{|Y_L + Y_O|^2} ~ \frac{g_L}{g_{IN}}\\
	&G_A = \frac{|Y_F|^2 ~ g_S}{\Re{ (Y_O Y_S + Y_O Y_I - Y_R Y_F)(Y_I + Y_S)^*}}\\
	&G_T = \frac{4 g_S g_L |Y_F|^2}{|(Y_S + Y_I) (Y_O + Y_L) - Y_R Y_F)|^2}\\
%	\\
	&K = \frac{2(g_I+g_S)(g_O + g_L)}{\Re{Y_R Y_F}	+  |Y_R Y_F|}\\
	&C = \frac{|Y_R Y_F|}{2 g_I g_O - \Re{Y_R Y_F}}
	\end{align*}
\begin{align*}
&g_{S_{opt}} = \frac{\sqrt{\left[
		2g_Ig_O - \Re{Y_RY_F} \right]^2
		-|Y_R Y_F|^2}}
{2g_O}\\
&g_{L_{opt}} = g_{S_{opt}} \frac{g_O}{g_I}\\
&b_{S_{opt}} = -b_I + \frac{\Im{Y_RY_F}}{2g_O}\\
&b_{L_{opt}} = -b_O + \frac{\Im{Y_RY_F}}{2g_I}
\end{align*}
	\begin{multicols}{2}
		\includegraphics[width=0.9\linewidth]{img/giacoletto}
		
		\[
		\begin{aligned}
		Y_{Ie} &
		= \nicefrac{1}{R_{b'e}} + j \omega (C_{b'e} + C_T)\\
		Y_{Re} &
		= - j \omega C_T\\
		Y_{Fe} &
		= g_m - j \omega C_T\\
		Y_{Oe} &
		= j \omega C_T
		\end{aligned}
		\]
	\end{multicols}
\newpage
\section{Parametri S}
	\begin{align*}
	\displaybreak[3]
	& \Gamma_{IN} = S_{11} + \frac{S_{12} S_{21} \Gamma_L}{1-S_{22}\Gamma_L}\\
	&\Gamma_{OUT} = S_{22} + \frac{S_{21} S_{12} \Gamma_S}{1-S_{11}\Gamma_S}
	\end{align*}
\subsubsection{Cerchi di stabilità}
	\begin{align*}
	\displaybreak[3]
	&
	D = \det \underline{\underline{S}} = S_{11} S_{22} - S_{21} S_{12}\\
	&
	\begin{dcases}
	C_S &= \frac{(S_{11} - S_{22}^*D)^*}{|S_{11}|^2 - |D|^2}\\
	r_S &= \frac{|S_{12}S_{21}|}{||D|^2 - |S_{11}|^2|}\\
	\end{dcases}
	\\
	&
	\begin{dcases}
	C_L &= \frac{(S_{22} - S_{11}^*D)^*}{|S_{22}|^2 - |D|^2}\\
	r_L &= \frac{|S_{12}S_{21}|}{||D|^2 - |S_{22}|^2|}\\
	\end{dcases}
	\\
	&
	\begin{dcases}
	K = \frac{1- |S_{11}|^2-|S_{22}|^2+|D|^2}{2 |S_{12} S_{21}|} > 1\\
	|D| = |S_{11} S_{22} - S_{21} S_{12}| < 1
	\end{dcases}
	\end{align*}
\subsubsection{Cerchi equi-guadagno ed equi-noise}
	\begin{align*}
	\displaybreak[3]
	&
	\overline{g}_P = \frac{\overline{G_P}}{|S_{21}|^2}\\
	&
	\begin{dcases}
	C_{P} =\frac{\overline{g}_P (S_{22} - S_{11}^* D)^*}
	{1+\overline{g}_P(|S_{22}|^2 - |D|^2)}\\
	r_{P} = {\frac{\sqrt{1 - 2 k |S_{12}S_{21}|\overline{g}_P + \overline{g}_P^2 |S_{12} S_{21}|^2}}{|1+\overline{g}_P(|S_{22}|^2 - |D|^2)|}}
	\end{dcases}
	\\
	\\
	&
	\overline{g}_A = \frac{\overline{G_A}}{|S_{21}|^2}
	\\
	&
	\begin{dcases}
	C_{A} =\frac{\overline{g}_A (S_{11} - S_{22}^* D)^*}
	{1+\overline{g}_A(|S_{11}|^2 - |D|^2)}\\
	r_{A} = {\frac{\sqrt{1 - 2 k |S_{12}S_{21}|\overline{g}_A + \overline{g}_A^2 |S_{12} S_{21}|^2}}{|1+\overline{g}_A(|S_{11}|^2 - |D|^2)|}}
	\end{dcases}
	\\
	\\
	&
	G_{TI} = \overline{G}_T \frac{|1-S_{11}\Gamma_{S}|^2}
	{|S_{21}|^2 (1-|\Gamma_S|^2)}
	\\
	&
	\begin{dcases}
	C_T = \frac{G_{TI}}{G_{TI}~|\Gamma_{OUT}|^2 + 1}\Gamma_{OUT}^*\\
	r_T = \sqrt{
		\frac{G_{TI}^2 |\Gamma_{OUT}|^2}{\left(G_{TI}|\Gamma_{OUT}|^2 +1\right) ^2} + 
		\frac{1 - G_{TI}}{G_{TI}|\Gamma_{OUT}|^2 +1}
	}		
	\end{dcases}
	\\
	\\
	&N_i = \frac{|\Gamma_S - \Gamma_{ON}|^2}{1-|\Gamma_{S}|^2}\\
	&C_i = \frac{\Gamma_{ON}}{1+N_i}\\
	&r_i = \sqrt{\frac{(1+N_i)N_i - N_i|\Gamma_{ON}|^2}{(1+N_i)^2}}\\
	&NF = NF_{MIN} + \frac{4r_n|\Gamma_{S}-\Gamma_{ON}|^2}{(1-|\Gamma_{S}|^2) |1+\Gamma_{ON}|^2}\\
	\end{align*}
\end{comment}

\end{document}
